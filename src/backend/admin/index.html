<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <meta name="theme-color" content="#000000">
    <base href="/admin/" />
    <title>CrossWord Backend</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    <main class="page">
        <header class="hero">
            <div>
                <p class="eyebrow">CrossWord</p>
                <h1>Endpoint Control Center</h1>
                <p class="lead">Manage user keys, AI + MCP settings, and backend storage.</p>
            </div>
            <div class="status" id="healthStatus">Health: unknown</div>
        </header>

        <section class="card">
            <h2>Access</h2>
            <div class="grid">
                <label>User ID <input type="text" id="userId"></label>
                <label>User Key <input type="password" id="userKey"></label>
                <label>Endpoint URL <input type="text" id="endpointUrl" placeholder="http://localhost:6065"></label>
                <label>Encrypt storage
                    <select id="encrypt">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                </label>
            </div>
            <div class="row">
                <button id="btnHealth" type="button">Check health</button>
                <button id="btnRegister" type="button">Register user</button>
                <button id="btnRotate" type="button">Rotate key</button>
                <button id="btnSaveLocal" type="button">Save to browser</button>
                <button id="btnLoadLocal" type="button">Load from browser</button>
            </div>
            <p id="accessMsg" class="msg"></p>
        </section>

        <section class="card">
            <h2>Users</h2>
            <div class="row">
                <button id="btnLoadUsers" type="button">Load users</button>
            </div>
            <table id="usersTable">
                <thead>
                    <tr><th>User ID</th><th>Encrypt</th><th>Created</th><th>Actions</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <p class="hint">Select a user to populate credentials; delete removes metadata only.</p>
        </section>

        <section class="card">
            <h2>AI Settings</h2>
            <div class="grid">
                <label>Base URL <input type="text" id="aiBaseUrl" placeholder="https://api.openai.com/v1"></label>
                <label>API Key <input type="password" id="aiApiKey" placeholder="sk-..."></label>
                <label>Model <input type="text" id="aiModel" placeholder="gpt-5.2"></label>
                <label>Custom Model <input type="text" id="aiCustomModel" placeholder="provider/model"></label>
                <label>Share Target
                    <select id="aiShareTarget">
                        <option value="analyze">analyze</option>
                        <option value="recognize">recognize</option>
                    </select>
                </label>
            </div>
        </section>

        <section class="card">
            <h2>MCP Servers</h2>
            <p class="hint">JSON array of servers: [{ id, serverLabel, origin, clientKey, secretKey }]</p>
            <textarea id="mcpJson" rows="6" spellcheck="false" placeholder='[{"id":"srv-1","serverLabel":"local","origin":"http://localhost:3001","clientKey":"","secretKey":""}]'></textarea>
        </section>

        <section class="card">
            <h2>Storage</h2>
            <div class="grid">
                <label>Prefer backend sync
                    <select id="preferBackendSync">
                        <option value="true">Backend</option>
                        <option value="false">WebDAV/local</option>
                    </select>
                </label>
                <label>WebDAV URL <input type="text" id="webdavUrl" placeholder="http://localhost:6065"></label>
                <label>WebDAV Username <input type="text" id="webdavUser"></label>
                <label>WebDAV Password <input type="password" id="webdavPass"></label>
                <label>WebDAV Token <input type="password" id="webdavToken"></label>
            </div>
            <div class="row">
                <button id="btnListStorage" type="button">List storage</button>
            </div>
            <pre id="storageOutput" class="output"></pre>
        </section>

        <section class="card">
            <h2>Actions</h2>
            <div class="row">
                <button id="btnLoadSettings" type="button">Load settings</button>
                <button id="btnSaveSettings" type="button">Save settings</button>
            </div>
            <p id="settingsMsg" class="msg"></p>
        </section>
    </main>

    <script type="module" src="./index.mjs"></script>
</body>
</html>
