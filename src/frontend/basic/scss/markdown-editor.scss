@use "../lib/mixins" as mixins;
@use "../lib/tokens" as tokens;
@use "../lib/config" as config;
@use "../lib/props";

@layer markdown-editor {
  // ============================================================================
  // MARKDOWN EDITOR COMPONENT STYLES
  // ============================================================================

  .markdown-editor-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    padding: var(--space-lg);
    max-block-size: 100%;
    background: var(--basic-surface-container);
    border-radius: var(--basic-radius-md);
    border: 1px solid color-mix(in oklab, var(--basic-outline) 25%, transparent);

    // Responsive padding
    @container (max-width: 1024px) {
      padding: var(--space-md);
      gap: var(--space-sm);
    }

    @container (max-width: 768px) {
      padding: var(--space-sm);
      gap: var(--space-xs);
    }

    @container (max-width: 480px) {
      padding: var(--space-xs);
    }

    // Simple hover effect
    &:hover {
      border-color: color-mix(in oklab, var(--basic-outline) 40%, transparent);
    }

    // Focus state
    &:focus-within {
      outline: 1px solid var(--basic-tertiary);
      outline-offset: -1px;
    }

    // Simple scrollbar
    scrollbar-width: thin;
    scrollbar-color: var(--basic-outline-variant) transparent;

    &::-webkit-scrollbar {
      width: 4px;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--basic-outline-variant);
    }
  }

  // ============================================================================
  // EDITOR HEADER
  // ============================================================================

  .editor-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-md);
    background: var(--basic-surface-container-high);
    border-radius: var(--basic-radius-sm);
    margin-bottom: var(--space-sm);

    @container (max-width: 768px) {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-sm);
      padding: var(--space-sm);
    }

    @container (max-width: 480px) {
      padding: var(--space-xs);
      gap: var(--space-xs);
    }

    h3 {
      margin: 0;
      font-size: var(--text-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--basic-on-surface);
      letter-spacing: -0.025em;
      line-height: var(--leading-tight);

      @container (max-width: 1024px) {
        font-size: var(--text-xl);
      }

      @container (max-width: 768px) {
        text-align: center;
        font-size: var(--text-lg);
      }
    }

    .editor-actions {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
      flex-wrap: wrap;

      // Responsive button layout
      @container (max-width: 640px) {
        gap: var(--space-xs);
      }

      @container (max-width: 480px) {
        justify-content: center;
        gap: var(--space-sm);
      }

      // Scrollable on very small screens
      @container (max-width: 360px) {
        overflow-x: auto;
        overflow-y: hidden;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        padding-bottom: var(--space-xs);

        &::-webkit-scrollbar {
          display: none;
        }

        flex-wrap: nowrap;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        padding: var(--space-xs) var(--space-md);
        border: 1px solid var(--basic-outline);
        border-radius: var(--basic-radius-sm);
        background: var(--basic-surface-container);
        color: var(--basic-on-surface);
        font-size: var(--text-sm);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        white-space: nowrap;
        min-height: 36px;

        @container (max-width: 640px) {
          padding: var(--space-xs);
          font-size: var(--text-xs);
          min-height: 32px;
        }

        &:hover {
          background: var(--basic-surface-container-high);
          border-color: var(--basic-tertiary);
        }

        &:focus-visible {
          outline: 1px solid var(--basic-tertiary);
          outline-offset: -1px;
        }

        &.primary {
          background: var(--basic-tertiary);
          color: var(--basic-on-tertiary);
          border-color: var(--basic-tertiary);

          &:hover {
            background: color-mix(in oklab, var(--basic-tertiary) 85%, black);
            border-color: color-mix(in oklab, var(--basic-tertiary) 85%, black);
          }
        }

        // Icon button variant
        &.btn-icon {
          padding: var(--space-sm);

          @container (max-width: 640px) {
            padding: var(--space-xs);
          }

          ui-phosphor-icon {
            flex-shrink: 0;
            transition: color var(--basic-motion-fast);
          }

          .btn-text {
            @container (max-width: 640px) {
              display: none;
            }
          }

          &:hover ui-phosphor-icon {
            color: var(--basic-tertiary);
          }

          &.primary:hover ui-phosphor-icon {
            color: var(--basic-on-tertiary);
          }
        }

        // Loading state
        &.loading {
          opacity: 0.7;
          pointer-events: none;

          &::after {
            content: "";
            width: 16px;
            height: 16px;
            border: 1px solid transparent;
            border-top: 1px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: var(--space-xs);
          }
        }
      }
    }
  }

  // ============================================================================
  // EDITOR LAYOUT
  // ============================================================================

  .editor-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
    flex: 1;
    min-height: 500px;

    // Split view
    &.split-view {
      grid-template-columns: 1fr 1fr;

      @container (max-width: 1024px) {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 1fr;
      }
    }

    @container (max-width: 768px) {
      gap: var(--space-md);
      min-height: 400px;
    }
  }

  // ============================================================================
  // EDITOR PANEL
  // ============================================================================

  .editor-panel {
    display: flex;
    flex-direction: column;
    background: var(--basic-surface);
    border-radius: var(--basic-radius-sm);
    border: 1px solid color-mix(in oklab, var(--basic-outline) 30%, transparent);
  }

  // Editor toolbar
  .editor-toolbar {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-sm);
    background: var(--basic-surface-container-high);
    border-bottom: 1px solid color-mix(in oklab, var(--basic-outline) 20%, transparent);
    overflow-x: auto;
    scrollbar-width: none;

    &::-webkit-scrollbar {
      display: none;
    }
  }

    .toolbar-group {
      display: flex;
      gap: var(--space-xs);
      align-items: center;
      flex-shrink: 0;

      .btn.small {
        padding: var(--space-xs) var(--space-sm);
        font-size: var(--text-xs);
        min-height: 32px;

        @container (max-width: 768px) {
          padding: 4px var(--space-xs);
          min-height: 28px;
        }
      }
    }
  }

  // Editor textarea
  .markdown-textarea {
    flex: 1;
    padding: var(--space-md);
    border: none;
    outline: none;
    background: transparent;
    color: var(--basic-on-surface);
    font-family: var(--font-family-mono);
    font-size: var(--text-sm);
    line-height: var(--leading-normal);
    resize: none;
    min-height: 250px;

    // Simple scrollbar
    scrollbar-width: thin;
    scrollbar-color: var(--basic-outline-variant) transparent;

    &::-webkit-scrollbar {
      width: 4px;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--basic-outline-variant);
    }

    // Placeholder styling
    &::placeholder {
      color: var(--basic-on-surface-variant);
      opacity: 0.7;
    }

    // Focus state
    &:focus {
      background: color-mix(in oklab, var(--basic-primary) 3%, var(--basic-surface));
    }

    @container (max-width: 768px) {
      padding: var(--space-sm);
      min-height: 200px;
    }
  }

  // Editor footer
  .editor-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-md) var(--space-lg);
    background: var(--basic-surface-container-high);
    border-top: 1px solid var(--basic-outline-variant);
    gap: var(--space-md);

    @container (max-width: 1024px) {
      padding: var(--space-sm) var(--space-md);
      gap: var(--space-sm);
    }

    @container (max-width: 768px) {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
    }

    .editor-stats {
      display: flex;
      gap: var(--space-lg);
      font-size: var(--text-sm);
      color: var(--basic-on-surface-variant);
      font-weight: var(--font-weight-medium);

      @container (max-width: 768px) {
        justify-content: center;
        gap: var(--space-xl);
      }

      @container (max-width: 480px) {
        flex-direction: column;
        gap: var(--space-xs);
        text-align: center;
      }

      .char-count,
      .word-count,
      .line-count {
        display: flex;
        align-items: center;
        gap: var(--space-xs);

        &::before {
          content: "üìù";
          font-size: var(--text-sm);
          opacity: 0.7;
        }
      }
    }

    .editor-actions {
      display: flex;
      gap: var(--space-sm);
      align-items: center;

      @container (max-width: 768px) {
        justify-content: center;
      }
    }

    .editor-mode {
      display: flex;
      gap: var(--space-xs);
      background: var(--basic-surface-container);
      border-radius: var(--basic-radius-md);
      padding: 2px;
      border: 0.5px solid color-mix(in oklab, var(--basic-outline) 15%, transparent);

      @container (max-width: 768px) {
        justify-content: center;
        width: 100%;
      }

      .btn.small {
        padding: var(--space-xs) var(--space-sm);
        border-radius: calc(var(--basic-radius-md) - 2px);
        background: transparent;
        border: none;
        box-shadow: none;
        min-height: 32px;

        &:hover {
          background: var(--basic-surface-container-high);
          transform: none;
        }

        &.active {
          background: var(--basic-primary);
          color: var(--basic-on-primary);
          font-weight: var(--font-weight-semibold);

          &:hover {
            background: color-mix(in oklab, var(--basic-primary) 85%, black);
          }
        }
      }
    }
  }

  // ============================================================================
  // PREVIEW PANEL
  // ============================================================================

  .preview-panel {
    display: flex;
    flex-direction: column;
    background: var(--basic-surface);
    border-radius: var(--basic-radius-lg);
    border: 1px solid var(--basic-outline);
    overflow: hidden;
    box-shadow: var(--basic-elev-1);

    @container (max-width: 768px) {
      border-radius: var(--basic-radius-md);
    }
  }

  .preview-header {
    padding: var(--space-md) var(--space-lg);
    background: var(--basic-surface-container-high);
    border-bottom: 1px solid var(--basic-outline-variant);

    @container (max-width: 768px) {
      padding: var(--space-sm) var(--space-md);
    }

    h4 {
      margin: 0;
      font-size: var(--text-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--basic-on-surface);

      @container (max-width: 768px) {
        font-size: var(--text-base);
        text-align: center;
      }
    }
  }

  .preview-content {
    flex: 1;
    overflow: auto;
    min-height: 300px;

    // Custom scrollbar
    scrollbar-width: thin;
    scrollbar-color: var(--basic-outline-variant) transparent;

    &::-webkit-scrollbar {
      width: 6px;
    }

    &::-webkit-scrollbar-thumb {
      background: var(--basic-outline-variant);
      border-radius: 3px;

      &:hover {
        background: var(--basic-outline);
      }
    }

    @container (max-width: 768px) {
      min-height: 250px;
    }
  }

  // ============================================================================
  // DARK THEME OVERRIDES
  // ============================================================================

  .basic-app[data-theme="dark"] .markdown-editor-container {
    .editor-header {
      background: var(--basic-surface-container-low);

      h3 {
        color: var(--basic-on-surface);
      }

      .btn {
        background: var(--basic-surface-container-low);
        border-color: var(--basic-outline);
        color: var(--basic-on-surface);

        &:hover {
          background: var(--basic-surface-container);
          border-color: var(--basic-tertiary);
        }

        &.primary {
          background: var(--basic-tertiary);
          color: var(--basic-on-tertiary);
          border-color: var(--basic-tertiary);

          &:hover {
            background: color-mix(in oklab, var(--basic-tertiary) 85%, black);
            border-color: color-mix(in oklab, var(--basic-tertiary) 85%, black);
          }
        }
      }
    }

    .editor-panel,
    .preview-panel {
      background: var(--basic-surface-container-low);
      border-color: var(--basic-outline);
    }

    .editor-toolbar {
      background: var(--basic-surface-container);
      border-color: var(--basic-outline);
    }

    .markdown-textarea {
      background: transparent;
      color: var(--basic-on-surface);

      &:focus {
        background: color-mix(in oklab, var(--basic-primary) 3%, var(--basic-surface-container-low));
      }

      &::placeholder {
        color: var(--basic-on-surface-variant);
      }
    }

    .editor-footer {
      background: var(--basic-surface-container);
      border-color: var(--basic-outline);

      .editor-stats {
        color: var(--basic-on-surface-variant);
      }

      .editor-mode {
        background: var(--basic-surface-container-low);
        border-color: var(--basic-outline);
      }
    }

    .preview-header {
      background: var(--basic-surface-container);
      border-color: var(--basic-outline);

      h4 {
        color: var(--basic-on-surface);
      }
    }
  }

  // ============================================================================
  // ANIMATIONS
  // ============================================================================

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  // Apply fade in to editor components
  .markdown-editor-container {
    animation: fadeInUp 0.4s ease-out;
  }
}