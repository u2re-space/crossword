@use "./config" as cfg;
@use "sass:math";

// ============================================================================
// RESPONSIVE & CONTAINER QUERY MIXINS
// ============================================================================

/// Container query mixin for responsive design
/// @param {String} $size - Container size (xs, sm, md, lg, xl, 2xl)
/// @param {String} $direction - Direction (min-width, max-width)
@mixin container-query($size, $direction: min-width) {
    @container (#{$direction}: #{cfg.config("container-sizes", $size)}) {
        @content;
    }
}

/// Media query mixin (use sparingly, prefer container queries)
/// @param {String} $size - Breakpoint size (xs, sm, md, lg, xl, 2xl)
/// @param {String} $direction - Direction (min-width, max-width)
@mixin media-query($size, $direction: min-width) {
    @media (#{$direction}: #{cfg.config("breakpoints", $size)}) {
        @content;
    }
}

/// Responsive spacing mixin
/// @param {String} $property - CSS property (margin, padding, etc.)
/// @param {Map} $sizes - Map of breakpoint -> size
@mixin responsive-spacing($property, $sizes) {
    @each $breakpoint, $size in $sizes {
        @if $breakpoint == "base" {
            #{$property}: cfg.config("spacing", $size);
        } @else {
            @include container-query($breakpoint) {
                #{$property}: cfg.config("spacing", $size);
            }
        }
    }
}

// ============================================================================
// LAYOUT & POSITIONING MIXINS
// ============================================================================

/// Flexbox utilities
/// @param {String} $direction - Flex direction
/// @param {String} $align - Align items
/// @param {String} $justify - Justify content
/// @param {String} $wrap - Flex wrap
@mixin flex($direction: row, $align: stretch, $justify: flex-start, $wrap: nowrap) {
    display: flex;
    flex-direction: $direction;
    align-items: $align;
    justify-content: $justify;
    flex-wrap: $wrap;
}

/// Grid utilities
/// @param {String|Number} $columns - Grid template columns
/// @param {String} $rows - Grid template rows
/// @param {String} $gap - Gap between items
@mixin grid($columns: 1, $rows: auto, $gap: 0) {
    display: grid;
    grid-template-columns: $columns;
    grid-template-rows: $rows;
    gap: $gap;
}

/// Centering utilities
@mixin center-absolute {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

@mixin center-flex {
    @include flex(row, center, center);
}

// ============================================================================
// LOGICAL PROPERTIES MIXINS
// ============================================================================

/// Logical sizing
/// @param {Length} $block-size - Block size (height)
/// @param {Length} $inline-size - Inline size (width)
/// @param {Length} $max-block-size - Max block size
/// @param {Length} $max-inline-size - Max inline size
@mixin logical-size($block-size: auto, $inline-size: auto, $max-block-size: none, $max-inline-size: none) {
    @if $block-size != auto {
        block-size: $block-size;
    }
    @if $inline-size != auto {
        inline-size: $inline-size;
    }
    @if $max-block-size != none {
        max-block-size: $max-block-size;
    }
    @if $max-inline-size != none {
        max-inline-size: $max-inline-size;
    }
}

/// Logical spacing (margins/padding)
/// @param {String} $property - Property type (margin, padding)
/// @param {Length} $block - Block direction spacing
/// @param {Length} $inline - Inline direction spacing
/// @param {Length} $block-start - Block start spacing
/// @param {Length} $block-end - Block end spacing
/// @param {Length} $inline-start - Inline start spacing
/// @param {Length} $inline-end - Inline end spacing
@mixin logical-spacing($property, $block: 0, $inline: 0, $block-start: null, $block-end: null, $inline-start: null, $inline-end: null) {
    @if $block-start != null {
        #{$property}-block-start: $block-start;
    }
    @if $block-end != null {
        #{$property}-block-end: $block-end;
    }
    @if $inline-start != null {
        #{$property}-inline-start: $inline-start;
    }
    @if $inline-end != null {
        #{$property}-inline-end: $inline-end;
    }
    @if $block-start == null and $block-end == null and $block != 0 {
        #{$property}-block: $block;
    }
    @if $inline-start == null and $inline-end == null and $inline != 0 {
        #{$property}-inline: $inline;
    }
}

/// Logical borders
/// @param {Length} $width - Border width
/// @param {String} $style - Border style
/// @param {Color} $color - Border color
/// @param {String} $sides - Which sides (all, block, inline, start, end)
@mixin logical-border($width: 1px, $style: solid, $color: currentColor, $sides: all) {
    @if $sides == "all" {
        border: $width $style $color;
    } @else if $sides == "block" {
        border-block: $width $style $color;
    } @else if $sides == "inline" {
        border-inline: $width $style $color;
    } @else if $sides == "block-start" {
        border-block-start: $width $style $color;
    } @else if $sides == "block-end" {
        border-block-end: $width $style $color;
    } @else if $sides == "inline-start" {
        border-inline-start: $width $style $color;
    } @else if $sides == "inline-end" {
        border-inline-end: $width $style $color;
    }
}

// ============================================================================
// TYPOGRAPHY MIXINS
// ============================================================================

/// Typography scale mixin
/// @param {String} $size - Font size key
/// @param {String} $weight - Font weight key
/// @param {String} $line-height - Line height key
/// @param {String} $letter-spacing - Letter spacing key
@mixin typography($size: base, $weight: normal, $line-height: normal, $letter-spacing: normal) {
    font-size: cfg.config("typography", "font-size", $size);
    font-weight: cfg.config("typography", "font-weight", $weight);
    line-height: cfg.config("typography", "line-height", $line-height);
    letter-spacing: cfg.config("typography", "letter-spacing", $letter-spacing);
}

/// Font family mixin
/// @param {String} $family - Font family type (sans, mono, emoji)
@mixin font-family($family: sans) {
    font-family: cfg.config("typography", "font-family", $family);
}

// ============================================================================
// INTERACTION & ANIMATION MIXINS
// ============================================================================

/// Interactive element base styles
/// @param {String} $cursor - Cursor type
/// @param {String} $touch-action - Touch action
@mixin interactive($cursor: pointer, $touch-action: manipulation) {
    cursor: $cursor;
    touch-action: $touch-action;
    user-select: none;
    -webkit-tap-highlight-color: transparent;

    &:focus-visible {
        outline: 2px solid cfg.config("colors", "focus");
        outline-offset: 2px;
    }
}

/// Hover and active states
/// @param {Color} $hover-bg - Hover background
/// @param {Color} $active-bg - Active background
/// @param {Number} $scale - Transform scale on hover
@mixin interactive-states($hover-bg: null, $active-bg: null, $scale: 1.02) {
    transition: all cfg.config("effects", "motion-fast");

    &:hover {
        @if $hover-bg != null {
            background-color: $hover-bg;
        }
        @if $scale != 1 {
            transform: scale($scale);
        }
    }

    &:active {
        @if $active-bg != null {
            background-color: $active-bg;
        }
        transform: scale(0.98);
    }
}

// ============================================================================
// UTILITY MIXINS
// ============================================================================

/// Scrollbar styling
/// @param {Length} $size - Scrollbar size
/// @param {Color} $thumb-color - Thumb color
/// @param {Color} $track-color - Track color
@mixin scrollbar($size: 8px, $thumb-color: rgba(0, 0, 0, 0.3), $track-color: transparent) {
    scrollbar-width: thin;
    scrollbar-color: $thumb-color $track-color;

    &::-webkit-scrollbar {
        inline-size: $size;
        block-size: $size;
    }

    &::-webkit-scrollbar-thumb {
        background-color: $thumb-color;
        border-radius: cfg.config("shape", "border-radius", "full");
    }

    &::-webkit-scrollbar-track {
        background-color: $track-color;
    }
}

/// Focus ring mixin
/// @param {Color} $color - Focus ring color
/// @param {Length} $width - Focus ring width
/// @param {Length} $offset - Focus ring offset
@mixin focus-ring($color: cfg.config("colors", "focus"), $width: 2px, $offset: 2px) {
    &:focus-visible {
        outline: $width solid $color;
        outline-offset: $offset;
    }
}

/// Truncate text with ellipsis
/// @param {Number} $lines - Number of lines (1 for single line, >1 for multiline)
@mixin truncate($lines: 1) {
    @if $lines == 1 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    } @else {
        display: -webkit-box;
        -webkit-line-clamp: $lines;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
}

/// Aspect ratio mixin
/// @param {Number} $ratio - Aspect ratio (width/height)
@mixin aspect-ratio($ratio) {
    aspect-ratio: $ratio;
}

// ============================================================================
// LEGACY COMPATIBILITY MIXINS
// ============================================================================

@mixin md-break($before: auto, $inside: auto, $after: auto) {
    break-before: $before;
    break-inside: $inside;
    break-after: $after;
}

@mixin md-heading-print($scale, $padding: null) {
    $resolved-padding: if($padding == null, cfg.config("heading", "padding"), $padding);
    $line-height: cfg.config("layout", "line-height");
    $h-size: calc(3 - clamp(1, sqrt($scale) * 0.9, 2));

    font-weight: bold;
    font-size: calc($h-size * 1em);
    padding-inline: $resolved-padding;
    margin-block-end: calc($h-size * 0.333em);
    margin-block-start: calc($h-size * 0.5em);
    display: block;
    line-height: $line-height;
    text-align: start;

    @include md-break(auto, avoid-page, avoid-page);
}

@mixin md-table-cell($padding: null) {
    $resolved-padding: if($padding == null, cfg.config("table", "cell-padding"), $padding);

    padding: $resolved-padding;
    white-space: normal;
}

@mixin md-font-smoothing($mode: always) {
    font-smooth: $mode !important;
    -webkit-font-smoothing: if($mode == always, subpixel-antialiased, antialiased) !important;
    -moz-osx-font-smoothing: if($mode == always, auto, grayscale) !important;
}

@mixin md-interactive-area($align: null, $touch: manipulation) {
    touch-action: $touch;
    pointer-events: auto;
    user-select: text;

    @if $align != null {
        text-align: $align;
    }
}

@mixin md-surface-root($align: start, $touch: manipulation) {
    color-scheme: inherit;
    font-size: inherit;
    isolation: isolate;

    @include md-interactive-area($align, $touch);
}

@mixin md-children-inherit($selector, $block-size: auto 1em) {
    #{$selector} {
        color-scheme: inherit;
        contain-intrinsic-block-size: $block-size;
    }
}

@mixin md-scrollbars($size: null) {
    $scroll-size: if($size == null, cfg.config("scrollbar", "size"), $size);
    $radius: cfg.config("shape", "border-radius");

    scrollbar-color: var(--color-scrollbar) transparent;
    scrollbar-width: thin;

    &::-webkit-scrollbar {
        inline-size: $scroll-size;
        block-size: $scroll-size;
    }

    &::-webkit-scrollbar-thumb {
        background-color: var(--color-scrollbar);
        border-radius: $radius;
    }

    &::-webkit-scrollbar-track {
        background-color: transparent;
    }
}

