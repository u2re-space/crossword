/**
 * Context-Based Custom Properties
 *
 * Defines CSS variables that change based on shell/view context.
 * Uses :has() pseudo-class to avoid specificity wars and enable
 * automatic cascading when DOM state changes.
 *
 * Wrapped in @layer to respect cascade layer order.
 */

@layer layer.shell.common {
    /**
     * Shell-agnostic tokens available in all shells
     * These are inherited by all child elements
     */
    :root {
        /* Layout dimensions */
        --shell-nav-height-base: 56px;
        --shell-content-gutter: 1rem;

        /* Color scheme defaults (light) */
        --shell-bg: var(--basic-surface);
        --shell-fg: var(--basic-on-surface);
        --shell-nav-bg: var(--basic-surface-container-high);
        --shell-nav-border: var(--basic-outline-variant);
    }

    /**
     * Dark mode overrides
     */
    @media (prefers-color-scheme: dark) {
        :root {
            --shell-bg: var(--basic-surface);
            --shell-fg: var(--basic-on-surface);
            --shell-nav-bg: var(--basic-surface-container-high);
            --shell-nav-border: var(--basic-outline-variant);
        }
    }

    /* ===================================================================== */
    /* SHELL-SPECIFIC CONTEXT SELECTORS                                     */
    /* ===================================================================== */

    /**
     * BasicShell Context
     * Applied when [data-shell="basic"] is present in DOM
     */
    :is(html, body):has([data-shell="basic"]) {
        /* Navigation */
        --shell-nav-height: var(--shell-nav-height-base);
        --shell-btn-hover: var(--basic-surface-container-highest);
        --shell-btn-active-bg: color-mix(in oklab, var(--basic-primary) 12%, transparent);
        --shell-btn-active-fg: var(--basic-primary);

        /* Status */
        --shell-status-bg: color-mix(in oklab, var(--basic-surface) 85%, var(--basic-on-surface));
        --shell-status-fg: var(--basic-on-primary);
    }

    /* Dark mode for BasicShell */
    @media (prefers-color-scheme: dark) {
        :is(html, body):has([data-shell="basic"]) {
            --shell-btn-hover: var(--basic-surface-container-highest);
            --shell-btn-active-bg: color-mix(in oklab, var(--basic-primary) 12%, transparent);
            --shell-btn-active-fg: var(--basic-primary);
            --shell-status-bg: color-mix(in oklab, var(--basic-surface) 85%, var(--basic-on-surface));
            --shell-status-fg: var(--basic-on-primary);
        }
    }

    /**
     * FaintShell Context
     * Applied when [data-shell="faint"] is present in DOM
     */
    :is(html, body):has([data-shell="faint"]) {
        --shell-nav-height: 40px;
        --shell-sidebar-width: 256px;
        --shell-sidebar-collapsed: 48px;
        --shell-tab-height: 32px;

        /* Faint-specific colors */
        --faint-nav-bg: var(--basic-surface-container-high);
        --faint-nav-border: var(--basic-outline-variant);
        --faint-sidebar-bg: var(--basic-surface-container-high);
    }

    @media (prefers-color-scheme: dark) {
        :is(html, body):has([data-shell="faint"]) {
            --faint-nav-bg: var(--basic-surface-container-high);
            --faint-nav-border: var(--basic-outline-variant);
            --faint-sidebar-bg: var(--basic-surface-container-high);
        }
    }

    /**
     * RawShell Context
     * Applied when [data-shell="raw"] is present in DOM
     */
    :is(html, body):has([data-shell="raw"]) {
        --shell-nav-height: 0px; /* No navbar in raw */
        --shell-content-padding: 0;
    }

    /* ===================================================================== */
    /* VIEW-SPECIFIC CONTEXT SELECTORS                                      */
    /* ===================================================================== */

    /**
     * Workcenter View Context
     * Applied when [data-view="workcenter"] is detected
     */
    :is(html, body):has([data-view="workcenter"]) {
        --view-layout: "grid";
        --view-sidebar-visible: true;
        --view-toolbar-expanded: true;
        --view-content-max-width: none;
    }

    /**
     * Viewer View Context
     */
    :is(html, body):has([data-view="viewer"]) {
        --view-layout: "flex";
        --view-content-max-width: 900px;
        --view-font-size-base: 1rem;
        --view-line-height-base: 1.6;
    }

    /**
     * Settings View Context
     */
    :is(html, body):has([data-view="settings"]) {
        --view-layout: "flex";
        --view-sidebar-visible: true;
        --view-content-max-width: 1200px;
    }

    /**
     * Explorer View Context
     */
    :is(html, body):has([data-view="explorer"]) {
        --view-layout: "flex";
        --view-sidebar-visible: true;
    }

    /**
     * Editor View Context
     */
    :is(html, body):has([data-view="editor"]) {
        --view-layout: "flex";
        --view-content-max-width: none;
    }

    /**
     * History View Context
     */
    :is(html, body):has([data-view="history"]) {
        --view-layout: "flex";
        --view-content-max-width: 1000px;
    }

    /**
     * Airpad View Context
     */
    :is(html, body):has([data-view="airpad"]) {
        --view-layout: "flex";
        --view-content-max-width: none;
    }

    /**
     * Home View Context
     */
    :is(html, body):has([data-view="home"]) {
        --view-layout: "flex";
        --view-content-max-width: 1200px;
    }

    /* ===================================================================== */
    /* COMBINED SHELL+VIEW CONTEXT                                          */
    /* ===================================================================== */

    /**
     * Workcenter in BasicShell
     * Applies only when both shell=basic AND view=workcenter
     */
    :is(html, body):has([data-shell="basic"] [data-view="workcenter"]) {
        --view-sidebar-position: "right";
        --view-toolbar-alignment: "end";
    }

    /**
     * Viewer in FaintShell
     * Faint shell shows tabbed views, so viewer gets tab styling
     */
    :is(html, body):has([data-shell="faint"] [data-view="viewer"]) {
        --view-tab-active: true;
        --view-tab-height: var(--shell-tab-height);
    }
}

/* ========================================================================= */
/* THEME OVERRIDES                                                         */
/* ========================================================================= */

@layer layer.override.theme {
    /**
     * High contrast mode support
     */
    @media (prefers-contrast: more) {
        :root {
            --shell-nav-border: #000;
            --shell-fg: #000;
        }

        @media (prefers-color-scheme: dark) {
            --shell-nav-border: #fff;
            --shell-fg: #fff;
        }
    }

    /**
     * Reduced motion support
     */
    @media (prefers-reduced-motion: reduce) {
        :root {
            --transition-fast: 0s;
            --transition-normal: 0s;
            --transition-slow: 0s;
        }
    }
}
