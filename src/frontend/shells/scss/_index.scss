@layer layer.shell.common {
    :root {
        /* Layout */
        --shell-nav-height-base: 56px;
        --shell-content-gutter: 1rem;

        /* Colors */
        --shell-bg: light-dark(var(--basic-surface), var(--basic-surface));
        --shell-fg: light-dark(var(--basic-on-surface), var(--basic-on-surface));
        --shell-nav-bg: light-dark(var(--basic-surface-container-high), var(--basic-surface-container-high));
        --shell-nav-border: light-dark(var(--basic-outline-variant), var(--basic-outline-variant));
    }

    /* Shell contexts */
    :is(html, body):has([data-shell="basic"]) {
        /* Layout */
        --shell-nav-height: var(--shell-nav-height-base);

        /* Colors */
        --shell-btn-hover: light-dark(var(--basic-surface-container-highest), var(--basic-surface-container-highest));
        --shell-btn-active-bg: color-mix(in oklab, var(--basic-primary) 12%, transparent);
        --shell-btn-active-fg: var(--basic-primary);
        --shell-status-bg: color-mix(in oklab, var(--basic-surface) 85%, var(--basic-on-surface));
        --shell-status-fg: var(--basic-on-primary);
    }

    :is(html, body):has([data-shell="faint"]) {
        /* Layout */
        --shell-nav-height: 40px;
        --shell-sidebar-width: 256px;
        --shell-sidebar-collapsed: 48px;
        --shell-tab-height: 32px;

        /* Colors */
        --faint-nav-bg: light-dark(var(--basic-surface-container-high), var(--basic-surface-container-high));
        --faint-nav-border: light-dark(var(--basic-outline-variant), var(--basic-outline-variant));
        --faint-sidebar-bg: light-dark(var(--basic-surface-container-high), var(--basic-surface-container-high));
    }

    :is(html, body):has([data-shell="raw"]) {
        --shell-nav-height: 0px;
        --shell-content-padding: 0;
    }

    /* View contexts */
    :is(html, body):has([data-view="workcenter"]) {
        --view-layout: "grid";
        --view-sidebar-visible: true;
        --view-toolbar-expanded: true;
        --view-content-max-width: none;
    }

    :is(html, body):has([data-view="viewer"]) {
        --view-layout: "flex";
        --view-content-max-width: 900px;
        --view-font-size-base: 1rem;
        --view-line-height-base: 1.6;
    }

    :is(html, body):has([data-view="settings"]) {
        --view-layout: "flex";
        --view-sidebar-visible: true;
        --view-content-max-width: 1200px;
    }

    :is(html, body):has([data-view="explorer"]) {
        --view-layout: "flex";
        --view-sidebar-visible: true;
    }

    :is(html, body):has([data-view="editor"]) {
        --view-layout: "flex";
        --view-content-max-width: none;
    }

    :is(html, body):has([data-view="history"]) {
        --view-layout: "flex";
        --view-content-max-width: 1000px;
    }

    :is(html, body):has([data-view="airpad"]) {
        --view-layout: "flex";
        --view-content-max-width: none;
    }

    :is(html, body):has([data-view="home"]) {
        --view-layout: "flex";
        --view-content-max-width: 1200px;
    }

    /* Combined shell + view */
    :is(html, body):has([data-shell="basic"] [data-view="workcenter"]) {
        --view-sidebar-position: "right";
        --view-toolbar-alignment: "end";
    }

    :is(html, body):has([data-shell="faint"] [data-view="viewer"]) {
        --view-tab-active: true;
        --view-tab-height: var(--shell-tab-height);
    }
}

@layer layer.override.theme {
    :root {
        /* Layout */
        --shell-nav-height: 48px;
        --shell-sidebar-width: 240px;
        --shell-sidebar-collapsed: 64px;
        --shell-status-height: 24px;
        --shell-toolbar-height: 40px;
        --shell-tab-height: 36px;

        /* Colors */
        --shell-bg: light-dark(var(--color-surface), var(--color-surface));
        --shell-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
        --shell-nav-bg: light-dark(var(--color-surface-elevated), var(--color-surface-elevated));
        --shell-nav-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
        --shell-sidebar-bg: light-dark(var(--color-surface), var(--color-surface));
        --shell-sidebar-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
        --shell-status-bg: light-dark(var(--color-surface-elevated), var(--color-surface-elevated));
        --shell-status-fg: light-dark(var(--color-text-secondary), var(--color-text-secondary));

        /* Borders */
        --shell-border-color: light-dark(var(--color-border), var(--color-border));
        --shell-divider-color: light-dark(var(--color-border), var(--color-border));

        /* Motion */
        --shell-transition: var(--transition-normal) var(--ease-in-out);
    }

    :is(:root, html):has([data-shell="raw"]) {
        --shell-nav-height: 0;
        --shell-sidebar-width: 0;
        --shell-status-height: 0;
        --shell-bg: light-dark(var(--color-surface), var(--color-surface));
        --shell-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
    }

    body:has([data-shell="raw"]) {
        overflow: hidden;
    }

    :is(:root, html):has([data-shell="basic"]) {
        --shell-nav-height: 48px;
        --shell-sidebar-width: 0;
        --shell-status-height: 24px;

        --shell-nav-bg: light-dark(var(--color-surface-elevated), var(--color-surface-elevated));
        --shell-nav-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
        --shell-nav-border: light-dark(var(--color-border), var(--color-border));
    }

    body:has([data-shell="basic"]) {
        padding-block-start: var(--shell-nav-height);
    }

    :is(:root, html):has([data-shell="basic"][data-theme="dark"]) {
        --shell-bg: var(--basic-surface);
        --shell-fg: var(--basic-on-surface);
        --shell-nav-bg: var(--basic-surface-container-high);
        --shell-nav-fg: var(--basic-on-surface);
        --shell-nav-border: var(--basic-outline-variant);
    }

    :is(:root, html):has([data-shell="faint"]) {
        --shell-nav-height: 0;
        --shell-sidebar-width: 240px;
        --shell-tab-height: 36px;
        --shell-toolbar-height: 40px;
        --shell-status-height: 24px;

        --shell-sidebar-bg: light-dark(var(--color-surface), var(--color-surface));
        --shell-sidebar-fg: light-dark(var(--color-on-surface), var(--color-on-surface));
        --shell-sidebar-border: light-dark(var(--color-border), var(--color-border));

        --shell-tabs-bg: light-dark(var(--color-surface-elevated), var(--color-surface-elevated));
        --shell-tab-active-bg: light-dark(var(--color-surface), var(--color-surface));
        --shell-tab-hover-bg: light-dark(var(--color-surface-hover), var(--color-surface-hover));
    }

    body:has([data-shell="faint"]) {
        margin-inline-start: var(--shell-sidebar-width);
    }

    :is(:root, html):has([data-shell="faint"][data-theme="dark"]) {
        --shell-bg: var(--basic-surface);
        --shell-fg: var(--basic-on-surface);
        --shell-sidebar-bg: var(--basic-surface-container-high);
        --shell-sidebar-fg: var(--basic-on-surface);
        --shell-sidebar-border: var(--basic-outline-variant);
        --shell-tabs-bg: var(--basic-surface-container-high);
        --shell-tab-active-bg: var(--basic-surface-container-highest);
        --shell-tab-hover-bg: var(--basic-surface-container-highest);
    }

    @media (prefers-contrast: more) {
        :root {
            --shell-nav-border: light-dark(#000000, #ffffff);
            --shell-fg: light-dark(#000000, #ffffff);
        }
    }

    @media (prefers-reduced-motion: reduce) {
        :root {
            --transition-fast: 0s;
            --transition-normal: 0s;
            --transition-slow: 0s;
        }
    }

    @media (max-width: 768px) {
        :is(:root, html):has([data-shell="faint"]) {
            --shell-sidebar-width: 0;
        }

        body:has([data-shell="faint"]) {
            margin-inline-start: 0;
        }

        :is(:root, html):has([data-shell="basic"]) {
            --shell-nav-height: 44px;
        }
    }

    @media print {
        :root {
            --shell-nav-height: 0;
            --shell-sidebar-width: 0;
            --shell-status-height: 0;
            --shell-bg: white;
            --shell-fg: black;
        }

        body:has([data-shell]) {
            margin: 0;
            padding: 0;
        }
    }
}