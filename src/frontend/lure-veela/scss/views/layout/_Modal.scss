@use "veela-lib" as *;
@use "../../library/mixins" as *;

//
@layer rs-forms-modal {

    //
    ui-modal {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;

        //
        @include solid-colorize("&", ("shade": var(--surface-opacity-subtle)));
    }

    //
    .rs-modal-backdrop {
        position: fixed;
        inset: 0;
        display: grid;
        place-content: center;
        place-items: center;
        padding: var(--space-xl);
        background: oklch(from black l c h / 0.22);
        z-index: 9999;
        backdrop-filter: blur(18px) saturate(120%);
        line-height: normal;

        //
        @media (pointer: coarse) {
            padding: calc(var(--space-xl) * 1.25);
        }
    }

    //
    .modal-form {
        --modal-radius: var(--radius-xl);
        --modal-shadow: 0 24px 60px rgba(12, 12, 16, 0.34);

        //
        min-inline-size: min(92vw, 33.75rem);
        max-inline-size: min(100%, 40rem);
        max-block-size: min(94vh, 45rem);
        inline-size: stretch;
        border-radius: var(--modal-radius);
        padding: var(--space-xl);
        box-shadow: var(--modal-shadow);
        backdrop-filter: blur(12px) saturate(120%);
        overflow: visible;
        line-height: normal;

        //
        @include vstack(var(--space-lg));
        @include container-inline;
        @include solid-colorize("&", ("shade": var(--surface-opacity-emphasis, 0.12)));
        @include scrollable("y");

        //
        & { scrollbar-color: color-mix(in oklch, var(--on-surface, currentColor) var(--scrollbar-tint, 86%), transparent) transparent; }

        //
        .modal-title {
            margin: 0;
            line-height: 1.2;
            place-content: center;
            place-items: center;
            text-align: center;

            //
            @include font-style("&", ("size": "xl", "weight": 700));
        }

        //
        .modal-description {
            margin: 0;
            background: transparent;
            place-content: center;
            place-items: center;
            text-align: center;

            //
            @include font-style("&", ("size": "base"));
        }

        //
        .modal-section {
            display: grid;
            gap: var(--space-sm);
            padding-block: var(--space-sm);
            inline-size: stretch;
            background: transparent;
            overflow: visible;
            block-size: max-content;

            &:last-of-type {
                border-block-end: none;
            }

            //
            .modal-section-title {
                margin: 0;
                place-content: center;
                place-items: center;
                text-align: center;

                //
                @include font-style("&", ("size": "sm", "weight": 600));
            }

            //
            .modal-section-fields {
                display: grid;
                gap: var(--space-sm);
            }
        }

        //
        .modal-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: var(--space-md);
            align-items: center;

            //
            .modal-actions-right {
                display: inline-flex;
                gap: var(--space-sm);
            }
        }

        //
        .modal-fields {
            padding-inline: var(--space-sm);
            max-block-size: min(62vh, 27.5rem);
            overflow-y: auto;
            overflow-x: hidden;

            //
            @include vstack(var(--space-md));
            @include container-inline;
            @include scrollbars(6px, var(--surface-opacity-emphasis));

            //
            .modal-field {
                & {
                    display: grid;
                    gap: var(--space-xs);
                    min-inline-size: 0;
                    background: transparent;
                    inline-size: stretch;
                    max-inline-size: stretch;
                    contain: inline-size;
                    container-type: inline-size;
                }

                //
                &:where(.valid, .invalid) {
                    animation: validationPulse 0.3s ease-in-out;
                }

                // Field Validation States
                &.valid :where(input, textarea, select) {
                    @include validation-success;
                }

                &.invalid :where(input, textarea, select) {
                    @include validation-error;
                }

                // Field Type Indicators
                &[data-multiline="true"] textarea {
                    min-block-size: 5rem;
                    resize: vertical;
                }

                &[data-numeric="true"] input {
                    text-align: end;
                    font-variant-numeric: tabular-nums;
                }

                &[data-json="true"] textarea {
                    font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;
                    font-size: 0.85em;
                    min-block-size: 6rem;
                    line-height: 1.4;
                }

                &[data-datetime="true"] {
                    position: relative;
                }

                // Links Field Enhancement
                & textarea[name="links"] {
                    min-block-size: 4rem;
                    font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;
                    font-size: 0.85em;
                    line-height: 1.4;
                }
            }

            //
            .contacts-group {
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
            }

            // Reduced motion support
            @media (prefers-reduced-motion: reduce) {
                .modal-field.valid,
                .modal-field.invalid {
                    animation: none;
                }

                .btn:hover:not(:disabled) {
                    transform: none;
                }
            }
        }
    }

    //
    // Container queries moved to separate file: _Modal.queries.scss

    //
    :where(.modal-toggle, .modal-sliders, .modal-sliders-group, .modal-container, .modal-main, .modal-controls) {
        display: flex;
        flex-direction: row;
        gap: 0.25rem;

        //
        @include solid-colorize("&", ("shade": var(--surface-opacity-subtle)));
    }
}
