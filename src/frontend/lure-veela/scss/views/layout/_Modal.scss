@use "veela-lib" as *;
@use "../../library/mixins" as ui;
@use "../../library/tokens" as t;

//
@layer rs-forms-modal {

    //
    ui-modal {
        display: flex;
        flex-direction: column;
        gap: var(--gap-xs);
        box-sizing: border-box;
        max-inline-size: min(100cqi, 100dvi);
        max-block-size: min(100cqb, 100dvb);

        @include ui.tonal-surface(surface-container-low, var(--surface-opacity-subtle), var(--radius-md));
    }

    //
    .rs-modal-backdrop {
        position: fixed;
        inset: 0;
        display: grid;
        place-content: center;
        place-items: center;
        padding: var(--space-xl);
        z-index: 9999;
        line-height: normal;
        overflow: hidden;
        box-sizing: border-box;
        max-inline-size: min(100cqi, 100dvi);
        max-block-size: min(100cqb, 100dvb);

        @include ui.glass-backdrop();
    }

    //
    .modal-form {
        min-inline-size: min(92vw, 33.75rem);
        max-inline-size: min(100%, 40rem);
        max-block-size: min(94vh, 45rem);
        inline-size: stretch;
        overflow: visible;
        line-height: normal;
        box-sizing: border-box;
        block-size: stretch;

        @include ui.card-surface(surface-container, var(--surface-opacity-emphasis), var(--radius-xl), var(--space-xl), 3);
        @include ui.vstack(var(--space-lg));
        @include ui.container-inline;
        @include scrollable("y");

        //
        &, &:focus-visible, &:focus { scrollbar-width: thin; scrollbar-color: color-mix(in oklch, var(--on-surface, currentColor) var(--scrollbar-tint, 86%), transparent) transparent; }

        //
        .modal-title {
            margin: 0;
            line-height: 1.2;
            place-content: center;
            place-items: center;
            text-align: center;

            //
            @include ui.text-heading("headline-small", center);
        }

        //
        .modal-description {
            margin: 0;
            background: transparent;
            place-content: center;
            place-items: center;
            text-align: center;

            //
            @include ui.text-body("body-medium");
        }

        //
        .modal-section {
            @include ui.section-stack(var(--space-sm));
            padding-block: var(--space-sm);
            background: transparent;
            overflow: visible;
            block-size: max-content;

            &:last-of-type {
                border-block-end: none;
            }

            //
            .modal-section-title {
                margin: 0;
                place-content: center;
                place-items: center;
                text-align: center;

                //
                @include ui.text-label("title-small", true);
            }

            //
            .modal-section-fields {
                @include ui.field-stack(var(--space-sm));
            }
        }

        //
        .modal-actions {
            @include ui.inline-toolbar(var(--space-md));
            justify-content: space-between;

            //
            .modal-actions-right {
                @include ui.inline-toolbar(var(--space-sm));
            }
        }

        //
        .modal-fields {
            padding-inline: var(--space-sm);
            max-block-size: min(62vh, 27.5rem);
            overflow-y: auto;
            overflow-x: hidden;

            @include ui.field-stack(var(--space-md));
            @include ui.container-inline;
            @include ui.scrollbars(6px, var(--surface-opacity-emphasis));

            //
            .modal-field {
                @include ui.field-stack(var(--space-xs));
                min-inline-size: 0;
                background: transparent;
                inline-size: stretch;
                max-inline-size: stretch;
                contain: inline-size;
                container-type: inline-size;

                //
                &:where(.valid, .invalid) {
                    animation: validationPulse 0.3s ease-in-out;
                }

                // Field Validation States
                &.valid :where(input, textarea, select) {
                    @include validation-success;
                }

                &.invalid :where(input, textarea, select) {
                    @include validation-error;
                }

                // Field Type Indicators
                &[data-multiline="true"] textarea {
                    min-block-size: 5rem;
                    resize: vertical;
                }

                &[data-numeric="true"] input {
                    text-align: end;
                    font-variant-numeric: tabular-nums;
                }

                &[data-json="true"] textarea {
                    font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;
                    font-size: 0.85em;
                    min-block-size: 6rem;
                    line-height: 1.4;
                }

                &[data-datetime="true"] {
                    position: relative;
                }

                // Links Field Enhancement
                & textarea[name="links"] {
                    min-block-size: 4rem;
                    font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;
                    font-size: 0.85em;
                    line-height: 1.4;
                }
            }

            //
            .contacts-group {
                display: flex;
                flex-direction: column;
                gap: var(--space-sm);
            }

            // Reduced motion support
            @media (prefers-reduced-motion: reduce) {
                .modal-field.valid,
                .modal-field.invalid {
                    animation: none;
                }

                .btn:where(:hover, :focus-visible):not(:disabled) {
                    transform: none;
                }
            }
        }
    }

    //
    // Container queries moved to separate file: _Modal.queries.scss

    //
    :where(.modal-toggle, .modal-sliders, .modal-sliders-group, .modal-container, .modal-main, .modal-controls) {
        display: flex;
        flex-direction: row;
        gap: var(--gap-xs);

        @include ui.tonal-surface(surface, var(--surface-opacity-subtle), var(--radius-md));
    }
}
