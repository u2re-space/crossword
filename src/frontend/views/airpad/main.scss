@layer reset, theme, layout, components, utilities;

/* ==========================================================================
   RESET LAYER - Global resets and base styles
   ========================================================================== */

@layer reset {
    *,
    *::before,
    *::after {
        box-sizing: border-box;
        font-variant-emoji: text;
    }

    html:has(.view-airpad) {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
    }

    body:has(.view-airpad) {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--on-surface);
        display: flex;
        flex-direction: column;
        min-block-size: 100vb;
        position: relative;
        line-height: 1.5;
    }
}

/* ==========================================================================
   THEME LAYER - Material You inspired color system and design tokens
   ========================================================================== */

@layer theme {
    :root:has(.view-airpad) {
        /* Material You color system - Enhanced with BeerCSS influences */
        --primary: #0061a4;
        --primary-container: #d1e4ff;
        --on-primary: #ffffff;
        --on-primary-container: #001d36;

        --secondary: #565f71;
        --secondary-container: #dae2f9;
        --on-secondary: #ffffff;
        --on-secondary-container: #131c2b;

        --tertiary: #705575;
        --tertiary-container: #fbd7fc;
        --on-tertiary: #ffffff;
        --on-tertiary-container: #28132e;

        --error: #ba1a1a;
        --error-container: #ffdad6;
        --on-error: #ffffff;
        --on-error-container: #410002;

        /* Enhanced surface system - Material Design 3 */
        --surface: #0f1419;
        --surface-variant: #1e2124;
        --surface-container: #1a1d20;
        --surface-container-low: #16191c;
        --surface-container-high: #1f2225;
        --surface-container-highest: #2a2d30;
        --on-surface: #e0e2e8;
        --on-surface-variant: #bfc8cc;

        /* Outline system - reduced contrast as requested */
        --outline: #40484c;
        --outline-variant: #2a3236;

        /* Enhanced shadow system - Material Design 3 elevation */
        --elevation-0: none;
        --elevation-1: 0 1px 2px 0 rgba(0, 0, 0, 0.30), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
        --elevation-2: 0 1px 2px 0 rgba(0, 0, 0, 0.30), 0 2px 6px 2px rgba(0, 0, 0, 0.15);
        --elevation-3: 0 1px 3px 0 rgba(0, 0, 0, 0.30), 0 4px 8px 3px rgba(0, 0, 0, 0.15);
        --elevation-4: 0 2px 3px 0 rgba(0, 0, 0, 0.30), 0 6px 10px 4px rgba(0, 0, 0, 0.15);
        --elevation-5: 0 4px 4px 0 rgba(0, 0, 0, 0.30), 0 8px 12px 6px rgba(0, 0, 0, 0.15);

        /* State layers - Enhanced Material You interaction states */
        --state-hover: rgba(255, 255, 255, 0.08);
        --state-focus: rgba(255, 255, 255, 0.12);
        --state-pressed: rgba(255, 255, 255, 0.10);
        --state-selected: rgba(255, 255, 255, 0.16);
        --state-dragged: rgba(255, 255, 255, 0.16);

        /* Enhanced spacing system - Material Design 3 */
        --space-0: 0;
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-10: 2.5rem;
        --space-12: 3rem;
        --space-16: 4rem;
        --space-20: 5rem;
        --space-24: 6rem;

        /* Enhanced border radius - Material You shape system */
        --radius-none: 0;
        --radius-xs: 0.25rem;
        --radius-sm: 0.5rem;
        --radius-md: 0.75rem;
        --radius-lg: 1rem;
        --radius-xl: 1.5rem;
        --radius-2xl: 2rem;
        --radius-3xl: 3rem;
        --radius-full: 9999px;

        /* Enhanced typography - Material Design 3 */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;
        --text-4xl: 2.25rem;
        --text-5xl: 3rem;

        --line-height-tight: 1.25;
        --line-height-normal: 1.5;
        --line-height-relaxed: 1.75;

        --font-weight-thin: 100;
        --font-weight-light: 300;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --font-weight-black: 900;

        /* Enhanced transitions - Material You motion */
        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow-in: 400ms cubic-bezier(0.05, 0.7, 0.1, 1);
        --transition-slow-out: 400ms cubic-bezier(0.3, 0, 0.8, 0.15);

        /* Additional Material You tokens */
        --motion-easing-standard: cubic-bezier(0.2, 0, 0, 1);
        --motion-easing-decelerate: cubic-bezier(0, 0, 0, 1);
        --motion-easing-accelerate: cubic-bezier(0.3, 0, 1, 1);
    }
}

/* ==========================================================================
   LAYOUT LAYER - Page layout and positioning
   ========================================================================== */

@layer layout {
    .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: var(--space-4) var(--space-4) calc(var(--space-16) + var(--space-6));
        gap: var(--space-4);
        inline-size: 100%;
        margin: 0 auto;
        position: relative;
    }

    .bottom-toolbar {
        position: fixed;
        inset-inline-start: var(--space-4);
        inset-block-end: var(--space-4);
        display: flex;
        gap: var(--space-3);
        align-items: center;
        z-index: 10;
    }
}

/* ==========================================================================
   COMPONENTS LAYER - Material You inspired component styles
   ========================================================================== */

@layer components {

    /* Primary button - Material Design 3 filled button */
    .primary-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        padding: var(--space-3) var(--space-6);
        border: none;
        border-radius: var(--radius-lg);
        background: var(--primary);
        color: var(--on-primary);
        font-family: inherit;
        font-size: var(--text-base);
        font-weight: var(--font-weight-medium);
        line-height: var(--line-height-tight);
        cursor: pointer;
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
        box-shadow: var(--elevation-1);
        transition: all var(--transition-fast);
        text-decoration: none;
        min-inline-size: 12rem;
        position: relative;
        overflow: hidden;

        &::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--state-hover);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        &:hover {
            box-shadow: var(--elevation-2);

            &::before {
                opacity: 1;
            }
        }

        &:active {
            box-shadow: var(--elevation-1);
            transform: scale(0.98);

            &::before {
                opacity: 0;
                background: var(--state-pressed);
            }
        }

        &:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
            box-shadow: var(--elevation-1), 0 0 0 4px color-mix(in srgb, var(--primary), transparent 25%);
        }

        &:disabled {
            opacity: 0.38;
            cursor: not-allowed;
            pointer-events: none;
            box-shadow: none;
            transform: none;

            &::before {
                display: none;
            }
        }
    }

    /* Toolbar button - Material Design 3 FAB */
    .toolbar-btn {
        inline-size: 3.5rem;
        block-size: 3.5rem;
        border-radius: var(--radius-2xl);
        background: var(--surface-container-high);
        border: none;
        color: var(--on-surface-variant);
        font-size: var(--text-xl);
        box-shadow: var(--elevation-3);
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;

        &::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--state-hover);
            opacity: 0;
            transition: opacity var(--transition-fast);
            border-radius: inherit;
        }

        &:hover {
            box-shadow: var(--elevation-4);
            transform: translateY(-1px);

            &::before {
                opacity: 1;
            }
        }

        &:active {
            box-shadow: var(--elevation-2);
            transform: scale(0.92) translateY(0);

            &::before {
                opacity: 0;
                background: var(--state-pressed);
            }
        }

        &:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
            box-shadow: var(--elevation-3), 0 0 0 4px color-mix(in srgb, var(--primary), transparent 25%);
        }
    }

    /* Status indicator - Material Design 3 chip/assist chip */
    .ws-status {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-1) var(--space-4);
        border-radius: var(--radius-2xl);
        font-size: var(--text-sm);
        font-weight: var(--font-weight-medium);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        box-shadow: var(--elevation-1);
        border: 1px solid transparent;
        position: relative;
        overflow: hidden;

        &::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(135deg, var(--outline-variant), transparent);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0.5;
        }

        &.ws-status-ok {
            background: color-mix(in srgb, var(--primary), transparent 12%);
            color: var(--primary);
            border-color: color-mix(in srgb, var(--primary), transparent 30%);
        }

        &.ws-status-bad {
            background: color-mix(in srgb, var(--error), transparent 12%);
            color: var(--error);
            border-color: color-mix(in srgb, var(--error), transparent 30%);
        }
    }

    /* Clipboard preview - Material You card */
    .clipboard-preview {
        position: fixed;
        inset-inline: var(--space-4);
        inset-block-end: calc(var(--space-16) + var(--space-4));
        z-index: 9;
        background: var(--surface);
        border: 1px solid var(--outline-variant);
        border-radius: var(--radius-lg);
        padding: var(--space-3) var(--space-4);
        font-size: var(--text-sm);
        color: var(--on-surface);
        max-inline-size: 47.5rem;
        margin: 0 auto;
        inset-inline-start: 50%;
        transform: translateX(-50%);
        inline-size: calc(100% - var(--space-8));
        max-block-size: 4rem;
        overflow: hidden;
        box-shadow: var(--elevation-3);
        display: none;

        &.visible {
            display: block;
        }

        .meta {
            font-size: var(--text-xs);
            color: var(--on-surface-variant);
            margin-block-end: var(--space-1);
        }

        .text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    }

    /* Configuration overlay - Material Design 3 dialog */
    .config-overlay {
        position: fixed;
        inset: 0;
        background: color-mix(in srgb, var(--shadow), transparent 40%);
        backdrop-filter: blur(12px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: var(--space-4);

        &.flex {
            display: flex;
        }
    }

    .config-panel {
        background: var(--surface-container-high);
        border: 1px solid var(--outline-variant);
        border-radius: var(--radius-2xl);
        padding: var(--space-6);
        max-inline-size: 28rem;
        inline-size: calc(100vw - var(--space-8));
        box-shadow: var(--elevation-5);
        animation: scaleIn 200ms cubic-bezier(0.4, 0, 0.2, 1);

        h3 {
            margin: 0 0 var(--space-6) 0;
            font-size: var(--text-2xl);
            font-weight: var(--font-weight-semibold);
            color: var(--on-surface);
            line-height: var(--line-height-tight);
        }
    }

    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .config-group {
        margin-block-end: var(--space-5);

        label {
            display: block;
            margin-block-end: var(--space-2);
            font-size: var(--text-sm);
            font-weight: var(--font-weight-medium);
            color: var(--on-surface);
            line-height: var(--line-height-normal);
        }

        input,
        textarea,
        select {
            inline-size: 100%;
            padding: var(--space-4) var(--space-4);
            background: var(--surface-container-highest);
            border: 1px solid var(--outline-variant);
            border-radius: var(--radius-lg);
            color: var(--on-surface);
            font-family: inherit;
            font-size: var(--text-base);
            transition: all var(--transition-fast);
            box-sizing: border-box;
            line-height: var(--line-height-normal);
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            pointer-events: auto;

            &:hover {
                background: var(--surface-container);
                border-color: var(--outline);
            }

            &:focus {
                outline: none;
                border-color: var(--primary);
                background: var(--surface-container-highest);
                box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary), transparent 20%);
            }

            &::placeholder {
                color: var(--on-surface-variant);
                opacity: 0.7;
            }

            &:invalid {
                border-color: var(--error);
                box-shadow: 0 0 0 3px color-mix(in srgb, var(--error), transparent 20%);
            }
        }
    }

    .config-actions {
        display: flex;
        gap: var(--space-3);
        margin-block-start: var(--space-6);
        justify-content: flex-end;

        button {
            padding: var(--space-3) var(--space-5);
            border: none;
            border-radius: var(--radius-lg);
            font-family: inherit;
            font-size: var(--text-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-inline-size: 6rem;

            &:first-child {
                background: var(--primary);
                color: var(--on-primary);

                &:hover {
                    background: color-mix(in srgb, var(--primary), black 8%);
                }

                &:active {
                    background: color-mix(in srgb, var(--primary), black 12%);
                    transform: scale(0.98);
                }
            }

            &:last-child {
                background: var(--surface-container-high);
                color: var(--on-surface-variant);
                border: 1px solid var(--outline-variant);

                &:hover {
                    background: var(--surface-container-highest);
                    border-color: var(--outline);
                }

                &:active {
                    background: color-mix(in srgb, var(--surface-container-high), var(--state-pressed));
                    transform: scale(0.98);
                }
            }

            &:focus-visible {
                outline: 2px solid var(--primary);
                outline-offset: 2px;
            }

            &:disabled {
                opacity: 0.38;
                cursor: not-allowed;
                pointer-events: none;
            }
        }
    }

    /* Log overlay - Material You dialog */
    .log-overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: color-mix(in srgb, var(--shadow), transparent 35%);
        backdrop-filter: blur(12px);
        z-index: 11;
        padding: var(--space-4);

        &.open {
            display: flex;
        }
    }

    .log-panel {
        inline-size: min(35rem, calc(100vw - var(--space-8)));
        max-block-size: calc(100vb - var(--space-8));
        background: var(--surface);
        border: 1px solid var(--outline-variant);
        border-radius: var(--radius-xl);
        box-shadow: var(--elevation-5);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .log-overlay-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-3) var(--space-4);
        border-block-end: 1px solid var(--outline-variant);
        font-size: var(--text-sm);
        font-weight: var(--font-weight-semibold);
    }

    .ghost-btn {
        padding: var(--space-2) var(--space-3);
        background: var(--surface-variant);
        color: var(--on-surface-variant);
        border: 1px solid var(--outline-variant);
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-size: var(--text-xs);

        &:active {
            filter: brightness(0.92);
        }
    }

    .log-container {
        flex: 1;
        padding: var(--space-4) var(--space-5);
        overflow-y: auto;
        font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
        font-size: var(--text-xs);
        line-height: 1.5;
        color: var(--on-surface);
        max-block-size: 25rem;
    }

    /* Hero section - Material Design 3 layout */
    .hero {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-4);
        inline-size: 100%;
        text-align: center;
        padding: var(--space-2) 0;

        h1 {
            margin: 0 0 var(--space-2) 0;
            font-size: var(--text-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--on-surface);
            line-height: var(--line-height-tight);
            letter-spacing: -0.025em;
        }

        .subtitle {
            font-size: var(--text-lg);
            color: var(--on-surface-variant);
            line-height: var(--line-height-normal);
            max-inline-size: 48rem;
            opacity: 0.87;
        }
    }

    .status-container {
        display: flex;
        flex-direction: row;
        place-content: center;
        place-items: center;
        gap: var(--space-2);
        flex-wrap: wrap;
    }

    /* Status bar - Material Design 3 layout */
    .status-bar {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: var(--space-4);
        font-size: var(--text-sm);
        color: var(--on-surface-variant);
        padding: var(--space-2) var(--space-4);
        background: var(--surface-container);
        border-radius: var(--radius-xl);
        border: 1px solid var(--outline-variant);

        .status-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-lg);
            background: var(--surface);

            span.value {
                font-weight: var(--font-weight-semibold);
                margin-inline-start: var(--space-1);
                font-variant-numeric: tabular-nums;
            }
        }
    }

    /* Big interactive buttons - Material Design 3 extended FAB style */
    .big-button {
        inline-size: 10rem;
        block-size: 10rem;
        border-radius: 50%;/*var(--radius-3xl);*/
        background: var(--surface-container-high);
        color: var(--on-surface);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        -webkit-user-select: none;
        touch-action: none;
        font-size: var(--text-xl);
        font-weight: var(--font-weight-semibold);
        box-shadow: var(--elevation-3);
        transition: all var(--transition-normal);
        border: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;

        &::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--state-hover);
            opacity: 0;
            transition: opacity var(--transition-fast);
            border-radius: inherit;
        }

        &:hover {
            box-shadow: var(--elevation-4);
            transform: translateY(-2px);

            &::before {
                opacity: 1;
            }
        }

        &:active {
            box-shadow: var(--elevation-2);
            transform: translateY(0) scale(0.96);

            &::before {
                opacity: 0;
                background: var(--state-pressed);
            }
        }

        &.active {
            box-shadow: var(--elevation-4), 0 0 0 6px color-mix(in srgb, var(--primary), transparent 15%);
            background: var(--primary-container);
            color: var(--on-primary-container);
        }

        &.air {
            background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--surface-container-high), color-mix(in srgb, var(--surface-container-high), var(--primary) 8%));

            &.active {
                background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--primary-container), var(--primary));
                color: var(--on-primary-container);
            }
        }

        &.ai {
            background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--surface-container-high), color-mix(in srgb, var(--surface-container-high), var(--secondary) 8%));

            &.active {
                background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--secondary-container), var(--secondary));
                color: var(--on-secondary-container);
                animation: pulse 2s infinite;
            }
        }

        &.air-move {
            background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--primary), color-mix(in srgb, var(--primary), black 10%));
            color: var(--on-primary);
        }

        &.ai.listening {
            background: radial-gradient(ellipse 80% 60% at 50% 20%, var(--error), color-mix(in srgb, var(--error), black 10%));
            color: var(--on-error);
            box-shadow: var(--elevation-4), 0 0 0 6px color-mix(in srgb, var(--error), transparent 15%);
        }
    }

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.air-block,
.ai-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    position: relative;
}

.air-row {
    display: flex;
    align-items: end;
    flex-direction: row;
    gap: 0.5rem;
    position: relative;
}

.neighbor-button {
    position: absolute;
    inset-inline-end: -4.5rem;
    inset-block-end: -1rem;
    transform: translate(-50%);
}

.ai-block {
    margin-block-end: 0.75rem;
}

.label {
    font-size: 1rem;
    color: #bfc8cc;
    text-align: center;
    line-height: 1.4;
}

.voice-line {
    inline-size: 100%;
    max-inline-size: 560px;
    font-size: 1rem;
    color: #e0e2e8;
    margin-block-start: 0.25rem;
    text-align: center;
    min-block-size: 18px;
}

.hint {
    font-size: 1rem;
    color: #bfc8cc;
    margin-block-start: 0.75rem;
    text-align: center;
    max-inline-size: 560px;
    display: flex;
    flex-direction: column;

    ul {
        padding-inline-start: 1.25rem;
        margin: 0.25rem 0 0;
    }

    li {
        margin-block-start: 0.25rem;
    }
}

    /* Stage layout - Material You layout */
    .stage {
        flex: 1;
        inline-size: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        gap: var(--space-8);
        min-block-size: 20rem;
        block-size: max-content;
    }

    .air-block,
    .ai-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-2);
    }

    .ai-block {
        margin-block-end: var(--space-3);
    }

    /* Label component - Material Design 3 body text */
    .label {
        font-size: var(--text-base);
        font-weight: var(--font-weight-medium);
        color: var(--on-surface-variant);
        text-align: center;
        line-height: var(--line-height-normal);
        opacity: 0.87;
    }

    /* Voice line - Material Design 3 display text */
    .voice-line {
        inline-size: 100%;
        max-inline-size: 40rem;
        font-size: var(--text-xl);
        font-weight: var(--font-weight-medium);
        color: var(--on-surface);
        margin-block-start: var(--space-2);
        text-align: center;
        min-block-size: 1.5rem;
        line-height: var(--line-height-tight);
        font-variant-numeric: tabular-nums;
        background: var(--surface-container);
        padding: var(--space-3) var(--space-4);
        border-radius: var(--radius-xl);
        border: 1px solid var(--outline-variant);
        position: relative;

        &::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--state-focus);
            opacity: 0;
            transition: opacity var(--transition-fast);
            border-radius: inherit;
        }

        &.listening {
            background: color-mix(in srgb, var(--secondary-container), transparent 20%);
            border-color: var(--secondary);

            &::before {
                opacity: 0.3;
                background: var(--secondary);
            }
        }
    }

    /* Hint section - Material Design 3 body text */
    .hint {
        font-size: var(--text-sm);
        color: var(--on-surface-variant);
        margin-block-start: var(--space-6);
        text-align: center;
        max-inline-size: 48rem;
        line-height: var(--line-height-relaxed);
        opacity: 0.8;

        ul {
            padding-inline-start: var(--space-6);
            margin: var(--space-3) 0 0;
            text-align: left;
            display: inline-block;
        }

        li {
            margin-block-start: var(--space-2);
            position: relative;
            padding-inline-start: var(--space-3);

            &::marker {
                color: var(--primary);
                font-weight: var(--font-weight-semibold);
            }

            &::before {
                content: '';
                position: absolute;
                inset-inline-start: 0;
                inset-block-start: 0.5em;
                inline-size: 4px;
                block-size: 4px;
                background: var(--primary);
                border-radius: var(--radius-full);
            }
        }
    }
}

/* ==========================================================================
   UTILITIES LAYER - Utility classes and responsive adjustments
   ========================================================================== */

@layer utilities {

.side-log-toggle {
    position: fixed;
    inset-inline-end: 1rem;
    inset-block-start: 50%;
    transform: translateY(-50%);
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    background: #40484c;
    color: #e0e2e8;
    border: 1px solid #40484c;
    border-radius: 1rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.30), 0 4px 8px 3px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 12;

    &:active {
        transform: translateY(-50%) scale(0.98);
    }
}

.neighbor-button {
    inline-size: 60px;
    block-size: 60px;
    border-radius: 9999px;
    background: #40484c;
    color: #e0e2e8;
    border: 1px solid #40484c;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.30), 0 2px 6px 2px rgba(0, 0, 0, 0.15);

    &:active {
        transform: scale(0.95);
        background: #353d41;
    }
}

.air-button-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

/* Virtual keyboard styles */
.keyboard-toggle {
    position: fixed;
    inset-block-end: 1.25rem;
    inset-inline-end: 1.25rem;
    inline-size: 56px;
    block-size: 56px;
    border-radius: 9999px;
    background: linear-gradient(135deg, #0061a4, #004d7a);
    color: white;
    border: none;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.30), 0 6px 10px 4px rgba(0, 0, 0, 0.15);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;

    &:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.30), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
    }
}

.keyboard-toggle-editable {
    caret-color: transparent;
    outline: none;
    color: transparent !important;
    text-shadow: none !important;
    overflow: hidden;

    &::before {
        content: '⌨️';
        position: absolute;
        inset-inline-start: 50%;
        inset-block-start: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 2;
        font-size: 24px;
        color: white;
        line-height: 1;
    }

    &:focus {
        caret-color: transparent;
    }

    &:focus::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 9999px;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        pointer-events: none;
        z-index: 1;
    }
}

.virtual-keyboard-container {
    position: fixed;
    inset: 0;
    //background: #0f1419;
    background: transparent;
    //border-block-start: 1px solid #40484c;
    //box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    transform: translateY(100%);
    transition: transform 250ms cubic-bezier(0.4, 0, 0.2, 1);
    max-block-size: 50vh;
    display: none;
    flex-direction: column;
    pointer-events: none;

    &.visible {
        transform: translateY(0);
    }
}

.keyboard-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0.75rem;
    border-block-end: 1px solid #40484c;
}

.keyboard-close {
    background: transparent;
    border: none;
    color: #bfc8cc;
    font-size: 20px;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    line-height: 1;

    &:active {
        color: #e0e2e8;
    }
}

.keyboard-tabs {
    display: flex;
    gap: 0.5rem;
}

.keyboard-tab {
    padding: 0.5rem 0.75rem;
    background: #40484c;
    border: none;
    border-radius: 0.75rem;
    color: #bfc8cc;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);

    &.active {
        background: #0061a4;
        color: white;
    }
}

.keyboard-content {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;
}

.keyboard-panel {
    display: none;

    &.active {
        display: block;
    }
}

.keyboard-shift-container {
    margin-block-end: 0.5rem;
}

.keyboard-shift {
    inline-size: 100%;
    padding: 0.5rem 1rem;
    background: #40484c;
    border: 1px solid #40484c;
    border-radius: 0.75rem;
    color: #bfc8cc;
    font-size: 1rem;
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);

    &.active {
        background: #0061a4;
        color: white;
    }
}

.keyboard-rows {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-block-end: 0.5rem;
}

.keyboard-row {
    display: flex;
    gap: 0.25rem;
    justify-content: center;
}

.keyboard-key {
    flex: 1;
    min-inline-size: 32px;
    max-inline-size: 48px;
    block-size: 44px;
    background: #40484c;
    border: 1px solid #40484c;
    border-radius: 0.75rem;
    color: #e0e2e8;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    touch-action: manipulation;
    user-select: none;

    &:active {
        background: #0061a4;
        color: white;
        transform: scale(0.95);
    }

    &.special {
        flex: 2;
        max-inline-size: none;
        font-size: 0.875rem;
    }

    &.space {
        flex: 4;
    }
}

.keyboard-special {
    display: flex;
    gap: 0.25rem;
    margin-block-start: 0.5rem;
}

.emoji-categories {
    display: flex;
    gap: 0.5rem;
    margin-block-end: 0.75rem;
    flex-wrap: wrap;
}

.emoji-category-btn {
    padding: 0.5rem 0.75rem;
    background: #40484c;
    border: none;
    border-radius: 0.75rem;
    color: #bfc8cc;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);

    &.active {
        background: #0061a4;
        color: white;
    }
}

.emoji-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
    gap: 0.5rem;
    max-block-size: 200px;
    overflow-y: auto;
}

.emoji-key {
    inline-size: 44px;
    block-size: 44px;
    background: #40484c;
    border: 1px solid #40484c;
    border-radius: 0.75rem;
    font-size: 24px;
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    touch-action: manipulation;
    display: flex;
    align-items: center;
    justify-content: center;

    &:active {
        background: #0061a4;
        transform: scale(0.95);
    }
}

/* Responsive adjustments */
@media (max-width: 520px) {
    .big-button {
        inline-size: 140px;
        block-size: 140px;
        border-radius: 9999px;
    }

    .neighbor-button {
        inline-size: 50px;
        block-size: 50px;
        border-radius: 9999px;
        font-size: 0.875rem;
    }

    .air-button-container {
        gap: 0.75rem;
    }

    .stage {
        gap: 1.5rem;
    }

    .side-log-toggle {
        inset-inline-end: 0.75rem;
    }

    .bottom-toolbar {
        inset-inline-start: 1rem;
        inset-block-end: 1rem;
        gap: 0.5rem;
    }

    .toolbar-btn {
        inline-size: 48px;
        block-size: 48px;
        border-radius: 1rem;
        font-size: 20px;
    }

    .clipboard-preview {
        inset-block-end: calc(4rem + 1rem);
    }

    .keyboard-toggle {
        inline-size: 48px;
        block-size: 48px;
        border-radius: 9999px;
        font-size: 20px;
        inset-block-end: 1rem;
        inset-inline-end: 1rem;
    }

    .virtual-keyboard-container {
        max-block-size: calc(100vh - 4rem);
    }

    .keyboard-key {
        min-inline-size: 28px;
        max-inline-size: 40px;
        block-size: 40px;
        font-size: 0.875rem;
    }

    .emoji-key {
        inline-size: 40px;
        block-size: 40px;
        font-size: 20px;
    }
}
}