/* ai-refactor: optimized/refactored at 2026-02-13T02:50:43Z */
/**
 * Markdown Veela Integration Module
 *
 * This module provides veela-lib integration for markdown styles.
 * It should only be imported when veela-lib is available.
 *
 * Usage:
 *   @use "./scss/markdown-veela" as veela;
 */

@use "veela-lib" as veela;

@layer tokens {
    :host,
    .markdown-body,
    #markdown,
    md-view {
        --md-fg-default: #{veela.theme-color("text-primary", "light")};
        --md-fg-muted: #{veela.theme-color("text-muted", "light")};
        --md-fg-accent: #{veela.theme-color("accent", "light")};
        --md-bg-default: #{veela.theme-color("surface", "light")};
        --md-bg-subtle: #{veela.theme-color("surface-container", "light")};
        --md-bg-code: #{veela.theme-color("code-bg", "light")};
        --md-border-default: #{veela.theme-color("border", "light")};
        --md-border-subtle: #{veela.theme-color("border-subtle", "light")};

        --md-font-body: #{veela.config("typography", "font-family", "sans")};
        --md-font-mono: #{veela.config("typography", "font-family", "mono")};

        font-size: #{veela.config("typography", "font-size", "base")};
        line-height: #{veela.config("layout", "line-height")};
    }

    .app-shell[data-theme="dark"] {
        :host,
        .markdown-body,
        #markdown,
        md-view {
            --md-fg-default: #{veela.theme-color("text-primary", "dark")};
            --md-fg-muted: #{veela.theme-color("text-muted", "dark")};
            --md-fg-accent: #{veela.theme-color("accent", "dark")};
            --md-bg-default: #{veela.theme-color("surface", "dark")};
            --md-bg-subtle: #{veela.theme-color("surface-container", "dark")};
            --md-bg-code: #{veela.theme-color("code-bg", "dark")};
            --md-border-default: #{veela.theme-color("border", "dark")};
            --md-border-subtle: #{veela.theme-color("border-subtle", "dark")};
        }
    }
}

@layer layout {
    .markdown-viewer-container {
        display: flex;
        flex-direction: column;
        min-height: 100%;
        max-height: 100%;
        overflow: hidden;
        background: var(--color-surface-container);
        box-shadow: var(--elev-1);
        transition: all var(--motion-normal);

        @container (max-width: 768px) {
            border-radius: var(--radius-lg);
            box-shadow: none;
        }

        &:hover {
            box-shadow: var(--elev-2);
        }

        &:focus-within {
            outline: none;
            box-shadow: var(--focus-ring), var(--elev-2);
        }
    }

    .markdown-viewer-container .viewer-content {
        position: relative;
        flex: 1;
        overflow: auto;
        background: var(--color-surface);
        scrollbar-width: thin;
        scrollbar-color: var(--color-outline-variant) transparent;

        &::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        &::-webkit-scrollbar-track {
            background: transparent;
        }

        &::-webkit-scrollbar-thumb {
            background: var(--color-outline-variant);
            border-radius: 4px;

            &:hover {
                background: var(--color-outline);
            }
        }
    }
}

@layer components {
    .markdown-viewer-container .viewer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-shrink: 0;
        gap: var(--space-lg);
        padding: var(--space-lg) var(--space-xl);
        background: var(--color-surface-container-high);

        @container (max-width: 768px) {
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
        }

        @container (max-width: 480px) {
            flex-direction: column;
            align-items: stretch;
            gap: var(--space-sm);
        }

        h3 {
            margin: 0;
            color: var(--color-on-surface);
            font-size: var(--text-xl);
            font-weight: var(--font-weight-semibold);
            line-height: var(--leading-tight);
            letter-spacing: -0.025em;

            @container (max-width: 768px) {
                font-size: var(--text-lg);
            }
        }

        .viewer-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            flex-wrap: wrap;

            @container (max-width: 640px) {
                gap: var(--space-xs);
            }

            @container (max-width: 480px) {
                justify-content: center;
                gap: var(--space-sm);
            }

            @container (max-width: 360px) {
                overflow-x: auto;
                overflow-y: hidden;
                padding-bottom: var(--space-xs);
                flex-wrap: nowrap;
                scrollbar-width: none;
                -webkit-overflow-scrolling: touch;

                &::-webkit-scrollbar {
                    display: none;
                }
            }
        }
    }

    .markdown-viewer-container .viewer-actions .viewer-btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        min-height: 44px;
        padding: var(--space-sm) var(--space-lg);
        border: none;
        border-radius: var(--radius-lg);
        background: var(--color-surface-container);
        color: var(--color-on-surface);
        font-size: var(--text-sm);
        font-weight: var(--font-weight-medium);
        white-space: nowrap;
        cursor: pointer;
        transition: all var(--motion-fast);

        @container (max-width: 640px) {
            min-height: 40px;
            padding: var(--space-xs) var(--space-md);
            font-size: var(--text-xs);
        }

        @container (max-width: 480px) {
            min-height: 44px;
            padding: var(--space-sm) var(--space-md);
        }

        &:hover {
            background: var(--color-surface-container-highest);
            transform: translateY(-1px);
            box-shadow: var(--elev-1);
        }

        &:active {
            transform: translateY(0);
            box-shadow: none;
        }

        &:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        &.btn-icon {
            padding: var(--space-sm);

            @container (max-width: 640px) {
                padding: var(--space-xs);
            }

            ui-icon {
                flex-shrink: 0;
                transition: color var(--motion-fast);
            }

            .btn-text {
                @container (max-width: 640px) {
                    display: none;
                }
            }

            &:hover ui-icon {
                color: var(--color-primary);
            }
        }

        &.loading {
            opacity: 0.7;
            pointer-events: none;

            &::after {
                content: "";
                width: 16px;
                height: 16px;
                margin-left: var(--space-xs);
                border: 2px solid transparent;
                border-top: 2px solid currentColor;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
        }
    }

    .markdown-viewer-container .viewer-content .markdown-viewer-content {
        min-height: 100%;
        padding: var(--space-2xl) var(--space-xl);
        overflow-wrap: break-word;
        word-wrap: break-word;
        color: var(--color-on-surface);
        line-height: var(--leading-relaxed);
        font-family: var(--font-family-system);
        font-size: var(--text-base);
        font-weight: var(--font-weight-normal);
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;

        @container (max-width: 1024px) {
            padding: var(--space-xl) var(--space-lg);
        }

        @container (max-width: 768px) {
            padding: var(--space-lg) var(--space-md);
        }

        @container (max-width: 480px) {
            padding: var(--space-md) var(--space-sm);
        }

        &::selection {
            background: color-mix(in oklab, var(--color-primary) 20%, transparent);
            color: var(--color-on-primary);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: var(--space-2xl) 0 var(--space-lg);
            color: var(--color-on-surface);
            font-weight: var(--font-weight-semibold);
            line-height: var(--leading-tight);
            letter-spacing: -0.025em;

            &:first-child {
                margin-top: 0;
            }

            @container (max-width: 768px) {
                margin: var(--space-xl) 0 var(--space-md);
            }
        }

        h1 {
            font-size: var(--text-3xl);
        }

        h2 {
            font-size: var(--text-2xl);
        }

        h3 {
            font-size: var(--text-xl);
        }

        h4 {
            font-size: var(--text-lg);
        }

        h5 {
            font-size: var(--text-base);
        }

        h6 {
            font-size: var(--text-sm);
        }

        p {
            margin: 0 0 var(--space-lg);
            color: var(--color-on-surface);

            &:last-child {
                margin-bottom: 0;
            }
        }

        a {
            color: var(--color-primary);
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 2px;
            transition: all var(--motion-fast);

            &:hover {
                color: var(--color-primary);
                text-decoration-thickness: 2px;
            }

            &:focus-visible {
                outline: none;
                border-radius: var(--radius-sm);
                box-shadow: var(--focus-ring);
            }
        }

        ul,
        ol {
            margin: var(--space-lg) 0;
            padding-left: var(--space-2xl);
            color: var(--color-on-surface);

            @container (max-width: 480px) {
                padding-left: var(--space-xl);
            }

            li {
                margin-bottom: var(--space-sm);

                &:last-child {
                    margin-bottom: 0;
                }
            }
        }

        blockquote {
            position: relative;
            margin: var(--space-xl) 0;
            padding: var(--space-lg) var(--space-xl);
            border-left: 4px solid var(--color-primary);
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
            background: var(--color-surface-container-low);
            color: var(--color-on-surface);
            font-style: italic;

            @container (max-width: 768px) {
                margin: var(--space-lg) 0;
                padding: var(--space-md) var(--space-lg);
            }

            &::before {
                content: '"';
                position: absolute;
                top: var(--space-sm);
                left: var(--space-sm);
                color: var(--color-primary);
                font-size: var(--text-2xl);
                opacity: 0.3;
            }
        }

        pre {
            margin: var(--space-xl) 0;
            padding: var(--space-lg);
            overflow-x: auto;
            border: 1px solid var(--color-outline);
            border-radius: var(--radius-lg);
            background: var(--color-surface-container-high);
            color: var(--color-on-surface);
            font-family: var(--font-family-mono);
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
            scrollbar-width: thin;
            scrollbar-color: var(--color-outline) transparent;

            @container (max-width: 768px) {
                margin: var(--space-lg) 0;
                padding: var(--space-md);
            }

            &::-webkit-scrollbar {
                height: 6px;
            }

            &::-webkit-scrollbar-thumb {
                background: var(--color-outline);
                border-radius: 3px;
            }

            code {
                padding: 0;
                border-radius: 0;
                background: none;
                color: inherit;
                font-family: inherit;
                font-size: inherit;
            }
        }

        code:not(pre code) {
            padding: 0.125rem 0.375rem;
            border: 1px solid var(--color-outline);
            border-radius: var(--radius-sm);
            background: var(--color-surface-container-high);
            color: var(--color-on-surface);
            font-family: var(--font-family-mono);
            font-size: 0.875em;
            font-weight: var(--font-weight-medium);
        }

        table {
            width: 100%;
            margin: var(--space-xl) 0;
            overflow: hidden;
            border-collapse: collapse;
            border: 1px solid var(--color-outline);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);

            @container (max-width: 768px) {
                margin: var(--space-lg) 0;
                font-size: var(--text-xs);
            }

            th,
            td {
                padding: var(--space-md) var(--space-lg);
                border-bottom: 1px solid var(--color-outline);
                color: var(--color-on-surface);
                text-align: left;

                @container (max-width: 768px) {
                    padding: var(--space-sm) var(--space-md);
                }
            }

            th {
                background: var(--color-surface-container-high);
                color: var(--color-on-surface);
                font-weight: var(--font-weight-semibold);
            }

            tbody tr {
                &:hover {
                    background: var(--color-surface-container-low);
                }

                &:last-child td {
                    border-bottom: none;
                }
            }
        }

        hr {
            position: relative;
            margin: var(--space-2xl) 0;
            border: none;
            border-top: 1px solid var(--color-outline);

            &::before {
                content: "";
                position: absolute;
                top: -1px;
                left: 50%;
                width: 60px;
                height: 1px;
                transform: translateX(-50%);
                background: var(--color-primary);
            }
        }

        img {
            max-width: 100%;
            height: auto;
            margin: var(--space-lg) 0;
            border-radius: var(--radius-md);
            box-shadow: var(--elev-1);

            @container (max-width: 768px) {
                margin: var(--space-md) 0;
            }
        }

        input[type="checkbox"] {
            margin-right: var(--space-sm);
            accent-color: var(--color-primary);
        }

        .katex {
            color: var(--color-on-surface);
            font-size: 1.1em;
        }

        .footnote-ref a {
            color: var(--color-primary);
            font-size: 0.8em;
            vertical-align: super;
        }

        dl {
            margin: var(--space-lg) 0;

            dt {
                margin-bottom: var(--space-xs);
                color: var(--color-on-surface);
                font-weight: var(--font-weight-semibold);
            }

            dd {
                margin: 0 0 var(--space-md) var(--space-xl);
                color: var(--color-on-surface-variant);
            }
        }
    }
}