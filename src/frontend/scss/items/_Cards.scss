@mixin make-wraps {
    flex-wrap: wrap;
    overflow-wrap: break-word;
    text-wrap: pretty;
    text-align: justify;
    text-overflow: ellipsis;
    text-spacing-trim: trim-start;
    word-wrap: break-word;
    word-break: break-word;
    white-space: normal;
    hyphens: auto;
    list-style-position: inside;
    font-variant-numeric: tabular-nums;
}

@mixin can-wrap-text {
    @include make-wraps;

    br {
        display: block;
        white-space: pre-line;
        content: "\A\n\r,";
        overflow-wrap: break-word;
        inline-size: stretch;
        line-height: inherit;
    }

    :where(span, a)::first-letter {
        text-transform: uppercase;
    }

    span, a {
        font-size: 0.7rem;
        display: inline-block;
        line-height: inherit;
        @include make-wraps;
    }

    :where(a) { text-transform: math-auto; }
    :where(ul, li, span, p):empty { display: none; }
    :where(ul, li, span)::marker { margin: 0; padding: 0; }
}

//
@layer rs-cards {
    :root {
        --card-gap: 0.5rem;
        --card-radius: 0.75rem;
        --card-padding: 0.75rem;
        --card-avatar-size: 40px;
    }

    [data-type="day"] {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        background-color: --c2-surface(0.0, var(--current, currentColor));
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: oklch(from --c2-on-surface(0.0, var(--current, currentColor)) l c h / 0.4) transparent;
    }

    [data-type="tasks"],
    [data-type="contacts"],
    [data-type="bonuses"],
    [data-type="services"] {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        grid-auto-rows: minmax(0px, max-content);
        grid-auto-flow: row;
        column-fill: balance;
        gap: var(--card-gap);
        align-items: start;

        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: oklch(from --c2-on-surface(0.0, var(--current, currentColor)) l c h / 0.4) transparent;
    }


    [data-type="preferences"],
    [data-type="quests"] {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        background-color: --c2-surface(0.0, var(--current, currentColor));

        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: oklch(from --c2-on-surface(0.0, var(--current, currentColor)) l c h / 0.4) transparent;
    }

    .card {
        li {
            font-size: inherit;
            color: currentColor;
            padding: 0;
            margin: 0;
            display: inline;
        }

        & {
            display: grid;
            grid-template-columns: minmax(0px, max-content) minmax(0px, 1fr) minmax(0px, max-content) minmax(0px, max-content);
            grid-auto-rows: minmax(0px, max-content);
            grid-auto-flow: column;
            column-fill: balance;
            align-items: center;
            gap: 1rem;
            row-gap: 0.5rem;
            padding: var(--card-padding);
            border-radius: var(--card-radius);
            background-color: --c2-surface(0.16, var(--current, currentColor));
            color: --c2-on-surface(0.0, var(--current, currentColor));
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
            transition: box-shadow 160ms ease, transform 160ms ease, background-color 160ms ease;
            touch-action: manipulation;
            user-select: none;
            inline-size: stretch;
            order: var(--card-order, initial);
        }

        & *:not(ui-icon, br, ui-longtext, input):empty {
            display: none;
        }

        & * {
            pointer-events: none;
            user-select: none;
        }

        & {
            background-color: --c2-surface(0.02, var(--current, currentColor));
            --current: oklch(from var(--primary, currentColor) l c calc(h + 0) / 1);
        }

        &[data-variant] {
            background-color: --c2-surface(0.1, var(--current, currentColor));
        }

        &:not([data-variant]), &[data-variant="default"] {
            background-color: --c2-surface(0.02, var(--current, currentColor));
            --current: oklch(from var(--primary, currentColor) l c calc(h + 0) / 1);
        }

        //
        &[data-variant="purple"] { --current: oklch(from var(--primary, currentColor) l c calc(h + 0) / 1); }
        &[data-variant="green"] { --current: oklch(from var(--primary, currentColor) l c calc(h + 60) / 1); }
        &[data-variant="blur"] { --current: oklch(from var(--primary, currentColor) l c calc(h + 120) / 1); backdrop-filter: blur(8px) saturate(120%); }

        &[data-open] {
            box-shadow: 0 10px 24px rgba(0,0,0,0.16);
        }

        &:hover { box-shadow: 0 6px 18px rgba(0,0,0,0.12); }
        &[data-open] { box-shadow: 0 10px 24px rgba(0,0,0,0.16); }

        .card-avatar {
            inline-size: var(--card-avatar-size);
            block-size: var(--card-avatar-size);
            min-inline-size: var(--card-avatar-size);
            grid-column: 1 / 1 span;
            border-radius: 50%;
            line-height: 0;
            display: grid;
            place-content: center;
            place-items: center;
            //background-color: --c2-surface(0.08, var(--current, currentColor));
            background-image: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.03));
            box-shadow: 0 2px 6px rgba(0,0,0,0.08) inset;
            aspect-ratio: 1 / 1;

            background-color: --c2-on-surface(-0.4, var(--current, currentColor));
            color: --c2-surface(0, var(--current, currentColor));
            --icon-color: --c2-surface(0, var(--current, currentColor));
        }

        .card-avatar .avatar-inner { font-weight: 700; font-size: 1rem; }

        /* Verbal description */
        .card-description, .card-content {
            font-size: 0.875rem;
            color: rgba(17,24,39,0.75);
            text-overflow: ellipsis;
            line-clamp: 4;
            line-height: normal;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            opacity: 1;

            grid-column: 1 / -1;
            block-size: max-content;
            box-sizing: border-box;
            display: -webkit-box;
            display: flex;
            gap: 0.25rem;
            overflow: hidden;
            padding-block: 0.5rem;
            flex-direction: column;

            .card-label {
                margin-block-start: 0.25rem;
                block-size: max-content;
                opacity: 0.8;
                font-size: 0.8rem;
                line-height: normal;
                display: flex;
                flex-direction: row;

                &:empty { display: none; }
                &:has(+ ul:empty) { display: none; }
            }

            ul {
                margin: 0;
                padding: 0;
                color: --c2-on-surface(-0.1, var(--current, currentColor));
                line-height: normal;
                block-size: max-content;
                overflow: hidden;
                opacity: 0.8;
                display: flex;
                gap: 0.25rem;
                flex-direction: column;
                list-style-position: inside;

                font-variant-numeric: tabular-nums;
                font-size: 0.8rem;

                li {
                    @include can-wrap-text;

                    & {
                        display: list-item;
                        flex-direction: row;
                        block-size: max-content;
                        margin: 0;
                        padding: 0;
                    }
                }
            }
        }

        p {
            @include can-wrap-text;

            & {
                display: inline-block;
                margin: 0;
                padding: 0;
                block-size: max-content;
                inline-size: stretch;
                line-height: 1.3;
            }
        }

        // toggle description
        & {
            .card-description {
                display: none;
                block-size: 0px;
                transition: opacity 160ms ease, block-size 160ms ease, display 160ms ease, padding-block 160ms ease;
                transition-behavior: allow-discrete;
            }
            &[data-open] .card-description { display:flex; opacity:1; block-size: max-content; padding-block: 0.5rem; }
            @starting-style { &[data-open] .card-description { opacity:0; block-size: 0px; padding-block: 0rem; } }
        }

        //
        .card-desc { padding: 0; margin: 0; font-size: 0.8rem; color: rgba(17,24,39,0.5); display: flex; flex-direction: row; gap: 0.25rem; list-style: none; li { padding: 0; margin: 0; } }
        .card-title { padding: 0; margin: 0; font-weight: 700; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; flex-direction: row; gap: 0.25rem; list-style: none; li { padding: 0; margin: 0; } }
        .card-kind { padding: 0; margin: 0; font-size: 0.8rem; color: rgba(17,24,39,0.5); margin-block-start: 0.25rem; display: flex; flex-direction: row; gap: 0.25rem; list-style: none; li { padding: 0; margin: 0; } }
        .card-time { padding: 0; margin: 0; font-size: 0.8rem; color: rgba(17,24,39,0.5); display: flex; flex-direction: row; gap: 0.25rem; list-style: none; li { padding: 0; margin: 0; } }
        .card-props { display: flex; inline-size: stretch; flex-direction:column; gap:0.25rem; justify-items:center; align-content: flex-start; }
        .card-actions { display: flex; gap:0.25rem; li { padding: 0; margin: 0; } }
        .card-actions > .action { display:flex; align-items:center; gap:0.25rem; padding:0.25rem 0.4rem; border-radius:0.375rem; background: --c2-surface(0.03, var(--current, currentColor)); cursor:pointer; border:0; }
        .card-actions > .action:hover { background: --c2-surface(0.06, var(--current, currentColor)); }

        .card-links {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            grid-column: 1 / -1;
            font-size: 0.8rem;
            color: rgba(17,24,39,0.6);

            ul {
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
                gap: 0.125rem;
                list-style: none;

                li a {
                    color: inherit;
                    text-decoration: none;
                    display: inline-flex;
                    align-items: center;
                    gap: 0.25rem;
                }

                li a:hover {
                    text-decoration: underline;
                }
            }
        }

        //
        a {
            pointer-events: auto;
            user-select: none;
            user-drag: auto;
            -webkit-user-drag: auto;
            color: --c2-on-surface(0.0, var(--current, currentColor));
            text-decoration: none;
            &:hover {
                text-decoration: underline;
            }
            &:active {
                text-decoration: underline;
            }
            &:focus {
                text-decoration: underline;
            }
        }

        button {
            pointer-events: auto;
            user-select: none;
            user-drag: none;
            -webkit-user-drag: none;
        }

        // small screens
        @container (max-inline-size: 800px) {
            /*.card-time { display:none; }*/
            .card-actions > .action span { display:none; }
        }
    }
}


