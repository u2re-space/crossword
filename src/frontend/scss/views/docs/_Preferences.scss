// ? Not yet completely finished...
// ! Some parts may be still missing...
// ! Some design concepts may be outdated...
// ! May need some refactoring or improvement...

//
@use "../../editors/mixins/Colorize" as *;

//
@layer rs-preferences {
    [data-type="preferences"],
    [data-type="quests"] {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;

        overflow-y: auto;
        scrollbar-width: thin;

        //
        @include solid-colorize();
    }

    .preferences-view {
        display: grid;
        gap: clamp(0.75rem, 1vw, 1.25rem);
        border-radius: clamp(0.75rem, 1vw, 1.1rem);
        padding: 0px;

        //
        @include solid-colorize("&", ("shade": 0.0));

        //
        .view-toolbar {
            position: sticky;
            inset-block-start: 0;
            z-index: 4;
            display: flex;
            justify-content: flex-end;
            padding-block-end: clamp(0.35rem, 0.8vw, 0.6rem);
            backdrop-filter: blur(12px) saturate(120%);

            .button-set {
                display: flex;
                flex-wrap: wrap;
                gap: clamp(0.35rem, 0.8vw, 0.6rem);

                button {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.35rem;
                    padding: 0.4rem 0.75rem;
                    border-radius: 999px;
                    border: 0;
                    cursor: pointer;
                    transition: background 140ms ease, transform 140ms ease;


                    @include solid-colorize("&", ("shade": 0.0));


                    span {
                        font-size: 0.85rem;
                        font-weight: 500;
                    }
                }
            }
        }

        [data-type="preferences"] {
            display: grid;
            gap: clamp(0.45rem, 1vw, 0.8rem);
        }

        .preference-accordion {
            border-radius: clamp(0.75rem, 1vw, 1rem);
            overflow: hidden;
            transition: border-color 160ms ease, background 160ms ease;

            @include solid-colorize("&", ("shade": 0.0));

            &[open] {
                border-color: color-mix(in oklab, currentColor 28%, transparent);
                background: color-mix(in oklab, currentColor 12%, transparent);
            }

            summary {
                display: grid;
                grid-template-columns: auto 1fr auto auto;
                gap: clamp(0.4rem, 0.8vw, 0.6rem);
                align-items: center;
                padding: clamp(0.75rem, 1vw + 0.5rem, 1rem);
                cursor: pointer;

                @include solid-colorize("&", ("shade": 0.0));

                span {
                    font-weight: 600;
                    font-size: clamp(0.92rem, 0.6cqi + 0.8rem, 1.02rem);
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                button.plain {
                    inline-size: 2rem;
                    block-size: 2rem;
                    border-radius: 999px;
                    display: inline-grid;
                    place-content: center;
                    border: none;
                    background: transparent;
                    color: inherit;
                    cursor: pointer;
                    transition: background 140ms ease;

                    @include solid-colorize("&", ("shade": 0.1));
                }
            }

            .spoiler-content {
                padding: clamp(0rem, 0.5vw, 0.35rem) clamp(0.75rem, 1vw + 0.5rem, 1rem) clamp(0.9rem, 1vw + 0.7rem, 1.15rem);
                display: grid;
                gap: clamp(0.6rem, 1vw, 0.9rem);
                scrollbar-width: thin;

                md-view {
                    inline-size: 100%;
                    min-block-size: 4rem;
                    color-scheme: light only;
                }

                .ai-spoiler {
                    border-radius: clamp(0.6rem, 1vw, 0.85rem);
                    border: 1px solid color-mix(in oklab, currentColor 16%, transparent);

                    @include solid-colorize("&", ("shade": 0.08));

                    summary {
                        display: inline-flex;
                        align-items: center;
                        gap: 0.45rem;
                        cursor: pointer;
                        padding: clamp(0.6rem, 0.8vw, 0.75rem) clamp(0.8rem, 1vw, 1rem);
                        ui-icon { --icon-size: 1.1rem; }
                        span { font-weight: 600; }
                    }

                    .ai-answer {
                        padding: clamp(0.6rem, 0.9vw, 0.85rem) clamp(0.8rem, 1vw, 1.1rem) clamp(0.8rem, 1vw, 1.25rem);
                        border-radius: clamp(0.45rem, 0.8vw, 0.6rem);

                        @include solid-colorize("&", ("shade": 0.12));
                    }
                }
            }
        }

        @media (max-width: 720px) {
            padding: clamp(0.65rem, 4vw, 1.1rem);

            .view-toolbar {
                justify-content: stretch;

                .button-set {
                    justify-content: stretch;

                    button {
                        flex: 1 1 calc(50% - 0.5rem);
                        justify-content: center;
                    }
                }
            }

            .preference-accordion summary {
                grid-template-columns: auto 1fr auto;
                gap: 0.45rem;

                button.plain span {
                    display: none;
                }
            }
        }
    }
}
