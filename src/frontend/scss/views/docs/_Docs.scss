// Documentation Views - Refactored and Optimized
// Unified with design system variables and mixins

@use "../../core/variables" as *;
@use "../../core/mixins" as *;
@use "../../core/colorize" as *;

@layer rs-docs {

    .doc-workspace {
        display: grid;
        gap: var(--gap-lg);
        inline-size: stretch;
        block-size: stretch;
        padding: var(--padding-xl);
        border-radius: var(--radius-xl);
        position: relative;
        grid-template-rows: minmax(0px, max-content) minmax(0px, 1fr) minmax(0px, max-content);
        grid-template-columns: minmax(0px, 1fr);

        @include surface(0);

        > * {
            grid-column: 1 / -1;
        }

        &, * {
            line-height: normal;
        }

        @include breakpoint("lg") {
            padding: var(--padding-lg);
        }

        &::before {
            content: "";
            position: absolute;
            inset: 0;
            z-index: -1;
            border-radius: inherit;
            opacity: var(--surface-opacity-emphasis);
            pointer-events: none;
            block-size: 0px;
            grid-row: 1 / 1 span;
            @include surface(var(--surface-opacity-emphasis));
        }
    }

    .doc-workspace-header {
        @include flex-center;
        flex-wrap: wrap;
        gap: var(--gap-md);
        grid-row: 3 / 3 span;
        grid-column: 1 / -1;
        inline-size: stretch;
        block-size: max-content;
        margin-block-start: var(--space-lg);
        text-align: center;

        .doc-headings {
            gap: var(--gap-xs);
            min-inline-size: 0;
            display: none !important;

            h1 {
                margin: 0;
                font-size: var(--font-2xl);
                font-weight: var(--font-weight-bold);
                letter-spacing: -0.01em;
            }

            p {
                margin: 0;
                font-size: var(--font-base);
            }
        }

        .doc-header-actions {
            @include flex-center;
            flex-wrap: wrap;
            gap: var(--gap-sm);
            justify-content: flex-end;
            grid-column: 1 / -1;
            inline-size: stretch;

            .doc-actions {
                display: inline-flex;
                gap: var(--gap-sm);
                flex-wrap: wrap;
                padding: var(--padding-sm);
                border-radius: var(--radius-lg);
                @include backdrop-blur("strong");
                @include surface(var(--surface-opacity-emphasis));

                .doc-action {
                    @include button-variant(0);
                    font-size: var(--font-sm);

                    &[disabled] {
                        opacity: var(--text-opacity-disabled);
                        pointer-events: none;
                    }
                }
            }
        }
    }

    .doc-collections {
        display: inline-flex;
        gap: var(--gap-md);
        padding: var(--padding-md);
        border-radius: var(--radius-lg);
        position: relative;
        isolation: isolate;
        grid-column: 1 / -1;
        inline-size: stretch;
        block-size: max-content;
        grid-row: 1 / 1 span;

        @include surface(var(--surface-opacity-emphasis));
        @include scrollable("x");
        @include hide-scrollbar;

        .doc-collection {
            @include button-variant(0);
            gap: var(--gap-sm);
            font-size: var(--font-sm);
            white-space: nowrap;
        }
    }

    .doc-body {
        display: grid;
        grid-template-columns: minmax(0, var(--sidebar-width)) minmax(0, 1fr);
        grid-template-rows: minmax(0, 1fr);
        gap: var(--gap-lg);
        position: relative;
        inline-size: stretch;
        block-size: stretch;
        grid-row: 2 / 2 span;
        overflow: hidden;
        border-radius: var(--radius-xl);

        @include breakpoint("lg") {
            grid-template-columns: minmax(0, 1fr);
            grid-template-rows: minmax(0, max-content) minmax(0, max-content) minmax(0, 1fr);
        }
    }

    .doc-sidebar-toggle {
        @include flex-between;
        grid-column: 1 / -1;
        inline-size: 100%;
        justify-self: stretch;
        border: 0;
        font: inherit;
        padding: var(--padding-md) var(--padding-lg);
        border-radius: var(--radius-lg);
        gap: var(--gap-md);
        cursor: pointer;
        transition: var(--transition-colors), var(--transition-transform);
        @include surface(var(--surface-opacity-emphasis));

        ui-icon {
            transition: transform var(--duration-slow) var(--ease-out);
        }

        &.is-open .doc-sidebar-toggle-chev {
            transform: rotate(180deg);
        }

        span {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-base);
        }

        @include breakpoint-up("lg") {
            display: none !important;
        }
    }

    .doc-pane {
        display: grid;
        gap: var(--space-lg);
        align-content: start;
        border-radius: var(--radius-xl);
        block-size: stretch;
        max-block-size: stretch;
        grid-template-rows: minmax(0px, 1fr);
        grid-template-columns: minmax(0px, 1fr);
        padding: var(--padding-sm);
        padding-block: var(--space-lg);
        @include surface(0);

        &.is-sidebar {
            position: relative;
            overflow: hidden;
            max-block-size: stretch;
            grid-template-rows: minmax(0px, max-content) minmax(0px, 1fr);
            @include surface(var(--surface-opacity-muted));

            &::before {
                content: "";
                position: absolute;
                inset-inline: 0;
                inset-block-start: 0;
                block-size: 4.5rem;
                pointer-events: none;
            }
        }

        &.is-preview {
            @include surface(var(--surface-opacity-muted));
            max-block-size: stretch;
        }

        @include breakpoint("lg") {
            &.is-sidebar {
                padding: var(--padding-xs);
                grid-column: 1 / -1;
                grid-row: 2;
                transition: max-block-size var(--duration-slow) var(--ease-out),
                           opacity var(--duration-normal) var(--ease-out);
                max-block-size: clamp(18rem, 60vh, 24rem);
                overflow: hidden;
                opacity: 1;
                box-shadow: none;

                &:not([data-open]) {
                    max-block-size: 0;
                    opacity: 0;
                }
            }

            &.is-preview {
                padding: var(--padding-xs);
                grid-column: 1 / -1;
                grid-row: 3;
            }
        }
    }

    .doc-search {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: var(--gap-sm);
        padding: var(--padding-sm) var(--padding-md);
        border-radius: var(--radius-lg);

        //
        @include surface(var(--surface-opacity-emphasis));

        input {
            border: none;
            background: transparent;
            font: inherit;
            color: inherit;
            inline-size: 100%;
            min-inline-size: 0;
            padding: var(--padding-sm);
            outline: none;
            border-radius: var(--radius-md);

            @include surface(0);
        }
    }

    .doc-listing {
        display: grid;
        gap: var(--gap-md);
        @include scrollable;
        block-size: stretch;
        inline-size: stretch;
        container-type: size;
        contain: strict;
        background: transparent;

        .doc-list {
            display: grid;
            gap: var(--gap-md);
            padding: 0;
            margin: 0;
            list-style: none;
            overflow: visible;
            @include hide-scrollbar;
            inline-size: stretch;
            max-inline-size: 100cqi;
            max-block-size: none;
            block-size: max-content;

            &:empty {
                display: none;
            }

            button {
                inline-size: stretch;
                max-inline-size: 100cqi;

                //
                @include text-truncate;
                @include surface(0);

                //
                button {
                    @include surface(var(--surface-opacity-default));
                }
            }
        }

        .doc-empty-state {
            font-size: var(--font-base);

            //
            @include empty-state;
        }
    }

    .doc-entry {
        grid-template-columns: minmax(0, 1fr) auto;
        gap: var(--gap-md);
        align-items: center;
        padding: var(--padding-md);
        cursor: pointer;
        justify-content: space-between;
        text-align: start;
        block-size: max-content;
        inline-size: stretch;

        //
        @include card-base;
        @include surface(var(--surface-opacity-default));

        .doc-entry-text {
            display: grid;
            gap: var(--gap-xs);
            min-inline-size: 0;
            inline-size: stretch;
            block-size: stretch;
            background: transparent;

            .doc-entry-title {
                font-weight: var(--font-weight-semibold);
                font-size: var(--font-md);

                @include text-truncate;
            }

            .doc-entry-subtitle {
                font-size: var(--font-sm);
                color: --c2-on-surface(var(--text-tint-secondary), var(--current, currentColor));
            }

            .doc-entry-summary {
                font-size: var(--font-xs);
                display: none;

                @include text-clamp(2);
            }
        }

        .doc-entry-actions {
            display: inline-flex;
            gap: var(--gap-sm);
            background: transparent;

            .doc-entry-chip {
                gap: var(--gap-xs);
                inline-size: auto;
                block-size: clamp(2.1rem, 3vw, 2.4rem);
                aspect-ratio: 1 / 1;
                padding-inline: var(--padding-sm);
                padding-block: var(--padding-xs);
                border-radius: var(--radius-full);
                cursor: pointer;
                transition: var(--transition-colors), var(--transition-transform);

                @include flex-center;

                span {
                    font-size: var(--font-xs);
                    font-weight: var(--font-weight-semibold);
                    white-space: nowrap;
                }
            }
        }
    }

    .doc-preview {
        display: grid;
        gap: 0px;
        min-block-size: clamp(26rem, 40vh, 48rem);
        overflow: hidden;
        block-size: stretch;
        grid-template-rows: minmax(0px, 1fr);
        grid-template-columns: minmax(0px, 1fr);
        background: transparent;

        .doc-preview-placeholder {
            text-align: center;
            padding: var(--padding-2xl);
            border-radius: var(--radius-xl);

            //
            @include grid-center;
            @include surface(var(--surface-opacity-emphasis));
        }
    }

    .doc-preview-frame {
        display: grid;
        gap: var(--gap-lg);
        padding: 0px;
        border-radius: var(--radius-sm);
        max-block-size: none;
        block-size: stretch;
        grid-template-rows: minmax(0px, max-content) minmax(0px, 1fr);
        grid-template-columns: minmax(0px, 1fr);
        background: transparent;

        @include scrollable;

        .doc-preview-header {
            @include flex-between;
            flex-wrap: wrap;
            gap: 0px;
            padding: var(--padding-sm);
            block-size: max-content;
            background: transparent;

            div:has(h2) {
                flex-grow: 1;
                text-align: center;
            }

            h2 {
                margin: 0;
                font-size: var(--font-xl);
            }

            .doc-subtitle {
                margin: 0;
                font-size: var(--font-sm);
            }

            .doc-preview-meta {
                display: inline-flex;
                gap: var(--gap-sm);
                flex-wrap: wrap;
                justify-content: flex-end;
            }
        }

        md-view {
            inline-size: stretch;
            min-block-size: stretch;
            block-size: stretch;
            border-radius: var(--radius-sm);
            padding: var(--padding-lg);

            //
            @include scrollable;
            @include surface(0);
        }

        .ai-answer {
            display: grid;
            gap: var(--gap-md);
            padding: var(--padding-lg);
            border-radius: var(--radius-lg);

            summary {
                gap: var(--gap-sm);
                cursor: pointer;
                font-weight: var(--font-weight-semibold);
                justify-content: flex-start;

                //
                @include flex-center;
            }
        }
    }

    .doc-meta-tag {
        gap: var(--gap-xs);
        padding: var(--padding-xs) var(--padding-md);
        border-radius: var(--radius-full);
        font-size: var(--font-xs);
        font-weight: var(--font-weight-semibold);
        letter-spacing: 0.01em;

        //
        @include flex-center;
        @include surface(0);
    }

    .doc-tag-pile {
        display: inline-flex;
        flex-wrap: wrap;
        gap: var(--gap-xs);

        //
        @include surface(0);
    }

    .quest-preview-columns {
        display: grid;
        gap: var(--gap-lg);

        @include breakpoint-up("lg") {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        section {
            display: grid;
            gap: var(--gap-sm);

            h3 {
                margin: 0;
                font-size: var(--font-lg);
                font-weight: var(--font-weight-semibold);

                //
                @include surface(0);
            }
        }
    }

    // Mobile optimizations
    @include breakpoint("md") {
        .doc-collections {
            justify-content: stretch;
        }

        .doc-workspace {
            padding: var(--padding-md);
        }

        .doc-pane {
            padding: 0px;
            inline-size: stretch;
        }

        .doc-preview-frame {
            max-block-size: none;
        }
    }

    // Reduced motion preferences
    @include reduced-motion {
        .doc-action,
        .doc-entry,
        .doc-collection {
            transition-duration: 0ms;
        }
    }
}
