@use "veela-lib" as *;

//
@layer rs-fields-input-list {

    // Enhanced field list edit with design system integration
    .field-list-edit {
        grid-template-columns: [button] minmax(0, 1fr) [checkbox] minmax(0, auto);
        display: grid;
        gap: var(--space-md);
        row-gap: var(--space-sm);
        container-type: inline-size;
        min-inline-size: 0;

        &-parts {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        &-part {
            grid-column: 1 / -1;
            place-content: center;
            place-items: center;

            display: grid;
            grid-template-columns: [input] minmax(0, 1fr) [checkbox-btn] minmax(0, auto) [remove-btn] minmax(0, auto);
            grid-template-rows: minmax(0, auto);
            gap: var(--space-sm);

            position: relative;
            padding: 0;
            border-radius: var(--space-md);
            container-type: inline-size;
            background: transparent;

            @include font-style("&");

            & > * {
                grid-row: 1 / 1 span;
            }

            & > :where(label, input) {
                grid-column: input;
            }

            & > :is(button, input[type="checkbox"]) {
                grid-column: remove-btn;
                margin: 0;
                line-height: 0;
                border-radius: var(--radius-full, 50%);
                inline-size: calc(var(--space-xl) * 1.6);
                block-size: calc(var(--space-xl) * 1.6);
                aspect-ratio: 1 / 1;
                font-weight: 500;
            }

            & > input[type="checkbox"] {
                grid-column: checkbox-btn;
            }

            input {
                &:where([type="text"], [type="tel"], [type="email"], [type="url"]) {
                    grid-column: input;
                    min-inline-size: 0;
                    border-width: 0.5px;
                }

                &[type="checkbox"][data-type="show-password-or-url"] {
                    grid-column: checkbox-btn;
                    min-block-size: 0;
                    min-inline-size: 0;
                    inline-size: calc(var(--space-lg) * 1.6);
                    block-size: calc(var(--space-lg) * 1.6);
                    border-radius: var(--radius-full);
                    z-index: 2;

                    @include checkbox-radio-base;
                }
            }

            a[data-type="preview"] {
                display: none;
                align-items: center;
                position: absolute;
                grid-column: input;
                gap: var(--space-xs);
                padding: calc(var(--space-sm) * 0.8) var(--space-sm);
                border-radius: var(--radius-sm);
                font-size: var(--text-sm);
                text-decoration: none;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                border: none;

                @include solid-colorize("&");
            }

            &[data-show-preview] a[data-type="preview"] {
                display: inline-flex;
            }
        }

        &[data-type] > :where(button, input[type="checkbox"]) {
            @include button-base;
            @include solid-colorize("&", ("shade": var(--surface-opacity-muted)));

            & {
                grid-column: button;
                gap: calc(var(--space-sm) * 0.9);
                padding: var(--space-md) calc(var(--space-md) * 1.3);
                border-radius: var(--radius-lg);

                border-width: 0px;
                box-shadow: var(--shadow-sm);
            }
        }

        &[data-type="phone"] {
            .field-list-edit-part input {
                font-variant-numeric: tabular-nums;
                letter-spacing: 0.02em;
            }
        }

        &[data-type="email"] {
            .field-list-edit-part input {
                text-transform: lowercase;
                font-variant-caps: all-small-caps;
            }
        }

        &[data-type="url"] {
            .field-list-edit-part input {
                font-family: ui-monospace, "Cascadia Code", "Source Code Pro", "SF Mono", Monaco, Menlo, monospace;
                font-size: 0.92em;
                word-break: break-all;
            }
        }
    }

    // Enhanced responsive adjustments
    @container (max-inline-size: 31.25rem) {
        .field-list-edit-part {
            a[data-type="preview"] {
                font-size: var(--text-xs);
            }
        }
    }

    @container (max-inline-size: 21.875rem) {
        .field-list-edit-part {
            padding: var(--space-sm);
            gap: calc(var(--space-sm) * 0.8);

            a[data-type="preview"] {
                font-size: var(--text-xs);
                padding: calc(var(--space-xs) * 0.7) var(--space-xs);
            }
        }
    }

    // Enhanced accessibility
    @media (prefers-reduced-motion: reduce) {
        .field-list-edit-part {
            &, :where(input, a, input[type="checkbox"], input[type="checkbox"]::before) {
                transition-duration: 0ms;
            }
        }

        .field-list-edit > :where(button, input[type="checkbox"]) {
            transition-duration: 0ms;
        }
    }

    @media (prefers-contrast: high) {
        .field-list-edit-part input,
        .field-list-edit > :where(button, input[type="checkbox"]) {
            border-width: 2px;
        }
    }
}

//
@layer rs-fields-descriptor {

    // Enhanced descriptor edit layout
    .descriptor-edit {
        display: grid;
        gap: var(--space-md);
        container-type: inline-size;
        min-inline-size: 0;
    }

    // Enhanced descriptor part layout
    .descriptor-edit-part {
        display: grid;
        gap: var(--space-xs);
        position: relative;
        container-type: inline-size;

        // Multi-line text input with enhanced styling
        textarea {
            display: block;
            block-size: max-content;
            resize: vertical;
            max-inline-size: stretch;
            max-block-size: stretch;
            inline-size: stretch;
        }

        // Single-line input (for URLs, emails, phones, tags) with enhanced styling
        input {
            inline-size: stretch;
            max-inline-size: stretch;
        }

        label {
            inline-size: stretch;
            max-inline-size: stretch;
        }

        // Field label (aria-hidden decorative) with enhanced styling
        label[aria-hidden="true"] {
            position: absolute;
            inset-inline-start: var(--space-md);
            inset-block-start: calc(var(--space-md) * -0.8);
            padding-inline: var(--space-sm);
            pointer-events: none;
            border-radius: var(--radius-xs);
            backdrop-filter: blur(4px);
            z-index: 1;

            @include font-style("&", ("size": "sm"));
            @include solid-colorize("&");
        }

        // Preview link (for URLs) with improved styling
        a[data-type="preview"] {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: calc(var(--space-sm) * 0.7) var(--space-sm);
            border-radius: var(--radius-sm);
            field-sizing: content;
            text-decoration: none;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            border: none;

            @include font-style("&", ("size": "sm"));
            @include solid-colorize("&");
        }

        // Show/hide password/URL checkbox with enhanced styling
        input[type="checkbox"][data-type="show-password-or-url"] {
            inline-size: auto;
            field-sizing: content;

            @include checkbox-radio-base;
        }
    }

    // Enhanced add button
    .descriptor-edit > :where(button, input[type="checkbox"]) {
        gap: calc(var(--space-sm) * 0.9);
        padding: var(--space-md) calc(var(--space-md) * 1.3);
        border-radius: var(--radius-lg);

        border-width: 0px;
        box-shadow: var(--shadow-sm);
    }

    // Type-specific styling with better organization
    .descriptor-edit[data-type="phone"] {
        .descriptor-edit-part input {
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.02em;
        }
    }

    .descriptor-edit[data-type="email"] {
        .descriptor-edit-part input {
            text-transform: lowercase;
            font-variant-caps: all-small-caps;
        }
    }

    .descriptor-edit[data-type="url"] {
        .descriptor-edit-part input {
            font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas, "DejaVu Sans Mono", monospace;
            font-size: 0.92em;
            word-break: break-all;
        }
    }

    // Enhanced responsive adjustments
    @container (max-inline-size: 25rem) {
        .descriptor-edit-part {
            a[data-type="preview"] {
                max-inline-size: 100%;
                font-size: var(--text-xs);
            }
        }
    }

    @container (max-inline-size: 20rem) {
        .descriptor-edit-part {
            gap: calc(var(--space-xs) * 0.8);

            textarea,
            input {
                padding: calc(var(--space-sm) * 0.8) var(--space-sm);
            }
        }
    }

    // Enhanced accessibility
    @media (prefers-reduced-motion: reduce) {
        .descriptor-edit-part textarea,
        .descriptor-edit-part input,
        .descriptor-edit-part a,
        .descriptor-edit > :where(button, input[type="checkbox"]) {
            transition-duration: 0ms;
        }
    }

    @media (prefers-contrast: high) {
        .descriptor-edit-part textarea,
        .descriptor-edit-part input,
        .descriptor-edit > :where(button, input[type="checkbox"]) {
            border-width: 2px;
        }
    }
}
