{"version":3,"file":"offscreen-capture.js","sources":["../../src/crx/offscreen/capture.ts"],"sourcesContent":["// Offscreen document for desktop capture in CRX-Snip\n\nconst canvas = document.getElementById('capture-canvas') as HTMLCanvasElement;\nconst ctx = canvas.getContext('2d');\n\n// Handle messages from service worker\nchrome.runtime.onMessage.addListener(async (message, sender, sendResponse) => {\n    if (message.type === 'capture-desktop' && message.streamId) {\n        try {\n            console.log('[Offscreen] Starting desktop capture...');\n\n            // Get media stream using the provided stream ID\n            const stream = await navigator.mediaDevices.getUserMedia({\n                video: {\n                    mandatory: {\n                        chromeMediaSource: 'desktop',\n                        chromeMediaSourceId: message.streamId,\n                        maxWidth: 4096,\n                        maxHeight: 2160\n                    }\n                } as any\n            });\n\n            // Create video element to capture the stream\n            const video = document.createElement('video');\n            video.srcObject = stream;\n\n            // Wait for video to load\n            await new Promise<void>((resolve) => {\n                video.onloadedmetadata = () => resolve();\n            });\n\n            video.play();\n\n            // Set canvas size to video dimensions\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n\n            // Draw video frame to canvas\n            ctx?.drawImage(video, 0, 0);\n\n            // Stop the stream\n            stream.getTracks().forEach(track => track.stop());\n\n            // Convert canvas to blob\n            const blob = await new Promise<Blob>((resolve) =>\n                canvas.toBlob(resolve, 'image/png', 1.0)\n            );\n\n            // Convert blob to ArrayBuffer\n            const arrayBuffer = await blob.arrayBuffer();\n\n            console.log('[Offscreen] Desktop capture completed, size:', arrayBuffer.byteLength);\n\n            sendResponse({ success: true, imageData: arrayBuffer });\n\n        } catch (error) {\n            console.error('[Offscreen] Desktop capture failed:', error);\n            sendResponse({ success: false, error: error instanceof Error ? error.message : String(error) });\n        }\n    }\n\n    return true; // Keep message channel open for async response\n});"],"names":[],"mappings":";AAEA,MAAM,MAAA,GAAS,QAAA,CAAS,cAAA,CAAe,gBAAgB,CAAA;AACvD,MAAM,GAAA,GAAM,MAAA,CAAO,UAAA,CAAW,IAAI,CAAA;AAGlC,MAAA,CAAO,QAAQ,SAAA,CAAU,WAAA,CAAY,OAAO,OAAA,EAAS,QAAQ,YAAA,KAAiB;AAC1E,EAAA,IAAI,OAAA,CAAQ,IAAA,KAAS,iBAAA,IAAqB,OAAA,CAAQ,QAAA,EAAU;AACxD,IAAA,IAAI;AACA,MAAA,OAAA,CAAQ,IAAI,yCAAyC,CAAA;AAGrD,MAAA,MAAM,MAAA,GAAS,MAAM,SAAA,CAAU,YAAA,CAAa,YAAA,CAAa;AAAA,QACrD,KAAA,EAAO;AAAA,UACH,SAAA,EAAW;AAAA,YACP,iBAAA,EAAmB,SAAA;AAAA,YACnB,qBAAqB,OAAA,CAAQ,QAAA;AAAA,YAC7B,QAAA,EAAU,IAAA;AAAA,YACV,SAAA,EAAW;AAAA;AACf;AACJ,OACH,CAAA;AAGD,MAAA,MAAM,KAAA,GAAQ,QAAA,CAAS,aAAA,CAAc,OAAO,CAAA;AAC5C,MAAA,KAAA,CAAM,SAAA,GAAY,MAAA;AAGlB,MAAA,MAAM,IAAI,OAAA,CAAc,CAAC,OAAA,KAAY;AACjC,QAAA,KAAA,CAAM,gBAAA,GAAmB,MAAM,OAAA,EAAQ;AAAA,MAC3C,CAAC,CAAA;AAED,MAAA,KAAA,CAAM,IAAA,EAAK;AAGX,MAAA,MAAA,CAAO,QAAQ,KAAA,CAAM,UAAA;AACrB,MAAA,MAAA,CAAO,SAAS,KAAA,CAAM,WAAA;AAGtB,MAAA,GAAA,EAAK,SAAA,CAAU,KAAA,EAAO,CAAA,EAAG,CAAC,CAAA;AAG1B,MAAA,MAAA,CAAO,WAAU,CAAE,OAAA,CAAQ,CAAA,KAAA,KAAS,KAAA,CAAM,MAAM,CAAA;AAGhD,MAAA,MAAM,IAAA,GAAO,MAAM,IAAI,OAAA;AAAA,QAAc,CAAC,OAAA,KAClC,MAAA,CAAO,MAAA,CAAO,OAAA,EAAS,aAAa,CAAG;AAAA,OAC3C;AAGA,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,WAAA,EAAY;AAE3C,MAAA,OAAA,CAAQ,GAAA,CAAI,8CAAA,EAAgD,WAAA,CAAY,UAAU,CAAA;AAElF,MAAA,YAAA,CAAa,EAAE,OAAA,EAAS,IAAA,EAAM,SAAA,EAAW,aAAa,CAAA;AAAA,IAE1D,SAAS,KAAA,EAAO;AACZ,MAAA,OAAA,CAAQ,KAAA,CAAM,uCAAuC,KAAK,CAAA;AAC1D,MAAA,YAAA,CAAa,EAAE,OAAA,EAAS,KAAA,EAAO,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAA,EAAG,CAAA;AAAA,IAClG;AAAA,EACJ;AAEA,EAAA,OAAO,IAAA;AACX,CAAC,CAAA"}