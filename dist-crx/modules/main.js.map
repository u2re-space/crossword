{"version":3,"mappings":"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","names":["renderTabName","stripMarkdown","file","content","index","__vite_import_meta_env__","storeShareTargetPayloadToCacheGateway","consumeCachedShareTargetPayloadFromGateway","lastTimestamp","lastMotionSentAt","resetMonteCarloSampling","onEnterAirMove","averageRateSampleCount","averageRateSampled","averageRateResolved","getCalibrationConfidence","addMonteCarloSample","gravityCorrection","gyroOnEnterAirMove","accelOnEnterAirMove"],"ignoreList":[],"sources":["../../src/core/api/index.ts","../../src/core/text/index.ts","../../src/core/phone/index.ts","../../src/core/document/markdown.ts","../../src/core/document/Parser.ts","../../src/core/storage/file-utils.ts","../../src/core/modules/LazyLoader.ts","../../src/core/storage/FileHandling.ts","../../src/core/modules/VoiceInput.ts","../../src/core/modules/TemplateManager.ts","../../src/core/modules/HistoryManager.ts","../../src/core/utils/Utils.ts","../../src/core/utils/DebugTaskGenerator.ts","../../src/core/index.ts","../../src/frontend/pwa/pwa-copy.ts","../../src/frontend/pwa/sw-url.ts","../../src/com/core/ViewTransferRouting.ts","../../src/frontend/pwa/sw-handling.ts","../../src/frontend/views/airpad/input/speech.ts","../../src/frontend/views/airpad/config/motion-state.ts","../../src/frontend/views/airpad/utils/math.ts","../../src/frontend/views/airpad/input/unfinised/gravity-sensor.ts","../../src/frontend/views/airpad/input/unfinised/gyroscope.ts","../../src/frontend/views/airpad/input/unfinised/accelerometer.ts","../../src/frontend/views/airpad/ui/air-button.ts","../../src/frontend/views/airpad/input/sensor/relative-orientation.ts","../../src/frontend/views/airpad/ui/clipboard-toolbar.ts","../../src/frontend/views/airpad/ui/config-ui.ts","../../src/frontend/views/airpad/main.ts"],"sourcesContent":["/**\n * API Module\n *\n * Provides API client and service communication utilities.\n * Used for backend API calls and processing requests.\n */\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\n/**\n * API response wrapper\n */\nexport interface ApiResponse<T = unknown> {\n    success: boolean;\n    data?: T;\n    error?: string;\n    metadata?: Record<string, unknown>;\n}\n\n/**\n * Processing request options\n */\nexport interface ProcessingOptions {\n    content: string | File | Blob;\n    contentType: \"text\" | \"file\" | \"blob\" | \"base64\";\n    processingType?: \"solve-and-answer\" | \"write-code\" | \"extract-css\" | \"recognize-content\";\n    options?: Record<string, unknown>;\n}\n\n/**\n * Analyze request options\n */\nexport interface AnalyzeOptions {\n    content: string;\n    contentType?: string;\n    options?: Record<string, unknown>;\n}\n\n// ============================================================================\n// API ENDPOINTS\n// ============================================================================\n\n/**\n * API endpoint paths\n */\nexport const API_PATHS = {\n    PROCESSING: \"/api/processing\",\n    ANALYZE: \"/api/analyze\",\n    HEALTH: \"/api/health\",\n    TEST: \"/api/test\",\n    PHOSPHOR_ICONS: \"/assets/icons/phosphor\"\n} as const;\n\nexport type ApiPath = typeof API_PATHS[keyof typeof API_PATHS];\n\n// ============================================================================\n// API CLIENT\n// ============================================================================\n\n/**\n * API client for frontend communication with backend services\n */\nexport const api = {\n    /**\n     * Send content for AI processing\n     */\n    async process(options: ProcessingOptions): Promise<ApiResponse> {\n        try {\n            const response = await fetch(API_PATHS.PROCESSING, {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(options)\n            });\n            return response.json();\n        } catch (error) {\n            return { success: false, error: String(error) };\n        }\n    },\n\n    /**\n     * Analyze content (lighter processing)\n     */\n    async analyze(content: string, contentType = \"text\"): Promise<ApiResponse> {\n        try {\n            const response = await fetch(API_PATHS.ANALYZE, {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ content, contentType })\n            });\n            return response.json();\n        } catch (error) {\n            return { success: false, error: String(error) };\n        }\n    },\n\n    /**\n     * Health check\n     */\n    async health(): Promise<{ ok: boolean; timestamp?: number }> {\n        try {\n            const response = await fetch(API_PATHS.HEALTH);\n            return response.json();\n        } catch {\n            return { ok: false };\n        }\n    },\n\n    /**\n     * Test API endpoint\n     */\n    async test(): Promise<ApiResponse> {\n        try {\n            const response = await fetch(API_PATHS.TEST);\n            return response.json();\n        } catch (error) {\n            return { success: false, error: String(error) };\n        }\n    },\n\n    /**\n     * Generic GET request\n     */\n    async get<T>(path: string): Promise<ApiResponse<T>> {\n        try {\n            const response = await fetch(path);\n            return response.json();\n        } catch (error) {\n            return { success: false, error: String(error) };\n        }\n    },\n\n    /**\n     * Generic POST request\n     */\n    async post<T>(path: string, data: unknown): Promise<ApiResponse<T>> {\n        try {\n            const response = await fetch(path, {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(data)\n            });\n            return response.json();\n        } catch (error) {\n            return { success: false, error: String(error) };\n        }\n    }\n};\n\n// ============================================================================\n// FETCH UTILITIES\n// ============================================================================\n\n/**\n * Fetch with timeout\n */\nexport async function fetchWithTimeout(\n    url: string,\n    options: RequestInit = {},\n    timeoutMs = 30000\n): Promise<Response> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), timeoutMs);\n\n    try {\n        return await fetch(url, {\n            ...options,\n            signal: controller.signal\n        });\n    } finally {\n        clearTimeout(timeout);\n    }\n}\n\n/**\n * Retry fetch with exponential backoff\n */\nexport async function fetchWithRetry(\n    url: string,\n    options: RequestInit = {},\n    maxRetries = 3,\n    baseDelayMs = 1000\n): Promise<Response> {\n    let lastError: Error | undefined;\n\n    for (let i = 0; i < maxRetries; i++) {\n        try {\n            return await fetch(url, options);\n        } catch (error) {\n            lastError = error as Error;\n            if (i < maxRetries - 1) {\n                await new Promise(resolve =>\n                    setTimeout(resolve, baseDelayMs * Math.pow(2, i))\n                );\n            }\n        }\n    }\n\n    throw lastError || new Error(\"Fetch failed\");\n}\n\n// Default export\nexport default api;\n","/**\n * Text Utilities\n *\n * Text formatting and manipulation utilities.\n */\n\nimport { writeText } from \"@rs-core/modules/Clipboard\";\nimport { parseDateCorrectly, getISOWeekNumber, getTimeZone, formatDateTime } from \"@rs-core/time\";\n\n// ============================================================================\n// STRING UTILITIES\n// ============================================================================\n\n/**\n * Check if fragment is not empty\n */\nexport const isNotEmpty = (frag: any): boolean => {\n    return !!(typeof frag == \"string\" ? frag?.trim?.() : frag);\n};\n\n/**\n * Convert to string safely\n */\nexport const toStringSafe = (value: unknown): string => {\n    return typeof value === \"string\" ? value : value == null ? \"\" : String(value);\n};\n\n/**\n * Collapse whitespace to single spaces\n */\nexport const collapseWhitespace = (value: string): string => {\n    return value.replace(/\\s+/g, \" \").trim();\n};\n\n/**\n * Convert label (capitalize first, replace _ with space)\n */\nexport const MAKE_LABEL = (label: string): string => {\n    return label?.charAt?.(0)?.toUpperCase?.() + label?.slice?.(1)?.replace?.(/_/g, \" \");\n};\n\n/**\n * Crop first letter (uppercase)\n */\nexport const cropFirstLetter = (text: string | any): string => {\n    return text?.charAt?.(0)?.toUpperCase?.() || \"C\";\n};\n\n/**\n * Convert to start case (Title Case)\n */\nexport const startCase = (value: string): string => {\n    return value\n        .replace(/[_\\-]+/g, \" \")\n        .replace(/([a-z0-9])([A-Z])/g, \"$1 $2\")\n        .replace(/\\s+/g, \" \")\n        .trim()\n        .replace(/^./, char => char.toUpperCase());\n};\n\n/**\n * Render tab name (capitalize, replace _ with space)\n */\nexport const renderTabName = (tabName: string): string => {\n    if (!tabName) return \"\";\n    tabName = tabName?.replace?.(/_/g, \" \") || tabName;\n    tabName = (tabName?.charAt?.(0)?.toUpperCase?.() + tabName?.slice?.(1)) || tabName;\n    return tabName;\n};\n\n// ============================================================================\n// MULTILINE UTILITIES\n// ============================================================================\n\n/**\n * Convert value to multiline string\n */\nexport const toMultiline = (value: unknown): string => {\n    if (!value) return \"\";\n    if (Array.isArray(value)) {\n        return value.map(item => (item ?? \"\").toString().trim()).filter(Boolean).join(\"\\n\");\n    }\n    return String(value ?? \"\");\n};\n\n/**\n * Convert multiline string to array\n */\nexport const fromMultiline = (value: string): string[] => {\n    if (!value) return [];\n    return value.split(/\\r?\\n/).map(line => line.trim()).filter(Boolean);\n};\n\n/**\n * Count lines in text\n */\nexport const countLines = (text: string | any): number => {\n    if (!text) return 0;\n    return Array.isArray(text) ? text.length : text?.split?.(/\\r\\n|\\r|\\n/)?.length;\n};\n\n/**\n * Wrap text in span\n */\nexport const wrapBySpan = (text: string | any): string => {\n    if (!text) return \"\";\n    return `<span>${Array.isArray(text) ? text?.join?.(\",\") : text}</span>`;\n};\n\n/**\n * Card render options\n */\nexport interface CardRenderOptions {\n    order?: number | null | undefined;\n}\n\n// ============================================================================\n// PATH UTILITIES\n// ============================================================================\n\n/**\n * Split path by dots\n */\nexport const splitPath = (path: string): string[] => path.split(\".\").filter(Boolean);\n\n/**\n * Get value by path\n */\nexport const getByPath = (source: any, path: string): any => {\n    return splitPath(path).reduce((acc, key) => (acc == null ? acc : acc[key]), source);\n};\n\n/**\n * Set value by path\n */\nexport const setByPath = (target: any, path: string, value: any): void => {\n    const keys = splitPath(path);\n    if (!keys.length) return;\n\n    let current = target;\n    for (let i = 0; i < keys.length - 1; i++) {\n        const key = keys[i];\n        if (typeof current[key] !== \"object\" || current[key] === null) {\n            current[key] = {};\n        }\n        current = current[key];\n    }\n    current[keys[keys.length - 1]] = value;\n};\n\n/**\n * Unset value by path\n */\nexport const unsetByPath = (target: any, path: string): void => {\n    const keys = splitPath(path);\n    if (!keys.length) return;\n\n    const parents: Array<[any, string]> = [];\n    let current = target;\n\n    for (let i = 0; i < keys.length - 1; i++) {\n        const key = keys[i];\n        if (current?.[key] === undefined) return;\n        parents.push([current, key]);\n        current = current[key];\n        if (typeof current !== \"object\" || current === null) return;\n    }\n\n    const lastKey = keys[keys.length - 1];\n    if (current && Object.prototype.hasOwnProperty.call(current, lastKey)) {\n        delete current[lastKey];\n        // Clean up empty parent objects\n        for (let i = parents.length - 1; i >= 0; i--) {\n            const [parent, key] = parents[i];\n            const value = parent[key];\n            if (value && typeof value === \"object\" && !Array.isArray(value) && !Object.keys(value).length) {\n                delete parent[key];\n            } else {\n                break;\n            }\n        }\n    }\n};\n\n/**\n * Make object entries\n */\nexport const makeObjectEntries = (object: any): [string, any][] => {\n    if (!object) return [];\n    if (typeof object == \"object\" || typeof object == \"function\") {\n        return [...Object.entries(object)];\n    }\n    return [];\n};\n\n// ============================================================================\n// MARKDOWN STRIPPING\n// ============================================================================\n\n/**\n * Strip markdown syntax from text\n */\nexport const stripMarkdown = (value: unknown): string => {\n    const input = toStringSafe(value);\n    if (!input) return \"\";\n\n    return input\n        .replace(/```[\\s\\S]*?```/g, \" \")           // code blocks\n        .replace(/`([^`]+)`/g, \"$1\")               // inline code\n        .replace(/!\\[[^\\]]*\\]\\([^\\)]+\\)/g, \" \")    // images\n        .replace(/\\[([^\\]]+)\\]\\([^\\)]+\\)/g, \"$1\")  // links\n        .replace(/(^|\\n)\\s{0,3}>\\s?/g, \"$1\")       // blockquotes\n        .replace(/(^|\\n)\\s{0,3}#{1,6}\\s+/g, \"$1\")  // headers\n        .replace(/(^|\\n)\\s{0,3}[-*+]\\s+/g, \"$1\")   // unordered lists\n        .replace(/(^|\\n)\\s{0,3}\\d+\\.\\s+/g, \"$1\")   // ordered lists\n        .replace(/(^|\\n)---[\\s\\S]*?---(?=\\n|$)/g, \"$1\") // front matter\n        .replace(/[\\\\*_~]/g, \"\")                   // emphasis chars\n        .replace(/`/g, \"\")                         // remaining backticks\n        .replace(/&nbsp;/gi, \" \")                  // nbsp entities\n        .replace(/<\\/?[^>]+>/g, \" \");              // HTML tags\n};\n\n/**\n * Sanitize document snippet\n */\nexport const sanitizeDocSnippet = (value: unknown): string => {\n    return collapseWhitespace(stripMarkdown(value));\n};\n\n/**\n * Truncate document snippet\n */\nexport const truncateDocSnippet = (value: string, limit = 260): string => {\n    const trimmed = value.trim();\n    if (!limit || trimmed.length <= limit) return trimmed;\n    return `${trimmed.slice(0, Math.max(1, limit - 1)).trimEnd()}`;\n};\n\n// ============================================================================\n// DATE TITLE BUILDERS\n// ============================================================================\n\n/**\n * Ensure date from various formats\n */\nexport const ensureDate = (value: any): Date | null => {\n    if (!value) return null;\n    const parsed = parseDateCorrectly(value);\n    if (!parsed) return null;\n    const time = parsed.getTime?.();\n    return Number.isFinite(time) ? parsed : null;\n};\n\n/**\n * Resolve begin date from day descriptor\n */\nexport const resolveBeginDate = (dayDesc: any): Date | null => {\n    return ensureDate(dayDesc?.begin_time ?? dayDesc?.properties?.begin_time ?? dayDesc?.start);\n};\n\n/**\n * Build primary day title\n */\nexport const buildPrimaryDayTitle = (dayDesc: any): string => {\n    const preset = dayDesc?.separatorTitle;\n    if (typeof preset === \"string\" && preset.trim()) return preset;\n\n    const date = resolveBeginDate(dayDesc);\n    if (!date) return dayDesc?.title || dayDesc?.id || \"Day\";\n\n    const formatted = date.toLocaleDateString(\"en-GB\", {\n        timeZone: getTimeZone(),\n        weekday: \"long\",\n        month: \"long\",\n        day: \"numeric\",\n        year: \"numeric\"\n    });\n\n    const week = dayDesc?.weekNumber ?? getISOWeekNumber(date);\n    if (week && formatted) return `${formatted}  Week ${week}`;\n    return formatted;\n};\n\n/**\n * Build secondary day title\n */\nexport const buildSecondaryDayTitle = (dayDesc: any, primary: string): string | null => {\n    const label = dayDesc?.title;\n    if (!label) return null;\n    if (!primary) return label;\n    return label.trim() === primary.trim() ? null : label;\n};\n\n// ============================================================================\n// DRAG & COPY HANDLERS\n// ============================================================================\n\n/**\n * Begin drag as text\n */\nexport const beginDragAsText = (ev: DragEvent): void => {\n    const text = (ev.currentTarget as HTMLElement)?.textContent?.trim?.();\n    if (text) {\n        ev.dataTransfer!.effectAllowed = \"copy\";\n        ev.dataTransfer?.clearData?.();\n        ev.dataTransfer?.setData?.(\"plain/text\", text);\n    }\n};\n\n/**\n * Copy phone on click\n */\nexport const copyPhoneClick = (ev: Event): void => {\n    const element = ev.currentTarget as HTMLElement;\n    const isPhoneElement = element?.matches?.('.phone') ? element : element?.querySelector?.('.phone');\n\n    if (isPhoneElement) {\n        ev?.preventDefault?.();\n        ev?.stopPropagation?.();\n        const phone = isPhoneElement?.textContent?.trim?.() ?? '';\n        if (phone) writeText(phone);\n    }\n};\n\n/**\n * Copy email on click\n */\nexport const copyEmailClick = (ev: Event): void => {\n    const element = ev.currentTarget as HTMLElement;\n    const isEmailElement = element?.matches?.('.email') ? element : element?.querySelector?.('.email');\n\n    if (isEmailElement) {\n        ev?.preventDefault?.();\n        ev?.stopPropagation?.();\n        const email = isEmailElement?.textContent?.trim?.() ?? '';\n        if (email) writeText(email);\n    }\n};\n\n// ============================================================================\n// RE-EXPORTS\n// ============================================================================\n\nexport { formatDateTime };\n","/**\n * Phone Utilities\n *\n * Phone number normalization and duplicate detection.\n * Primarily designed for Russian (RF) phone numbers.\n */\n\n// ============================================================================\n// CONSTANTS\n// ============================================================================\n\nexport const PHONE_CANDIDATE_RE = /\\+?\\d[\\d\\s().\\-]{4,}\\d/g;\nexport const EXT_CUT_RE = /(\\.?|\\.?|ext\\.?|extension)\\s*[:#\\-x]*\\s*\\d+.*/i;\n\n// ============================================================================\n// NORMALIZATION OPTIONS\n// ============================================================================\n\nexport interface NormalizeOptions {\n    defaultTrunk?: string;\n    countryCode?: string;\n    cityCode?: string | null;\n    stripExtensions?: boolean;\n    minLocal?: number;\n    maxLocal?: number;\n}\n\nconst DEFAULT_OPTIONS: Required<NormalizeOptions> = {\n    defaultTrunk: '8',\n    countryCode: '7',\n    cityCode: null,\n    stripExtensions: true,\n    minLocal: 5,\n    maxLocal: 7\n};\n\n// ============================================================================\n// NORMALIZATION\n// ============================================================================\n\n/**\n * Normalize a single phone number\n * Returns null if cannot be normalized to valid format\n */\nexport const normalizeOne = (input: string, options: NormalizeOptions = {}): string | null => {\n    if (input == null) return null;\n    const opts = { ...DEFAULT_OPTIONS, ...options };\n\n    let s = String(input).trim();\n    if (!s) return null;\n\n    // Strip extensions\n    if (opts.stripExtensions) {\n        s = s.replace(EXT_CUT_RE, '');\n    }\n\n    // Flag for leading plus (important for +7  8)\n    const hasPlusInStart = /^\\+/.test(s);\n\n    // Remove all non-digit characters\n    let digits = s.replace(/\\D/g, '');\n    if (!digits) return null;\n\n    // Normalization for Russia (RF)\n    if (hasPlusInStart && digits.startsWith(opts.countryCode)) {\n        // +7xxxxxxxxxx  8xxxxxxxxxx\n        digits = opts.defaultTrunk + digits.slice(opts.countryCode.length);\n    } else if (digits.length === 11 && digits.startsWith(opts.countryCode)) {\n        // 7xxxxxxxxxx (11 digits)  8xxxxxxxxxx\n        digits = opts.defaultTrunk + digits.slice(1);\n    } else if (digits.length === 10) {\n        // 10 digits (mobile/local with area code)  prepend defaultTrunk\n        digits = opts.defaultTrunk + digits;\n    } else if (opts.cityCode && digits.length >= opts.minLocal && digits.length <= opts.maxLocal) {\n        // 57 digits (local city numbers)  prepend defaultTrunk + cityCode\n        digits = opts.defaultTrunk + opts.cityCode + digits;\n    } else if (digits.length === 11 && digits.startsWith(opts.defaultTrunk)) {\n        // Already 11 digits starting with defaultTrunk (8)  leave as is\n    } else if (opts.cityCode && digits.length === opts.cityCode.length + 7) {\n        // cityCode + local (no leading 8)  prepend defaultTrunk\n        digits = opts.defaultTrunk + digits;\n    } else {\n        // Could not normalize to 11-digit RF format\n        return null;\n    }\n\n    // Expect 11 digits starting with defaultTrunk (8)\n    return /^\\d{11}$/.test(digits) ? digits : null;\n};\n\n/**\n * Split string into phone candidates\n */\nexport const splitCandidates = (value: string): string[] => {\n    if (value == null) return [];\n    const s = String(value);\n    const matches = s.match(PHONE_CANDIDATE_RE);\n    if (matches?.length) return matches;\n    // Fallback: split by common delimiters\n    return s.split(/[;,/|]+/).map(x => x.trim()).filter(Boolean);\n};\n\n/**\n * Normalize multiple phone numbers\n */\nexport const normalizePhones = (value: string | string[], options: NormalizeOptions = {}): string[] => {\n    const out = new Set<string>();\n\n    if (Array.isArray(value)) {\n        for (const v of value) {\n            if (typeof v === 'string') {\n                for (const cand of splitCandidates(v)) {\n                    const n = normalizeOne(cand, options);\n                    if (n) out.add(n);\n                }\n            } else {\n                const n = normalizeOne(v, options);\n                if (n) out.add(n);\n            }\n        }\n    } else if (typeof value === 'string') {\n        for (const c of splitCandidates(value)) {\n            const n = normalizeOne(c, options);\n            if (n) out.add(n);\n        }\n    } else {\n        const n = normalizeOne(value, options);\n        if (n) out.add(n);\n    }\n\n    return [...out];\n};\n\n// ============================================================================\n// ROW HELPERS\n// ============================================================================\n\n/**\n * Get index for row\n */\nexport const getIndexForRow = (row: any, pos: number): number => {\n    if (Array.isArray(row) && typeof row[1] === 'number') return row[1];\n    if (row && typeof row === 'object' && typeof row.index === 'number') return row.index;\n    return pos;\n};\n\n/**\n * Get phones from row\n */\nexport const getPhonesFromRow = (row: any): any => {\n    if (Array.isArray(row)) return row[0];\n    if (row && typeof row === 'object') {\n        if ('phones' in row) return row.phones;\n        if ('phone' in row) return row.phone;\n    }\n    return row;\n};\n\n// ============================================================================\n// DUPLICATE DETECTION\n// ============================================================================\n\nexport interface DuplicateResult {\n    duplicatesByNumber: Record<string, number[]>;\n    pairs: [number, string[]][];\n    duplicatesByIndex: Record<string, string[]>;\n    normalize: (s: string) => string | null;\n}\n\n/**\n * Find duplicate phone numbers in rows\n */\nexport function findDuplicatePhones(rows: any[], userOptions: NormalizeOptions = {}): DuplicateResult {\n    const options = { ...DEFAULT_OPTIONS, ...userOptions };\n\n    const numberToIndices = new Map<string, Set<number>>();\n    const indexToNumbersAll = new Map<number, Set<string>>();\n\n    rows.forEach((row: any, pos: number) => {\n        const idx = getIndexForRow(row, pos);\n        const phonesRaw = getPhonesFromRow(row);\n        const phones = normalizePhones(phonesRaw, options);\n\n        if (!indexToNumbersAll.has(idx)) indexToNumbersAll.set(idx, new Set());\n        const setForIndex = indexToNumbersAll.get(idx)!;\n\n        for (const p of phones) {\n            setForIndex.add(p);\n            if (!numberToIndices.has(p)) numberToIndices.set(p, new Set());\n            numberToIndices.get(p)!.add(idx);\n        }\n    });\n\n    // Keep only duplicates\n    const duplicatesByNumber: Record<string, number[]> = {};\n    for (const [num, set] of numberToIndices.entries()) {\n        if (set.size > 1) {\n            duplicatesByNumber[num] = [...set].sort((a, b) => a - b);\n        }\n    }\n\n    // For each index  which numbers intersect\n    const duplicatesByIndex: Record<string, string[]> = {};\n    for (const [idx, set] of indexToNumbersAll.entries()) {\n        const dups = [...set].filter(n => duplicatesByNumber[n]);\n        if (dups.length) duplicatesByIndex[idx] = dups.sort();\n    }\n\n    // Pairs [index, phone[]] only where there are intersections\n    const pairs = Object.entries(duplicatesByIndex)\n        .map(([idx, nums]) => [Number(idx), nums] as [number, string[]])\n        .sort((a, b) => a[0] - b[0]);\n\n    return {\n        duplicatesByNumber,\n        pairs,\n        duplicatesByIndex,\n        normalize: (s: string) => normalizeOne(s, options)\n    };\n}\n","/**\n * Markdown Renderer\n *\n * Shared markdown rendering utility.\n * Uses marked for parsing and optionally highlight.js for code highlighting.\n */\n\nimport { H } from \"fest/lure\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface RenderOptions {\n    /** Enable syntax highlighting for code blocks */\n    syntaxHighlight?: boolean;\n    /** Enable GitHub Flavored Markdown */\n    gfm?: boolean;\n    /** Sanitize HTML output */\n    sanitize?: boolean;\n    /** Base URL for relative links */\n    baseUrl?: string;\n}\n\nexport interface MarkdownResult {\n    html: string;\n    element?: HTMLElement;\n}\n\n// ============================================================================\n// SIMPLE MARKDOWN PARSER\n// ============================================================================\n\n/**\n * Simple markdown to HTML converter\n * Handles common markdown syntax without external dependencies\n */\nfunction parseMarkdown(markdown: string): string {\n    let html = markdown;\n\n    // Escape HTML entities for code content\n    const escapeHtml = (text: string) => text\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n\n    // Process code blocks first (before other transformations)\n    html = html.replace(/```(\\w*)\\n([\\s\\S]*?)```/g, (_, lang, code) => {\n        const escapedCode = escapeHtml(code.trim());\n        return `<pre><code class=\"language-${lang || 'text'}\">${escapedCode}</code></pre>`;\n    });\n\n    // Inline code\n    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\n\n    // Headers (must be at start of line)\n    html = html.replace(/^######\\s+(.+)$/gm, '<h6>$1</h6>');\n    html = html.replace(/^#####\\s+(.+)$/gm, '<h5>$1</h5>');\n    html = html.replace(/^####\\s+(.+)$/gm, '<h4>$1</h4>');\n    html = html.replace(/^###\\s+(.+)$/gm, '<h3>$1</h3>');\n    html = html.replace(/^##\\s+(.+)$/gm, '<h2>$1</h2>');\n    html = html.replace(/^#\\s+(.+)$/gm, '<h1>$1</h1>');\n\n    // Bold and italic\n    html = html.replace(/\\*\\*\\*(.+?)\\*\\*\\*/g, '<strong><em>$1</em></strong>');\n    html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n    html = html.replace(/\\*(.+?)\\*/g, '<em>$1</em>');\n    html = html.replace(/___(.+?)___/g, '<strong><em>$1</em></strong>');\n    html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');\n    html = html.replace(/_(.+?)_/g, '<em>$1</em>');\n\n    // Strikethrough\n    html = html.replace(/~~(.+?)~~/g, '<del>$1</del>');\n\n    // Blockquotes\n    html = html.replace(/^>\\s+(.+)$/gm, '<blockquote>$1</blockquote>');\n\n    // Horizontal rules\n    html = html.replace(/^(-{3,}|_{3,}|\\*{3,})$/gm, '<hr>');\n\n    // Unordered lists\n    html = html.replace(/^[\\*\\-]\\s+(.+)$/gm, '<li>$1</li>');\n    html = html.replace(/(<li>.*<\\/li>\\n?)+/g, '<ul>$&</ul>');\n\n    // Ordered lists\n    html = html.replace(/^\\d+\\.\\s+(.+)$/gm, '<li>$1</li>');\n\n    // Links [text](url)\n    html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" rel=\"noopener\">$1</a>');\n\n    // Images ![alt](url)\n    html = html.replace(/!\\[([^\\]]*)\\]\\(([^)]+)\\)/g, '<img src=\"$2\" alt=\"$1\" loading=\"lazy\">');\n\n    // Paragraphs (double newlines)\n    html = html.replace(/\\n\\n+/g, '</p><p>');\n\n    // Single newlines to <br>\n    html = html.replace(/\\n/g, '<br>');\n\n    // Wrap in paragraph if not already\n    if (!html.startsWith('<')) {\n        html = `<p>${html}</p>`;\n    }\n\n    // Clean up empty paragraphs\n    html = html.replace(/<p>\\s*<\\/p>/g, '');\n    html = html.replace(/<p><br><\\/p>/g, '');\n\n    return html;\n}\n\n// ============================================================================\n// MARKDOWN RENDERING\n// ============================================================================\n\n/**\n * Render markdown to HTML string\n */\nexport async function renderMarkdown(\n    markdown: string,\n    options: RenderOptions = {}\n): Promise<string> {\n    const { gfm = true } = options;\n\n    // Try to use marked library if available\n    try {\n        const { marked } = await import(\"marked\");\n        return await marked.parse(markdown, { gfm, breaks: true });\n    } catch {\n        // Fallback to simple parser\n        return parseMarkdown(markdown);\n    }\n}\n\n/**\n * Render markdown to DOM element\n */\nexport async function renderMarkdownToElement(\n    markdown: string,\n    options: RenderOptions = {}\n): Promise<HTMLElement> {\n    const html = await renderMarkdown(markdown, options);\n    return H`<div class=\"markdown-body\">${html}</div>` as HTMLElement;\n}\n\n/**\n * Render markdown synchronously (simple parser only)\n */\nexport function renderMarkdownSync(markdown: string): string {\n    return parseMarkdown(markdown);\n}\n\n/**\n * Extract plain text from markdown\n */\nexport function stripMarkdown(markdown: string): string {\n    return markdown\n        // Remove code blocks\n        .replace(/```[\\s\\S]*?```/g, '')\n        .replace(/`[^`]+`/g, '')\n        // Remove headers\n        .replace(/^#+\\s+/gm, '')\n        // Remove emphasis\n        .replace(/[*_]{1,3}([^*_]+)[*_]{1,3}/g, '$1')\n        // Remove links but keep text\n        .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1')\n        // Remove images\n        .replace(/!\\[[^\\]]*\\]\\([^)]+\\)/g, '')\n        // Remove blockquotes\n        .replace(/^>\\s+/gm, '')\n        // Remove horizontal rules\n        .replace(/^[-_*]{3,}$/gm, '')\n        // Trim whitespace\n        .trim();\n}\n\n/**\n * Extract title from markdown (first h1 or first line)\n */\nexport function extractTitle(markdown: string): string {\n    const h1Match = markdown.match(/^#\\s+(.+)$/m);\n    if (h1Match) return h1Match[1].trim();\n\n    const firstLine = markdown.split('\\n')[0];\n    return stripMarkdown(firstLine).slice(0, 100);\n}\n\n/**\n * Check if content is likely markdown\n */\nexport function isLikelyMarkdown(content: string): boolean {\n    const mdPatterns = [\n        /^#+ /m,           // Headers\n        /\\*\\*[^*]+\\*\\*/,   // Bold\n        /\\[[^\\]]+\\]\\([^)]+\\)/, // Links\n        /```[\\s\\S]*?```/,  // Code blocks\n        /^[-*] /m,         // Lists\n        /^>\\s/m            // Blockquotes\n    ];\n\n    return mdPatterns.some(pattern => pattern.test(content));\n}\n","import { H } from \"fest/lure\";\nimport type { DocCollection, DocEntry, DocParser } from \"../utils/Types\";\nimport { formatDateTime, sanitizeDocSnippet, truncateDocSnippet } from \"@rs-core/text\";\n\n//\nexport const parseMarkdownEntry: DocParser = async ({ collection, file, filePath }) => {\n    const text = await file.text();\n    const rawTitleLine = text.trim().split(/\\r?\\n/).find((line) => line.trim().length) || \"\";\n    const sanitizedTitle = sanitizeDocSnippet(rawTitleLine);\n    const fallbackTitle = sanitizeDocSnippet(file.name.replace(/\\.[^.]+$/, \"\")) || file.name;\n    const title = sanitizedTitle || fallbackTitle;\n    const summarySource = text.trim().split(/\\r?\\n/).slice(0, 6).join(\" \");\n    const summary = truncateDocSnippet(sanitizeDocSnippet(summarySource));\n    const sanitizedBody = sanitizeDocSnippet(text);\n\n    //\n    const blob = new Blob([text], { type: \"text/markdown\" });\n    const url = URL.createObjectURL(blob);\n    const wordCount = text.split(/\\s+/).filter(Boolean).length;\n\n    const $setter = (el) => {\n        el?.renderMarkdown?.(text);\n    }\n\n    const entry: DocEntry = {\n        id: `${collection.id}:${filePath}`,\n        title,\n        subtitle: formatDateTime(file.lastModified),\n        summary: summary || undefined,\n        path: filePath,\n        fileName: file.name,\n        collectionId: collection.id,\n        modifiedAt: file.lastModified,\n        wordCount,\n        searchText: [title, summary, truncateDocSnippet(sanitizedBody, 20000)].filter(Boolean).join(\" \\n\").toLowerCase(),\n        renderPreview: (container) => {\n            container.replaceChildren(\n                H`<div class=\"doc-preview-frame\">\n                    <header class=\"doc-preview-header\">\n                        <div>\n                            <h2>${title || file.name}</h2>\n                            <p class=\"doc-subtitle\">Updated ${formatDateTime(file.lastModified)}</p>\n                        </div>\n                        ${wordCount ? H`<span class=\"doc-meta-tag\">${wordCount} words</span>` : null}\n                    </header>\n                    <md-view ref=${$setter} src=${url}></md-view>\n                </div>`\n            );\n        },\n        //dispose: () => URL.revokeObjectURL(url),\n        raw: text\n    };\n\n    return entry;\n};\n\n//\nexport const unique = <T,>(values: T[]) => Array.from(new Set(values));\nexport const normalizeCollections = (collections: DocCollection[]): DocCollection[] => {\n    return collections.map((collection) => {\n        const dirs = collection.dirs?.length\n            ? collection.dirs.slice()\n            : collection.dir\n                ? [collection.dir]\n                : [];\n        const normalized = { ...collection, dirs };\n        if (!normalized.emptyState && collection.description) {\n            normalized.emptyState = collection.description;\n        }\n        return normalized;\n    });\n};\n\n//\nexport const ensureCollections = async (COLLECTIONS) => {\n    for (const collection of COLLECTIONS) {\n        const dirs = collection.dirs ?? (collection.dir ? [collection.dir] : []);\n        for (const dir of dirs) {\n            try {\n                await getDirectoryHandle(null, dir, { create: true } as any);\n            } catch (error) {\n                console.warn(\"Failed to ensure directory\", dir, error);\n            }\n        }\n    }\n};\n","/**\n * File Utilities\n *\n * Common file handling utilities used across views.\n */\n\n// ============================================================================\n// FILE TYPE DETECTION\n// ============================================================================\n\n/**\n * Check if a file is a markdown file\n */\nexport function isMarkdownFile(file: File | string): boolean {\n    const name = typeof file === \"string\" ? file : file.name;\n    const type = typeof file === \"string\" ? \"\" : file.type;\n\n    const mdExtensions = /\\.(md|markdown|mdown|mkd|mkdn|mdtxt|mdtext)$/i;\n    return mdExtensions.test(name) || type === \"text/markdown\";\n}\n\n/**\n * Check if a file is a text file\n */\nexport function isTextFile(file: File | string): boolean {\n    const name = typeof file === \"string\" ? file : file.name;\n    const type = typeof file === \"string\" ? \"\" : file.type;\n\n    if (type.startsWith(\"text/\")) return true;\n\n    const textExtensions = /\\.(txt|text|log|json|xml|yaml|yml|toml|ini|cfg|conf)$/i;\n    return textExtensions.test(name);\n}\n\n/**\n * Check if a file is an image\n */\nexport function isImageFile(file: File | string): boolean {\n    const name = typeof file === \"string\" ? file : file.name;\n    const type = typeof file === \"string\" ? \"\" : file.type;\n\n    if (type.startsWith(\"image/\")) return true;\n\n    const imageExtensions = /\\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|avif)$/i;\n    return imageExtensions.test(name);\n}\n\n/**\n * Check if a file is a code file\n */\nexport function isCodeFile(file: File | string): boolean {\n    const name = typeof file === \"string\" ? file : file.name;\n\n    const codeExtensions = /\\.(js|ts|jsx|tsx|py|rb|go|rs|c|cpp|h|hpp|java|kt|swift|php|cs|css|scss|sass|less|html|vue|svelte)$/i;\n    return codeExtensions.test(name);\n}\n\n// ============================================================================\n// FILE READING\n// ============================================================================\n\n/**\n * Read a file as text\n */\nexport async function readFileAsText(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = () => reject(new Error(\"Failed to read file\"));\n        reader.readAsText(file);\n    });\n}\n\n/**\n * Read a file as data URL\n */\nexport async function readFileAsDataURL(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = () => reject(new Error(\"Failed to read file\"));\n        reader.readAsDataURL(file);\n    });\n}\n\n/**\n * Read a file as array buffer\n */\nexport async function readFileAsArrayBuffer(file: File): Promise<ArrayBuffer> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as ArrayBuffer);\n        reader.onerror = () => reject(new Error(\"Failed to read file\"));\n        reader.readAsArrayBuffer(file);\n    });\n}\n\n// ============================================================================\n// FILE CREATION\n// ============================================================================\n\n/**\n * Create a text file\n */\nexport function createTextFile(content: string, filename: string, mimeType = \"text/plain\"): File {\n    return new File([content], filename, { type: mimeType });\n}\n\n/**\n * Create a markdown file\n */\nexport function createMarkdownFile(content: string, filename = \"document.md\"): File {\n    return new File([content], filename, { type: \"text/markdown\" });\n}\n\n/**\n * Create a JSON file\n */\nexport function createJsonFile(data: unknown, filename = \"data.json\"): File {\n    const content = JSON.stringify(data, null, 2);\n    return new File([content], filename, { type: \"application/json\" });\n}\n\n// ============================================================================\n// FILE DOWNLOAD\n// ============================================================================\n\n/**\n * Trigger a file download\n */\nexport function downloadFile(file: File | Blob, filename?: string): void {\n    const url = URL.createObjectURL(file);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = filename || (file instanceof File ? file.name : \"download\");\n    a.click();\n    setTimeout(() => URL.revokeObjectURL(url), 250);\n}\n\n/**\n * Download text content as a file\n */\nexport function downloadTextFile(content: string, filename: string, mimeType = \"text/plain\"): void {\n    const blob = new Blob([content], { type: mimeType });\n    downloadFile(blob, filename);\n}\n\n/**\n * Download markdown content\n */\nexport function downloadMarkdown(content: string, filename = \"document.md\"): void {\n    downloadTextFile(content, filename, \"text/markdown\");\n}\n\n// ============================================================================\n// FILE PICKING\n// ============================================================================\n\n/**\n * Open a file picker dialog\n */\nexport async function pickFile(accept = \"*\"): Promise<File | null> {\n    return new Promise((resolve) => {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.accept = accept;\n        input.onchange = () => {\n            resolve(input.files?.[0] || null);\n        };\n        input.oncancel = () => resolve(null);\n        input.click();\n    });\n}\n\n/**\n * Open a file picker for multiple files\n */\nexport async function pickFiles(accept = \"*\"): Promise<File[]> {\n    return new Promise((resolve) => {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.accept = accept;\n        input.multiple = true;\n        input.onchange = () => {\n            resolve(Array.from(input.files || []));\n        };\n        input.oncancel = () => resolve([]);\n        input.click();\n    });\n}\n\n/**\n * Open a markdown file picker\n */\nexport async function pickMarkdownFile(): Promise<File | null> {\n    return pickFile(\".md,.markdown,.txt,text/markdown,text/plain\");\n}\n\n// ============================================================================\n// FILE SYSTEM ACCESS API\n// ============================================================================\n\n/**\n * Save file using File System Access API (with fallback)\n */\nexport async function saveFile(\n    content: string,\n    suggestedName = \"document.md\",\n    types = [{ description: \"Markdown\", accept: { \"text/markdown\": [\".md\"] } }]\n): Promise<boolean> {\n    try {\n        if (\"showSaveFilePicker\" in window) {\n            const handle = await (window as any).showSaveFilePicker({\n                suggestedName,\n                types\n            });\n            const writable = await handle.createWritable();\n            await writable.write(content);\n            await writable.close();\n            return true;\n        }\n    } catch (error) {\n        if ((error as Error).name === \"AbortError\") {\n            return false;\n        }\n    }\n\n    // Fallback to download\n    downloadTextFile(content, suggestedName);\n    return true;\n}\n\n/**\n * Open file using File System Access API (with fallback)\n */\nexport async function openFile(\n    types = [{ description: \"Markdown\", accept: { \"text/markdown\": [\".md\", \".markdown\"] } }]\n): Promise<{ content: string; filename: string } | null> {\n    try {\n        if (\"showOpenFilePicker\" in window) {\n            const [handle] = await (window as any).showOpenFilePicker({ types });\n            const file = await handle.getFile();\n            const content = await file.text();\n            return { content, filename: file.name };\n        }\n    } catch (error) {\n        if ((error as Error).name === \"AbortError\") {\n            return null;\n        }\n    }\n\n    // Fallback to file input\n    const file = await pickFile();\n    if (!file) return null;\n\n    const content = await readFileAsText(file);\n    return { content, filename: file.name };\n}\n","/**\n * Lazy loading utility for components and their styles\n */\n\nexport interface LazyComponent<T> {\n    component: T;\n    dispose?: () => void;\n}\n\nexport interface LazyLoaderOptions {\n    cssPath?: string;\n    componentName: string;\n}\n\n/**\n * Lazy load a component and its CSS\n */\nexport async function lazyLoadComponent<T>(\n    importFn: () => Promise<T>,\n    options: LazyLoaderOptions\n): Promise<LazyComponent<T>> {\n    const { cssPath, componentName } = options;\n\n    console.log(`[LazyLoader] Loading component: ${componentName}`);\n\n    // Load CSS first if specified\n    if (cssPath) {\n        try {\n            await loadCSS(cssPath);\n        } catch (error) {\n            console.warn(`[LazyLoader] Failed to load CSS for ${componentName}:`, error);\n        }\n    }\n\n    // Load the component\n    try {\n        const component = await importFn();\n        console.log(`[LazyLoader] Successfully loaded component: ${componentName}`);\n        return { component };\n    } catch (error) {\n        console.error(`[LazyLoader] Failed to load component ${componentName}:`, error);\n        throw error;\n    }\n}\n\n/**\n * Load CSS dynamically\n */\nasync function loadCSS(href: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n        // Check if already loaded\n        const existingLinks = document.querySelectorAll(`link[href=\"${href}\"]`);\n        if (existingLinks.length > 0) {\n            resolve();\n            return;\n        }\n\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = href;\n        link.onload = () => resolve();\n        link.onerror = () => reject(new Error(`Failed to load CSS: ${href}`));\n\n        document.head.appendChild(link);\n    });\n}\n\n/**\n * Cache for loaded components to avoid re-loading\n */\nconst componentCache = new Map<string, LazyComponent<any>>();\n\n/**\n * Get or load a cached component\n */\nexport async function getCachedComponent<T>(\n    cacheKey: string,\n    importFn: () => Promise<T>,\n    options: LazyLoaderOptions\n): Promise<LazyComponent<T>> {\n    if (componentCache.has(cacheKey)) {\n        return componentCache.get(cacheKey)!;\n    }\n\n    const lazyComponent = await lazyLoadComponent(importFn, options);\n    componentCache.set(cacheKey, lazyComponent);\n    return lazyComponent;\n}\n\n/**\n * Clear component cache (useful for development/testing)\n */\nexport function clearComponentCache(): void {\n    componentCache.clear();\n}\n\n/**\n * Dispose of cached components\n */\nexport function disposeCachedComponents(): void {\n    for (const [, lazyComponent] of componentCache) {\n        if (lazyComponent.dispose) {\n            lazyComponent.dispose();\n        }\n    }\n    componentCache.clear();\n}","export interface FileHandlingOptions {\n    onFilesAdded: (files: File[]) => void | Promise<void>;\n    onError?: (error: string) => void;\n    onProgress?: (file: File, loaded: number, total: number) => void;\n}\n\nexport class FileHandler {\n    private options: FileHandlingOptions;\n    private dragOverElements: Set<HTMLElement> = new Set();\n\n    constructor(options: FileHandlingOptions) {\n        this.options = { ...options }; // Clone to avoid mutations\n    }\n\n    /**\n     * Programmatically add files into the same pipeline as UI selection / DnD / paste.\n     * Used by PWA share-target and launchQueue ingestion.\n     */\n    addFiles(files: File[]): void | Promise<void> {\n        if (!Array.isArray(files) || files.length === 0) return;\n        return this.options.onFilesAdded(files);\n    }\n\n    /**\n     * Set up file input element with file selection\n     */\n    setupFileInput(container: HTMLElement, accept: string = \"*\"): HTMLInputElement {\n        const fileInput = document.createElement('input');\n        fileInput.type = 'file';\n        fileInput.multiple = true;\n        fileInput.accept = accept;\n        fileInput.style.display = 'none';\n\n        fileInput.addEventListener('change', (e) => {\n            const files = Array.from((e.target as HTMLInputElement).files || []);\n            if (files.length > 0) {\n                this.options.onFilesAdded(files);\n            }\n            // Reset input value to allow selecting the same file again\n            fileInput.value = '';\n        });\n\n        container.append(fileInput);\n        return fileInput;\n    }\n\n    /**\n     * Set up drag and drop handling for an element\n     */\n    setupDragAndDrop(element: HTMLElement): void {\n        element.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.addDragOver(element);\n        });\n\n        element.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.removeDragOver(element);\n        });\n\n        element.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.removeDragOver(element);\n\n            const files = Array.from(e.dataTransfer?.files || []);\n            if (files.length > 0) {\n                this.options.onFilesAdded(files);\n            }\n        });\n    }\n\n    /**\n     * Set up paste handling for an element\n     */\n    setupPasteHandling(element: HTMLElement): void {\n        element.addEventListener('paste', (e) => {\n            const files = Array.from(e.clipboardData?.files || []);\n            if (files.length > 0) {\n                e.preventDefault();\n                this.options.onFilesAdded(files);\n            }\n        });\n    }\n\n    /**\n     * Set up all file handling for a container (file input button, drag & drop, paste)\n     */\n    setupCompleteFileHandling(\n        container: HTMLElement,\n        fileSelectButton: HTMLElement,\n        dropZone?: HTMLElement,\n        accept: string = \"*\"\n    ): void {\n        // Setup file input\n        const fileInput = this.setupFileInput(container, accept);\n\n        // Connect file select button\n        fileSelectButton.addEventListener('click', () => {\n            fileInput.click();\n        });\n\n        // Setup drag and drop if drop zone provided\n        if (dropZone) {\n            this.setupDragAndDrop(dropZone);\n        }\n\n        // Setup paste handling\n        this.setupPasteHandling(container);\n    }\n\n    /**\n     * Validate file types and sizes\n     */\n    validateFiles(files: File[], options: {\n        maxSize?: number; // in bytes\n        allowedTypes?: string[];\n        maxFiles?: number;\n    } = {}): { valid: File[], invalid: { file: File, reason: string }[] } {\n        const { maxSize, allowedTypes, maxFiles } = options;\n        const valid: File[] = [];\n        const invalid: { file: File, reason: string }[] = [];\n\n        // Check max files limit\n        if (maxFiles && files.length > maxFiles) {\n            invalid.push(...files.slice(maxFiles).map(file => ({\n                file,\n                reason: `Too many files. Maximum ${maxFiles} files allowed.`\n            })));\n            files = files.slice(0, maxFiles);\n        }\n\n        for (const file of files) {\n            let isValid = true;\n            let reason = '';\n\n            // Check file size\n            if (maxSize && file.size > maxSize) {\n                isValid = false;\n                reason = `File too large. Maximum size is ${this.formatFileSize(maxSize)}.`;\n            }\n\n            // Check file type\n            if (allowedTypes && allowedTypes.length > 0) {\n                const isAllowed = allowedTypes.some(type => {\n                    if (type.includes('*')) {\n                        // Wildcard matching (e.g., \"image/*\")\n                        return file.type.startsWith(type.replace('/*', '/'));\n                    }\n                    return file.type === type;\n                });\n\n                if (!isAllowed) {\n                    isValid = false;\n                    reason = reason || `File type not allowed. Allowed types: ${allowedTypes.join(', ')}.`;\n                }\n            }\n\n            if (isValid) {\n                valid.push(file);\n            } else {\n                invalid.push({ file, reason });\n            }\n        }\n\n        return { valid, invalid };\n    }\n\n    /**\n     * Read file content as text\n     */\n    async readFileAsText(file: File, onProgress?: (loaded: number, total: number) => void): Promise<string> {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => resolve(reader.result as string);\n            reader.onerror = () => reject(new Error(`Failed to read file: ${file.name}`));\n            if (onProgress) {\n                reader.onprogress = (e) => {\n                    if (e.lengthComputable) {\n                        onProgress(e.loaded, e.total);\n                    }\n                };\n            }\n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * Read file content as ArrayBuffer\n     */\n    async readFileAsArrayBuffer(file: File): Promise<ArrayBuffer> {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => resolve(reader.result as ArrayBuffer);\n            reader.onerror = () => reject(new Error(`Failed to read file: ${file.name}`));\n            reader.readAsArrayBuffer(file);\n        });\n    }\n\n    /**\n     * Read file content as Data URL\n     */\n    async readFileAsDataURL(file: File): Promise<string> {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => resolve(reader.result as string);\n            reader.onerror = () => reject(new Error(`Failed to read file: ${file.name}`));\n            reader.readAsDataURL(file);\n        });\n    }\n\n    /**\n     * Read multiple files as text\n     */\n    async readFilesAsText(\n        files: File[],\n        onProgress?: (file: File, loaded: number, total: number) => void\n    ): Promise<{ file: File, content: string }[]> {\n        const results: { file: File, content: string }[] = [];\n\n        for (const file of files) {\n            try {\n                const content = await this.readFileAsText(file, (loaded, total) => {\n                    onProgress?.(file, loaded, total);\n                });\n                results.push({ file, content });\n            } catch (error) {\n                console.warn(`Failed to read file ${file.name}:`, error);\n                // Continue with other files\n            }\n        }\n\n        return results;\n    }\n\n    /**\n     * Get file icon based on MIME type\n     */\n    getFileIcon(mimeType: string): string {\n        if (mimeType.startsWith('image/')) return '';\n        if (mimeType === 'application/pdf') return '';\n        if (mimeType.includes('json')) return '';\n        if (mimeType.includes('text') || mimeType.includes('markdown')) return '';\n        if (mimeType.includes('javascript') || mimeType.includes('typescript')) return '';\n        if (mimeType.includes('css')) return '';\n        if (mimeType.includes('html')) return '';\n        if (mimeType.startsWith('video/')) return '';\n        if (mimeType.startsWith('audio/')) return '';\n        if (mimeType.includes('zip') || mimeType.includes('rar')) return '';\n        return '';\n    }\n\n    /**\n     * Format file size for display\n     */\n    formatFileSize(bytes: number): string {\n        if (bytes < 1024) return `${bytes} B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n        if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n        return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n    }\n\n    /**\n     * Check if a file is likely a markdown file\n     */\n    isMarkdownFile(file: File): boolean {\n        const name = file.name.toLowerCase();\n        const type = file.type.toLowerCase();\n\n        return name.endsWith('.md') ||\n            name.endsWith('.markdown') ||\n            name.endsWith('.mdown') ||\n            name.endsWith('.mkd') ||\n            name.endsWith('.mkdn') ||\n            name.endsWith('.mdtxt') ||\n            name.endsWith('.mdtext') ||\n            type.includes('markdown') ||\n            type.includes('text');\n    }\n\n    /**\n     * Check if a file is an image\n     */\n    isImageFile(file: File): boolean {\n        return file.type.startsWith('image/');\n    }\n\n    /**\n     * Check if a file is a text file\n     */\n    isTextFile(file: File): boolean {\n        return file.type.startsWith('text/') ||\n            this.isMarkdownFile(file) ||\n            file.type.includes('javascript') ||\n            file.type.includes('typescript') ||\n            file.type.includes('css') ||\n            file.type.includes('html') ||\n            file.type.includes('json') ||\n            file.type.includes('xml');\n    }\n\n    /**\n     * Check if a file is a binary file\n     */\n    isBinaryFile(file: File): boolean {\n        return !this.isTextFile(file) && !this.isImageFile(file);\n    }\n\n    /**\n     * Get file metadata\n     */\n    getFileMetadata(file: File): {\n        name: string;\n        extension: string;\n        size: number;\n        type: string;\n        lastModified: number;\n        isText: boolean;\n        isImage: boolean;\n        isBinary: boolean;\n        formattedSize: string;\n        icon: string;\n    } {\n        const extension = file.name.split('.').pop()?.toLowerCase() || '';\n        const isText = this.isTextFile(file);\n        const isImage = this.isImageFile(file);\n        const isBinary = this.isBinaryFile(file);\n\n        return {\n            name: file.name,\n            extension,\n            size: file.size,\n            type: file.type,\n            lastModified: file.lastModified,\n            isText,\n            isImage,\n            isBinary,\n            formattedSize: this.formatFileSize(file.size),\n            icon: this.getFileIcon(file.type)\n        };\n    }\n\n    /**\n     * Get files metadata for multiple files\n     */\n    getFilesMetadata(files: File[]): Array<ReturnType<FileHandler['getFileMetadata']>> {\n        return files.map(file => this.getFileMetadata(file));\n    }\n\n    private addDragOver(element: HTMLElement): void {\n        if (!this.dragOverElements.has(element)) {\n            this.dragOverElements.add(element);\n            element.classList.add('drag-over');\n        }\n    }\n\n    private removeDragOver(element: HTMLElement): void {\n        if (this.dragOverElements.has(element)) {\n            this.dragOverElements.delete(element);\n            element.classList.remove('drag-over');\n        }\n    }\n\n    /**\n     * Manually trigger file processing with the provided files\n     */\n    processFiles(files: File[]): void {\n        this.options.onFilesAdded(files);\n    }\n\n    /**\n     * Create a downloadable file from content\n     */\n    createDownloadableFile(content: string | Blob | ArrayBuffer, filename: string, mimeType?: string): void {\n        let blob: Blob;\n\n        if (content instanceof Blob) {\n            blob = content;\n        } else if (content instanceof ArrayBuffer) {\n            blob = new Blob([content], { type: mimeType || 'application/octet-stream' });\n        } else {\n            blob = new Blob([content], { type: mimeType || 'text/plain;charset=utf-8' });\n        }\n\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        a.style.display = 'none';\n\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n\n        // Clean up the URL object\n        setTimeout(() => URL.revokeObjectURL(url), 100);\n    }\n\n    /**\n     * Create a shareable file URL\n     */\n    createFileURL(file: File): string {\n        return URL.createObjectURL(file);\n    }\n\n    /**\n     * Revoke a file URL to free memory\n     */\n    revokeFileURL(url: string): void {\n        URL.revokeObjectURL(url);\n    }\n\n    /**\n     * Clean up event listeners and references\n     */\n    destroy(): void {\n        this.dragOverElements.clear();\n    }\n}\n\n/**\n * Utility function to create a file handler with default options\n */\nexport function createFileHandler(options: FileHandlingOptions): FileHandler {\n    return new FileHandler(options);\n}\n\n/**\n * Utility function to read markdown file from URL\n */\nexport async function readMarkdownFromUrl(url: string): Promise<string | null> {\n    try {\n        const response = await fetch(url, { credentials: 'include', cache: 'no-store' });\n        if (!response.ok) return null;\n\n        const contentType = response.headers.get('content-type') || '';\n        if (!contentType.includes('text') && !contentType.includes('markdown')) {\n            return null;\n        }\n\n        return await response.text();\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Extract text from DataTransfer (for paste/drop operations)\n */\nexport async function extractTextFromDataTransfer(dt: DataTransfer): Promise<string | null> {\n    try {\n        const uriList = dt.getData(\"text/uri-list\");\n        if (uriList?.trim()) return uriList.trim();\n    } catch {\n        // ignore\n    }\n\n    try {\n        const text = dt.getData(\"text/plain\");\n        if (text?.trim()) return text;\n    } catch {\n        // ignore\n    }\n\n    return null;\n}","export interface VoiceInputOptions {\n    language?: string;\n    continuous?: boolean;\n    interimResults?: boolean;\n    maxAlternatives?: number;\n}\n\nexport class VoiceInputManager {\n    private recognition: any = null;\n    private isListening: boolean = false;\n    private options: VoiceInputOptions;\n\n    constructor(options: VoiceInputOptions = {}) {\n        this.options = {\n            language: 'en-US',\n            continuous: false,\n            interimResults: false,\n            maxAlternatives: 1,\n            ...options\n        };\n\n        this.initializeRecognition();\n    }\n\n    /**\n     * Initialize speech recognition if supported\n     */\n    private initializeRecognition(): void {\n        // Check for browser support\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n\n        if (!SpeechRecognition) {\n            console.warn('Speech recognition not supported in this browser');\n            return;\n        }\n\n        this.recognition = new SpeechRecognition();\n        this.recognition.lang = this.options.language;\n        this.recognition.continuous = this.options.continuous;\n        this.recognition.interimResults = this.options.interimResults;\n        this.recognition.maxAlternatives = this.options.maxAlternatives;\n    }\n\n    /**\n     * Check if speech recognition is supported\n     */\n    isSupported(): boolean {\n        return this.recognition !== null;\n    }\n\n    /**\n     * Start listening for speech input\n     */\n    startListening(): Promise<string> {\n        return new Promise((resolve, reject) => {\n            if (!this.recognition) {\n                reject(new Error('Speech recognition not supported'));\n                return;\n            }\n\n            if (this.isListening) {\n                reject(new Error('Already listening'));\n                return;\n            }\n\n            let done = false;\n            const finish = (value: string | null) => {\n                if (done) return;\n                done = true;\n                this.isListening = false;\n                try {\n                    this.recognition.stop();\n                } catch {\n                    // ignore\n                }\n                if (value) {\n                    resolve(value);\n                } else {\n                    reject(new Error('No speech detected'));\n                }\n            };\n\n            // Set up event handlers\n            this.recognition.onresult = (e: any) => {\n                const text = String(e?.results?.[0]?.[0]?.transcript || \"\").trim();\n                finish(text || null);\n            };\n\n            this.recognition.onerror = () => finish(null);\n            this.recognition.onend = () => finish(null);\n\n            // Start recognition\n            try {\n                this.isListening = true;\n                this.recognition.start();\n            } catch (error) {\n                this.isListening = false;\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * Stop listening\n     */\n    stopListening(): void {\n        if (this.recognition && this.isListening) {\n            try {\n                this.recognition.stop();\n            } catch {\n                // ignore\n            }\n            this.isListening = false;\n        }\n    }\n\n    /**\n     * Check if currently listening\n     */\n    getIsListening(): boolean {\n        return this.isListening;\n    }\n\n    /**\n     * Set recognition language\n     */\n    setLanguage(language: string): void {\n        this.options.language = language;\n        if (this.recognition) {\n            this.recognition.lang = language;\n        }\n    }\n\n    /**\n     * Get available languages (limited support in browsers)\n     */\n    getAvailableLanguages(): string[] {\n        // Most browsers don't expose available languages\n        // This is a common set supported by Chrome\n        return [\n            'en-US', 'en-GB', 'en-AU', 'en-CA', 'en-IN', 'en-IE',\n            'es-ES', 'es-US', 'es-MX', 'es-AR', 'es-CO', 'es-CL',\n            'fr-FR', 'fr-CA', 'de-DE', 'it-IT', 'pt-BR', 'pt-PT',\n            'ru-RU', 'ja-JP', 'ko-KR', 'zh-CN', 'zh-TW', 'ar-SA',\n            'hi-IN', 'nl-NL', 'sv-SE', 'no-NO', 'da-DK', 'fi-FI'\n        ];\n    }\n\n    /**\n     * Clean up resources\n     */\n    destroy(): void {\n        this.stopListening();\n        this.recognition = null;\n    }\n}\n\n/**\n * Get speech prompt with timeout\n */\nexport async function getSpeechPrompt(\n    options: VoiceInputOptions & { timeout?: number } = {}\n): Promise<string | null> {\n    const { timeout = 10000, ...voiceOptions } = options;\n\n    const voiceManager = new VoiceInputManager(voiceOptions);\n\n    if (!voiceManager.isSupported()) {\n        console.warn('Speech recognition not supported');\n        return null;\n    }\n\n    try {\n        // Create a promise that resolves when speech is detected or times out\n        const speechPromise = voiceManager.startListening();\n\n        // Create a timeout promise\n        const timeoutPromise = new Promise<string>((_, reject) => {\n            setTimeout(() => {\n                voiceManager.stopListening();\n                reject(new Error('Speech recognition timeout'));\n            }, timeout);\n        });\n\n        // Race between speech detection and timeout\n        return await Promise.race([speechPromise, timeoutPromise]);\n\n    } catch (error) {\n        console.warn('Speech recognition failed:', error);\n        return null;\n    } finally {\n        voiceManager.destroy();\n    }\n}\n\n/**\n * Check if speech recognition is available\n */\nexport function isSpeechRecognitionAvailable(): boolean {\n    return !!(window as any).SpeechRecognition || !!(window as any).webkitSpeechRecognition;\n}\n\n/**\n * Get user media permission for microphone (if needed)\n */\nexport async function requestMicrophonePermission(): Promise<boolean> {\n    try {\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        // Stop the stream immediately after getting permission\n        stream.getTracks().forEach(track => track.stop());\n        return true;\n    } catch {\n        return false;\n    }\n}","import { H } from \"fest/lure\";\n\n// Import built-in templates\nimport { DEFAULT_TEMPLATES } from \"@rs-com/core/BuiltInAI\";\n\nexport interface PromptTemplate {\n    id?: string;\n    name: string;\n    prompt: string;\n    category?: string;\n    tags?: string[];\n    createdAt?: number;\n    updatedAt?: number;\n    usageCount?: number;\n}\n\nexport interface TemplateManagerOptions {\n    storageKey?: string;\n    defaultTemplates?: PromptTemplate[];\n}\n\nexport class TemplateManager {\n    private storageKey: string;\n    private templates: PromptTemplate[] = [];\n    private defaultTemplates: PromptTemplate[];\n\n    constructor(options: TemplateManagerOptions = {}) {\n        this.storageKey = options.storageKey || 'rs-prompt-templates';\n        this.defaultTemplates = options.defaultTemplates || this.getDefaultTemplates();\n        this.loadTemplates();\n    }\n\n    /**\n     * Get all templates\n     */\n    getAllTemplates(): PromptTemplate[] {\n        return [...this.templates];\n    }\n\n    /**\n     * Get template by ID\n     */\n    getTemplateById(id: string): PromptTemplate | undefined {\n        return this.templates.find(t => t.id === id);\n    }\n\n    /**\n     * Add a new template\n     */\n    addTemplate(template: Omit<PromptTemplate, 'id' | 'createdAt' | 'updatedAt'>): PromptTemplate {\n        const newTemplate: PromptTemplate = {\n            ...template,\n            id: this.generateId(),\n            createdAt: Date.now(),\n            updatedAt: Date.now(),\n            usageCount: 0\n        };\n\n        this.templates.push(newTemplate);\n        this.saveTemplates();\n        return newTemplate;\n    }\n\n    /**\n     * Update an existing template\n     */\n    updateTemplate(id: string, updates: Partial<PromptTemplate>): boolean {\n        const index = this.templates.findIndex(t => t.id === id);\n        if (index === -1) return false;\n\n        this.templates[index] = {\n            ...this.templates[index],\n            ...updates,\n            updatedAt: Date.now()\n        };\n\n        this.saveTemplates();\n        return true;\n    }\n\n    /**\n     * Remove a template\n     */\n    removeTemplate(id: string): boolean {\n        const index = this.templates.findIndex(t => t.id === id);\n        if (index === -1) return false;\n\n        this.templates.splice(index, 1);\n        this.saveTemplates();\n        return true;\n    }\n\n    /**\n     * Increment usage count for a template\n     */\n    incrementUsageCount(id: string): void {\n        const template = this.templates.find(t => t.id === id);\n        if (template) {\n            template.usageCount = (template.usageCount || 0) + 1;\n            this.saveTemplates();\n        }\n    }\n\n    /**\n     * Search templates by name or content\n     */\n    searchTemplates(query: string): PromptTemplate[] {\n        const lowercaseQuery = query.toLowerCase();\n        return this.templates.filter(template =>\n            template.name.toLowerCase().includes(lowercaseQuery) ||\n            template.prompt.toLowerCase().includes(lowercaseQuery) ||\n            template.tags?.some(tag => tag.toLowerCase().includes(lowercaseQuery))\n        );\n    }\n\n    /**\n     * Get templates by category\n     */\n    getTemplatesByCategory(category: string): PromptTemplate[] {\n        return this.templates.filter(template => template.category === category);\n    }\n\n    /**\n     * Get most used templates\n     */\n    getMostUsedTemplates(limit: number = 5): PromptTemplate[] {\n        return this.templates\n            .sort((a, b) => (b.usageCount || 0) - (a.usageCount || 0))\n            .slice(0, limit);\n    }\n\n    /**\n     * Export templates as JSON\n     */\n    exportTemplates(): string {\n        return JSON.stringify(this.templates, null, 2);\n    }\n\n    /**\n     * Import templates from JSON\n     */\n    importTemplates(jsonData: string): boolean {\n        try {\n            const importedTemplates = JSON.parse(jsonData) as PromptTemplate[];\n\n            // Validate structure\n            if (!Array.isArray(importedTemplates)) {\n                throw new Error('Invalid template data: not an array');\n            }\n\n            for (const template of importedTemplates) {\n                if (!template.name || !template.prompt) {\n                    throw new Error('Invalid template: missing name or prompt');\n                }\n            }\n\n            // Assign new IDs to avoid conflicts\n            const templatesWithIds = importedTemplates.map(template => ({\n                ...template,\n                id: this.generateId(),\n                createdAt: template.createdAt || Date.now(),\n                updatedAt: Date.now()\n            }));\n\n            this.templates.push(...templatesWithIds);\n            this.saveTemplates();\n            return true;\n        } catch (error) {\n            console.error('Failed to import templates:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Reset to default templates\n     */\n    resetToDefaults(): void {\n        this.templates = this.defaultTemplates.map(template => ({\n            ...template,\n            id: this.generateId(),\n            createdAt: Date.now(),\n            updatedAt: Date.now(),\n            usageCount: 0\n        }));\n        this.saveTemplates();\n    }\n\n    /**\n     * Create template editor modal\n     */\n    createTemplateEditor(container: HTMLElement, onSave?: () => void): void {\n        const modal = H`<div class=\"template-editor-modal\">\n      <div class=\"modal-overlay\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h3>Prompt Templates</h3>\n          </div>\n\n          <div class=\"template-list\">\n            ${this.templates.map((template, index) =>\n            H`<div class=\"template-item\">\n                <div class=\"template-header\">\n                  <input type=\"text\" class=\"template-name\" value=\"${template.name}\" data-index=\"${index}\" placeholder=\"Template name\">\n                  <button class=\"btn small remove-template\" data-index=\"${index}\" title=\"Remove template\"></button>\n                </div>\n                <textarea class=\"template-prompt\" data-index=\"${index}\" placeholder=\"Enter your prompt template...\">${template.prompt}</textarea>\n                <div class=\"template-meta\">\n                  ${template.usageCount ? H`<span class=\"usage-count\">Used ${template.usageCount} times</span>` : ''}\n                  ${template.category ? H`<span class=\"category\">${template.category}</span>` : ''}\n                </div>\n              </div>`\n        )}\n          </div>\n\n          <div class=\"modal-actions\">\n            <button class=\"btn\" data-action=\"add-template\">Add Template</button>\n            <button class=\"btn\" data-action=\"reset-defaults\">Reset to Defaults</button>\n            <button class=\"btn primary\" data-action=\"save-templates\">Save Changes</button>\n            <button class=\"btn\" data-action=\"close-editor\">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>` as HTMLElement;\n\n        // Template editor events\n        modal.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.getAttribute('data-action');\n            const index = target.getAttribute('data-index');\n\n            if (action === 'add-template') {\n                this.addTemplate({\n                    name: 'New Template',\n                    prompt: 'Enter your prompt template here...',\n                    category: 'Custom'\n                });\n                modal.remove();\n                this.createTemplateEditor(container, onSave);\n\n            } else if (action === 'reset-defaults') {\n                if (confirm('Are you sure you want to reset all templates to defaults? This will remove all custom templates.')) {\n                    this.resetToDefaults();\n                    modal.remove();\n                    this.createTemplateEditor(container, onSave);\n                }\n\n            } else if (action === 'save-templates') {\n                // Update templates from inputs\n                const nameInputs = modal.querySelectorAll('.template-name') as NodeListOf<HTMLInputElement>;\n                const promptInputs = modal.querySelectorAll('.template-prompt') as NodeListOf<HTMLTextAreaElement>;\n\n                this.templates = Array.from(nameInputs).map((input, i) => {\n                    const index = parseInt(input.getAttribute('data-index') || '0');\n                    const originalTemplate = this.templates[index];\n\n                    return {\n                        ...originalTemplate,\n                        name: input.value.trim() || 'Untitled Template',\n                        prompt: promptInputs[i].value.trim() || 'Enter your prompt...',\n                        updatedAt: Date.now()\n                    };\n                });\n\n                this.saveTemplates();\n                modal.remove();\n                onSave?.();\n\n            } else if (action === 'close-editor') {\n                modal.remove();\n\n            } else if (target.classList.contains('remove-template') && index !== null) {\n                const templateIndex = parseInt(index);\n                const template = this.templates[templateIndex];\n                if (confirm(`Remove template \"${template.name}\"?`)) {\n                    this.removeTemplate(template.id!);\n                    modal.remove();\n                    this.createTemplateEditor(container, onSave);\n                }\n            }\n        });\n\n        container.append(modal);\n    }\n\n    /**\n     * Create template selector dropdown\n     */\n    createTemplateSelect(selectedPrompt?: string): HTMLSelectElement {\n        const select = document.createElement('select');\n        select.className = 'template-select';\n\n        // Add default option\n        const defaultOption = document.createElement('option');\n        defaultOption.value = '';\n        defaultOption.textContent = 'Select Template...';\n        select.append(defaultOption);\n\n        // Add template options\n        this.templates.forEach(template => {\n            const option = document.createElement('option');\n            option.value = template.prompt;\n            option.textContent = template.name;\n            if (template.category) {\n                option.textContent += ` (${template.category})`;\n            }\n            select.append(option);\n        });\n\n        // Set selected value if provided\n        if (selectedPrompt) {\n            select.value = selectedPrompt;\n        }\n\n        return select;\n    }\n\n    private getDefaultTemplates(): PromptTemplate[] {\n        return DEFAULT_TEMPLATES.map(template => ({\n            ...template,\n            id: this.generateId(),\n            createdAt: Date.now(),\n            updatedAt: Date.now(),\n            usageCount: 0\n        }));\n    }\n\n    private generateId(): string {\n        return `template_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    private loadTemplates(): void {\n        try {\n            const stored = localStorage.getItem(this.storageKey);\n            if (stored) {\n                const parsedTemplates = JSON.parse(stored) as PromptTemplate[];\n\n                // Validate and migrate old format\n                this.templates = parsedTemplates.map(template => ({\n                    ...template,\n                    id: template.id || this.generateId(),\n                    createdAt: template.createdAt || Date.now(),\n                    updatedAt: template.updatedAt || Date.now(),\n                    usageCount: template.usageCount || 0\n                }));\n            } else {\n                // Initialize with defaults\n                this.resetToDefaults();\n            }\n        } catch (error) {\n            console.warn('Failed to load templates from storage:', error);\n            this.resetToDefaults();\n        }\n    }\n\n    private saveTemplates(): void {\n        try {\n            localStorage.setItem(this.storageKey, JSON.stringify(this.templates));\n        } catch (error) {\n            console.warn('Failed to save templates to storage:', error);\n        }\n    }\n}\n\n/**\n * Utility function to create a template manager\n */\nexport function createTemplateManager(options?: TemplateManagerOptions): TemplateManager {\n    return new TemplateManager(options);\n}","import { H } from \"fest/lure\";\n\nexport interface HistoryEntry {\n    id?: string;\n    ts: number;\n    prompt: string;\n    before: string; // Input content (file names or text)\n    after: string;  // Output content\n    ok: boolean;\n    error?: string;\n    duration?: number; // Processing time in ms\n    model?: string;    // AI model used\n    tokens?: number;   // Token usage\n}\n\nexport interface HistoryManagerOptions {\n    storageKey?: string;\n    maxEntries?: number;\n    autoSave?: boolean;\n}\n\nexport class HistoryManager {\n    private storageKey: string;\n    private maxEntries: number;\n    private autoSave: boolean;\n    private entries: HistoryEntry[] = [];\n\n    constructor(options: HistoryManagerOptions = {}) {\n        this.storageKey = options.storageKey || 'rs-basic-history';\n        this.maxEntries = options.maxEntries || 100;\n        this.autoSave = options.autoSave !== false;\n        this.loadHistory();\n    }\n\n    /**\n     * Add a new history entry\n     */\n    addEntry(entry: Omit<HistoryEntry, 'id' | 'ts'>): HistoryEntry {\n        const fullEntry: HistoryEntry = {\n            ...entry,\n            id: this.generateId(),\n            ts: Date.now()\n        };\n\n        this.entries.unshift(fullEntry); // Add to beginning\n\n        // Trim to max entries\n        if (this.entries.length > this.maxEntries) {\n            this.entries = this.entries.slice(0, this.maxEntries);\n        }\n\n        if (this.autoSave) {\n            this.saveHistory();\n        }\n\n        return fullEntry;\n    }\n\n    /**\n     * Get all history entries\n     */\n    getAllEntries(): HistoryEntry[] {\n        return [...this.entries];\n    }\n\n    /**\n     * Get recent entries (last N)\n     */\n    getRecentEntries(limit: number = 10): HistoryEntry[] {\n        return this.entries.slice(0, limit);\n    }\n\n    /**\n     * Get entry by ID\n     */\n    getEntryById(id: string): HistoryEntry | undefined {\n        return this.entries.find(entry => entry.id === id);\n    }\n\n    /**\n     * Remove entry by ID\n     */\n    removeEntry(id: string): boolean {\n        const index = this.entries.findIndex(entry => entry.id === id);\n        if (index === -1) return false;\n\n        this.entries.splice(index, 1);\n        if (this.autoSave) {\n            this.saveHistory();\n        }\n        return true;\n    }\n\n    /**\n     * Clear all history\n     */\n    clearHistory(): void {\n        this.entries = [];\n        if (this.autoSave) {\n            this.saveHistory();\n        }\n    }\n\n    /**\n     * Search history entries\n     */\n    searchEntries(query: string): HistoryEntry[] {\n        const lowercaseQuery = query.toLowerCase();\n        return this.entries.filter(entry =>\n            entry.prompt.toLowerCase().includes(lowercaseQuery) ||\n            entry.before.toLowerCase().includes(lowercaseQuery) ||\n            entry.after.toLowerCase().includes(lowercaseQuery)\n        );\n    }\n\n    /**\n     * Get successful entries only\n     */\n    getSuccessfulEntries(): HistoryEntry[] {\n        return this.entries.filter(entry => entry.ok);\n    }\n\n    /**\n     * Get failed entries only\n     */\n    getFailedEntries(): HistoryEntry[] {\n        return this.entries.filter(entry => !entry.ok);\n    }\n\n    /**\n     * Get statistics\n     */\n    getStatistics() {\n        const total = this.entries.length;\n        const successful = this.entries.filter(e => e.ok).length;\n        const failed = total - successful;\n        const avgDuration = this.entries\n            .filter(e => e.duration)\n            .reduce((sum, e) => sum + (e.duration || 0), 0) / Math.max(1, this.entries.filter(e => e.duration).length);\n\n        return {\n            total,\n            successful,\n            failed,\n            successRate: total > 0 ? (successful / total) * 100 : 0,\n            averageDuration: avgDuration || 0\n        };\n    }\n\n    /**\n     * Export history as JSON\n     */\n    exportHistory(): string {\n        return JSON.stringify(this.entries, null, 2);\n    }\n\n    /**\n     * Import history from JSON\n     */\n    importHistory(jsonData: string): boolean {\n        try {\n            const importedEntries = JSON.parse(jsonData) as HistoryEntry[];\n\n            if (!Array.isArray(importedEntries)) {\n                throw new Error('Invalid history data: not an array');\n            }\n\n            // Validate entries\n            for (const entry of importedEntries) {\n                if (typeof entry.ts !== 'number' || typeof entry.prompt !== 'string') {\n                    throw new Error('Invalid history entry: missing required fields');\n                }\n            }\n\n            // Assign new IDs to avoid conflicts\n            const entriesWithIds = importedEntries.map(entry => ({\n                ...entry,\n                id: entry.id || this.generateId()\n            }));\n\n            // Merge with existing entries, avoiding duplicates\n            const existingIds = new Set(this.entries.map(e => e.id));\n            const newEntries = entriesWithIds.filter(e => !existingIds.has(e.id));\n\n            this.entries.unshift(...newEntries);\n\n            // Trim to max entries\n            if (this.entries.length > this.maxEntries) {\n                this.entries = this.entries.slice(0, this.maxEntries);\n            }\n\n            if (this.autoSave) {\n                this.saveHistory();\n            }\n\n            return true;\n        } catch (error) {\n            console.error('Failed to import history:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Create history view component\n     */\n    createHistoryView(onEntrySelect?: (entry: HistoryEntry) => void): HTMLElement {\n        const container = H`<div class=\"history-view\">\n      <div class=\"history-header\">\n        <h3>Processing History</h3>\n        <div class=\"history-actions\">\n          <button class=\"btn small\" data-action=\"clear-history\">Clear All</button>\n          <button class=\"btn small\" data-action=\"export-history\">Export</button>\n        </div>\n      </div>\n\n      <div class=\"history-stats\">\n        ${this.createStatsDisplay()}\n      </div>\n\n      <div class=\"history-list\">\n        ${this.entries.length === 0\n                ? H`<div class=\"empty-history\">No history yet. Start processing some content!</div>`\n                : this.entries.map(entry => this.createHistoryItem(entry, onEntrySelect))\n            }\n      </div>\n    </div>` as HTMLElement;\n\n        // Set up event listeners\n        container.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.getAttribute('data-action');\n            const entryId = target.getAttribute('data-entry-id');\n\n            if (action === 'clear-history') {\n                if (confirm('Are you sure you want to clear all history?')) {\n                    this.clearHistory();\n                    // Refresh the view\n                    const newContainer = this.createHistoryView(onEntrySelect);\n                    container.replaceWith(newContainer);\n                }\n            } else if (action === 'export-history') {\n                this.exportHistoryToFile();\n            } else if (action === 'use-entry' && entryId) {\n                const entry = this.getEntryById(entryId);\n                if (entry) {\n                    onEntrySelect?.(entry);\n                }\n            }\n        });\n\n        return container;\n    }\n\n    /**\n     * Create compact history display (for recent activity)\n     */\n    createRecentHistoryView(limit: number = 3, onEntrySelect?: (entry: HistoryEntry) => void): HTMLElement {\n        const recentEntries = this.getRecentEntries(limit);\n\n        const container = H`<div class=\"recent-history\">\n      <div class=\"recent-header\">\n        <h4>Recent Activity</h4>\n        <button class=\"btn small\" data-action=\"view-full-history\">View All</button>\n      </div>\n\n      ${recentEntries.length === 0\n                ? H`<div class=\"no-recent\">No recent activity</div>`\n                : recentEntries.map(entry => this.createCompactHistoryItem(entry, onEntrySelect))\n            }\n    </div>` as HTMLElement;\n\n        // Set up event listeners\n        container.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.getAttribute('data-action');\n            const entryId = target.getAttribute('data-entry-id');\n\n            if (action === 'view-full-history') {\n                // This would typically trigger a view change\n                console.log('View full history requested');\n            } else if (action === 'use-entry' && entryId) {\n                const entry = this.getEntryById(entryId);\n                if (entry) {\n                    onEntrySelect?.(entry);\n                }\n            }\n        });\n\n        return container;\n    }\n\n    private createStatsDisplay(): HTMLElement {\n        const stats = this.getStatistics();\n\n        return H`<div class=\"stats-grid\">\n      <div class=\"stat-item\">\n        <span class=\"stat-value\">${stats.total}</span>\n        <span class=\"stat-label\">Total</span>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-value success\">${stats.successful}</span>\n        <span class=\"stat-label\">Success</span>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-value error\">${stats.failed}</span>\n        <span class=\"stat-label\">Failed</span>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-value\">${stats.successRate.toFixed(1)}%</span>\n        <span class=\"stat-label\">Success Rate</span>\n      </div>\n    </div>` as HTMLElement;\n    }\n\n    private createHistoryItem(entry: HistoryEntry, onEntrySelect?: (entry: HistoryEntry) => void): HTMLElement {\n        const time = new Date(entry.ts).toLocaleString();\n        const duration = entry.duration ? ` (${(entry.duration / 1000).toFixed(1)}s)` : '';\n\n        return H`<div class=\"history-item ${entry.ok ? 'success' : 'error'}\">\n      <div class=\"history-meta\">\n        <span class=\"history-status ${entry.ok ? 'success' : 'error'}\">\n          ${entry.ok ? '' : ''}\n        </span>\n        <span class=\"history-time\">${time}${duration}</span>\n        ${entry.model ? H`<span class=\"history-model\">${entry.model}</span>` : ''}\n      </div>\n\n      <div class=\"history-content\">\n        <div class=\"history-prompt\">${entry.prompt}</div>\n        <div class=\"history-input\">Input: ${entry.before}</div>\n        ${entry.error ? H`<div class=\"history-error\">Error: ${entry.error}</div>` : ''}\n      </div>\n\n      <div class=\"history-actions\">\n        <button class=\"btn small\" data-action=\"use-entry\" data-entry-id=\"${entry.id}\">Use Prompt</button>\n        ${entry.ok ? H`<button class=\"btn small\" data-action=\"view-result\" data-entry-id=\"${entry.id}\">View Result</button>` : ''}\n      </div>\n    </div>` as HTMLElement;\n    }\n\n    private createCompactHistoryItem(entry: HistoryEntry, onEntrySelect?: (entry: HistoryEntry) => void): HTMLElement {\n        const time = new Date(entry.ts).toLocaleString();\n        const shortPrompt = entry.prompt.length > 40 ? entry.prompt.substring(0, 40) + '...' : entry.prompt;\n\n        return H`<div class=\"history-item-compact ${entry.ok ? 'success' : 'error'}\">\n      <div class=\"history-meta\">\n        <span class=\"history-status ${entry.ok ? 'success' : 'error'}\">${entry.ok ? '' : ''}</span>\n        <span class=\"history-prompt\">${shortPrompt}</span>\n      </div>\n      <div class=\"history-time\">${time}</div>\n      <button class=\"btn small\" data-action=\"use-entry\" data-entry-id=\"${entry.id}\">Use</button>\n    </div>` as HTMLElement;\n    }\n\n    private exportHistoryToFile(): void {\n        const data = this.exportHistory();\n        const blob = new Blob([data], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `ai-history-${new Date().toISOString().split('T')[0]}.json`;\n        document.body.append(link);\n        link.click();\n        link.remove();\n\n        URL.revokeObjectURL(url);\n    }\n\n    private generateId(): string {\n        return `history_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    private loadHistory(): void {\n        try {\n            if (typeof localStorage === \"undefined\") return;\n            const stored = localStorage.getItem(this.storageKey);\n            if (stored) {\n                const parsedEntries = JSON.parse(stored) as HistoryEntry[];\n\n                // Validate and migrate old format\n                this.entries = parsedEntries.map(entry => ({\n                    ...entry,\n                    id: entry.id || this.generateId()\n                }));\n            }\n        } catch (error) {\n            console.warn('Failed to load history from storage:', error);\n            this.entries = [];\n        }\n    }\n\n    private saveHistory(): void {\n        try {\n            if (typeof localStorage === \"undefined\") return;\n            localStorage.setItem(this.storageKey, JSON.stringify(this.entries));\n        } catch (error) {\n            console.warn('Failed to save history to storage:', error);\n        }\n    }\n}\n\n/**\n * Utility function to create a history manager\n */\nexport function createHistoryManager(options?: HistoryManagerOptions): HistoryManager {\n    return new HistoryManager(options);\n}","import { createDayDescriptor, insideOfDay, parseDateCorrectly } from \"@rs-core/time\";\nimport type { ChapterDescriptor, DayDescriptor } from \"@rs-core/utils/Types\";\nimport type { EntityInterface } from \"@rs-com/template/EntityInterface\";\nimport { JSOX } from \"jsox\";\n\n//\nexport const $unfiltered = <\n    E extends EntityInterface<any, any> = EntityInterface<any, any>,\n    C extends ChapterDescriptor = ChapterDescriptor\n    >(obj: E, desc: C): boolean => {\n    return true;\n}\n\n//\nexport const $byKind = <\n    E extends EntityInterface<any, any> = EntityInterface<any, any>,\n    C extends ChapterDescriptor = ChapterDescriptor\n    >(obj: E, desc: C): boolean => {\n    const kind = typeof desc == \"string\" ? desc : (desc as any)?.kind;\n    return (obj.kind === kind || !kind || kind == \"all\" || !obj.kind);\n}\n\n//\nexport const $insideOfDay = <\n    E extends EntityInterface<any, any> = EntityInterface<any, any>,\n    C extends DayDescriptor = DayDescriptor\n    >(obj: E, desc: C): boolean => {\n    const kind = typeof desc == \"string\" ? desc : (desc as any)?.kind;\n    const status = typeof desc == \"string\" ? desc : desc?.status;\n    const begin_time = (typeof desc == \"string\" ? desc : (desc?.begin_time ?? desc)) as any;\n    const end_time = (typeof desc == \"string\" ? desc : (desc?.end_time ?? desc)) as any;\n    return insideOfDay(obj, { begin_time, end_time, status }) ||\n        (status == obj?.properties?.status || status == \"all\" || !status) ||\n        (kind == obj?.kind || kind == \"all\" || !obj.kind);\n}\n\n//\nexport const renderTabName = (tabName: string) => {\n    if (!tabName) return \"\";\n\n    // split _ as spaces\n    tabName = tabName?.replace?.(/_/g, \" \") || tabName;\n\n    // capitalize first word letter\n    tabName = (tabName?.charAt?.(0)?.toUpperCase?.() + tabName?.slice?.(1)) || tabName;\n\n    //\n    return tabName;\n}\n\n\n\n// more smarter and stronger version of REMOVE_IF_HAS\nexport const REMOVE_IF_HAS_SIMILAR = (array: any[], old: any, idx: number = -1, srcObj: any = null) => {\n    if (array?.indexOf?.(old) >= 0) { array.splice(array.indexOf(old), 1); } else\n        if (idx >= 0 && idx < array?.length) { array.splice(idx, 1); } else {\n            // TODO: other mechanisms of finding index\n        }\n}\n\n\n\n//\nexport const REMOVE_IF_HAS = (array: any[], item: any) => {\n    if (array?.indexOf?.(item) >= 0) { array.splice(array.indexOf(item), 1); };\n};\n\n//\nexport const PUSH_ONCE = (array: any[], item: any) => {\n    if (array?.indexOf?.(item) < 0) { array.push(item); };\n};\n\n//\nexport const SPLICE_INTO_ONCE = (array: any[], item: any, index: number | string | symbol = -1) => {\n    if (typeof index != \"number\" || index < 0 || index >= array?.length) { PUSH_ONCE(array, item); } else\n        if (typeof index == \"number\" && array?.indexOf?.(item) < 0) { array.splice(index, 0, item); };\n};\n\n//\nexport const cachedPerFile = new WeakMap<File | Blob, any>();\nexport const cachedPerFileName = new Map<string, any>();\n\n//\nexport const GET_OR_CACHE = async (file: File | Blob | Promise<File | Blob> | null) => {\n    try { file = await file; } catch (e) { file = null; console.warn(e); }; if (file == null) return null;\n    if (cachedPerFile.has(file)) return cachedPerFile.get(file);\n    if (file?.type != \"application/json\") { return cachedPerFile.get(file); };\n\n    //\n    const raw = await file?.text?.()?.catch?.(console.warn.bind(console)) || \"{}\";\n    let obj = {} as any; try { obj = JSOX.parse(raw) as any; } catch (_) { try { obj = JSON.parse(raw) as any; } catch (e) { console.warn(e); } }\n    if (file) { cachedPerFile.set(file, obj); }\n    return obj;\n};\n\n// if any other argument isn't working, such as File object (for example, while exclusion)\nexport const GET_OR_CACHE_BY_NAME = async (fileName: string, file?: File | Blob | Promise<File | Blob> | null) => {\n    try { file = await file; } catch (e) { file = null; console.warn(e); }; if (fileName == null) return null;\n    if (cachedPerFileName.has(fileName)) return cachedPerFileName.get(fileName);\n    const obj = file != null ? await GET_OR_CACHE(file) : cachedPerFileName?.get(fileName);\n    if (fileName) { cachedPerFileName.set(fileName, obj); }\n    return obj;\n};\n\n\n//\nexport const cleanToDay = (item: EntityInterface<any, any>) => {\n    return createDayDescriptor(parseDateCorrectly(item?.properties?.begin_time));\n};\n\n//\nexport const closestOfDay = (item: EntityInterface<any, any>, days: any[]) => {\n    return days?.find((d) => insideOfDay(item, d));\n};\n\n//\nexport const closestOfKind = (item: EntityInterface<any, any>, subgroups: any[]) => {\n    return subgroups?.find((d) => d?.kind == item?.kind);\n};\n\n\n//\nexport const mergeByExists = <T extends { name: string }>(dataRef: T[], refs: T[]) => {\n    // Build index maps for O(1) lookups\n    const dataMap = new Map<string, { item: T; index: number }>();\n    dataRef.forEach((item, index) => {\n        if (item?.name) dataMap.set(item.name, { item, index });\n    });\n\n    const refsMap = new Map<string, T>();\n    refs.forEach(ref => {\n        if (ref?.name) refsMap.set(ref.name, ref);\n    });\n\n    // Update existing items\n    for (const [name, { index }] of dataMap) {\n        const ref = refsMap.get(name);\n        if (ref) {\n            dataRef[index] = ref;\n        }\n    }\n\n    // Add new items\n    for (const [name, ref] of refsMap) {\n        if (!dataMap.has(name)) {\n            dataRef.push(ref);\n        }\n    }\n\n    // Remove deleted items (iterated backwards to maintain indices)\n    for (let i = dataRef.length - 1; i >= 0; i--) {\n        const item = dataRef[i];\n        if (item?.name && !refsMap.has(item.name)) {\n            dataRef.splice(i, 1);\n        }\n    }\n\n    // sort by name\n    dataRef.sort((a: T, b: T) => a?.name?.localeCompare?.(b?.name ?? \"\"));\n\n    // return sorted data\n    return dataRef;\n}\n","import { writeTimelineTask } from \"../storage/FileSystem.js\";\nimport { fixEntityId } from \"@rs-com/template/EntityId.js\";\n\n// Debug configuration\nconst DEBUG_IMMITATE = 10 * 1000; // 10 seconds\nconst DEBUG_ENABLED = true; // Set to false to disable debug mode\n\n// Sample task templates for different kinds\nconst TASK_TEMPLATES = [\n    {\n        kind: \"job\",\n        name: \"Debug Job Task\",\n        description: \"This is a debug job task generated for testing purposes. It includes all necessary properties and follows the entity structure.\",\n        status: \"pending\",\n        icon: \"briefcase\",\n        variant: \"blue\"\n    },\n    {\n        kind: \"action\",\n        name: \"Debug Action Task\",\n        description: \"This is a debug action task generated for testing. It simulates a typical action that might be part of a daily routine.\",\n        status: \"in_progress\",\n        icon: \"play-circle\",\n        variant: \"green\"\n    },\n    {\n        kind: \"other\",\n        name: \"Debug Other Task\",\n        description: \"This is a debug task of 'other' kind. It represents miscellaneous tasks that don't fit into specific categories.\",\n        status: \"under_consideration\",\n        icon: \"play-circle\",//\"question-mark-circle\",\n        variant: \"orange\"\n    }\n];\n\n// Sample locations for tasks\nconst SAMPLE_LOCATIONS = [\n    \"Office\",\n    \"Home\",\n    \"Gym\",\n    \"Coffee Shop\",\n    \"Library\",\n    \"Park\",\n    \"Shopping Mall\",\n    \"Restaurant\"\n];\n\n// Sample contacts\nconst SAMPLE_CONTACTS = [\n    {\n        email: [\"debug@example.com\"],\n        phone: [\"+1234567890\"],\n        links: [\"https://example.com\"]\n    },\n    {\n        email: [\"test@example.com\"],\n        phone: [\"+0987654321\"]\n    }\n];\n\n/**\n * Generates a random debug task with realistic properties\n */\nexport const generateDebugTask = (): any => {\n    const now = new Date();\n    const template = TASK_TEMPLATES[Math.floor(Math.random() * TASK_TEMPLATES.length)];\n\n    // Generate random time for the task (within next 7 days)\n    const daysOffset = Math.floor(Math.random() * 7);\n    const hoursOffset = Math.floor(Math.random() * 24);\n    const minutesOffset = Math.floor(Math.random() * 60);\n\n    const beginTime = new Date(now);\n    beginTime.setDate(beginTime.getDate() + daysOffset);\n    beginTime.setHours(beginTime.getHours() + hoursOffset);\n    beginTime.setMinutes(beginTime.getMinutes() + minutesOffset);\n\n    // End time is 1-4 hours after begin time\n    const durationHours = 1 + Math.floor(Math.random() * 3);\n    const endTime = new Date(beginTime);\n    endTime.setHours(endTime.getHours() + durationHours);\n\n    const location = SAMPLE_LOCATIONS[Math.floor(Math.random() * SAMPLE_LOCATIONS.length)];\n    const contacts = SAMPLE_CONTACTS[Math.floor(Math.random() * SAMPLE_CONTACTS.length)];\n\n    const task = {\n        type: \"task\",\n        kind: template.kind,\n        name: `${template.name} ${Date.now()}`,\n        title: template.name,\n        description: template.description,\n        icon: template.icon,\n        variant: template.variant,\n        properties: {\n            status: template.status,\n            begin_time: {\n                timestamp: beginTime.getTime(),\n                iso_date: beginTime.toISOString()\n            },\n            end_time: {\n                timestamp: endTime.getTime(),\n                iso_date: endTime.toISOString()\n            },\n            location: location,\n            contacts: contacts,\n            members: [],\n            events: []\n        }\n    };\n\n    // Fix the entity ID to follow the naming convention\n    fixEntityId(task as any, { mutate: true });\n\n    return task;\n};\n\n/**\n * Generates multiple debug tasks\n */\nexport const generateDebugTasks = (count: number = 3): any[] => {\n    const tasks: any[] = [];\n    for (let i = 0; i < count; i++) {\n        tasks.push(generateDebugTask());\n    }\n    return tasks;\n};\n\n/**\n * Writes debug tasks to the timeline\n */\nexport const writeDebugTasks = async (taskCount: number = 1): Promise<any[]> => {\n    if (!DEBUG_ENABLED) {\n        console.log(\"Debug task generation is disabled\");\n        return [];\n    }\n\n    const tasks = generateDebugTasks(taskCount);\n    const results: any[] = [];\n\n    for (const task of tasks) {\n        try {\n            const result = await writeTimelineTask(task);\n            results.push(result);\n            console.log(\"Debug task written:\", task.name, task.id);\n        } catch (error) {\n            console.warn(\"Failed to write debug task:\", error);\n        }\n    }\n\n    return results;\n};\n\n/**\n * Auto-generates debug tasks on page refresh and via setTimeout\n */\nexport const startDebugTaskGeneration = (): void => {\n    if (!DEBUG_ENABLED) {\n        console.log(\"Debug task generation is disabled\");\n        return;\n    }\n\n    console.log(\"Starting debug task generation...\");\n\n    // Generate initial task on page load\n    //writeDebugTasks(1).catch(console.warn);\n\n    // Set up periodic generation\n    const generatePeriodically = () => {\n        setTimeout(async () => {\n            if (DEBUG_ENABLED) {\n                await writeDebugTasks(1);\n                generatePeriodically(); // Schedule next generation\n            }\n        }, DEBUG_IMMITATE);\n    };\n\n    //generatePeriodically();\n};\n\n/**\n * Manual trigger for debug task generation\n */\nexport const triggerDebugTaskGeneration = (count: number = 1): Promise<any[]> => {\n    if (!DEBUG_ENABLED) {\n        console.log(\"Debug task generation is disabled\");\n        return Promise.resolve([]);\n    }\n\n    return writeDebugTasks(count);\n};\n\n/**\n * Enable or disable debug mode\n */\nexport const setDebugMode = (enabled: boolean): void => {\n    (globalThis as any).DEBUG_ENABLED = enabled;\n    console.log(`Debug mode ${enabled ? 'enabled' : 'disabled'}`);\n};\n\n/**\n * Get current debug mode status\n */\nexport const isDebugModeEnabled = (): boolean => {\n    return DEBUG_ENABLED;\n};\n\n// Expose debug functions to global scope for easy testing\nif (typeof globalThis !== 'undefined') {\n    (globalThis as any).debugTaskGenerator = {\n        generate: triggerDebugTaskGeneration,\n        setMode: setDebugMode,\n        isEnabled: isDebugModeEnabled\n    };\n}\n","/**\n * Core Module\n *\n * Central module providing core utilities for the CrossWord application.\n *\n * Structure:\n * - api/      : API client and service communication\n * - storage/  : localStorage, sessionStorage, IndexedDB utilities\n * - document/ : Markdown rendering, DOCX export, document tools\n * - time/     : Time/date utilities\n * - text/     : Text formatting utilities\n * - phone/    : Phone number utilities\n * - modules/  : Feature modules (clipboard, history, etc.)\n * - utils/    : General utilities (types, theme, etc.)\n */\n\n// ============================================================================\n// API\n// ============================================================================\n\nexport {\n    api,\n    API_PATHS,\n    fetchWithTimeout,\n    fetchWithRetry,\n    type ApiResponse,\n    type ProcessingOptions,\n    type AnalyzeOptions,\n    type ApiPath\n} from \"./api\";\n\n// ============================================================================\n// STORAGE\n// ============================================================================\n\nexport {\n    // Keys\n    StorageKeys,\n    type StorageKey,\n\n    // LocalStorage\n    getItem,\n    setItem,\n    removeItem,\n    getString,\n    setString,\n    isLocalStorageAvailable,\n\n    // SessionStorage\n    getSessionItem,\n    setSessionItem,\n    removeSessionItem,\n\n    // IndexedDB\n    getIDBItem,\n    setIDBItem,\n    removeIDBItem,\n    IDBStorage,\n\n    // Pre-configured instances\n    workCenterStorage,\n    historyStorage,\n    settingsStorage\n} from \"./storage\";\n\n// ============================================================================\n// TIME UTILITIES\n// ============================================================================\n\nexport {\n    // Timezone\n    getTimeZone,\n\n    // Parsing\n    isPureHHMM,\n    parseDateCorrectly,\n    parseAndGetCorrectTime,\n    getComparableTimeValue,\n    isDate,\n\n    // Range checks\n    checkInTimeRange,\n    checkRemainsTime,\n\n    // Day descriptors\n    getISOWeekNumber,\n    createDayDescriptor,\n    insideOfDay,\n    notInPast,\n\n    // Timeline\n    SplitTimelinesByDays,\n    computeTimelineOrderInGeneral,\n    computeTimelineOrderInsideOfDay,\n\n    // Formatting\n    normalizeSchedule,\n    formatAsTime,\n    formatAsDate,\n    formatDateTime\n} from \"./time\";\n\n// ============================================================================\n// TEXT UTILITIES\n// ============================================================================\n\nexport {\n    // String utilities\n    isNotEmpty,\n    toStringSafe,\n    collapseWhitespace,\n    MAKE_LABEL,\n    cropFirstLetter,\n    startCase,\n    renderTabName,\n\n    // Multiline\n    toMultiline,\n    fromMultiline,\n    countLines,\n    wrapBySpan,\n\n    // Path utilities\n    splitPath,\n    getByPath,\n    setByPath,\n    unsetByPath,\n    makeObjectEntries,\n\n    // Markdown stripping\n    stripMarkdown,\n    sanitizeDocSnippet,\n    truncateDocSnippet,\n\n    // Date titles\n    ensureDate,\n    resolveBeginDate,\n    buildPrimaryDayTitle,\n    buildSecondaryDayTitle,\n\n    // Drag & copy handlers\n    beginDragAsText,\n    copyPhoneClick,\n    copyEmailClick\n} from \"./text\";\n\n// ============================================================================\n// PHONE UTILITIES\n// ============================================================================\n\nexport {\n    // Constants\n    PHONE_CANDIDATE_RE,\n    EXT_CUT_RE,\n\n    // Normalization\n    normalizeOne,\n    splitCandidates,\n    normalizePhones,\n\n    // Row helpers\n    getIndexForRow,\n    getPhonesFromRow,\n\n    // Duplicate detection\n    findDuplicatePhones,\n\n    // Types\n    type NormalizeOptions,\n    type DuplicateResult\n} from \"./phone\";\n\n// ============================================================================\n// DOCUMENT (Markdown & DOCX)\n// ============================================================================\n\nexport {\n    // Markdown\n    renderMarkdown,\n    renderMarkdownToElement,\n    renderMarkdownSync,\n    extractTitle,\n    isLikelyMarkdown,\n    type RenderOptions,\n    type MarkdownResult,\n\n    // DOCX\n    downloadMarkdownAsDocx,\n    downloadHtmlAsDocx,\n    createDocxBlobFromHtml,\n    createDocxBlobFromMarkdown,\n    type DocxExportOptions,\n\n    // Conversion\n    convertToHtml,\n    convertToMarkdown,\n    copyAsMarkdown,\n    copyAsHTML,\n    copyAsTeX,\n    copyAsMathML,\n    type CopyOptions,\n\n    // Parsing\n    parseMarkdownEntry,\n    unique,\n    normalizeCollections,\n    ensureCollections\n} from \"./document\";\n\n// ============================================================================\n// CLIPBOARD\n// ============================================================================\n\nexport {\n    copy,\n    writeText,\n    writeHTML,\n    writeImage,\n    readText,\n    toText,\n    requestCopy,\n    listenForClipboardRequests,\n    initClipboardReceiver,\n    requestCopyViaCRX,\n    isChromeExtension,\n    isClipboardAvailable,\n    isClipboardWriteAvailable,\n    COPY_HACK,\n    copyWithResult,\n    type ClipboardDataType,\n    type ClipboardWriteOptions,\n    type ClipboardResult,\n    type CRXCopyOptions\n} from \"./modules/Clipboard\";\n\n// Legacy aliases\nexport { copy as copyToClipboard } from \"./modules/Clipboard\";\nexport { readText as readFromClipboard } from \"./modules/Clipboard\";\n\n// ============================================================================\n// FILE UTILITIES\n// ============================================================================\n\nexport {\n    // Type detection\n    isMarkdownFile,\n    isTextFile,\n    isImageFile,\n    isCodeFile,\n\n    // Reading\n    readFileAsText,\n    readFileAsDataURL,\n    readFileAsArrayBuffer,\n\n    // Creation\n    createTextFile,\n    createMarkdownFile,\n    createJsonFile,\n\n    // Download\n    downloadFile,\n    downloadTextFile,\n    downloadMarkdown,\n\n    // Picking\n    pickFile,\n    pickFiles,\n    pickMarkdownFile,\n\n    // File System Access API\n    saveFile,\n    openFile\n} from \"./storage/file-utils\";\n\n// ============================================================================\n// MODULES (Feature modules)\n// ============================================================================\n\nexport { getCachedComponent, clearComponentCache, disposeCachedComponents } from \"./modules/LazyLoader\";\nexport { createFileHandler } from \"./storage/FileHandling\";\nexport { getSpeechPrompt } from \"./modules/VoiceInput\";\nexport { createTemplateManager } from \"./modules/TemplateManager\";\nexport { HistoryManager, createHistoryManager } from \"./modules/HistoryManager\";\n\n// ============================================================================\n// GENERAL UTILITIES\n// ============================================================================\n\nexport * from \"./utils\";\n\n// ============================================================================\n// COMMON HELPER FUNCTIONS\n// ============================================================================\n\n/**\n * Create a debounced function\n */\nexport function debounce<T extends (...args: any[]) => any>(\n    fn: T,\n    delay: number\n): (...args: Parameters<T>) => void {\n    let timeoutId: ReturnType<typeof setTimeout>;\n    return (...args: Parameters<T>) => {\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(() => fn(...args), delay);\n    };\n}\n\n/**\n * Create a throttled function\n */\nexport function throttle<T extends (...args: any[]) => any>(\n    fn: T,\n    limit: number\n): (...args: Parameters<T>) => void {\n    let inThrottle = false;\n    return (...args: Parameters<T>) => {\n        if (!inThrottle) {\n            fn(...args);\n            inThrottle = true;\n            setTimeout(() => (inThrottle = false), limit);\n        }\n    };\n}\n\n/**\n * Wait for a specific duration\n */\nexport function sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Generate a unique ID\n */\nexport function uniqueId(prefix = \"\"): string {\n    return `${prefix}${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 9)}`;\n}\n\n/**\n * Deep clone an object\n */\nexport function deepClone<T>(obj: T): T {\n    if (obj === null || typeof obj !== \"object\") return obj;\n    if (obj instanceof Date) return new Date(obj.getTime()) as T;\n    if (obj instanceof Array) return obj.map(item => deepClone(item)) as T;\n    if (obj instanceof Object) {\n        const cloned = {} as T;\n        for (const key in obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, key)) {\n                (cloned as any)[key] = deepClone((obj as any)[key]);\n            }\n        }\n        return cloned;\n    }\n    return obj;\n}\n\n/**\n * Check if value is empty (null, undefined, empty string, empty array/object)\n */\nexport function isEmpty(value: unknown): boolean {\n    if (value === null || value === undefined) return true;\n    if (typeof value === \"string\") return value.trim().length === 0;\n    if (Array.isArray(value)) return value.length === 0;\n    if (typeof value === \"object\") return Object.keys(value).length === 0;\n    return false;\n}\n\n/**\n * Clamp a number between min and max\n */\nexport function clamp(value: number, min: number, max: number): number {\n    return Math.min(Math.max(value, min), max);\n}\n\n/**\n * Check if we're in a browser environment\n */\nexport function isBrowser(): boolean {\n    return typeof window !== \"undefined\" && typeof document !== \"undefined\";\n}\n\n/**\n * Check if we're in a worker environment\n */\nexport function isWorker(): boolean {\n    return typeof self !== \"undefined\" && typeof window === \"undefined\";\n}\n","/**\n * PWA Clipboard Handler\n * Connects PWA frontend with service worker clipboard operations\n * Listens for clipboard requests from service worker via BroadcastChannel\n */\n\nimport { initClipboardReceiver, listenForClipboardRequests, requestCopy } from \"../../core\";\nimport { initToastReceiver } from \"../items/Toast\";\nimport { unifiedMessaging } from \"@rs-com/core/UnifiedMessaging\";\n\n// Track initialization\nlet _pwaClipboardInitialized = false;\nlet _cleanupFns: (() => void)[] = [];\n\nconst sendShareTargetResultToWorkcenter = async (data: Record<string, unknown>, priority: \"high\" | \"normal\" = \"high\"): Promise<void> => {\n    await unifiedMessaging.sendMessage({\n        type: \"share-target-result\",\n        destination: \"workcenter\",\n        data,\n        metadata: { priority }\n    });\n};\n\n// Helper function to extract recognized content from AI responses\nconst tryParseJSON = (data: unknown): unknown => {\n    if (typeof data !== 'string') return null;\n    try {\n        return JSON.parse(data);\n    } catch {\n        return null;\n    }\n};\n\nconst extractRecognizedContent = (data: unknown): unknown => {\n    // If it's already a string that's not JSON, return as-is\n    if (typeof data === 'string') {\n        const parsed = tryParseJSON(data);\n        if (parsed && typeof parsed === 'object') {\n            // Extract content from recognized_data field\n            const obj = parsed as Record<string, unknown>;\n\n            // Priority: recognized_data > verbose_data > data itself\n            if (obj.recognized_data != null) {\n                const rd = obj.recognized_data;\n                // If it's an array, join the elements\n                if (Array.isArray(rd)) {\n                    return rd.map(item =>\n                        typeof item === 'string' ? item : JSON.stringify(item)\n                    ).join('\\n');\n                }\n                return typeof rd === 'string' ? rd : JSON.stringify(rd);\n            }\n\n            if (typeof obj.verbose_data === 'string' && obj.verbose_data.trim()) {\n                return obj.verbose_data;\n            }\n\n            // Common shape: { type: \"markdown\"|\"text\"|..., content: \"...\" }\n            if (typeof (obj as any).content === 'string' && (obj as any).content.trim()) {\n                return (obj as any).content;\n            }\n\n            // OpenAI Chat Completions style\n            const choices = (obj as any).choices;\n            if (Array.isArray(choices) && choices.length > 0) {\n                const first = choices[0];\n                const msgContent = first?.message?.content;\n                if (typeof msgContent === 'string' && msgContent.trim()) return msgContent;\n                const txt = first?.text;\n                if (typeof txt === 'string' && txt.trim()) return txt;\n            }\n\n            // Other common shapes\n            const outText = (obj as any).output_text;\n            if (typeof outText === 'string' && outText.trim()) return outText;\n            const output = (obj as any).output;\n            if (Array.isArray(output) && output.length > 0) {\n                const firstOut = output[0];\n                const text0 = firstOut?.content?.[0]?.text;\n                if (typeof text0 === 'string' && text0.trim()) return text0;\n            }\n\n            // No recognized_data, return original data\n            return data;\n        }\n        // Not JSON, return as-is\n        return data;\n    }\n\n    // If it's an object, try to extract recognized_data\n    if (data && typeof data === 'object') {\n        const obj = data as Record<string, unknown>;\n        if (obj.recognized_data != null) {\n            const rd = obj.recognized_data;\n            if (Array.isArray(rd)) {\n                return rd.map(item =>\n                    typeof item === 'string' ? item : JSON.stringify(item)\n                ).join('\\n');\n            }\n            return typeof rd === 'string' ? rd : JSON.stringify(rd);\n        }\n        if (typeof obj.verbose_data === 'string' && obj.verbose_data.trim()) {\n            return obj.verbose_data;\n        }\n\n        // Common shape: { type: \"markdown\"|\"text\"|..., content: \"...\" }\n        if (typeof (obj as any).content === 'string' && (obj as any).content.trim()) {\n            return (obj as any).content;\n        }\n\n        // OpenAI Chat Completions style\n        const choices = (obj as any).choices;\n        if (Array.isArray(choices) && choices.length > 0) {\n            const first = choices[0];\n            const msgContent = first?.message?.content;\n            if (typeof msgContent === 'string' && msgContent.trim()) return msgContent;\n            const txt = first?.text;\n            if (typeof txt === 'string' && txt.trim()) return txt;\n        }\n\n        // Other common shapes\n        const outText = (obj as any).output_text;\n        if (typeof outText === 'string' && outText.trim()) return outText;\n        const output = (obj as any).output;\n        if (Array.isArray(output) && output.length > 0) {\n            const firstOut = output[0];\n            const text0 = firstOut?.content?.[0]?.text;\n            if (typeof text0 === 'string' && text0.trim()) return text0;\n        }\n    }\n\n    return data;\n};\n\n/**\n * Check for pending clipboard operations from service worker\n */\nconst checkPendingClipboardOperations = async (): Promise<void> => {\n    try {\n        // Wait for service worker to be ready and controlling the page\n        if (!navigator.serviceWorker) {\n            console.log('[PWA-Copy] Service workers not supported');\n            return;\n        }\n\n        // Wait for service worker to be controlling the page\n        if (!navigator.serviceWorker.controller) {\n            console.log('[PWA-Copy] Waiting for service worker to control page...');\n\n            // Wait for service worker to become active\n            const registration = await navigator.serviceWorker.ready;\n            if (!registration.active) {\n                console.log('[PWA-Copy] Service worker not active yet');\n                return;\n            }\n\n            // Give it a moment to start controlling\n            await new Promise(resolve => setTimeout(resolve, 100));\n        }\n\n        console.log('[PWA-Copy] Checking for pending clipboard operations...');\n        const response = await fetch('/clipboard/pending');\n        const data = await response.json();\n\n        if (data.operations && Array.isArray(data.operations) && data.operations.length > 0) {\n            console.log('[PWA-Copy] Found', data.operations.length, 'pending clipboard operations');\n\n            for (const operation of data.operations) {\n                if (operation.type === 'ai-result' && operation.data) {\n                    console.log('[PWA-Copy] Processing pending AI result:', operation.id);\n                    const text = extractRecognizedContent(operation.data);\n                    const { copy } = await import(\"../../core/modules/Clipboard\");\n                    await copy(text, { showFeedback: true });\n\n                    await sendShareTargetResultToWorkcenter({\n                        content: typeof text === \"string\" ? text : JSON.stringify(text),\n                        rawData: operation.data,\n                        timestamp: Date.now(),\n                        source: \"share-target\",\n                        action: \"AI Processing (Pending)\",\n                        metadata: {\n                            operationId: operation.id,\n                            fromPendingQueue: true\n                        }\n                    });\n                    console.log(\"[PWA-Copy] Delivered pending share target result to work center\");\n\n                    // Remove the processed operation from the queue\n                    try {\n                        await fetch(`/clipboard/remove/${operation.id}`, { method: 'DELETE' });\n                    } catch (error) {\n                        console.warn('[PWA-Copy] Failed to remove processed operation:', error);\n                    }\n                }\n            }\n        }\n    } catch (error) {\n        console.warn('[PWA-Copy] Failed to check pending operations:', error);\n    }\n};\n\n/**\n * Initialize PWA clipboard listeners\n * Call this early in the PWA lifecycle to receive clipboard requests from service worker\n */\nexport const initPWAClipboard = (): (() => void) => {\n    if (_pwaClipboardInitialized) {\n        return () => cleanupPWAClipboard();\n    }\n    _pwaClipboardInitialized = true;\n\n    console.log('[PWA-Copy] Initializing clipboard and toast receivers...');\n\n    // Check for any pending clipboard operations that completed while page was closed\n    checkPendingClipboardOperations().catch(console.warn);\n\n    // Listen for clipboard requests from service worker\n    _cleanupFns.push(initClipboardReceiver());\n\n    // Listen for toast messages from service worker\n    _cleanupFns.push(initToastReceiver());\n\n    // Listen for various clipboard and share target operations\n    if (typeof BroadcastChannel !== \"undefined\") {\n        // Listen for direct clipboard requests from service worker\n        const clipboardChannel = new BroadcastChannel(\"rs-clipboard\");\n\n        const clipboardHandler = async (event: MessageEvent) => {\n            const { type, data, options, operations } = event.data || {};\n            console.log('[PWA-Copy] Clipboard channel message:', type, data);\n\n            // Handle direct clipboard copy requests\n            if (type === \"copy\" && data !== undefined) {\n                const { copy } = await import(\"../../core/modules/Clipboard\");\n                await copy(data, { showFeedback: true, ...options });\n            }\n\n            // Handle pending operations sent directly from service worker\n            if (type === \"pending-operations\" && operations && Array.isArray(operations)) {\n                console.log('[PWA-Copy] Received', operations.length, 'pending operations via broadcast');\n                for (const operation of operations) {\n                    if (operation.type === 'ai-result' && operation.data) {\n                        console.log('[PWA-Copy] Processing broadcasted AI result:', operation.id);\n                        const text = typeof operation.data === 'string' ? operation.data : JSON.stringify(operation.data);\n                        const { copy } = await import(\"../../core/modules/Clipboard\");\n                        await copy(text, { showFeedback: true });\n\n                        await sendShareTargetResultToWorkcenter({\n                            content: text,\n                            rawData: operation.data,\n                            timestamp: Date.now(),\n                            source: \"share-target\",\n                            action: \"AI Processing (Broadcasted)\",\n                            metadata: {\n                                operationId: operation.id,\n                                fromBroadcast: true\n                            }\n                        });\n                        console.log(\"[PWA-Copy] Delivered broadcasted share target result to work center\");\n\n                        // Remove the processed operation from the queue\n                        try {\n                            await fetch(`/clipboard/remove/${operation.id}`, { method: 'DELETE' });\n                        } catch (error) {\n                            console.warn('[PWA-Copy] Failed to remove processed operation:', error);\n                        }\n                    }\n                }\n            }\n        };\n\n        clipboardChannel.addEventListener(\"message\", clipboardHandler);\n        _cleanupFns.push(() => {\n            clipboardChannel.removeEventListener(\"message\", clipboardHandler);\n            clipboardChannel.close();\n        });\n\n        // Listen for share target clipboard operations\n        const shareChannel = new BroadcastChannel(\"rs-share-target\");\n\n        const shareHandler = async (event: MessageEvent) => {\n            const { type, data } = event.data || {};\n            console.log('[PWA-Copy] Share channel message:', type, data);\n\n            // Handle share-target copy request\n            if (type === \"copy-shared\" && data) {\n                const { copy } = await import(\"../../core/modules/Clipboard\");\n                await copy(data, { showFeedback: true });\n            }\n\n            // Handle share-received notification\n            if (type === \"share-received\" && data) {\n                console.log('[PWA-Copy] Share received from SW:', data);\n            }\n\n            // Handle AI result from service worker\n            if (type === \"ai-result\" && data) {\n                console.log('[PWA-Copy] AI result from SW:', data);\n                if (data.success && data.data) {\n                    const text = extractRecognizedContent(data.data);\n                    const { copy } = await import(\"../../core/modules/Clipboard\");\n                    await copy(text, { showFeedback: true });\n\n                    // Also broadcast to work center for visibility\n                    await unifiedMessaging.sendMessage({\n                        type: 'share-target-result',\n                        destination: 'workcenter',\n                        data: {\n                            content: typeof text === 'string' ? text : JSON.stringify(text),\n                            rawData: data.data,\n                            timestamp: Date.now(),\n                            source: 'share-target',\n                            action: 'AI Processing',\n                            metadata: {\n                                fromServiceWorker: true,\n                                shareTargetId: data.id || 'unknown'\n                            }\n                        },\n                        metadata: { priority: 'high' }\n                    });\n                } else {\n                    const { showToast } = await import(\"../items/Toast\");\n                    showToast({ message: data.error || \"Processing failed\", kind: \"error\" });\n                }\n            }\n\n            // Handle share target input attachment (when files/text/URLs come in)\n            if (type === \"share-received\" && data) {\n                console.log('[PWA-Copy] Share received, broadcasting input to work center:', data);\n                await unifiedMessaging.sendMessage({\n                    type: 'share-target-input',\n                    destination: 'workcenter',\n                    data: {\n                        ...data,\n                        timestamp: Date.now(),\n                        metadata: {\n                            fromServiceWorker: true,\n                            ...data.metadata\n                        }\n                    },\n                    metadata: { priority: 'high' }\n                });\n            }\n        };\n\n        shareChannel.addEventListener(\"message\", shareHandler);\n        _cleanupFns.push(() => {\n            shareChannel.removeEventListener(\"message\", shareHandler);\n            shareChannel.close();\n        });\n\n        // Listen for legacy commit-to-clipboard messages from service worker\n        const swChannel = new BroadcastChannel(\"rs-sw\");\n\n        const swHandler = async (event: MessageEvent) => {\n            const { type, results } = event.data || {};\n            console.log('[PWA-Copy] SW channel message:', type, results);\n\n            // Handle commit-to-clipboard messages\n            if (type === \"commit-to-clipboard\" && results && Array.isArray(results)) {\n                for (const result of results) {\n                    if (result?.status === 'queued' && result?.data) {\n                        console.log('[PWA-Copy] Copying result data:', result.data);\n                        // Use the extractRecognizedContent function to get the right data\n                        const extractedContent = extractRecognizedContent(result.data);\n                        const { copy } = await import(\"../../core/modules/Clipboard\");\n                        await copy(extractedContent, { showFeedback: true });\n\n                        // Also broadcast to work center for visibility\n                        await unifiedMessaging.sendMessage({\n                            type: 'share-target-result',\n                            destination: 'workcenter',\n                            data: {\n                                content: typeof extractedContent === 'string' ? extractedContent : JSON.stringify(extractedContent),\n                                rawData: result.data,\n                                timestamp: Date.now(),\n                                source: 'share-target',\n                                action: 'Legacy AI Processing',\n                                metadata: {\n                                    legacyCommit: true,\n                                    resultStatus: result.status\n                                }\n                            },\n                            metadata: { priority: 'normal' }\n                        });\n\n                        break; // Only copy the first successful result\n                    }\n                }\n            }\n        };\n\n        swChannel.addEventListener(\"message\", swHandler);\n        _cleanupFns.push(() => {\n            swChannel.removeEventListener(\"message\", swHandler);\n            swChannel.close();\n        });\n    }\n\n    console.log('[PWA-Copy] Receivers initialized');\n    return () => cleanupPWAClipboard();\n};\n\n/**\n * Cleanup all PWA clipboard listeners\n */\nexport const cleanupPWAClipboard = (): void => {\n    _cleanupFns.forEach(fn => fn?.());\n    _cleanupFns = [];\n    _pwaClipboardInitialized = false;\n};\n\n/**\n * Request copy operation via service worker\n * Useful when clipboard access is restricted in current context\n */\nexport const requestCopyViaServiceWorker = (data: unknown): void => {\n    requestCopy(data, { showFeedback: true });\n};\n\n// Re-export for convenience\nexport { requestCopy, listenForClipboardRequests, initClipboardReceiver };\n\n// Default export\nexport default {\n    init: initPWAClipboard,\n    cleanup: cleanupPWAClipboard,\n    requestCopy: requestCopyViaServiceWorker\n};\n","type ProbeResult = {\n    ok: boolean;\n    url: string;\n    contentType?: string | null;\n    status?: number;\n};\n\nconst isLikelyJavaScriptContentType = (contentType: string | null | undefined): boolean => {\n    const ct = (contentType || \"\").toLowerCase();\n    return ct.includes(\"javascript\") || ct.includes(\"ecmascript\") || ct.includes(\"module\");\n};\n\nconst probeScriptUrl = async (url: string): Promise<ProbeResult> => {\n    try {\n        const res = await fetch(url, {\n            method: \"GET\",\n            cache: \"no-store\",\n            credentials: \"same-origin\",\n        });\n        const contentType = res.headers.get(\"content-type\");\n        return { ok: res.ok && isLikelyJavaScriptContentType(contentType), url, contentType, status: res.status };\n    } catch {\n        return { ok: false, url };\n    }\n};\n\nexport const getServiceWorkerCandidates = (): string[] => {\n    const env = (import.meta as any)?.env;\n    const isDev = Boolean(env?.DEV);\n\n    // Dev: VitePWA injectManifest serves /sw.js.\n    if (isDev) return [\"/sw.js\"];\n\n    // Prod: support both root and /apps/cw/ (Fastify may expose one or both).\n    return [\"/sw.js\", \"/apps/cw/sw.js\"];\n};\n\nexport const ensureServiceWorkerRegistered = async (): Promise<ServiceWorkerRegistration | null> => {\n    if (typeof window === \"undefined\") return null;\n    if (!(\"serviceWorker\" in navigator)) return null;\n\n    // Prefer existing registration.\n    try {\n        const existing = await navigator.serviceWorker.getRegistration(\"/\");\n        if (existing) return existing;\n    } catch {\n        // ignore\n    }\n\n    const candidates = getServiceWorkerCandidates();\n    const scope = \"/\";\n\n    for (const url of candidates) {\n        const probe = await probeScriptUrl(url);\n        if (!probe.ok) continue;\n\n        try {\n            return await navigator.serviceWorker.register(url, {\n                scope,\n                type: \"module\",\n                updateViaCache: \"none\",\n            });\n        } catch (e) {\n            // Try next candidate.\n            console.warn(\"[SW] Registration attempt failed for\", url, e);\n        }\n    }\n\n    // Best-effort diagnostics.\n    try {\n        const probes = await Promise.all(candidates.map(probeScriptUrl));\n        console.warn(\"[SW] No valid service worker script found. Probes:\", probes);\n    } catch {\n        // ignore\n    }\n\n    return null;\n};\n\n","import { sendMessage, type UnifiedMessage } from \"@rs-com/core/UnifiedMessaging\";\n\nexport type ViewTransferSource = \"share-target\" | \"launch-queue\" | \"pending\" | \"clipboard\";\n\nexport type ViewTransferDestination =\n    | \"viewer\"\n    | \"workcenter\"\n    | \"explorer\"\n    | \"editor\"\n    | \"history\"\n    | \"settings\"\n    | \"home\"\n    | \"airpad\"\n    | \"print\";\n\nexport type ViewTransferActionHint = \"open\" | \"attach\" | \"save\" | \"process\";\n\nexport interface ViewTransferHint {\n    destination?: ViewTransferDestination;\n    action?: ViewTransferActionHint;\n    contentType?: string;\n    filename?: string;\n}\n\nexport interface ViewTransferPayload {\n    source: ViewTransferSource;\n    route: \"share-target\" | \"launch-queue\" | \"clipboard\";\n    title?: string;\n    text?: string;\n    url?: string;\n    files?: File[];\n    pending?: boolean;\n    hint?: ViewTransferHint;\n    metadata?: Record<string, unknown>;\n}\n\nexport interface ViewTransferResolved {\n    destination: ViewTransferDestination;\n    routePath: `/${ViewTransferDestination}`;\n    messageType: string;\n    contentType: string;\n    data: Record<string, unknown>;\n    metadata: Record<string, unknown>;\n}\n\nconst getContentType = (payload: ViewTransferPayload): string => {\n    if (payload.hint?.contentType) return String(payload.hint.contentType);\n    const files = Array.isArray(payload.files) ? payload.files : [];\n    const text = String(payload.text || \"\").trim();\n    const url = String(payload.url || \"\").trim();\n\n    if (files.length > 0) {\n        const file = files[0];\n        const name = String(file?.name || \"\").toLowerCase();\n        const mime = String(file?.type || \"\").toLowerCase();\n        if (mime.startsWith(\"image/\")) return \"image\";\n        if (mime === \"text/markdown\" || name.endsWith(\".md\") || name.endsWith(\".markdown\")) return \"markdown\";\n        if (mime.startsWith(\"text/\")) return \"text\";\n        return \"file\";\n    }\n\n    if (url) return \"url\";\n    if (text) return \"text\";\n    return \"other\";\n};\n\nconst pickDestination = (payload: ViewTransferPayload, contentType: string): ViewTransferDestination => {\n    if (payload.hint?.destination) return payload.hint.destination;\n    if (payload.hint?.action === \"save\") return \"explorer\";\n    if (payload.hint?.action === \"process\" || payload.hint?.action === \"attach\") return \"workcenter\";\n    if (payload.hint?.action === \"open\") return \"viewer\";\n\n    if (contentType === \"markdown\" || contentType === \"text\") return \"viewer\";\n    if (contentType === \"url\") return \"workcenter\";\n    if (contentType === \"image\" || contentType === \"file\") return \"workcenter\";\n    return \"workcenter\";\n};\n\nconst toMessageType = (destination: ViewTransferDestination, hint?: ViewTransferHint): string => {\n    if (destination === \"viewer\") return hint?.action === \"open\" ? \"content-load\" : \"content-view\";\n    if (destination === \"explorer\") return \"file-save\";\n    if (destination === \"workcenter\") return \"content-attach\";\n    if (destination === \"editor\") return \"content-load\";\n    return \"content-share\";\n};\n\nexport const resolveViewTransfer = (payload: ViewTransferPayload): ViewTransferResolved => {\n    const contentType = getContentType(payload);\n    const destination = pickDestination(payload, contentType);\n    const messageType = toMessageType(destination, payload.hint);\n    const files = Array.isArray(payload.files) ? payload.files : [];\n\n    const data: Record<string, unknown> = {\n        title: payload.title,\n        text: payload.text,\n        content: payload.text,\n        url: payload.url,\n        files,\n        filename: payload.hint?.filename || files[0]?.name,\n        source: payload.source,\n        route: payload.route,\n        hint: payload.hint\n    };\n\n    return {\n        destination,\n        routePath: `/${destination}`,\n        messageType,\n        contentType,\n        data,\n        metadata: {\n            source: payload.source,\n            route: payload.route,\n            pending: Boolean(payload.pending),\n            hint: payload.hint,\n            ...(payload.metadata || {})\n        }\n    };\n};\n\nexport const dispatchViewTransfer = async (\n    payload: ViewTransferPayload\n): Promise<{ delivered: boolean; resolved: ViewTransferResolved }> => {\n    const resolved = resolveViewTransfer(payload);\n    const message: Omit<UnifiedMessage, \"id\" | \"source\"> & { source?: string } = {\n        type: resolved.messageType,\n        destination: resolved.destination,\n        contentType: resolved.contentType,\n        data: resolved.data,\n        metadata: resolved.metadata,\n        source: `view-transfer:${payload.source}`\n    };\n\n    const delivered = await sendMessage(message);\n    return { delivered, resolved };\n};\n","// PWA clipboard and service worker communication\nimport { initPWAClipboard } from \"./pwa-copy\";\nimport { showToast } from \"../items/Toast\";\nimport { ensureServiceWorkerRegistered } from \"./sw-url\";\nimport { dispatchViewTransfer, type ViewTransferHint } from \"@rs-com/core/ViewTransferRouting\";\nimport { BROADCAST_CHANNELS } from \"@rs-com/config/Names\";\nimport {\n    consumeCachedShareTargetPayload as consumeCachedShareTargetPayloadFromGateway,\n    storeShareTargetPayloadToCache as storeShareTargetPayloadToCacheGateway,\n    type CachedShareTargetPayload\n} from \"@rs-com/core/ShareTargetGateway\";\n\n// ============================================================================\n// CSS INJECTION\n// ============================================================================\n\nexport const ensureAppCss = () => {\n    // App is built as a JS module; make sure extracted CSS is loaded in production.\n    // Skip extension pages: they have their own HTML entrypoints and CSS injection.\n    const viteEnv = (import.meta as any)?.env;\n    if (viteEnv?.DEV) return;\n    if (typeof window === \"undefined\") return;\n    if (globalThis?.location?.protocol === \"chrome-extension:\") return;\n\n    const id = \"rs-crossword-css\";\n    if (document.getElementById(id)) return;\n\n    const link = document.createElement(\"link\");\n    link.id = id;\n    link.rel = \"stylesheet\";\n\n    // Resolve CSS relative to module location (handles /apps/cw/ mounting)\n    // Module is at .../modules/index.js, CSS is at .../assets/crossword.css\n    try {\n        // Go up from modules/ to app root, then into assets/\n        const cssUrl = new URL(\"../assets/crossword.css\", import.meta.url);\n        link.href = cssUrl.toString();\n    } catch {\n        // Fallback: try document-relative path\n        link.href = \"assets/crossword.css\";\n    }\n\n    // Handle load errors by trying alternative paths\n    let altIndex = 0;\n    link.onerror = () => {\n        const altPaths = [\n            // Relative to app root (if main entry, not in modules/)\n            new URL(\"./assets/crossword.css\", import.meta.url).toString(),\n            // Absolute from document root\n            \"/assets/crossword.css\",\n            // Common app mounting paths\n            \"/apps/cw/assets/crossword.css\",\n        ];\n\n        if (altIndex < altPaths.length) {\n            const nextPath = altPaths[altIndex++];\n            if (link.href !== nextPath) {\n                console.warn(`[CSS] Trying path: ${nextPath}`);\n                link.href = nextPath;\n                return;\n            }\n        }\n        link.onerror = null;\n    };\n\n    document.head.append(link);\n};\n\n// ============================================================================\n// SERVICE WORKER INITIALIZATION\n// ============================================================================\n\nlet _swRegistration: ServiceWorkerRegistration | null = null;\nlet _swInitPromise: Promise<ServiceWorkerRegistration | null> | null = null;\nlet _swOptions: { immediate?: boolean, onRegistered?: () => void, onRegisterError?: (error: any) => void } = {\n    immediate: false,\n    onRegistered: () => {\n        console.log('[PWA] Service worker registered successfully');\n    },\n    onRegisterError: (error) => {\n        console.error('[PWA] Service worker registration failed:', error);\n    }\n};\n\n/**\n * Initialize PWA service worker early in the page lifecycle\n * This ensures share target and other PWA features work correctly\n */\nexport const initServiceWorker = async (_options: { immediate?: boolean, onRegistered?: () => void, onRegisterError?: (error: any) => void } = _swOptions): Promise<ServiceWorkerRegistration | null> => {\n    // Return cached promise if already initializing\n    if (_swInitPromise) return _swInitPromise;\n\n    _swInitPromise = (async () => {\n        // Skip in extension context\n        if (typeof globalThis === 'undefined') return null;\n        if (globalThis?.location?.protocol === 'chrome-extension:') return null;\n        if (!('serviceWorker' in navigator)) {\n            console.warn('[PWA] Service workers not supported');\n            return null;\n        }\n\n        try {\n            const registration = await ensureServiceWorkerRegistered();\n            if (!registration) {\n                console.error('[PWA] Service worker registration failed: no valid sw.js found');\n                return null;\n            }\n\n            _swRegistration = registration;\n            const viteEnv = (import.meta as any)?.env;\n\n            // In dev, aggressively activate updated SW to avoid stale Workbox routes breaking Vite module fetches.\n            // This prevents \"Failed to fetch dynamically imported module: /src/...\" when an old SW is still controlling the page.\n            try {\n                if (viteEnv?.DEV && registration.waiting) {\n                    registration.waiting.postMessage({ type: 'SKIP_WAITING' });\n                }\n            } catch (e) {\n                console.warn('[PWA] Failed to auto-skip-waiting in dev:', e);\n            }\n\n            // Handle updates\n            registration?.addEventListener?.('updatefound', () => {\n                const newWorker = registration?.installing;\n                if (newWorker) {\n                    newWorker?.addEventListener?.('statechange', () => {\n                        if (newWorker?.state === 'installed' && navigator.serviceWorker.controller) {\n                            console.log('[PWA] New service worker available');\n                            showToast({ message: 'App update available', kind: 'info' });\n                            try {\n                                if (viteEnv?.DEV && registration.waiting) {\n                                    registration.waiting.postMessage({ type: 'SKIP_WAITING' });\n                                }\n                            } catch (e) {\n                                console.warn('[PWA] Failed to auto-skip-waiting on updatefound:', e);\n                            }\n                        }\n                    });\n                }\n            });\n\n            // Check for updates periodically (every 30 minutes)\n            setInterval(() => {\n                registration?.update?.().catch?.(console.warn);\n            }, 30 * 60 * 1000);\n\n            console.log('[PWA] Service worker registered successfully');\n            return registration;\n        } catch (error) {\n            console.error('[PWA] Service worker registration failed:', error);\n            return null;\n        }\n    })();\n\n    return _swInitPromise;\n};\n\n/**\n * Get current service worker registration\n */\nexport const getServiceWorkerRegistration = () => _swRegistration;\n\n/**\n * Wait for service worker to be ready\n */\nexport const waitForServiceWorker = async (): Promise<ServiceWorkerRegistration | null> => {\n    if (_swRegistration) return _swRegistration;\n    return _swInitPromise || initServiceWorker();\n};\n\n// ============================================================================\n// BROADCAST RECEIVERS\n// ============================================================================\n\nlet _receiversCleanup: (() => void) | null = null;\n\nexport const initReceivers = () => {\n    if (_receiversCleanup) return;\n    _receiversCleanup = initPWAClipboard();\n};\n\n// ============================================================================\n// SHARE TARGET PROCESSING\n// ============================================================================\n\ninterface ShareDataInput {\n    title?: string;\n    text?: string;\n    url?: string;\n    sharedUrl?: string;\n    files?: File[] | any[];\n    fileCount?: number;\n    imageCount?: number;\n    timestamp?: number;\n    aiProcessed?: boolean;\n    results?: any[];\n    source?: string;\n}\n\nconst routeToTransferView = async (\n    shareData: ShareDataInput,\n    source: \"share-target\" | \"launch-queue\" | \"pending\",\n    hint?: ViewTransferHint,\n    pending = false\n): Promise<boolean> => {\n    const files = Array.isArray(shareData.files)\n        ? shareData.files.filter((file): file is File => file instanceof File)\n        : [];\n\n    const { delivered, resolved } = await dispatchViewTransfer({\n        source,\n        route: source === \"launch-queue\" ? \"launch-queue\" : \"share-target\",\n        title: shareData.title,\n        text: shareData.text,\n        url: shareData.url || shareData.sharedUrl,\n        files,\n        hint,\n        pending,\n        metadata: {\n            timestamp: shareData.timestamp || Date.now(),\n            fileCount: shareData.fileCount ?? files.length,\n            imageCount: shareData.imageCount ?? files.filter((f) => f.type.startsWith(\"image/\")).length\n        }\n    });\n\n    const currentPath = (globalThis?.location?.pathname || \"\").replace(/\\/+$/, \"\") || \"/\";\n    if (currentPath !== resolved.routePath) {\n        const nextUrl = new URL(globalThis?.location?.href);\n        nextUrl.pathname = resolved.routePath;\n        nextUrl.search = \"\";\n        nextUrl.hash = \"\";\n        globalThis.location.href = nextUrl.toString();\n    }\n\n    return delivered;\n};\n\n/**\n * Extract processable content from share data\n * Handles various formats from SW, server, or direct input\n */\nconst extractShareContent = (shareData: ShareDataInput): { content: string | null; type: 'text' | 'url' | 'file' | null } => {\n    // Check for text content first\n    const text = shareData.text?.trim();\n    if (text) {\n        return { content: text, type: 'text' };\n    }\n\n    // Check for URL (handle both 'url' and 'sharedUrl' from server)\n    const url = (shareData.url || shareData.sharedUrl)?.trim();\n    if (url) {\n        return { content: url, type: 'url' };\n    }\n\n    // Check for title as fallback\n    const title = shareData.title?.trim();\n    if (title) {\n        return { content: title, type: 'text' };\n    }\n\n    // Check for actual file objects\n    if (Array.isArray(shareData.files) && shareData.files.length > 0) {\n        const firstFile = shareData.files[0];\n        if (firstFile instanceof File || firstFile instanceof Blob) {\n            return { content: null, type: 'file' };\n        }\n    }\n\n    return { content: null, type: null };\n};\n\n/**\n * Process share target data with AI - broadcasts results to PWA clipboard handlers\n * This is called when SW didn't process (or failed), or for server-side fallback\n */\nexport const processShareTargetData = async (shareData: ShareDataInput, skipIfEmpty = false): Promise<boolean> => {\n    console.log(\"[ShareTarget] Processing shared data:\", {\n        hasText: !!shareData.text,\n        hasUrl: !!shareData.url,\n        fileCount: shareData.files?.length || shareData.fileCount || 0,\n        imageCount: shareData.imageCount || 0,\n        source: shareData.source || 'unknown',\n        aiProcessed: shareData.aiProcessed\n    });\n\n    // If AI already processed in SW, just show result info\n    if (shareData.aiProcessed && shareData.results?.length) {\n        console.log(\"[ShareTarget] AI already processed in SW, showing result\");\n        showToast({ message: \"Content processed by service worker\", kind: \"success\" });\n        return true;\n    }\n\n    const { content, type } = extractShareContent(shareData);\n\n    console.log(\"[ShareTarget] Extracted content:\", { content: content?.substring(0, 50), type });\n\n    if (!content && type !== 'file') {\n        if (skipIfEmpty) {\n            console.log(\"[ShareTarget] No content to process (skipping)\");\n            return false;\n        }\n\n        // Check if there's file metadata but no actual files\n        if (shareData.fileCount && shareData.fileCount > 0) {\n            // Files were processed in SW, this is just metadata notification\n            console.log(\"[ShareTarget] Files processed in service worker\");\n            showToast({ message: \"Files received and being processed\", kind: \"info\" });\n            return true;\n        }\n\n        console.warn(\"[ShareTarget] No content to process\");\n        showToast({ message: \"No content received to process\", kind: \"warning\" });\n        return false;\n    }\n\n    try {\n        console.log(\"[ShareTarget] Starting AI processing for type:\", type);\n        showToast({ message: \"Processing shared content...\", kind: \"info\" });\n\n        // Utility function to convert file to base64\n        const fileToBase64 = (file: File): Promise<string> => {\n            return new Promise((resolve, reject) => {\n                const reader = new FileReader();\n                reader.onload = () => resolve(reader.result as string);\n                reader.onerror = reject;\n                reader.readAsDataURL(file);\n            });\n        };\n\n        // Use unified processing endpoint\n        console.log(\"[ShareTarget] Using unified processing endpoint\");\n\n        let processingContent: any;\n        let contentType: string;\n\n        if (type === 'file' && shareData.files?.[0]) {\n            const file = shareData.files[0] as File;\n            console.log(\"[ShareTarget] Processing file:\", { name: file.name, type: file.type, size: file.size });\n\n            // Convert file to base64 for API transport\n            const base64 = await fileToBase64(file);\n            processingContent = base64;\n            contentType = 'base64';\n        } else if (content) {\n            processingContent = content;\n            contentType = 'text';\n            console.log(\"[ShareTarget] Processing text content, length:\", content.length);\n        } else {\n            throw new Error(\"No processable content found\");\n        }\n\n        // Call unified processing endpoint\n        console.log(\"[ShareTarget] Calling unified processing API\");\n        const response = await fetch('/api/processing', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                content: processingContent,\n                contentType,\n                processingType: 'general-processing',\n                metadata: {\n                    source: 'share-target',\n                    title: shareData.title || 'Shared Content',\n                    timestamp: Date.now()\n                }\n            })\n        });\n\n        if (!response.ok) {\n            throw new Error(`Processing API failed: ${response.status}`);\n        }\n\n        const result = await response.json();\n        console.log(\"[ShareTarget] Unified processing completed:\", { success: result.success });\n\n        if (result.success && result.data) {\n            console.log(\"[ShareTarget] Processing result via unified messaging\");\n\n            // Send to clipboard if configured\n            const clipboardChannel = new BroadcastChannel(CHANNELS.CLIPBOARD);\n            clipboardChannel.postMessage({\n                type: 'copy',\n                data: result.data\n            });\n            clipboardChannel.close();\n\n            // Send to workcenter for display (destination-aware)\n            try {\n                const { unifiedMessaging } = await import(\"@rs-com/core/UnifiedMessaging\");\n                await unifiedMessaging.sendMessage({\n                    type: 'share-target-result',\n                    source: 'share-target',\n                    destination: 'workcenter',\n                    data: {\n                        content: typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2),\n                        rawData: result.data,\n                        timestamp: Date.now(),\n                        source: 'share-target',\n                        action: 'Processing (/api/processing)',\n                        metadata: result.metadata\n                    },\n                    metadata: { priority: 'high' }\n                } as any);\n            } catch (e) {\n                // Fallback to legacy broadcast (best-effort)\n                const workCenterChannel = new BroadcastChannel(BROADCAST_CHANNELS.WORK_CENTER);\n                workCenterChannel.postMessage({\n                    type: 'share-target-result',\n                    data: {\n                        content: result.data,\n                        rawData: result.data,\n                        timestamp: Date.now(),\n                        source: 'share-target',\n                        action: 'Processing (/api/processing)',\n                        metadata: result.metadata\n                    }\n                });\n                workCenterChannel.close();\n            }\n\n            return true;\n        } else {\n            const errorMsg = result?.error || \"AI processing returned no data\";\n            console.warn(\"[ShareTarget] AI processing failed:\", errorMsg);\n\n            // Broadcast error to clipboard handlers\n            const shareChannel = new BroadcastChannel(CHANNELS.SHARE_TARGET);\n            shareChannel.postMessage({\n                type: 'ai-result',\n                data: { success: false, error: errorMsg }\n            });\n            shareChannel.close();\n\n            showToast({ message: `Processing failed: ${errorMsg}`, kind: \"warning\" });\n            return false;\n        }\n    } catch (error: any) {\n        console.error(\"[ShareTarget] Processing error:\", error);\n\n        // Try fallback to server-side AI processing\n        console.log(\"[ShareTarget] Attempting server-side fallback\");\n        const fallbackResult = await tryServerSideProcessing(shareData);\n        if (fallbackResult) {\n            console.log(\"[ShareTarget] Server-side fallback succeeded\");\n            return true;\n        }\n\n        console.warn(\"[ShareTarget] All processing methods failed\");\n\n        // Broadcast error to clipboard handlers\n        const shareChannel = new BroadcastChannel(CHANNELS.SHARE_TARGET);\n        shareChannel.postMessage({\n            type: 'ai-result',\n            data: { success: false, error: error?.message || String(error) }\n        });\n        shareChannel.close();\n\n        showToast({ message: `Processing failed: ${error?.message || 'Unknown error'}`, kind: \"error\" });\n        return false;\n    }\n};\n\n// BroadcastChannel names (using centralized naming system)\nexport const CHANNELS = {\n    SHARE_TARGET: BROADCAST_CHANNELS.SHARE_TARGET,\n    TOAST: BROADCAST_CHANNELS.TOAST,\n    CLIPBOARD: BROADCAST_CHANNELS.CLIPBOARD,\n    MINIMAL_APP: BROADCAST_CHANNELS.MINIMAL_APP,\n    MAIN_APP: BROADCAST_CHANNELS.MAIN_APP,\n    FILE_EXPLORER: BROADCAST_CHANNELS.FILE_EXPLORER,\n    PRINT_VIEWER: BROADCAST_CHANNELS.PRINT_VIEWER\n} as const;\n\n// ============================================================================\n// SHARE TARGET CACHE CONSUMPTION (FILES)\n// ============================================================================\n\nexport const storeShareTargetPayloadToCache = async (payload: { files: File[]; meta?: any }): Promise<boolean> =>\n    storeShareTargetPayloadToCacheGateway(payload);\n\n/**\n * Read and (optionally) clear share-target cached payload, including real files.\n * This is used by Basic edition to attach incoming files to WorkCenter or open markdown.\n */\nexport const consumeCachedShareTargetPayload = async (opts: { clear?: boolean } = {}): Promise<CachedShareTargetPayload | null> =>\n    consumeCachedShareTargetPayloadFromGateway(opts);\n\n/**\n * Fallback to server-side AI processing when client-side fails\n * Broadcasts results to PWA clipboard handlers instead of copying directly\n */\nconst tryServerSideProcessing = async (shareData: ShareDataInput): Promise<boolean> => {\n    try {\n        const { content, type } = extractShareContent(shareData);\n        if (!content) return false;\n\n        console.log(\"[ShareTarget] Attempting server-side AI fallback\");\n\n        // Get API settings\n        const { getRuntimeSettings } = await import(\"@rs-com/config/RuntimeSettings\");\n        const settings = await getRuntimeSettings().catch(() => null);\n        const apiKey = settings?.ai?.apiKey;\n\n        if (!apiKey) {\n            console.log(\"[ShareTarget] No API key for server fallback\");\n            return false;\n        }\n\n        // Call server-side AI endpoint\n        const response = await fetch('/api/share/process', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                text: type === 'text' ? content : undefined,\n                url: type === 'url' ? content : undefined,\n                title: shareData.title,\n                apiKey,\n                baseUrl: settings?.ai?.baseUrl,\n                model: settings?.ai?.customModel || settings?.ai?.model\n            })\n        });\n\n        if (!response.ok) {\n            console.warn(\"[ShareTarget] Server fallback failed:\", response.status);\n            return false;\n        }\n\n        const result = await response.json();\n        if (result?.ok && result?.data) {\n            // Broadcast result to PWA clipboard handlers\n            console.log(\"[ShareTarget] Broadcasting server-side result to clipboard handlers\");\n            const shareChannel = new BroadcastChannel(CHANNELS.SHARE_TARGET);\n            shareChannel.postMessage({\n                type: 'ai-result',\n                data: { success: true, data: String(result.data) }\n            });\n            shareChannel.close();\n            return true;\n        }\n\n        return false;\n    } catch (error) {\n        console.warn(\"[ShareTarget] Server fallback error:\", error);\n        return false;\n    }\n};\n\n/**\n * Handle share target data from various sources\n */\nexport const handleShareTarget = () => {\n    const params = new URLSearchParams(globalThis?.location?.search);\n    const shared = params.get(\"shared\");\n\n    // Handle URL params from server-side share handler\n    if (shared === \"1\" || shared === \"true\") {\n        console.log(\"[ShareTarget] Detected shared=1 URL param, processing server-side share\");\n\n        // Extract share data from URL params (server-side handler)\n        const shareFromParams: ShareDataInput = {\n            title: params.get(\"title\") || undefined,\n            text: params.get(\"text\") || undefined,\n            url: params.get(\"url\") || undefined,\n            sharedUrl: params.get(\"sharedUrl\") || undefined,\n            timestamp: Date.now(),\n            source: 'url-params'\n        };\n\n        console.log(\"[ShareTarget] Share data from URL params:\", {\n            title: shareFromParams.title,\n            text: shareFromParams.text,\n            url: shareFromParams.url,\n            sharedUrl: shareFromParams.sharedUrl\n        });\n\n        // Clean up URL\n        const cleanUrl = new URL(globalThis?.location?.href);\n        ['shared', 'action', 'title', 'text', 'url', 'sharedUrl'].forEach(p => cleanUrl.searchParams.delete(p));\n        globalThis?.history?.replaceState?.({}, \"\", cleanUrl.pathname + cleanUrl.hash);\n\n        // Check if we have content from params\n        const { content, type } = extractShareContent(shareFromParams);\n        console.log(\"[ShareTarget] Extracted from URL params:\", { content: content?.substring(0, 50), type });\n\n        if (content || type === 'file') {\n            console.log(\"[ShareTarget] Processing from URL params\");\n            routeToTransferView(shareFromParams, \"share-target\").catch((error) => {\n                console.warn(\"[ShareTarget] Route transfer failed, falling back to processing:\", error);\n                processShareTargetData(shareFromParams, true);\n            });\n            return; // Don't also check cache\n        } else {\n            console.log(\"[ShareTarget] No processable content in URL params, checking cache\");\n        }\n\n        // No content in params, try cache\n        if ('caches' in globalThis) {\n            caches.open(\"share-target-data\")\n                .then(cache => cache?.match?.(\"/share-target-data\"))\n                .then(response => response?.json?.())\n                .then(async (data: ShareDataInput | undefined) => {\n                    if (data) {\n                        console.log(\"[ShareTarget] Retrieved cached data:\", data);\n                        const delivered = await routeToTransferView(data, \"share-target\", undefined, true);\n                        if (!delivered) {\n                            await processShareTargetData(data, true);\n                        }\n                    } else {\n                        console.log(\"[ShareTarget] No cached share data found\");\n                    }\n                })\n                .catch(e => console.warn(\"[ShareTarget] Cache retrieval failed:\", e));\n        }\n    } else if (shared === \"test\") {\n        // Test mode - just show confirmation\n        showToast({ message: \"Share target route working\", kind: \"info\" });\n\n        const cleanUrl = new URL(globalThis?.location?.href);\n        cleanUrl.searchParams.delete(\"shared\");\n        globalThis?.history?.replaceState?.({}, \"\", cleanUrl.pathname + cleanUrl.hash);\n    }\n\n    // Check for pending share data from sessionStorage (server-side handler fallback)\n    try {\n        const pendingData = sessionStorage.getItem(\"rs-pending-share\");\n        if (pendingData) {\n            sessionStorage.removeItem(\"rs-pending-share\");\n            const shareData = JSON.parse(pendingData) as ShareDataInput;\n            console.log(\"[ShareTarget] Found pending share in sessionStorage:\", shareData);\n            routeToTransferView(shareData, \"pending\", undefined, true).catch((error) => {\n                console.warn(\"[ShareTarget] Pending transfer routing failed:\", error);\n            });\n        }\n    } catch (e) {\n        // Ignore sessionStorage errors\n    }\n\n    // Listen for real-time share target broadcasts from service worker\n    // Note: AI results are handled by PWA clipboard receivers, this handles share notifications\n    if (typeof BroadcastChannel !== \"undefined\") {\n        const shareChannel = new BroadcastChannel(CHANNELS.SHARE_TARGET);\n        shareChannel.addEventListener(\"message\", async (event) => {\n            const msgType = event.data?.type;\n            const msgData = event.data?.data;\n\n            console.log(\"[ShareTarget] Broadcast received:\", { type: msgType, hasData: !!msgData });\n\n            if (msgType === \"share-received\" && msgData) {\n                console.log(\"[ShareTarget] Share notification received:\", {\n                    hasText: !!msgData.text,\n                    hasUrl: !!msgData.url,\n                    fileCount: msgData.fileCount || 0,\n                    aiEnabled: msgData.aiEnabled,\n                    source: msgData.source\n                });\n\n                // Check if this is just a notification (files processed in SW)\n                // vs actual data we need to process\n                if (msgData.fileCount > 0 && !msgData.files?.length) {\n                    // This is a notification - files were handled in SW\n                    showToast({ message: `Processing ${msgData.fileCount} file(s)...`, kind: \"info\" });\n                } else if (msgData.text || msgData.url || msgData.title) {\n                    // We have text content to potentially process\n                    console.log(\"[ShareTarget] Processing broadcasted share data\");\n                    const delivered = await routeToTransferView(msgData, \"share-target\", undefined, true);\n                    if (!delivered) {\n                        await processShareTargetData(msgData, true);\n                    }\n                }\n            } else if (msgType === \"ai-result\") {\n                console.log(\"[ShareTarget] AI result broadcast received (handled by PWA clipboard)\");\n            }\n        });\n\n        console.log(\"[ShareTarget] Broadcast channel listener set up\");\n    } else {\n        console.warn(\"[ShareTarget] BroadcastChannel not available\");\n    }\n};\n\n// ============================================================================\n// LAUNCH QUEUE TYPES AND HANDLING\n// ============================================================================\n\n// Type definitions for Launch Queue API\ninterface LaunchParams {\n    files: FileSystemFileHandle[];\n    targetURL?: string;\n}\n\ninterface LaunchQueue {\n    setConsumer(callback: (launchParams: LaunchParams) => void): void;\n}\n\ndeclare global {\n    interface Window {\n        launchQueue?: LaunchQueue;\n    }\n}\n\n/**\n * Set up launchQueue consumer for PWA file launches and share-target\n * This handles direct file launches when the PWA is opened with files\n */\nexport const setupLaunchQueueConsumer = async () => {\n    if (!('launchQueue' in globalThis)) {\n        console.log('[LaunchQueue] launchQueue API not available');\n        return;\n    }\n\n    try {\n        // Set up the consumer for launch queue\n        globalThis?.launchQueue?.setConsumer?.((launchParams: LaunchParams) => {\n            console.log('[LaunchQueue] Launch params received:', launchParams);\n            const $files = [...launchParams.files];\n\n            // Handle files from launch queue\n            if (!$files || $files.length === 0) {\n                console.log('[LaunchQueue] No files in launch params - this may indicate:');\n                console.log('  - File opener was used but no files were selected');\n                console.log('  - Launch queue consumer called with empty payload');\n                console.log('  - Permission issues preventing file access');\n                console.log('  - Browser compatibility issues');\n                return;\n            }\n\n            //\n            console.log(`[LaunchQueue] Processing ${$files.length} file handle(s)`);\n\n            // Convert FileSystemHandle objects to actual File objects\n            const files: File[] = [];\n            const failedHandles: any[] = [];\n            let hasMarkdownFile = false;\n\n            //\n            (async () => {\n                for (const fileHandle of $files) {\n                    try {\n                        console.log('[LaunchQueue] Processing file handle:', {\n                            name: fileHandle.name || 'unknown',\n                            type: fileHandle.constructor.name,\n                            hasGetFile: typeof fileHandle.getFile === 'function',\n                            isFile: fileHandle instanceof File\n                        });\n\n                        // For file handles, get the actual file\n                        if (fileHandle.getFile) {\n                            try {\n                                // Check if we have permission to access the file\n                                if ('queryPermission' in fileHandle) {\n                                    const permission = await (fileHandle as any).queryPermission();\n                                    console.log('[LaunchQueue] File handle permission:', permission);\n                                    if (permission !== 'granted') {\n                                        console.warn('[LaunchQueue] No permission to access file:', fileHandle.name);\n                                        failedHandles.push(fileHandle);\n                                        continue;\n                                    }\n                                }\n\n                                const file = await fileHandle.getFile();\n                                console.log('[LaunchQueue] Got file from handle:', file.name, file.type, file.size);\n                                files.push(file);\n                                // Check if this is a markdown file\n                                if (file.type === 'text/markdown' || file.name.toLowerCase().endsWith('.md')) {\n                                    hasMarkdownFile = true;\n                                }\n                            } catch (permError) {\n                                console.warn('[LaunchQueue] Permission or access error for file handle:', permError, fileHandle);\n                                failedHandles.push(fileHandle);\n                            }\n                        } else if (fileHandle instanceof File) {\n                            // Already a File object\n                            console.log('[LaunchQueue] File handle is already a File object:', fileHandle.name, fileHandle.type);\n                            files.push(fileHandle);\n                            // Check if this is a markdown file\n                            if (fileHandle.type === 'text/markdown' || fileHandle.name.toLowerCase().endsWith('.md')) {\n                                hasMarkdownFile = true;\n                            }\n                        } else {\n                            console.warn('[LaunchQueue] Unknown file handle type:', fileHandle.constructor.name);\n                            failedHandles.push(fileHandle);\n                        }\n                    } catch (error) {\n                        console.warn('[LaunchQueue] Failed to get file from handle:', error, fileHandle);\n                        failedHandles.push(fileHandle);\n                    }\n                }\n\n                console.log(`[LaunchQueue] Successfully processed ${files.length} files, ${failedHandles.length} failed`);\n\n                // Check if we have any successfully processed files\n                if (files.length === 0) {\n                    if (failedHandles.length > 0) {\n                        console.error('[LaunchQueue] All file handles failed to process');\n                        showToast({\n                            message: `Failed to process ${failedHandles.length} launched file(s)`,\n                            kind: 'error'\n                        });\n                    } else {\n                        console.log('[LaunchQueue] No files to process after filtering');\n                    }\n                    return;\n                }\n\n                if (files.length > 0) {\n                    // Create share data object compatible with existing processing\n                    const shareData = {\n                        files,\n                        fileCount: files.length,\n                        timestamp: Date.now(),\n                        // Determine if there are images for AI processing\n                        imageCount: files?.filter?.(f => f.type.startsWith('image/')).length,\n                        // Check for markdown files\n                        markdownCount: files?.filter?.(f => f.type === 'text/markdown' || f.name.toLowerCase().endsWith('.md')).length,\n                        // Mark as launch queue origin for debugging\n                        source: 'launch-queue'\n                    };\n\n                    console.log('[LaunchQueue] Created share data:', {\n                        fileCount: shareData.fileCount,\n                        imageCount: shareData.imageCount,\n                        fileTypes: files?.map?.(f => ({ name: f.name, type: f.type, size: f.size })),\n                        source: shareData.source\n                    });\n\n                    const hint: ViewTransferHint | undefined = (hasMarkdownFile && files.length === 1)\n                        ? { destination: \"viewer\", action: \"open\", filename: files[0]?.name }\n                        : undefined;\n\n                    // Show immediate feedback that files were received\n                    showToast({\n                        message: `Received ${files.length} file(s)`,\n                        kind: 'info'\n                    });\n\n                    try {\n                        const delivered = await routeToTransferView(shareData, \"launch-queue\", hint, true);\n                        if (!delivered) {\n                            console.warn('[LaunchQueue] Share target processing returned false');\n                            showToast({\n                                message: `Received ${files.length} file(s); delivery is pending`,\n                                kind: 'warning'\n                            });\n                        } else {\n                            console.log('[LaunchQueue] Transfer routed successfully');\n                        }\n                    } catch (error) {\n                        console.error('[LaunchQueue] Failed to route launch queue files:', error);\n                        const stored = await storeShareTargetPayloadToCache({\n                            files,\n                            meta: { timestamp: Date.now(), source: 'launch-queue' }\n                        });\n                        if (stored) {\n                            const url = new URL(globalThis?.location?.href);\n                            url.pathname = '/share-target';\n                            url.searchParams.set('shared', '1');\n                            url.hash = '';\n                            globalThis.location.href = url.toString();\n                        } else {\n                            showToast({\n                                message: `Failed to process ${files.length} launched file(s)`,\n                                kind: 'error'\n                            });\n                        }\n                    }\n                }\n\n                // Handle any target URL if present (for custom protocol launches)\n                if (launchParams.targetURL) {\n                    console.log('[LaunchQueue] Target URL:', launchParams.targetURL);\n                    // Could handle URL-based launches here if needed\n                }\n            })();\n        });\n\n        console.log('[LaunchQueue] Consumer set up successfully');\n    } catch (error) {\n        console.error('[LaunchQueue] Failed to set up consumer:', error);\n    }\n};\n\n// ============================================================================\n// PENDING SHARE DATA HANDLING\n// ============================================================================\n\n/**\n * Check for pending share data from server-side share target handler\n * This handles cases where the service worker wasn't active during share\n */\nexport const checkPendingShareData = async () => {\n    try {\n        const pendingData = globalThis?.sessionStorage?.getItem?.(\"rs-pending-share\");\n        if (!pendingData) return null;\n\n        // Clear immediately to prevent duplicate processing\n        globalThis?.sessionStorage?.removeItem?.(\"rs-pending-share\");\n\n        const shareData = JSON.parse(pendingData);\n        console.log(\"[ShareTarget] Found pending share data:\", shareData);\n\n        // Store in cache for the normal share target flow to pick up\n        if ('caches' in window) {\n            const cache = await globalThis?.caches?.open?.('share-target-data');\n            await cache?.put?.('/share-target-data', new Response(JSON.stringify({\n                ...shareData,\n                files: [],\n                timestamp: shareData.timestamp || Date.now()\n            }), {\n                headers: { 'Content-Type': 'application/json' }\n            }));\n        }\n\n        return shareData;\n    } catch (error) {\n        console.warn(\"[ShareTarget] Failed to process pending share data:\", error);\n        return null;\n    }\n};","// =========================\r\n// SpeechRecognition (AI-)\r\n// =========================\r\n\r\nimport { log, aiButton, aiStatusEl, voiceTextEl } from '../utils/utils';\r\nimport { sendWS, connectWS, isWSConnected } from '../network/websocket';\r\n\r\nlet recognition: any = null;\r\nlet aiListening = false;\r\nexport let aiModeActive = false;\r\n\r\nexport const checkIsAiModeActive = () => {\r\n    return aiListening || aiModeActive;\r\n}\r\n\r\nfunction setAiStatus(text: string) {\r\n    if (aiStatusEl) {\r\n        aiStatusEl.textContent = text;\r\n    }\r\n}\r\n\r\nfunction setupSpeechRecognition() {\r\n    const SR = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n    if (!SR) {\r\n        log('SpeechRecognition API  .');\r\n        return null;\r\n    }\r\n    const recog = new SR();\r\n    recog.lang = 'ru-RU';\r\n    recog.interimResults = false;\r\n    recog.maxAlternatives = 1;\r\n    return recog;\r\n}\r\n\r\nexport function initSpeechRecognition() {\r\n    recognition = setupSpeechRecognition();\r\n\r\n    if (recognition) {\r\n        recognition.onstart = () => {\r\n            aiListening = true;\r\n            aiModeActive = true;\r\n            if (aiButton) {\r\n                aiButton.classList.add('listening');\r\n            }\r\n            setAiStatus('listening');\r\n            if (voiceTextEl) {\r\n                voiceTextEl.textContent = '...';\r\n            }\r\n            log('Speech: start');\r\n        };\r\n\r\n        recognition.onend = () => {\r\n            aiListening = false;\r\n            aiModeActive = false;\r\n            if (aiButton) {\r\n                aiButton.classList.remove('listening');\r\n            }\r\n            setAiStatus('idle');\r\n            log('Speech: end');\r\n        };\r\n\r\n        recognition.onerror = (event: any) => {\r\n            if (voiceTextEl) {\r\n                voiceTextEl.textContent = ' : ' + event.error;\r\n            }\r\n            log('Speech error: ' + event.error);\r\n        };\r\n\r\n        recognition.onresult = (event: any) => {\r\n            const transcript = event.results[0][0].transcript;\r\n            const normalized = (transcript || '').trim();\r\n            const words = normalized.split(/\\s+/).filter(Boolean);\r\n\r\n            if (voiceTextEl) {\r\n                voiceTextEl.textContent = normalized\r\n                    ? ': ' + normalized\r\n                    : '  ';\r\n            }\r\n            log('Speech result: ' + normalized);\r\n\r\n            if (words.length < 2) {\r\n                log('Speech:   ( >= 2)       WS');\r\n                return;\r\n            }\r\n\r\n            const payload = {\r\n                type: 'voice_command',\r\n                text: normalized,\r\n            };\r\n\r\n            const trySend = (deadline: number) => {\r\n                if (isWSConnected()) {\r\n                    sendWS(payload);\r\n                    return;\r\n                }\r\n                if (Date.now() > deadline) {\r\n                    log('Speech:    WS,   ');\r\n                    return;\r\n                }\r\n                setTimeout(() => trySend(deadline), 120);\r\n            };\r\n\r\n            if (!isWSConnected()) {\r\n                log('Speech:  WS   ');\r\n                connectWS();\r\n                trySend(Date.now() + 2000);\r\n            } else {\r\n                sendWS(payload);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\n// =========================\r\n// AI-: pointer\r\n// =========================\r\nexport function initAiButton() {\r\n    if (!aiButton) return;\r\n\r\n    let pointerActive = false;\r\n    let pointerId: number | null = null;\r\n\r\n    aiButton.addEventListener('pointerdown', (e) => {\r\n        e.preventDefault();\r\n        if (pointerActive) return;\r\n        pointerActive = true;\r\n        pointerId = e.pointerId;\r\n        aiButton.setPointerCapture(pointerId);\r\n\r\n        if (!recognition) {\r\n            log('SpeechRecognition ');\r\n            return;\r\n        }\r\n        try {\r\n            recognition.start();\r\n        } catch (err: any) {\r\n            log('Recognition start error: ' + err.message);\r\n        }\r\n    });\r\n\r\n    aiButton.addEventListener('pointerup', (e) => {\r\n        if (!pointerActive || e.pointerId !== pointerId) return;\r\n        e.preventDefault();\r\n        pointerActive = false;\r\n        aiButton.releasePointerCapture(pointerId);\r\n        pointerId = null;\r\n\r\n        if (!recognition) return;\r\n        try {\r\n            recognition.stop();\r\n        } catch (err: any) {\r\n            log('Recognition stop error: ' + err.message);\r\n        }\r\n    });\r\n\r\n    aiButton.addEventListener('pointercancel', () => {\r\n        if (!pointerActive) return;\r\n        pointerActive = false;\r\n        pointerId = null;\r\n        if (recognition) {\r\n            try { recognition.stop(); } catch { /* ignore */ }\r\n        }\r\n    });\r\n}\r\n\r\n","// =========================\r\n// Unified motion accumulator and debounced sender\r\n// =========================\r\n\r\nimport { MOTION_SEND_INTERVAL, MOTION_JITTER_EPS } from './config';\r\nimport { sendWS } from '../network/websocket';\r\n\r\ntype MotionAccum = { dx: number; dy: number; dz: number };\r\n\r\nconst accum: MotionAccum = { dx: 0, dy: 0, dz: 0 };\r\n\r\nlet flushTimer: number | null = null;\r\n\r\nfunction clearAccum() {\r\n    accum.dx = 0;\r\n    accum.dy = 0;\r\n    accum.dz = 0;\r\n}\r\n\r\nfunction scheduleFlush() {\r\n    if (flushTimer !== null) return;\r\n    flushTimer = globalThis?.setTimeout?.(() => {\r\n        flushTimer = null;\r\n        if (accum.dx === 0 && accum.dy === 0 && accum.dz === 0) return;\r\n        sendWS({\r\n            type: 'move',\r\n            dx: accum.dx,\r\n            dy: accum.dy,\r\n            dz: accum.dz,\r\n        });\r\n        clearAccum();\r\n    }, MOTION_SEND_INTERVAL) as any;\r\n}\r\n\r\n// Public API: accumulate motion deltas; they will be sent debounced\r\nexport function enqueueMotion(dx: number, dy: number, dz: number = 0) {\r\n    // Jitter suppression: ignore near-zero noise\r\n    if (Math.abs(dx) < MOTION_JITTER_EPS) dx = 0;\r\n    if (Math.abs(dy) < MOTION_JITTER_EPS) dy = 0;\r\n    if (Math.abs(dz) < MOTION_JITTER_EPS) dz = 0;\r\n    if (dx === 0 && dy === 0 && dz === 0) return;\r\n\r\n    accum.dx += dx;\r\n    accum.dy += dy;\r\n    accum.dz += dz;\r\n    scheduleFlush();\r\n}\r\n\r\n// For tests / manual resets\r\nexport function resetMotionAccum() {\r\n    clearAccum();\r\n    if (flushTimer !== null) {\r\n        clearTimeout(flushTimer);\r\n        flushTimer = null;\r\n    }\r\n}\r\n\r\n","// =========================\r\n// Vector Math Utilities\r\n// =========================\r\n\r\n// Vector3 type\r\nexport interface Vector3 {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n}\r\n\r\nfunction n0(v: number | undefined | null): number {\r\n    return Number.isFinite(v as number) ? (v as number) : 0;\r\n}\r\n\r\n// =========================\r\n// Scalar helpers\r\n// =========================\r\n\r\nexport function clamp01(v: number): number {\r\n    const x = n0(v);\r\n    return x < 0 ? 0 : x > 1 ? 1 : x;\r\n}\r\n\r\nexport function lerp(a: number, b: number, t: number): number {\r\n    return n0(a) + (n0(b) - n0(a)) * clamp01(t);\r\n}\r\n\r\n// Exponential smoothing factor in [0..1] for given dt (seconds) and rate (1/seconds).\r\nexport function expSmoothing(dtSeconds: number, ratePerSecond: number): number {\r\n    const dt = Math.max(0, n0(dtSeconds));\r\n    const rate = Math.abs(n0(ratePerSecond));\r\n    return 1 - Math.exp(-rate * dt);\r\n}\r\n\r\n// Create a vector from components\r\nexport function vec3(x: number, y: number, z: number): Vector3 {\r\n    return { x: n0(x), y: n0(y), z: n0(z) };\r\n}\r\n\r\n// Create a zero vector\r\nexport function vec3Zero(): Vector3 {\r\n    return { x: 0, y: 0, z: 0 };\r\n}\r\n\r\n//\r\nexport function vec3Mix(a: Vector3, b: Vector3, f: number = 0.5): Vector3 {\r\n    const ax = n0(a.x);\r\n    const ay = n0(a.y);\r\n    const az = n0(a.z);\r\n    const bx = n0(b.x);\r\n    const by = n0(b.y);\r\n    const bz = n0(b.z);\r\n    const ff = n0(f);\r\n    return {\r\n        x: ax + (bx - ax) * ff,\r\n        y: ay + (by - ay) * ff,\r\n        z: az + (bz - az) * ff,\r\n    };\r\n}\r\n\r\n// Is near vector\r\nexport function vec3IsNear(v: Vector3, other: Vector3, epsilon: number = 0.01): boolean {\r\n    const e = n0(epsilon) || 0.01;\r\n    return Math.abs(n0(v.x) - n0(other.x)) < e && Math.abs(n0(v.y) - n0(other.y)) < e && Math.abs(n0(v.z) - n0(other.z)) < e;\r\n}\r\n\r\n// Is far vector\r\nexport function vec3IsFar(v: Vector3, other: Vector3, epsilon: number = 0.01): boolean {\r\n    const e = n0(epsilon) || 0.01;\r\n    return Math.abs(n0(v.x) - n0(other.x)) > e && Math.abs(n0(v.y) - n0(other.y)) > e && Math.abs(n0(v.z) - n0(other.z)) > e;\r\n}\r\n\r\n// Create a vector from sensor reading\r\nexport function vec3FromSensor(sensor: { x?: number; y?: number; z?: number }): Vector3 {\r\n    return {\r\n        x: n0(sensor.x),\r\n        y: n0(sensor.y),\r\n        z: n0(sensor.z),\r\n    };\r\n}\r\n\r\n// Vector subtraction: a - b\r\nexport function vec3Sub(a: Vector3, b: Vector3): Vector3 {\r\n    return {\r\n        x: n0(a.x) - n0(b.x),\r\n        y: n0(a.y) - n0(b.y),\r\n        z: n0(a.z) - n0(b.z),\r\n    };\r\n}\r\n\r\n// Vector addition: a + b\r\nexport function vec3Add(a: Vector3, b: Vector3): Vector3 {\r\n    return {\r\n        x: n0(a.x) + n0(b.x),\r\n        y: n0(a.y) + n0(b.y),\r\n        z: n0(a.z) + n0(b.z),\r\n    };\r\n}\r\n\r\n// Scale vector by scalar: v * s\r\nexport function vec3Scale(v: Vector3, scalar: number): Vector3 {\r\n    const s = n0(scalar);\r\n    return {\r\n        x: n0(v.x) * s,\r\n        y: n0(v.y) * s,\r\n        z: n0(v.z) * s,\r\n    };\r\n}\r\n\r\n// Component-wise multiplication: a * b\r\nexport function vec3Mul(a: Vector3, b: Vector3): Vector3 {\r\n    return {\r\n        x: n0(a.x) * n0(b.x),\r\n        y: n0(a.y) * n0(b.y),\r\n        z: n0(a.z) * n0(b.z),\r\n    };\r\n}\r\n\r\n// Clamp vector length to max (radial clamp): keeps direction, limits magnitude.\r\nexport function vec3Clamp(v: Vector3, max: number): Vector3 {\r\n    const m = Math.abs(n0(max));\r\n    if (m === 0) return vec3Zero();\r\n\r\n    const x = n0(v.x);\r\n    const y = n0(v.y);\r\n    const z = n0(v.z);\r\n    const length = Math.hypot(x, y, z);\r\n\r\n    // If already within limit (or zero), return the sanitized vector unchanged.\r\n    if (length === 0 || length <= m) return { x, y, z };\r\n\r\n    const s = m / length;\r\n    return { x: x * s, y: y * s, z: z * s };\r\n}\r\n\r\n// Apply dead zone: if |component| < threshold, set to 0\r\nexport function vec3DeadZone(v: Vector3, threshold: number): Vector3 {\r\n    const t = Math.abs(n0(threshold));\r\n    return {\r\n        x: Math.abs(n0(v.x)) < t ? 0 : n0(v.x),\r\n        y: Math.abs(n0(v.y)) < t ? 0 : n0(v.y),\r\n        z: Math.abs(n0(v.z)) < t ? 0 : n0(v.z),\r\n    };\r\n}\r\n\r\n// Check if vector is near zero (all components < epsilon)\r\nexport function vec3IsNearZero(v: Vector3, epsilon: number = 0.01): boolean {\r\n    const e = Math.abs(n0(epsilon) || 0.01);\r\n    return Math.abs(n0(v.x)) < e && Math.abs(n0(v.y)) < e && Math.abs(n0(v.z)) < e;\r\n}\r\n\r\n// Exponential smoothing: result = current + (target - current) * factor\r\nexport function vec3Smooth(current: Vector3, target: Vector3, factor: number = 0.25): Vector3 {\r\n    return vec3Mix(current, target, factor);\r\n}\r\n\r\n//\r\nexport function vec3Normalize(v: Vector3, dt: number = 0.1): Vector3 {\r\n    const denom = Math.max(0.000001, Math.abs(n0(dt)) || 0.000001);\r\n    return { x: n0(v.x) / denom, y: n0(v.y) / denom, z: n0(v.z) / denom };\r\n}\r\n\r\n// Select components for 2D mouse movement\r\n// axisMapping: 'ax', 'ay', 'az' for x, y, z components\r\nexport function vec3Select2D(v: Vector3, axisX: 'ax' | 'ay' | 'az', axisY: 'ax' | 'ay' | 'az'): { x: number; y: number } {\r\n    const componentMap = {\r\n        ax: v.x || 0,\r\n        ay: v.y || 0,\r\n        az: v.z || 0,\r\n    };\r\n    return {\r\n        x: componentMap[axisX],\r\n        y: componentMap[axisY],\r\n    };\r\n}\r\n\r\n// Select components for 3D mouse movement\r\nexport function vec3Select(v: Vector3, axisX: 'ax' | 'ay' | 'az', axisY: 'ax' | 'ay' | 'az', axisZ: 'ax' | 'ay' | 'az'): { x: number; y: number; z: number } {\r\n    const componentMap = {\r\n        ax: n0(v.x),\r\n        ay: n0(v.y),\r\n        az: n0(v.z),\r\n    };\r\n    return {\r\n        x: componentMap[axisX],\r\n        y: componentMap[axisY],\r\n        z: componentMap[axisZ],\r\n    };\r\n}\r\n\r\n// Apply direction multipliers to 2D vector\r\nexport function vec2ApplyDirection(v: { x: number; y: number }, dirX: number = 1, dirY: number = 1): { x: number; y: number } {\r\n    return {\r\n        x: n0(v.x) * (n0(dirX) || 1),\r\n        y: n0(v.y) * (n0(dirY) || 1),\r\n    };\r\n}\r\n\r\n// Scale 2D vector by scalar\r\nexport function vec2Scale(v: { x: number; y: number }, scalar: number = 1): { x: number; y: number } {\r\n    const s = n0(scalar);\r\n    return {\r\n        x: n0(v.x) * s,\r\n        y: n0(v.y) * s,\r\n    };\r\n}\r\n\r\n// Rotate X/Y by Z angle (radians). Optionally override output Z (useful when Z is repurposed).\r\nexport function vec3RotateXYByAngle(v: Vector3, angleRad: number, zOverride?: number): Vector3 {\r\n    const a = n0(angleRad);\r\n    const cosA = Math.cos(a);\r\n    const sinA = Math.sin(a);\r\n    const x = n0(v.x);\r\n    const y = n0(v.y);\r\n    return {\r\n        x: x * cosA - y * sinA,\r\n        y: x * sinA + y * cosA,\r\n        z: zOverride !== undefined ? n0(zOverride) : n0(v.z),\r\n    };\r\n}\r\n\r\n// =========================\r\n// Angle Math\r\n// =========================\r\n\r\n//    [-PI, PI]\r\nexport function normalizeAngle(angle: number): number {\r\n    const twoPi = Math.PI * 2;\r\n    angle = angle % twoPi;\r\n    if (angle < -Math.PI) {\r\n        angle += twoPi;\r\n    } else if (angle > Math.PI) {\r\n        angle -= twoPi;\r\n    }\r\n    return angle;\r\n}\r\n\r\n//      \r\nexport function angleDelta(a: number, b: number): number {\r\n    return normalizeAngle(a - b);\r\n}\r\n\r\n// Normalize all angles in a vector\r\nexport function vec3NormalizeAngles(v: Vector3): Vector3 {\r\n    return {\r\n        x: normalizeAngle(n0(v.x)),\r\n        y: normalizeAngle(n0(v.y)),\r\n        z: normalizeAngle(n0(v.z)),\r\n    };\r\n}\r\n\r\n// Calculate angle deltas between two angle vectors\r\nexport function vec3AngleDelta(current: Vector3, base: Vector3): Vector3 {\r\n    return {\r\n        x: angleDelta(n0(current.x), n0(base.x)),\r\n        y: angleDelta(n0(current.y), n0(base.y)),\r\n        z: angleDelta(n0(current.z), n0(base.z)),\r\n    };\r\n}\r\n","// =========================\r\n// Gravity Sensor\r\n// =========================\r\n\r\nimport { log } from '../../utils/utils';\r\nimport { vec3Zero, vec3FromSensor, vec3Smooth, vec3NormalizeAngles, type Vector3, vec3Normalize } from '../../utils/math';\r\nimport { GRAVITY_SMOOTH } from '../../config/config';\r\n\r\nlet gravitySensor: any = null;\r\n\r\n// Smoothed gravity vector (normalized)\r\nlet gravityVector: Vector3 = vec3Zero();\r\nlet gravityMagnitude: number = 0;\r\n\r\n// Get current gravity vector (normalized)\r\nexport function getGravityVector(): Vector3 {\r\n    return gravityVector;\r\n}\r\n\r\n// Get gravity magnitude\r\nexport function getGravityMagnitude(): number {\r\n    return gravityMagnitude;\r\n}\r\n\r\n// Check if gravity sensor is available\r\nexport function isGravityAvailable(): boolean {\r\n    return gravitySensor !== null;\r\n}\r\n\r\n// Reset gravity sensor state\r\nexport function resetGravitySensor() {\r\n    gravityVector = vec3Zero();\r\n    gravityMagnitude = 0;\r\n}\r\n\r\n// Calculate orientation correction matrix from gravity vector\r\n// Returns rotation angles to align with gravity\r\nexport function getOrientationCorrection(): Vector3 {\r\n    if (gravityMagnitude < 0.1) {\r\n        return vec3Zero(); // Not enough gravity data\r\n    }\r\n\r\n    // Calculate pitch and roll from gravity vector\r\n    // Pitch: rotation around X axis (forward/backward tilt)\r\n    // Roll: rotation around Y axis (left/right tilt)\r\n    const gx = gravityVector.x;\r\n    const gy = gravityVector.y;\r\n    const gz = gravityVector.z;\r\n\r\n    const pitch = Math.atan2(-gx, Math.sqrt(gy * gy + gz * gz));\r\n    const roll = Math.atan2(gy, gz);\r\n\r\n    return {\r\n        x: pitch,  // pitch correction\r\n        y: roll,   // roll correction\r\n        z: 0       // yaw not determined from gravity alone\r\n    };\r\n}\r\n\r\n// Apply dimensional correction to a vector using gravity reference\r\nexport function applyDimensionalCorrection(vector: Vector3, useGravity: boolean = true): Vector3 {\r\n    if (!useGravity || !isGravityAvailable() || gravityMagnitude < 0.1) {\r\n        return vector; // No correction if gravity not available\r\n    }\r\n\r\n    const correction = getOrientationCorrection();\r\n\r\n    // Apply pitch and roll corrections\r\n    // This compensates for device orientation relative to gravity\r\n    return {\r\n        x: vector.x - correction.x * 0.1, // Subtle correction\r\n        y: vector.y - correction.y * 0.1,\r\n        z: vector.z\r\n    };\r\n}\r\n\r\n// Initialize gravity sensor\r\nexport function initGravitySensor() {\r\n    if (!('GravitySensor' in window)) {\r\n        log('GravitySensor API is not supported.');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        gravitySensor = new (window as any).GravitySensor({ frequency: 60 });\r\n    } catch (err: any) {\r\n        log('Cannot create GravitySensor: ' + (err.message || err));\r\n        return;\r\n    }\r\n\r\n    gravitySensor.addEventListener('reading', () => {\r\n        const rawGravity = vec3FromSensor(gravitySensor!);\r\n\r\n        // Smooth the gravity vector\r\n        gravityVector = vec3Smooth(gravityVector, rawGravity, GRAVITY_SMOOTH);\r\n\r\n        // Calculate magnitude\r\n        gravityMagnitude = Math.hypot(gravityVector.x, gravityVector.y, gravityVector.z);\r\n\r\n        // Normalize gravity vector\r\n        if (gravityMagnitude > 0.1) {\r\n            const invMag = 1.0 / gravityMagnitude;\r\n            gravityVector = {\r\n                x: gravityVector.x * invMag,\r\n                y: gravityVector.y * invMag,\r\n                z: gravityVector.z * invMag\r\n            };\r\n        }\r\n    });\r\n\r\n    gravitySensor.addEventListener('error', (event: any) => {\r\n        log('GravitySensor error: ' + ((event?.error?.message) || event?.message || event));\r\n    });\r\n\r\n    gravitySensor.start();\r\n    log('GravitySensor started (60 Hz)');\r\n}\r\n\r\n","// =========================\r\n// Gyroscope\r\n// =========================\r\n\r\nimport { log } from '../../utils/utils';\r\nimport { sendWS, isWSConnected } from '../../network/websocket';\r\nimport { enqueueMotion } from '../../config/motion-state';\r\nimport { aiModeActive } from '../speech';\r\nimport { getAirState, isMotionCalibrated, setMotionCalibrated, resetMotionBaseline } from '../../ui/air-button';\r\nimport { ANGLE_DEADZONE, ANGLE_GAIN, ANGLE_SMOOTH, ANGLE_MAX_STEP, MOTION_SEND_INTERVAL, gyroDirX, gyroDirY, gyroDirZ, gyroSrcForMouseX, gyroSrcForMouseY, gyroSrcForMouseZ, GYRO_DEADZONE, GYRO_GAIN, GYRO_SMOOTH, GYRO_MAX_SAMPLE_COUNT, GYRO_ROTATION_GAIN, GRAVITY_CORRECTION_STRENGTH } from '../../config/config';\r\nimport {\r\n    vec3Zero,\r\n    vec3FromSensor,\r\n    vec3NormalizeAngles,\r\n    vec3AngleDelta,\r\n    vec3DeadZone,\r\n    vec3Select2D,\r\n    vec2ApplyDirection,\r\n    vec2Scale,\r\n    vec3Smooth,\r\n    vec3Clamp,\r\n    vec3IsNearZero,\r\n    type Vector3,\r\n    vec3Scale,\r\n    vec3Mix,\r\n    vec3Add,\r\n    vec3Sub,\r\n    vec3Select,\r\n    normalizeAngle,\r\n    vec3RotateXYByAngle,\r\n} from '../../utils/math';\r\nimport { applyDimensionalCorrection, getOrientationCorrection, isGravityAvailable } from './gravity-sensor';\r\n\r\n//\r\nlet gyroscope: any = null;\r\n\r\n// smoothed values of \"movement\" for cursor\r\nlet filteredMovement = { x: 0, y: 0 };\r\nlet lastTimestamp: number = performance.now();\r\nlet lastMotionSentAt: number = 0;\r\n\r\n// reset IMU state (e.g. when exiting AIR_MOVE)\r\nfunction resetGyroState() {\r\n    setMotionCalibrated(false);\r\n    filteredMovement = { x: 0, y: 0 };\r\n    lastTimestamp = performance.now();\r\n    lastMotionSentAt = 0;\r\n    resetMonteCarloSampling();\r\n    gyroscopeSmoothed = vec3Zero();\r\n    integratedAngles = vec3Zero();\r\n    lastGyroMovement = vec3Zero();\r\n}\r\n\r\nexport function resetGyroscopeState() {\r\n    resetGyroState();\r\n    resetMotionBaseline();\r\n}\r\n\r\n// Called when entering AIR_MOVE mode\r\nexport function onEnterAirMove() {\r\n    resetGyroState();\r\n}\r\n\r\n// Monte Carlo sampling for real-time calibration\r\nlet gyroscopeSmoothed: Vector3 = vec3Zero();\r\nlet gyroscopeResolved: Vector3 = vec3Zero(); // calibrated baseline (bias)\r\nlet integratedAngles: Vector3 = vec3Zero(); // accumulated angles\r\n\r\n// Sliding window for Monte Carlo sampling\r\nlet gyroscopeSampleWindow: Vector3[] = [];\r\nlet gyroscopeSampleWeights: number[] = []; // weights for each sample\r\nlet gyroscopeTotalWeight = 0;\r\nlet gyroscopeWeightedSum: Vector3 = vec3Zero(); // cached weighted sum for efficiency\r\n\r\n//\r\nlet averageRateSampleCount = 0;\r\nlet averageRateSampled = 0;\r\nlet averageRateResolved = 0;\r\n\r\n// Reset Monte Carlo sampling window\r\nfunction resetMonteCarloSampling() {\r\n    gyroscopeSampleWindow = [];\r\n    gyroscopeSampleWeights = [];\r\n    gyroscopeTotalWeight = 0;\r\n    gyroscopeWeightedSum = vec3Zero();\r\n    gyroscopeResolved = vec3Zero();\r\n}\r\n\r\n// Get calibration confidence (0-1): higher when window is full\r\nfunction getCalibrationConfidence(): number {\r\n    return Math.pow(Math.min(1, gyroscopeSampleWindow.length / GYRO_MAX_SAMPLE_COUNT), 2);\r\n}\r\n\r\n// Add sample to sliding window Monte Carlo sampler (optimized incremental update)\r\nfunction addMonteCarloSample(sample: Vector3, weight: number = 1, smoothForDiff: Vector3 = vec3Zero()): void {\r\n    if ((Math.abs(sample.x) + Math.abs(sample.y) + Math.abs(sample.z)) < 0.0001) return;\r\n\r\n    // too large difference from resolved - skip sample\r\n    if (Math.hypot(smoothForDiff.x - gyroscopeResolved.x, smoothForDiff.y - gyroscopeResolved.y, smoothForDiff.z - gyroscopeResolved.z) > (1 - getCalibrationConfidence())) {\r\n        return;\r\n    }\r\n\r\n    // Normalize the sample (angles)\r\n    const normalizedSample = vec3NormalizeAngles(sample);\r\n    const weightedSample = vec3Scale(normalizedSample, 1 / Math.max(0.001, weight));\r\n\r\n    // Check if we need to remove oldest sample\r\n    let removedWeightedSample: Vector3 | null = null;\r\n    if (gyroscopeSampleWindow.length >= GYRO_MAX_SAMPLE_COUNT) {\r\n        // Remove oldest sample (FIFO) - store for incremental update\r\n        const removedWeight = gyroscopeSampleWeights.shift()!;\r\n        removedWeightedSample = vec3Scale(gyroscopeSampleWindow.shift()!, removedWeight);\r\n        gyroscopeTotalWeight -= removedWeight;\r\n    }\r\n\r\n    // Add new sample to window\r\n    gyroscopeSampleWindow.push(weightedSample);\r\n    gyroscopeSampleWeights.push(weight);\r\n    gyroscopeTotalWeight += 1;\r\n\r\n    // Incremental update of weighted sum (more efficient than recalculating)\r\n    if (removedWeightedSample) {\r\n        // Remove old contribution\r\n        gyroscopeWeightedSum = vec3Sub(gyroscopeWeightedSum, removedWeightedSample);\r\n    }\r\n    // Add new contribution\r\n    gyroscopeWeightedSum = vec3Add(gyroscopeWeightedSum, weightedSample);\r\n\r\n    // Calculate weighted average (calibrated baseline)\r\n    if (gyroscopeTotalWeight > 0) {\r\n        gyroscopeResolved = vec3Scale(gyroscopeWeightedSum, 1 / gyroscopeTotalWeight);\r\n    }\r\n}\r\n\r\n//\r\nexport const gravityCorrection = (gyro: Vector3) => {\r\n    if (isGravityAvailable()) {\r\n        const orientationCorrection = getOrientationCorrection();\r\n        return {\r\n            x: gyro.x - orientationCorrection.x * GRAVITY_CORRECTION_STRENGTH,\r\n            y: gyro.y - orientationCorrection.y * GRAVITY_CORRECTION_STRENGTH,\r\n            z: gyro.z\r\n        };\r\n    }\r\n    return gyro;\r\n}\r\n\r\n//\r\nfunction gyroscopeSmooth(currentAngles: Vector3, dt: number = 0.1, sampleFactor: number = 1): Vector3 {\r\n    const smoothFactor = Math.max(0.1, Math.min(dt * 10, GYRO_SMOOTH, 1));\r\n\r\n    // Normalize accumulated angles\r\n    const normAngles = (currentAngles);\r\n\r\n    // Monte Carlo base sampling (real-time calibration/bias correction)\r\n    addMonteCarloSample(vec3NormalizeAngles(normAngles), sampleFactor, gyroscopeSmoothed);\r\n\r\n    // Remove bias using calibrated baseline, then smooth\r\n    const unbiasedAngles = vec3Sub(normAngles, gyroscopeResolved);\r\n    gyroscopeSmoothed = vec3Smooth(gyroscopeSmoothed, normAngles, smoothFactor);\r\n    let smoothGyro = gyroscopeSmoothed;\r\n\r\n    // Apply dead-zone after corrections\r\n    return vec3NormalizeAngles(smoothGyro);\r\n}\r\n\r\n//\r\nexport const getRotatedGyro = (gyro: Vector3) => {\r\n\r\n    //\r\n    let selectedAxes = vec3Select(\r\n        gyro,\r\n        gyroSrcForMouseX as 'ax' | 'ay' | 'az',\r\n        gyroSrcForMouseY as 'ax' | 'ay' | 'az',\r\n        gyroSrcForMouseZ as 'ax' | 'ay' | 'az'\r\n    );\r\n\r\n    // Extract Z axis rotation (rotation around Z axis)\r\n    const rotationZ = normalizeAngle(selectedAxes.z * gyroDirZ);\r\n    return vec3RotateXYByAngle(selectedAxes, rotationZ, 1);\r\n}\r\n\r\n\r\n//\r\nlet lastGyroMovement: Vector3 = vec3Zero();\r\nlet forSendingGyroMovement: Vector3 = vec3Zero();\r\nlet lastSendingTime: number = 0;\r\n\r\n//\r\nlet deltaGyroMovement: Vector3 = vec3Zero();\r\n\r\n//\r\nconst calculateDeltaGyroMovement = (gyro: Vector3) => {\r\n    const result = vec3Sub(gyro, lastGyroMovement);\r\n    lastGyroMovement = gyro;\r\n    return (deltaGyroMovement = result);\r\n}\r\n\r\n//\r\nlet sendWSGyroMovement = (movement: Vector3) => {\r\n    forSendingGyroMovement = vec3Add(forSendingGyroMovement, movement);\r\n\r\n    const baseMovement = {\r\n        x: forSendingGyroMovement.x * gyroDirX * GYRO_GAIN,\r\n        y: forSendingGyroMovement.y * gyroDirY * GYRO_GAIN,\r\n        z: forSendingGyroMovement.z * GYRO_GAIN * GYRO_ROTATION_GAIN\r\n    }; forSendingGyroMovement = vec3Zero();\r\n\r\n    const clampedMovement: Vector3 = vec3Clamp(baseMovement, ANGLE_MAX_STEP);\r\n    // Jitter suppression using gyro deadzone\r\n    const jx = Math.abs(clampedMovement.x) < GYRO_DEADZONE ? 0 : clampedMovement.x;\r\n    const jy = Math.abs(clampedMovement.y) < GYRO_DEADZONE ? 0 : clampedMovement.y;\r\n    const jz = Math.abs(clampedMovement.z) < GYRO_DEADZONE ? 0 : clampedMovement.z;\r\n    if (jx === 0 && jy === 0 && jz === 0) return;\r\n    enqueueMotion(jx, jy, jz);\r\n}\r\n\r\n//  \r\nexport function initGyro() {\r\n    if (!('Gyroscope' in window)) {\r\n        log('Gyroscope API  .');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        gyroscope = new (window as any).Gyroscope({ frequency: 60 });\r\n    } catch (err: any) {\r\n        log('  Gyroscope: ' + (err.message || err));\r\n        return;\r\n    }\r\n\r\n    //\r\n    gyroscope.addEventListener('reading', () => {\r\n        //\r\n        const now = performance.now();\r\n        const dtMs = now - (lastTimestamp || now); // to avoid huge dt on first entry\r\n        const dt = dtMs / 1000; lastTimestamp = now; // in seconds\r\n\r\n        //\r\n        averageRateSampled += dt; averageRateSampleCount++;\r\n        averageRateResolved = averageRateSampled / averageRateSampleCount;\r\n\r\n        // for lag/overshoot correction\r\n        const averageRateFactor = (dt / averageRateResolved); // if dt > 1 has lag, dt < 1 has overshoot\r\n\r\n        // integrate raw gyro to angles\r\n        const rawGyro = vec3FromSensor(gyroscope!);\r\n        integratedAngles = vec3NormalizeAngles(vec3Add(integratedAngles, vec3Scale(rawGyro, dt)));\r\n\r\n        // smoothing & calibration on accumulated angles\r\n        const filteredGyro = getRotatedGyro(gyroscopeSmooth(integratedAngles, dt, averageRateFactor));\r\n\r\n        // track delta between current and previous angles\r\n        const delta = vec3DeadZone(calculateDeltaGyroMovement(filteredGyro), GYRO_DEADZONE);\r\n\r\n        // small values after smoothing are not sent\r\n        if (vec3IsNearZero(delta)) { return; }\r\n\r\n        //  \r\n        if (getAirState() !== 'AIR_MOVE') { return; }\r\n        if (!isWSConnected()) return;\r\n        if (aiModeActive) return;\r\n\r\n        // selection of axes for mouse (as you previously selected axes of accelerometer)\r\n        sendWSGyroMovement(delta);\r\n    });\r\n\r\n    gyroscope.addEventListener('error', (event: any) => {\r\n        log('Gyroscope error: ' + ((event.error && event.error.message) || event.message || event));\r\n    });\r\n\r\n    gyroscope.start();\r\n    log('Gyroscope started (60 Hz, angle integration)');\r\n}\r\n","// =========================\r\n// Accelerometer\r\n// =========================\r\n\r\nimport { log } from '../../utils/utils';\r\nimport { isWSConnected } from '../../network/websocket';\r\nimport { enqueueMotion } from '../../config/motion-state';\r\nimport { getAirState, setMotionCalibrated } from '../../ui/air-button';\r\nimport { ACCELEROMETER_DEADZONE, ACCELEROMETER_GAIN, ACCELEROMETER_SMOOTH, ACCELEROMETER_MAX_SAMPLE_COUNT, GRAVITY_CORRECTION_STRENGTH, accelSrcForMouseX, accelSrcForMouseY, accelSrcForMouseZ, accelDirX, accelDirY, accelDirZ } from '../../config/config';\r\nimport { vec3Zero, vec3FromSensor, vec3Sub, vec3Scale, type Vector3, vec3Mix, vec3Smooth, vec3Add, vec3DeadZone, vec3IsNearZero, vec3Select } from '../../utils/math';\r\nimport { aiModeActive } from '../speech';\r\nimport { getGravityVector, isGravityAvailable, getGravityMagnitude, getOrientationCorrection } from './gravity-sensor';\r\n\r\n//\r\nlet accelerometer: any = null;\r\n\r\n// smoothed values of \"movement\" for cursor\r\nlet lastTimestamp: number = performance.now();\r\nlet lastMotionSentAt: number = 0;\r\n\r\n// reset accelerometer state (e.g. when exiting AIR_MOVE)\r\nfunction resetAccelState() {\r\n    setMotionCalibrated(false);\r\n    lastTimestamp = performance.now();\r\n    lastMotionSentAt = 0;\r\n    resetMonteCarloSampling();\r\n    accelerometerSmoothed = vec3Zero();\r\n    accelerometerResolved = vec3Zero();\r\n    forSendingMovement = vec3Zero();\r\n}\r\n\r\nexport function resetAccelerometerState() {\r\n    resetAccelState();\r\n}\r\n\r\n// Called when entering AIR_MOVE mode\r\nexport function onEnterAirMove() {\r\n    resetAccelState();\r\n}\r\n\r\n// Monte Carlo sampling for real-time calibration\r\nlet accelerometerSmoothed: Vector3 = vec3Zero();\r\nlet accelerometerResolved: Vector3 = vec3Zero(); // calibrated baseline (bias)\r\n\r\n// Sliding window for Monte Carlo sampling\r\nlet accelerometerSampleWindow: Vector3[] = [];\r\nlet accelerometerSampleWeights: number[] = []; // weights for each sample\r\nlet accelerometerTotalWeight = 0;\r\nlet accelerometerWeightedSum: Vector3 = vec3Zero(); // cached weighted sum for efficiency\r\n\r\n//\r\nlet averageRateSampleCount = 0;\r\nlet averageRateSampled = 0;\r\nlet averageRateResolved = 0;\r\n\r\n// Reset Monte Carlo sampling window\r\nfunction resetMonteCarloSampling() {\r\n    accelerometerSampleWindow = [];\r\n    accelerometerSampleWeights = [];\r\n    accelerometerTotalWeight = 0;\r\n    accelerometerWeightedSum = vec3Zero();\r\n    accelerometerResolved = vec3Zero();\r\n}\r\n\r\n// Add sample to sliding window Monte Carlo sampler (optimized incremental update)\r\nfunction addMonteCarloSample(sample: Vector3, weight: number = 1, smoothForDiff: Vector3 = vec3Zero()): void {\r\n    if ((Math.abs(sample.x) + Math.abs(sample.y) + Math.abs(sample.z)) < 0.0001) return;\r\n\r\n    // too large difference from resolved - skip sample\r\n    if (Math.hypot(smoothForDiff.x - accelerometerResolved.x, smoothForDiff.y - accelerometerResolved.y, smoothForDiff.z - accelerometerResolved.z) > 2.0) {\r\n        return;\r\n    }\r\n\r\n    const weightedSample = vec3Scale(sample, 1 / Math.max(0.001, weight));\r\n\r\n    // Check if we need to remove oldest sample\r\n    let removedWeightedSample: Vector3 | null = null;\r\n    if (accelerometerSampleWindow.length >= ACCELEROMETER_MAX_SAMPLE_COUNT) {\r\n        // Remove oldest sample (FIFO) - store for incremental update\r\n        const removedWeight = accelerometerSampleWeights.shift()!;\r\n        removedWeightedSample = vec3Scale(accelerometerSampleWindow.shift()!, removedWeight);\r\n        accelerometerTotalWeight -= removedWeight;\r\n    }\r\n\r\n    // Add new sample to window\r\n    accelerometerSampleWindow.push(weightedSample);\r\n    accelerometerSampleWeights.push(weight);\r\n    accelerometerTotalWeight += 1;\r\n\r\n    // Incremental update of weighted sum (more efficient than recalculating)\r\n    if (removedWeightedSample) {\r\n        // Remove old contribution\r\n        accelerometerWeightedSum = vec3Sub(accelerometerWeightedSum, removedWeightedSample);\r\n    }\r\n    // Add new contribution\r\n    accelerometerWeightedSum = vec3Add(accelerometerWeightedSum, weightedSample);\r\n\r\n    // Calculate weighted average (calibrated baseline)\r\n    if (accelerometerTotalWeight > 0) {\r\n        accelerometerResolved = vec3Scale(accelerometerWeightedSum, 1 / accelerometerTotalWeight);\r\n    }\r\n}\r\n\r\n// Get calibration confidence (0-1): higher when window is full\r\nfunction getCalibrationConfidence(): number {\r\n    return Math.min(1, accelerometerSampleWindow.length / ACCELEROMETER_MAX_SAMPLE_COUNT);\r\n}\r\n\r\n\r\n//\r\nexport const gravityCorrection = (gyro: Vector3) => {\r\n    if (isGravityAvailable()) {\r\n        const orientationCorrection = getOrientationCorrection();\r\n        return {\r\n            x: gyro.x - orientationCorrection.x * GRAVITY_CORRECTION_STRENGTH,\r\n            y: gyro.y - orientationCorrection.y * GRAVITY_CORRECTION_STRENGTH,\r\n            z: gyro.z\r\n        };\r\n    }\r\n    return gyro;\r\n}\r\n\r\n\r\n//\r\nfunction accelerometerSmooth(accel: Vector3, dt: number = 0.1, sampleFactor: number = 1): Vector3 {\r\n    const smoothFactor = Math.max(0.05, Math.min(dt * 1, ACCELEROMETER_SMOOTH, 1));\r\n\r\n    // Dead-zone, smoothing and normalization\r\n    accelerometerSmoothed = vec3Smooth(accelerometerSmoothed, accel, smoothFactor);\r\n\r\n    // Monte Carlo base sampling (real-time calibration/bias correction)\r\n    // Use sampleFactor as weight to account for timing variations\r\n    addMonteCarloSample(accel, sampleFactor, accelerometerSmoothed);\r\n\r\n    // Remove gravity component if gravity sensor is available\r\n    //let linearAccel = vec3Sub(accelerometerSmoothed, accelerometerResolved);\r\n\r\n    let linearAccel = (accelerometerSmoothed);\r\n\r\n    // Apply dead-zone to final result\r\n    return linearAccel;\r\n}\r\n\r\n//\r\nlet lastMovement = vec3Zero();\r\nconst computeMovementDelta = (movement: Vector3) => {\r\n    const result = vec3Sub(movement, lastMovement);\r\n    lastMovement = movement;\r\n    return result;\r\n}\r\n\r\n//\r\nlet forSendingMovement: Vector3 = vec3Zero();\r\nlet sendWSMovement = (movement: Vector3) => {\r\n    forSendingMovement = vec3Add(forSendingMovement, movement);\r\n\r\n    const mappedMovement = {\r\n        x: forSendingMovement.x * accelDirX * ACCELEROMETER_GAIN,\r\n        y: forSendingMovement.y * accelDirY * ACCELEROMETER_GAIN,\r\n        z: forSendingMovement.z * accelDirZ * ACCELEROMETER_GAIN\r\n    };\r\n    forSendingMovement = vec3Zero();\r\n\r\n    // Jitter suppression before enqueue\r\n    if (Math.abs(mappedMovement.x) < ACCELEROMETER_DEADZONE) mappedMovement.x = 0;\r\n    if (Math.abs(mappedMovement.y) < ACCELEROMETER_DEADZONE) mappedMovement.y = 0;\r\n    if (Math.abs(mappedMovement.z) < ACCELEROMETER_DEADZONE) mappedMovement.z = 0;\r\n    if (mappedMovement.x === 0 && mappedMovement.y === 0 && mappedMovement.z === 0) return;\r\n\r\n    enqueueMotion(mappedMovement.x, mappedMovement.y, mappedMovement.z);\r\n}\r\n\r\n//\r\nconst gravityBasedCorrection = (accel: Vector3) => {\r\n    if (isGravityAvailable() && getGravityMagnitude() > 0.1) {\r\n        const gravity = getGravityVector();\r\n        const gravityMagnitude = getGravityMagnitude();\r\n        return {\r\n            x: accel.x - gravity.x * gravityMagnitude,\r\n            y: accel.y - gravity.y * gravityMagnitude,\r\n            z: accel.z - gravity.z * gravityMagnitude\r\n        };\r\n    }\r\n    return accel;\r\n}\r\n\r\n// initialize accelerometer\r\nexport function initAccelerometer() {\r\n    if (!('Accelerometer' in window)) {\r\n        log('Accelerometer API is not supported.');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        accelerometer = new (window as any).Accelerometer({ frequency: 60 });\r\n    } catch (err: any) {\r\n        log('Cannot create Accelerometer: ' + (err.message || err));\r\n        return;\r\n    }\r\n\r\n    //\r\n    accelerometer.addEventListener('reading', () => {\r\n        //\r\n        const now = performance.now();\r\n        const dtMs = now - (lastTimestamp || now); // to avoid huge dt on first entry\r\n        const dt = dtMs / 1000; lastTimestamp = now; // in seconds\r\n\r\n        //\r\n        averageRateSampled += dt; averageRateSampleCount++;\r\n        averageRateResolved = averageRateSampled / averageRateSampleCount;\r\n\r\n        // for lag/overshoot correction\r\n        const averageRateFactor = (dt / averageRateResolved); // if dt > 1 has lag, dt < 1 has overshoot\r\n\r\n        // smoothing\r\n        const filteredAccel = accelerometerSmooth(vec3FromSensor(accelerometer!), dt, averageRateFactor);\r\n        const corrected = gravityBasedCorrection(filteredAccel);\r\n        const delta = vec3DeadZone(computeMovementDelta(corrected), ACCELEROMETER_DEADZONE);\r\n\r\n        // small values after smoothing are not sent\r\n        if (vec3IsNearZero(filteredAccel)) { return; }\r\n\r\n        //  \r\n        if (getAirState() !== 'AIR_MOVE') { return; }\r\n        if (!isWSConnected()) return;\r\n        if (aiModeActive) return;\r\n\r\n        // selection of axes for mouse\r\n        sendWSMovement(delta);\r\n    });\r\n\r\n    accelerometer.addEventListener('error', (event: any) => {\r\n        log('Accelerometer error: ' + ((event?.error?.message) || event?.message || event));\r\n    });\r\n\r\n    accelerometer.start(); log('Accelerometer started (60 Hz)');\r\n}\r\n","// =========================\r\n// Air-: pointer +  + AirMove (Trackball/Touchpad)\r\n// =========================\r\n\r\nimport { log, airButton, airStatusEl } from '../utils/utils';\r\nimport { sendWS, connectWS } from '../network/websocket';\r\nimport { checkIsAiModeActive } from '../input/speech';\r\nimport { HOLD_DELAY, TAP_THRESHOLD, MOVE_TAP_THRESHOLD, SWIPE_THRESHOLD } from '../config/config';\r\nimport { onEnterAirMove as gyroOnEnterAirMove } from '../input/unfinised/gyroscope';\r\nimport { onEnterAirMove as accelOnEnterAirMove } from '../input/unfinised/accelerometer';\r\n\r\nexport type AirState = 'IDLE' | 'WAIT_TAP_OR_HOLD' | 'AIR_MOVE' | 'GESTURE_SWIPE';\r\n\r\nlet airState: AirState = 'IDLE';\r\nlet airDownTime = 0;\r\nlet airDownPos: { x: number; y: number } | null = null;\r\nlet airMoveTimer: number | null = null;\r\nlet dragActive = false;\r\nlet lastSwipePos: { x: number; y: number } | null = null;\r\nlet swipeDirection: 'vertical' | 'horizontal' | null = null;\r\n\r\n//  ()    \r\nlet baseGx = 0, baseGy = 0, baseGz = 0;\r\nlet motionCalibrated = false;\r\nlet filteredDx = 0;\r\nlet filteredDy = 0;\r\nlet lastMotionSentAt = 0;\r\n\r\n// =====   DRAG =====\r\n//    tap-tap-hold \r\nlet lastTapEndTime = 0;           //    tap\r\nlet lastTapWasClean = false;      //    tap \"\" (,  )\r\nlet pendingDragOnHold = false;    // :  hold   drag\r\n\r\nconst DOUBLE_TAP_WINDOW = 300;    //   tap   down  drag\r\nconst DRAG_HOLD_DELAY = 150;      //  hold  drag (  HOLD_DELAY)\r\n\r\n// ========== Getters / Setters ==========\r\n\r\nexport function getAirState(): AirState {\r\n    return airState;\r\n}\r\n\r\nexport function isDragActive(): boolean {\r\n    return dragActive;\r\n}\r\n\r\nexport function isMotionCalibrated(): boolean {\r\n    return motionCalibrated;\r\n}\r\n\r\nexport function setMotionCalibrated(value: boolean) {\r\n    motionCalibrated = value;\r\n}\r\n\r\nexport function getMotionBaseline() {\r\n    return { baseGx, baseGy, baseGz };\r\n}\r\n\r\nexport function setMotionBaseline(gx: number, gy: number, gz: number) {\r\n    baseGx = gx;\r\n    baseGy = gy;\r\n    baseGz = gz;\r\n    motionCalibrated = true;\r\n}\r\n\r\nexport function resetMotionBaseline() {\r\n    baseGx = baseGy = baseGz = 0;\r\n    motionCalibrated = false;\r\n    filteredDx = filteredDy = 0;\r\n    lastMotionSentAt = 0;\r\n}\r\n\r\nexport function getFilteredMotion() {\r\n    return { filteredDx, filteredDy };\r\n}\r\n\r\nexport function setFilteredMotion(dx: number, dy: number) {\r\n    filteredDx = dx;\r\n    filteredDy = dy;\r\n}\r\n\r\nexport function getLastMotionSentAt(): number {\r\n    return lastMotionSentAt;\r\n}\r\n\r\nexport function setLastMotionSentAt(time: number) {\r\n    lastMotionSentAt = time;\r\n}\r\n\r\n// ========== State Management ==========\r\n\r\nfunction setAirStatus(state: AirState) {\r\n    airState = state;\r\n    if (airStatusEl) {\r\n        airStatusEl.textContent = state + (dragActive ? ' [DRAG]' : '');\r\n    }\r\n    if (airButton) {\r\n        airButton.classList.toggle('air-move', state === 'AIR_MOVE');\r\n        airButton.classList.toggle('active', state !== 'IDLE');\r\n        airButton.classList.toggle('drag-active', dragActive);\r\n    }\r\n}\r\n\r\nexport function resetAirState() {\r\n    const wasDragging = dragActive;\r\n\r\n    setAirStatus('IDLE');\r\n    airDownPos = null;\r\n    lastSwipePos = null;\r\n    swipeDirection = null;\r\n    pendingDragOnHold = false;\r\n\r\n    if (airMoveTimer !== null) {\r\n        clearTimeout(airMoveTimer);\r\n        airMoveTimer = null;\r\n    }\r\n\r\n    //   lastTapEndTime  lastTapWasClean !\r\n    //     double-tap   \r\n\r\n    resetMotionBaseline();\r\n}\r\n\r\n// ========== Air Move (Cursor Control via Sensors) ==========\r\n\r\n/**\r\n *    AIR_MOVE     /.\r\n * @param startDrag -  true,   drag- ( )\r\n */\r\nexport function enterAirMove(startDrag: boolean = false) {\r\n    setAirStatus('AIR_MOVE');\r\n    resetMotionBaseline();\r\n\r\n    //     \r\n    gyroOnEnterAirMove();\r\n    accelOnEnterAirMove();\r\n\r\n    //  drag  \r\n    if (startDrag && !dragActive) {\r\n        dragActive = true;\r\n        sendWS({ type: 'mouse_down', button: 'left' });\r\n        log('Air: AIR_MOVE + DRAG started (mouse down)');\r\n\r\n        //     [DRAG]\r\n        setAirStatus('AIR_MOVE');\r\n    } else {\r\n        log('Air: AIR_MOVE started (cursor control via sensors)');\r\n    }\r\n}\r\n\r\n/**\r\n *   AIR_MOVE \r\n */\r\nfunction exitAirMove() {\r\n    if (airState !== 'AIR_MOVE') return;\r\n\r\n    //   drag-,   \r\n    if (dragActive) {\r\n        sendWS({ type: 'mouse_up', button: 'left' });\r\n        log('Air: DRAG ended (mouse up)');\r\n        dragActive = false;\r\n    } else {\r\n        log('Air: AIR_MOVE ended');\r\n    }\r\n}\r\n\r\n// ========== Pointer Handlers ==========\r\n\r\nfunction airOnDown(e: PointerEvent) {\r\n    //    air-   WS\r\n    connectWS();\r\n\r\n    if (checkIsAiModeActive()) return;\r\n\r\n    const now = Date.now();\r\n\r\n    // ===== :   DRAG? =====\r\n    // Drag  :\r\n    // 1.  tap  \"\" (,  )\r\n    // 2.    DOUBLE_TAP_WINDOW     tap\r\n    const timeSinceLastTap = now - lastTapEndTime;\r\n    const shouldPrepareForDrag = lastTapWasClean && (timeSinceLastTap < DOUBLE_TAP_WINDOW);\r\n\r\n    if (shouldPrepareForDrag) {\r\n        pendingDragOnHold = true;\r\n        log(`Air: double-tap detected (${timeSinceLastTap}ms since last tap), preparing for drag...`);\r\n    } else {\r\n        pendingDragOnHold = false;\r\n    }\r\n\r\n    //    tap\r\n    lastTapWasClean = false;\r\n\r\n    // Clear any existing hold timer\r\n    if (airMoveTimer !== null) {\r\n        clearTimeout(airMoveTimer);\r\n        airMoveTimer = null;\r\n    }\r\n\r\n    airDownTime = now;\r\n    airDownPos = { x: e.clientX, y: e.clientY };\r\n    setAirStatus('WAIT_TAP_OR_HOLD');\r\n\r\n    // =====   =====\r\n    //    drag    \r\n    //    HOLD_DELAY\r\n\r\n    const holdDelay = pendingDragOnHold ? DRAG_HOLD_DELAY : HOLD_DELAY;\r\n\r\n    airMoveTimer = globalThis?.setTimeout?.(() => {\r\n        if (airState === 'WAIT_TAP_OR_HOLD') {\r\n            enterAirMove(pendingDragOnHold);\r\n        }\r\n    }, holdDelay) as any;\r\n}\r\n\r\nfunction airOnUp(e: PointerEvent | null) {\r\n    if (checkIsAiModeActive()) {\r\n        resetAirState();\r\n        return;\r\n    }\r\n\r\n    const now = Date.now();\r\n    const dt = now - airDownTime;\r\n\r\n    //     \"\" tap\r\n    let wasCleanTap = false;\r\n\r\n    //    AIR_MOVE\r\n    if (airState === 'AIR_MOVE') {\r\n        exitAirMove();\r\n    }\r\n\r\n    //  -\r\n    if (airState === 'GESTURE_SWIPE') {\r\n        log('Air: swipe gesture ended');\r\n    }\r\n\r\n    //   (    = )\r\n    if (airState === 'WAIT_TAP_OR_HOLD') {\r\n        if (airDownPos && dt < TAP_THRESHOLD) {\r\n            const clientX = e ? e.clientX : airDownPos.x;\r\n            const clientY = e ? e.clientY : airDownPos.y;\r\n            const dx = clientX - airDownPos.x;\r\n            const dy = clientY - airDownPos.y;\r\n            const dist = Math.hypot(dx, dy);\r\n\r\n            if (dist < MOVE_TAP_THRESHOLD) {\r\n                //   tap!\r\n                wasCleanTap = true;\r\n\r\n                //    \" tap\"  drag,     \r\n                //    \r\n                if (!pendingDragOnHold) {\r\n                    sendWS({ type: 'click', button: 'left' });\r\n                    log('Air: tap  click');\r\n                } else {\r\n                    //   tap-tap ( hold)   double-click\r\n                    sendWS({ type: 'click', button: 'left', count: 2 });\r\n                    log('Air: tap-tap  double-click');\r\n                    wasCleanTap = false; //       drag-sequence\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //    tap   \r\n    lastTapEndTime = now;\r\n    lastTapWasClean = wasCleanTap;\r\n\r\n    if (wasCleanTap) {\r\n        log(`Air: clean tap recorded, next tap+hold within ${DOUBLE_TAP_WINDOW}ms will start drag`);\r\n    }\r\n\r\n    dragActive = false;\r\n    resetAirState();\r\n}\r\n\r\n// ========== Swipe Gestures (Scroll) ==========\r\n\r\nfunction handleAirSurfaceMove(x: number, y: number) {\r\n    if (!airDownPos) return;\r\n\r\n    const dxSurf = x - airDownPos.x;\r\n    const dySurf = y - airDownPos.y;\r\n\r\n    if (airState === 'WAIT_TAP_OR_HOLD') {\r\n        const dist = Math.hypot(dxSurf, dySurf);\r\n\r\n        //       \r\n        if (dist > SWIPE_THRESHOLD) {\r\n            //     AIR_MOVE\r\n            if (airMoveTimer !== null) {\r\n                clearTimeout(airMoveTimer);\r\n                airMoveTimer = null;\r\n            }\r\n\r\n            //   \" tap\"     tap-tap-hold  drag\r\n            pendingDragOnHold = false;\r\n            lastTapWasClean = false;\r\n\r\n            setAirStatus('GESTURE_SWIPE');\r\n            startSwipeGesture(dxSurf, dySurf);\r\n        }\r\n    } else if (airState === 'GESTURE_SWIPE') {\r\n        continueSwipeGesture(x, y);\r\n    }\r\n}\r\n\r\nfunction startSwipeGesture(dxSurf: number, dySurf: number) {\r\n    const absX = Math.abs(dxSurf);\r\n    const absY = Math.abs(dySurf);\r\n\r\n    if (absY > absX) {\r\n        //    \r\n        swipeDirection = 'vertical';\r\n        lastSwipePos = { x: airDownPos!.x, y: airDownPos!.y };\r\n\r\n        const initialDelta = Math.round(dySurf * 0.8);\r\n        sendWS({ type: 'scroll', dx: 0, dy: initialDelta });\r\n        log(`Air: swipe ${dySurf > 0 ? 'down' : 'up'}  scroll`);\r\n    } else {\r\n        //    \r\n        swipeDirection = 'horizontal';\r\n        const direction = dxSurf > 0 ? 'right' : 'left';\r\n\r\n        log(`Air: swipe ${direction}`);\r\n        sendWS({ type: 'gesture_swipe', direction });\r\n\r\n        resetAirState();\r\n    }\r\n}\r\n\r\nfunction continueSwipeGesture(x: number, y: number) {\r\n    if (!lastSwipePos || !airDownPos || swipeDirection !== 'vertical') return;\r\n\r\n    const dy = y - lastSwipePos.y;\r\n\r\n    if (Math.abs(dy) > 2) {\r\n        const delta = Math.round(dy * 0.8);\r\n        sendWS({ type: 'scroll', dx: 0, dy: delta });\r\n        lastSwipePos = { x, y };\r\n    }\r\n}\r\n\r\n\r\n// ========== Context Menu & Middle-Click Scroll (Neighbor Button) ==========\r\n\r\nlet neighborState: 'IDLE' | 'WAIT_TAP_OR_HOLD' | 'MIDDLE_SCROLL' = 'IDLE';\r\nlet neighborDownTime = 0;\r\nlet neighborDownPos: { x: number; y: number } | null = null;\r\nlet neighborHoldTimer: number | null = null;\r\nlet neighborPointerId: number | null = null;\r\n\r\nconst NEIGHBOR_HOLD_DELAY = 250; // ms   middle-scroll\r\nconst NEIGHBOR_TAP_THRESHOLD = 200; // ms\r\nconst NEIGHBOR_MOVE_THRESHOLD = 15; // px\r\n\r\nfunction enterMiddleScrollMode() {\r\n    neighborState = 'MIDDLE_SCROLL';\r\n\r\n    //     \r\n    resetAirState();\r\n\r\n    // Middle mouse down\r\n    sendWS({ type: 'mouse_down', button: 'middle' });\r\n    log('Neighbor: MIDDLE_SCROLL started (sensors active)');\r\n\r\n    //  \r\n    const neighborButton = document.getElementById('airNeighborButton');\r\n    neighborButton?.classList.add('middle-scroll-active', 'active');\r\n\r\n    //\r\n    enterAirMove();\r\n}\r\n\r\nfunction exitMiddleScrollMode() {\r\n    if (neighborState !== 'MIDDLE_SCROLL') return;\r\n\r\n    // Middle mouse up\r\n    sendWS({ type: 'mouse_up', button: 'middle' });\r\n    log('Neighbor: MIDDLE_SCROLL ended');\r\n\r\n    //\r\n    neighborState = 'IDLE';\r\n    resetAirState();\r\n\r\n    //   \r\n    const neighborButton = document.getElementById('airNeighborButton');\r\n    neighborButton?.classList.remove('middle-scroll-active', 'active');\r\n}\r\n\r\nfunction resetNeighborState() {\r\n    if (neighborHoldTimer !== null) {\r\n        clearTimeout(neighborHoldTimer);\r\n        neighborHoldTimer = null;\r\n    }\r\n    neighborDownPos = null;\r\n    neighborState = 'IDLE';\r\n\r\n    const neighborButton = document.getElementById('airNeighborButton');\r\n    neighborButton?.classList.remove('middle-scroll-active', 'active');\r\n\r\n    resetAirState();\r\n}\r\n\r\nfunction initNeighborButton() {\r\n    const neighborButton = document.getElementById('airNeighborButton');\r\n    if (!neighborButton) return;\r\n\r\n    neighborButton.addEventListener('pointerdown', (e) => {\r\n        e.preventDefault();\r\n        if (neighborPointerId !== null && neighborPointerId !== e.pointerId) return;\r\n\r\n        connectWS();\r\n        if (checkIsAiModeActive()) return;\r\n\r\n        neighborPointerId = e.pointerId;\r\n        neighborButton.setPointerCapture(neighborPointerId);\r\n        neighborDownTime = Date.now();\r\n        neighborDownPos = { x: e.clientX, y: e.clientY };\r\n        neighborState = 'WAIT_TAP_OR_HOLD';\r\n\r\n        neighborButton.classList.add('active');\r\n\r\n        //    middle-scroll \r\n        neighborHoldTimer = globalThis?.setTimeout?.(() => {\r\n            neighborHoldTimer = null;\r\n            if (neighborState === 'WAIT_TAP_OR_HOLD') {\r\n                enterMiddleScrollMode();\r\n            }\r\n        }, NEIGHBOR_HOLD_DELAY) as any;\r\n    });\r\n\r\n    neighborButton.addEventListener('pointermove', (e) => {\r\n        if (e.pointerId !== neighborPointerId || !neighborDownPos) return;\r\n        e.preventDefault();\r\n\r\n        //      hold   (   )\r\n        if (neighborState === 'WAIT_TAP_OR_HOLD') {\r\n            const dx = e.clientX - neighborDownPos.x;\r\n            const dy = e.clientY - neighborDownPos.y;\r\n            const dist = Math.hypot(dx, dy);\r\n\r\n            if (dist > NEIGHBOR_MOVE_THRESHOLD) {\r\n                //      hold\r\n                if (neighborHoldTimer !== null) {\r\n                    clearTimeout(neighborHoldTimer);\r\n                    neighborHoldTimer = null;\r\n                }\r\n                //     ,  swipe\r\n            }\r\n        }\r\n\r\n        //   MIDDLE_SCROLL     ,\r\n        //    pointermove     \r\n    });\r\n\r\n    neighborButton.addEventListener('pointerup', (e) => {\r\n        if (e.pointerId !== neighborPointerId) return;\r\n        e.preventDefault();\r\n\r\n        const dt = Date.now() - neighborDownTime;\r\n\r\n        //   middle-scroll \r\n        if (neighborState === 'MIDDLE_SCROLL') {\r\n            exitMiddleScrollMode();\r\n        }\r\n        //  tap  context menu (right click)\r\n        else if (neighborState === 'WAIT_TAP_OR_HOLD' && dt < NEIGHBOR_TAP_THRESHOLD) {\r\n            if (neighborDownPos) {\r\n                const dx = e.clientX - neighborDownPos.x;\r\n                const dy = e.clientY - neighborDownPos.y;\r\n                const dist = Math.hypot(dx, dy);\r\n\r\n                if (dist < NEIGHBOR_MOVE_THRESHOLD) {\r\n                    sendWS({ type: 'click', button: 'right' });\r\n                    log('Neighbor: tap  right-click (context menu)');\r\n                }\r\n            }\r\n        }\r\n\r\n        if (neighborPointerId !== null) {\r\n            neighborButton.releasePointerCapture(neighborPointerId);\r\n            neighborPointerId = null;\r\n        }\r\n        resetNeighborState();\r\n    });\r\n\r\n    neighborButton.addEventListener('pointercancel', (e) => {\r\n        if (e?.pointerId === neighborPointerId || e?.pointerId == null) {\r\n            if (neighborState === 'MIDDLE_SCROLL') {\r\n                sendWS({ type: 'mouse_up', button: 'middle' });\r\n                log('Neighbor: middle-scroll cancelled');\r\n            }\r\n\r\n            if (neighborPointerId !== null) {\r\n                neighborButton.releasePointerCapture(neighborPointerId);\r\n                neighborPointerId = null;\r\n            }\r\n            resetNeighborState();\r\n        }\r\n    });\r\n\r\n    //     \r\n    neighborButton.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n    });\r\n\r\n    log('Neighbor button initialized (tap: right-click, hold: middle-scroll via sensors)');\r\n}\r\n\r\n// ==========    gyroscope.ts / accelerometer.ts ==========\r\n\r\nexport function isMiddleScrollActive(): boolean {\r\n    return neighborState === 'MIDDLE_SCROLL';\r\n}\r\n\r\n// ========== Initialization ==========\r\n\r\nexport function initAirButton() {\r\n    if (!airButton) return;\r\n\r\n    initNeighborButton();\r\n\r\n    let pointerId: number | null = null;\r\n\r\n    airButton.addEventListener('pointerdown', (e) => {\r\n        e.preventDefault();\r\n        if (pointerId !== null && pointerId !== e.pointerId) return;\r\n\r\n        pointerId = e.pointerId;\r\n        airButton?.setPointerCapture(pointerId);\r\n        airOnDown(e);\r\n    });\r\n\r\n    document.addEventListener('pointermove', (e) => {\r\n        if (e.pointerId !== pointerId) return;\r\n        e.preventDefault();\r\n\r\n        if (!airDownPos) return;\r\n        if (checkIsAiModeActive()) return;\r\n\r\n        handleAirSurfaceMove(e.clientX, e.clientY);\r\n    });\r\n\r\n    document.addEventListener('pointerup', (e) => {\r\n        if (e.pointerId !== pointerId) return;\r\n        e.preventDefault();\r\n\r\n        if (pointerId !== null) {\r\n            airButton?.releasePointerCapture(pointerId);\r\n        }\r\n        pointerId = null;\r\n        airOnUp(e);\r\n    });\r\n\r\n    document.addEventListener('pointercancel', (e) => {\r\n        if (e?.pointerId === pointerId || e?.pointerId == null) {\r\n            if (pointerId !== null) {\r\n                airButton?.releasePointerCapture(pointerId);\r\n            }\r\n            pointerId = null;\r\n\r\n            if (dragActive) {\r\n                sendWS({ type: 'mouse_up', button: 'left' });\r\n                dragActive = false;\r\n                log('Air: drag cancelled (mouse up)');\r\n            }\r\n\r\n            resetAirState();\r\n        }\r\n    });\r\n\r\n    log('Air button initialized');\r\n}\r\n","import { log } from '../../utils/utils';\r\nimport { enqueueMotion } from '../../config/motion-state';\r\nimport { aiModeActive } from '../speech';\r\nimport { getAirState } from '../../ui/air-button';\r\nimport {\r\n    REL_ORIENT_DEADZONE,\r\n    REL_ORIENT_GAIN,\r\n    REL_ORIENT_SMOOTH,\r\n    REL_ORIENT_MAX_STEP,\r\n    REL_ORIENT_MAX_STEP_MAX,\r\n    REL_ORIENT_MAX_STEP_UP_RATE,\r\n    REL_ORIENT_MAX_STEP_DOWN_RATE,\r\n    REL_ORIENT_SMOOTH_RATE_LOW,\r\n    REL_ORIENT_SMOOTH_RATE_HIGH,\r\n    relDirX,\r\n    relDirY,\r\n    relDirZ,\r\n    relSrcForMouseX,\r\n    relSrcForMouseY,\r\n    relSrcForMouseZ,\r\n    MOTION_JITTER_EPS,\r\n} from '../../config/config';\r\nimport {\r\n    vec3Zero,\r\n    vec3Clamp,\r\n    vec3Smooth,\r\n    vec3IsNearZero,\r\n    vec3Select,\r\n    type Vector3,\r\n    vec3RotateXYByAngle,\r\n    expSmoothing,\r\n    lerp,\r\n    clamp01,\r\n} from '../../utils/math';\r\nimport { isWSConnected } from '../../network/websocket';\r\n\r\n\r\nlet relSensor: any = null;\r\n\r\n// Orientation state\r\nlet lastQuat: [number, number, number, number] | null = null;\r\nlet smoothedDelta: Vector3 = vec3Zero(); // smoothed small-angle delta\r\nlet dynamicMaxStepPx: number = REL_ORIENT_MAX_STEP; // adaptive clamp radius in pixels/tick\r\n\r\n// Quaternion helpers\r\ntype Quat = [number, number, number, number];\r\n\r\n// Normalize with stability: keep sign consistent with previous to avoid hemisphere flips\r\nconst quatNormalizeStable = (q: Quat, prev: Quat | null): Quat => {\r\n    const [x, y, z, w] = q;\r\n    const len = Math.hypot(x, y, z, w) || 1;\r\n    let nx = x / len, ny = y / len, nz = z / len, nw = w / len;\r\n    if (prev) {\r\n        const dot = nx * prev[0] + ny * prev[1] + nz * prev[2] + nw * prev[3];\r\n        if (dot < 0) {\r\n            nx = -nx; ny = -ny; nz = -nz; nw = -nw;\r\n        }\r\n    }\r\n    return [nx, ny, nz, nw];\r\n};\r\n\r\nconst quatConj = (q: Quat): Quat => {\r\n    const [x, y, z, w] = q;\r\n    return [-x, -y, -z, w];\r\n};\r\n\r\nconst quatMul = (a: Quat, b: Quat): Quat => {\r\n    const [ax, ay, az, aw] = a;\r\n    const [bx, by, bz, bw] = b;\r\n    return [\r\n        aw * bx + ax * bw + ay * bz - az * by,\r\n        aw * by - ax * bz + ay * bw + az * bx,\r\n        aw * bz + ax * by - ay * bx + az * bw,\r\n        aw * bw - ax * bx - ay * by - az * bz,\r\n    ];\r\n};\r\n\r\n// Quaternion delta  small-angle vector (axis * angle)\r\nconst quatDeltaToAxisAngle = (dq: Quat): Vector3 => {\r\n    const [x, y, z, w] = dq;\r\n    const sinHalf = Math.hypot(x, y, z);\r\n    const angle = 2 * Math.atan2(sinHalf, w || 1);\r\n    if (sinHalf < 1e-6) {\r\n        return { x: 0, y: 0, z: 0 };\r\n    }\r\n    const inv = 1 / sinHalf;\r\n    return { x: x * inv * angle, y: y * inv * angle, z: z * inv * angle };\r\n};\r\n\r\nfunction mapToPixelsRaw(movement: Vector3): Vector3 {\r\n    const selected = vec3Select(\r\n        movement,\r\n        relSrcForMouseX as 'ax' | 'ay' | 'az',\r\n        relSrcForMouseY as 'ax' | 'ay' | 'az',\r\n        relSrcForMouseZ as 'ax' | 'ay' | 'az'\r\n    );\r\n\r\n    const rotationZ = selected.z * relDirZ;\r\n    const projected = vec3RotateXYByAngle(selected, rotationZ, 1);\r\n    return {\r\n        x: projected.x * relDirX * REL_ORIENT_GAIN,\r\n        y: projected.y * relDirY * REL_ORIENT_GAIN,\r\n        z: projected.z * relDirZ * REL_ORIENT_GAIN,\r\n    };\r\n}\r\n\r\nfunction clampPxRadiusFromDeltaVec(deltaVec: Vector3, dt: number): number {\r\n    // Convert deltaVec (rad axis-angle vector) into \"desired pixel movement\" magnitude.\r\n    // This makes the clamp depend on current motion intensity, and shrink when motion shrinks.\r\n    const rawMapped = mapToPixelsRaw(deltaVec);\r\n    const magPx = Math.hypot(rawMapped.x, rawMapped.y, rawMapped.z);\r\n    const desired = Math.max(REL_ORIENT_MAX_STEP, Math.min(REL_ORIENT_MAX_STEP_MAX, magPx));\r\n\r\n    // \"Incremental\" update: grow slower, shrink faster (feels responsive but stable).\r\n    const t = desired > dynamicMaxStepPx ? expSmoothing(dt, REL_ORIENT_MAX_STEP_UP_RATE) : expSmoothing(dt, REL_ORIENT_MAX_STEP_DOWN_RATE);\r\n    dynamicMaxStepPx = lerp(dynamicMaxStepPx, desired, t);\r\n\r\n    if (!Number.isFinite(dynamicMaxStepPx)) dynamicMaxStepPx = REL_ORIENT_MAX_STEP;\r\n    dynamicMaxStepPx = Math.max(REL_ORIENT_MAX_STEP, Math.min(REL_ORIENT_MAX_STEP_MAX, dynamicMaxStepPx));\r\n    return dynamicMaxStepPx;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n//\r\nfunction mapAndScale(movement: Vector3, maxStepPx: number): Vector3 {\r\n    const mapped = mapToPixelsRaw(movement);\r\n    return vec3Clamp(mapped, maxStepPx);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//vec3NormalizeAngles\r\n\r\nfunction handleReading(quat: number[], dt: number): Vector3 {\r\n    if (!quat || quat.length < 4) return vec3Zero();\r\n\r\n    //\r\n    const curQuat = quatNormalizeStable([quat[0], quat[1], quat[2], quat[3]], lastQuat);\r\n    if (!lastQuat) { lastQuat = curQuat; };\r\n\r\n    // deltaQuat = q_curr * conj(q_prev)\r\n    const deltaQuat = quatMul(curQuat, quatConj(lastQuat)); lastQuat = curQuat;\r\n\r\n    // small-angle vector from delta quaternion\r\n    const deltaVec = quatDeltaToAxisAngle(deltaQuat);\r\n\r\n    // Update adaptive clamp from current (unsmoothed) deltaVec.\r\n    const maxStepPx = clampPxRadiusFromDeltaVec(deltaVec, dt);\r\n\r\n    // Smooth delta directly in quaternion space (axis-angle vector)\r\n    const deltaPx = mapToPixelsRaw(deltaVec);\r\n    const deltaMagPx = Math.hypot(deltaPx.x, deltaPx.y, deltaPx.z);\r\n    const magT = clamp01((deltaMagPx - REL_ORIENT_MAX_STEP) / Math.max(1, (REL_ORIENT_MAX_STEP_MAX - REL_ORIENT_MAX_STEP)));\r\n    const smoothRate = lerp(REL_ORIENT_SMOOTH_RATE_LOW, REL_ORIENT_SMOOTH_RATE_HIGH, magT);\r\n    const smoothFactor = clamp01(expSmoothing(dt, smoothRate) * clamp01(REL_ORIENT_SMOOTH));\r\n    smoothedDelta = vec3Smooth(smoothedDelta, deltaVec, smoothFactor * 0.9);\r\n\r\n    // clamp delta\r\n    // Convert pixel clamp to axis-angle clamp (rad) for stability before mapping.\r\n    const maxStepRad = maxStepPx / Math.max(1e-6, Math.abs(REL_ORIENT_GAIN));\r\n    smoothedDelta = vec3Clamp(smoothedDelta, Math.max(REL_ORIENT_DEADZONE, maxStepRad));\r\n\r\n    // Dead-zone / jitter suppression\r\n    const dz = {\r\n        x: Math.abs(smoothedDelta.x) < REL_ORIENT_DEADZONE ? 0 : smoothedDelta.x,\r\n        y: Math.abs(smoothedDelta.y) < REL_ORIENT_DEADZONE ? 0 : smoothedDelta.y,\r\n        z: Math.abs(smoothedDelta.z) < REL_ORIENT_DEADZONE ? 0 : smoothedDelta.z,\r\n    };\r\n\r\n    //\r\n    if (Math.abs(dz.x) < MOTION_JITTER_EPS && Math.abs(dz.y) < MOTION_JITTER_EPS && Math.abs(dz.z) < MOTION_JITTER_EPS) {\r\n        return vec3Zero();\r\n    }\r\n\r\n    // Map axes, apply gain, clamp\r\n    const mapped = mapAndScale(dz, maxStepPx);\r\n\r\n    // Ignore near-zero after mapping\r\n    if (vec3IsNearZero(mapped, MOTION_JITTER_EPS)) return vec3Zero();\r\n    return mapped;\r\n}\r\n\r\nexport function initRelativeOrientation() {\r\n    if (!(window as any).RelativeOrientationSensor ) {\r\n        log('RelativeOrientationSensor API is not supported.');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        relSensor = new (window as any).RelativeOrientationSensor({ frequency: 120, referenceFrame: 'device' });\r\n    } catch (err: any) {\r\n        log('Cannot create RelativeOrientationSensor: ' + (err?.message || err));\r\n        relSensor = null;\r\n        return;\r\n    }\r\n\r\n    let lastTs = performance.now();\r\n\r\n    relSensor.addEventListener('reading', () => {\r\n        const now = performance.now();\r\n        const dt = Math.max(0.00001, (now - lastTs) / 1000);\r\n        lastTs = now;\r\n\r\n        const mapped = handleReading(relSensor.quaternion, dt);\r\n\r\n        //\r\n        if (getAirState && getAirState() !== 'AIR_MOVE') return;\r\n        if (!isWSConnected()) return;\r\n        if (aiModeActive) return;\r\n\r\n        // Accumulate into unified motion queue\r\n        enqueueMotion(mapped.x, mapped.y, mapped.z);\r\n    });\r\n\r\n    relSensor.addEventListener('error', (event: any) => {\r\n        log('RelativeOrientationSensor error: ' + ((event?.error?.message) || event?.message || event));\r\n    });\r\n\r\n    try {\r\n        relSensor.start();\r\n        log('RelativeOrientationSensor started (120 Hz)');\r\n    } catch (err: any) {\r\n        log('RelativeOrientationSensor start failed: ' + (err?.message || err));\r\n    }\r\n}\r\n","// =========================\r\n// Clipboard toolbar (Cut / Copy / Paste)\r\n// =========================\r\n\r\nimport { log, btnCut, btnCopy, btnPaste, clipboardPreviewEl } from '../utils/utils';\r\nimport {\r\n    onServerClipboardUpdate,\r\n    requestClipboardCopy,\r\n    requestClipboardCut,\r\n    requestClipboardPaste,\r\n    requestClipboardGet,\r\n} from '../network/websocket';\r\n\r\nfunction setPreview(text: string, meta?: { source?: string }) {\r\n    if (!clipboardPreviewEl || typeof clipboardPreviewEl === 'undefined') return;\r\n\r\n    const source = meta?.source ? String(meta.source) : 'pc';\r\n    const safeText = String(text ?? '');\r\n\r\n    if (!safeText) {\r\n        clipboardPreviewEl.classList.remove('visible');\r\n        clipboardPreviewEl.innerHTML = '';\r\n        return;\r\n    }\r\n\r\n    clipboardPreviewEl.innerHTML = `\r\n        <div class=\"meta\">Clipboard (${source})</div>\r\n        <div class=\"text\"></div>\r\n    `;\r\n    const textEl = clipboardPreviewEl.querySelector('.text') as HTMLElement | null;\r\n    if (textEl) textEl.textContent = safeText;\r\n    clipboardPreviewEl.classList.add('visible');\r\n}\r\n\r\nasync function readPhoneClipboardText(): Promise<string> {\r\n    // Requires HTTPS (or localhost) + user gesture in most browsers.\r\n    const nav: any = navigator as any;\r\n    if (nav?.clipboard?.readText) {\r\n        return await nav.clipboard.readText();\r\n    }\r\n    // Fallback\r\n    return globalThis?.prompt?.('    (clipboard readText ):', '') || '';\r\n}\r\n\r\nasync function tryWritePhoneClipboardText(text: string): Promise<boolean> {\r\n    const nav: any = navigator as any;\r\n    if (nav?.clipboard?.writeText) {\r\n        try {\r\n            await nav.clipboard.writeText(text);\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function initClipboardToolbar() {\r\n    // Keep preview in sync with backend clipboard events\r\n    onServerClipboardUpdate((text, meta) => setPreview(text, meta));\r\n\r\n    // Best-effort initial fetch (so UI isn't empty)\r\n    requestClipboardGet().then((res) => {\r\n        if (res?.ok && typeof res.text === 'string') setPreview(res.text, { source: 'pc' });\r\n    });\r\n\r\n    btnCopy?.addEventListener('click', async () => {\r\n        const res = await requestClipboardCopy();\r\n        if (!res?.ok) {\r\n            log('Copy failed: ' + (res?.error || 'unknown'));\r\n            return;\r\n        }\r\n\r\n        const text = String(res.text || '');\r\n        setPreview(text, { source: 'pc' });\r\n\r\n        // Best-effort: try to write to phone clipboard (may be blocked by browser policies).\r\n        const ok = await tryWritePhoneClipboardText(text);\r\n        if (!ok) {\r\n            log('PC clipboard received. If phone clipboard write is blocked, copy from the preview line.');\r\n        }\r\n    });\r\n\r\n    btnCut?.addEventListener('click', async () => {\r\n        const res = await requestClipboardCut();\r\n        if (!res?.ok) {\r\n            log('Cut failed: ' + (res?.error || 'unknown'));\r\n            return;\r\n        }\r\n\r\n        const text = String(res.text || '');\r\n        setPreview(text, { source: 'pc' });\r\n\r\n        const ok = await tryWritePhoneClipboardText(text);\r\n        if (!ok) {\r\n            log('PC clipboard received (after cut). If phone clipboard write is blocked, copy from the preview line.');\r\n        }\r\n    });\r\n\r\n    btnPaste?.addEventListener('click', async () => {\r\n        const text = await readPhoneClipboardText();\r\n        if (!text) {\r\n            log('Paste: phone clipboard is empty (or permission denied).');\r\n            return;\r\n        }\r\n\r\n        const res = await requestClipboardPaste(text);\r\n        if (!res?.ok) {\r\n            log('Paste failed: ' + (res?.error || 'unknown'));\r\n            return;\r\n        }\r\n\r\n        // Show what we just pasted (useful confirmation)\r\n        setPreview(text, { source: 'phone' });\r\n    });\r\n}\r\n\r\n\r\n","// =========================\n// Configuration UI for Airpad\n// =========================\n\nimport {\n    getRemoteHost,\n    setRemoteHost,\n    getRemotePort,\n    setRemotePort,\n    getRemoteProtocol,\n    setRemoteProtocol,\n} from '../config/config';\nimport { disconnectWS, connectWS, isWSConnected } from '../network/websocket';\nimport { hideKeyboard } from '../input/keyboard/handlers';\n\nfunction getAirpadHostElement(): Element {\n    return document.querySelector('.view-airpad') ?? document.querySelector('#app') ?? document.body;\n}\n\n// Create configuration overlay\nexport function createConfigUI(): HTMLElement {\n    const overlay = document.createElement('div');\n    overlay.className = 'config-overlay';\n    overlay.innerHTML = `\n        <div class=\"config-panel\">\n            <h3>Airpad Configuration</h3>\n\n            <div class=\"config-group\">\n                <label for=\"remoteHost\">Remote Host/IP:</label>\n                <input type=\"text\" id=\"remoteHost\" />\n            </div>\n\n            <div class=\"config-group\">\n                <label for=\"remotePort\">Remote Port:</label>\n                <input type=\"text\" id=\"remotePort\" />\n            </div>\n\n            <div class=\"config-group\">\n                <label for=\"remoteProtocol\">Remote Protocol:</label>\n                <select id=\"remoteProtocol\">\n                    <option value=\"auto\">Auto (recommended)</option>\n                    <option value=\"https\">HTTPS / WSS</option>\n                    <option value=\"http\">HTTP / WS</option>\n                </select>\n            </div>\n\n            <div class=\"config-actions\">\n                <button id=\"saveConfig\" type=\"button\">Save & Reconnect</button>\n                <button id=\"cancelConfig\" type=\"button\">Cancel</button>\n            </div>\n        </div>\n    `;\n\n    // Add event listeners\n    const hostInput = overlay.querySelector('#remoteHost') as HTMLInputElement;\n    const portInput = overlay.querySelector('#remotePort') as HTMLInputElement;\n    const protocolInput = overlay.querySelector('#remoteProtocol') as HTMLSelectElement;\n    const saveButton = overlay.querySelector('#saveConfig') as HTMLButtonElement;\n    const cancelButton = overlay.querySelector('#cancelConfig') as HTMLButtonElement;\n\n    hostInput.value = getRemoteHost();\n    portInput.value = getRemotePort();\n    protocolInput.value = getRemoteProtocol();\n\n    saveButton.addEventListener('click', () => {\n        setRemoteHost(hostInput.value);\n        setRemotePort(portInput.value);\n        setRemoteProtocol(protocolInput.value);\n\n        // Disconnect and reconnect with new settings\n        if (isWSConnected()) {\n            disconnectWS();\n        }\n        setTimeout(() => connectWS(), 100);\n\n        // Hide overlay\n        overlay.style.display = 'none';\n    });\n\n    cancelButton.addEventListener('click', () => {\n        overlay.style.display = 'none';\n    });\n\n    // Click outside to close\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) {\n            overlay.style.display = 'none';\n        }\n    });\n\n    return overlay;\n}\n\n// Show configuration overlay\nexport function showConfigUI(): void {\n    // Hide virtual keyboard when opening config dialog\n    hideKeyboard();\n\n    const host = getAirpadHostElement();\n    let overlay = document.querySelector('.config-overlay') as HTMLElement | null;\n    if (overlay && overlay.parentElement !== host) {\n        overlay.remove();\n        overlay = null;\n    }\n    if (!overlay) {\n        overlay = createConfigUI();\n        host.appendChild(overlay);\n    } else {\n        const hostInput = overlay.querySelector('#remoteHost') as HTMLInputElement | null;\n        const portInput = overlay.querySelector('#remotePort') as HTMLInputElement | null;\n        const protocolInput = overlay.querySelector('#remoteProtocol') as HTMLSelectElement | null;\n        if (hostInput) hostInput.value = getRemoteHost();\n        if (portInput) portInput.value = getRemotePort();\n        if (protocolInput) protocolInput.value = getRemoteProtocol();\n    }\n    overlay.style.display = 'flex';\n}","// =========================\r\n// Main entry point\r\n// =========================\r\n\r\n//\r\nimport stylesheet from './main.scss?inline';\r\nimport { initServiceWorker } from '@rs-frontend/pwa/sw-handling';\r\n\r\n//\r\nimport { log, getBtnConnect } from './utils/utils';\r\nimport { initWebSocket, onWSConnectionChange } from './network/websocket';\r\nimport { initSpeechRecognition, initAiButton } from './input/speech';\r\nimport { initAirButton } from './ui/air-button';\r\nimport { initRelativeOrientation } from './input/sensor/relative-orientation';\r\nimport { initVirtualKeyboard, setRemoteKeyboardEnabled } from './input/virtual-keyboard';\r\nimport { initClipboardToolbar } from './ui/clipboard-toolbar';\r\nimport { showConfigUI } from './ui/config-ui';\r\nimport { loadAsAdopted } from 'fest/dom';\r\nimport { H } from 'fest/lure';\r\n\r\nlet unsubscribeWsKeyboardSync: (() => void) | null = null;\r\n\r\n// =========================\r\n// Mount function for routing system\r\n// =========================\r\n\r\nexport default async function mountAirpad(mountElement: HTMLElement): Promise<void> {\r\n    console.log('[Airpad] Mounting airpad app...');\r\n\r\n    loadAsAdopted(stylesheet);\r\n\r\n    // Find or create #app container\r\n    let appContainer = mountElement ?? document.body.querySelector('#app') ?? document.body as HTMLElement;\r\n    if (!appContainer) {\r\n        appContainer = document.createElement('div');\r\n        appContainer.id = 'app';\r\n    }\r\n\r\n    // Replace previous airpad markup to avoid duplicate UI when remounting.\r\n    appContainer.replaceChildren(H`\r\n        <div class=\"container\">\r\n            <header class=\"hero\">\r\n                <h1>Air Trackpad + AI Assistant</h1>\r\n                <div class=\"subtitle\">\r\n                        : Air  , AI   .\r\n                </div>\r\n\r\n                <div class=\"status-container\">\r\n                    <div class=\"status-bar\">\r\n                        <div class=\"status-item\">\r\n                            WS:\r\n                            <span id=\"wsStatus\" class=\"value ws-status-bad\">disconnected</span>\r\n                        </div>\r\n                        <div class=\"status-item\">\r\n                            Air:\r\n                            <span id=\"airStatus\" class=\"value\">IDLE</span>\r\n                        </div>\r\n                        <div class=\"status-item\">\r\n                            AI:\r\n                            <span id=\"aiStatus\" class=\"value\">idle</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"btnConnect\"\r\n                        class=\"primary-btn\">\r\n                        WS Connect\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div class=\"stage\">\r\n                <div class=\"ai-block\">\r\n                    <div contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" id=\"aiButton\" class=\"big-button ai\">\r\n                        AI\r\n                    </div>\r\n                    <div class=\"label\">  (  )</div>\r\n                </div>\r\n\r\n                <div class=\"air-block\">\r\n                    <div class=\"air-row\">\r\n                    <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"airButton\" class=\"big-button air\">\r\n                        Air\r\n                    </button>\r\n                    <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"airNeighborButton\"\r\n                        class=\"neighbor-button\">Act</button>\r\n                    </div>\r\n                    <div class=\"label\">Air/  </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div id=\"voiceText\" class=\"voice-line\"></div>\r\n\r\n            <section class=\"hint\" id=\"hintPanel\" aria-label=\"Airpad quick help\">\r\n                <details class=\"hint-group\" data-hint-group open>\r\n                    <summary> Air-</summary>\r\n                    <ul>\r\n                        <li>   .</li>\r\n                        <li> &gt; 100ms   air-.</li>\r\n                        <li> /    .</li>\r\n                        <li> /  .</li>\r\n                    </ul>\r\n                </details>\r\n\r\n                <details class=\"hint-group\" data-hint-group open>\r\n                    <summary>AI-</summary>\r\n                    <ul>\r\n                        <li>      .</li>\r\n                        <li>     <code>voice_command</code>.</li>\r\n                    </ul>\r\n                </details>\r\n\r\n                <details class=\"hint-group\" data-hint-group open>\r\n                    <summary> </summary>\r\n                    <ul>\r\n                        <li>    .</li>\r\n                        <li> ,   .</li>\r\n                        <li>    .</li>\r\n                    </ul>\r\n                </details>\r\n            </section>\r\n        </div>\r\n\r\n        <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"logToggle\" class=\"side-log-toggle\"\r\n            aria-controls=\"logOverlay\" aria-expanded=\"false\">\r\n            \r\n        </button>\r\n\r\n        <div id=\"logOverlay\" class=\"log-overlay\" aria-hidden=\"true\">\r\n            <div class=\"log-panel\">\r\n                <div class=\"log-overlay-header\">\r\n                    <span> </span>\r\n                    <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"logClose\"\r\n                        class=\"ghost-btn\" aria-label=\" \"></button>\r\n                </div>\r\n                <div id=\"logContainer\" class=\"log-container\"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Bottom clipboard toolbar (phone <-> PC) -->\r\n        <div class=\"bottom-toolbar\" id=\"clipboardToolbar\" aria-label=\"Clipboard actions\">\r\n            <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"btnCut\"\r\n                class=\"toolbar-btn\" aria-label=\"Cut (Ctrl+X)\"></button>\r\n            <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"btnCopy\"\r\n                class=\"toolbar-btn\" aria-label=\"Copy (Ctrl+C)\"></button>\r\n            <button contenteditable=\"false\" virtualkeyboardpolicy=\"manual\" type=\"button\" id=\"btnPaste\"\r\n                class=\"toolbar-btn\" aria-label=\"Paste (Ctrl+V)\"></button>\r\n        </div>\r\n        <div id=\"clipboardPreview\" class=\"clipboard-preview\" aria-live=\"polite\"></div>\r\n    `);\r\n\r\n    // Initialize the airpad functionality\r\n    await initAirpadApp();\r\n}\r\n\r\n// =========================\r\n// Internal initialization\r\n// =========================\r\n\r\nasync function initAirpadApp(): Promise<void> {\r\n    function initConfigButton() {\r\n    const existingConfigButton = document.getElementById('btnConfig');\r\n    if (existingConfigButton) {\r\n        return;\r\n    }\r\n\r\n    const configButton = document.createElement('button');\r\n    configButton.id = 'btnConfig';\r\n    configButton.type = 'button';\r\n    configButton.className = 'toolbar-btn';\r\n    configButton.textContent = '';\r\n    configButton.title = 'Configuration';\r\n    configButton.setAttribute('aria-label', 'Configuration');\r\n    configButton.addEventListener('click', showConfigUI);\r\n\r\n    const bottomToolbar = document.querySelector('.bottom-toolbar');\r\n    if (bottomToolbar) {\r\n        bottomToolbar.appendChild(configButton);\r\n    }\r\n}\r\n\r\n// =========================\r\n// Init\r\n// =========================\r\nfunction initLogOverlay() {\r\n    const overlay = document.getElementById('logOverlay');\r\n    const toggle = document.getElementById('logToggle');\r\n    const close = document.getElementById('logClose');\r\n\r\n    if (!overlay || !toggle) {\r\n        return;\r\n    }\r\n\r\n    const openOverlay = () => {\r\n        overlay.classList.add('open');\r\n        overlay.setAttribute('aria-hidden', 'false');\r\n        toggle.setAttribute('aria-expanded', 'true');\r\n    };\r\n\r\n    const closeOverlay = () => {\r\n        overlay.classList.remove('open');\r\n        overlay.setAttribute('aria-hidden', 'true');\r\n        toggle.setAttribute('aria-expanded', 'false');\r\n    };\r\n\r\n    toggle.addEventListener('click', openOverlay);\r\n    close?.addEventListener('click', closeOverlay);\r\n    overlay.addEventListener('click', (e) => {\r\n        if (e.target === overlay) {\r\n            closeOverlay();\r\n        }\r\n    });\r\n    document.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Escape' && overlay.classList.contains('open')) {\r\n            closeOverlay();\r\n        }\r\n    });\r\n    }\r\n\r\n    function initAdaptiveHintPanel() {\r\n        const hintRoot = document.getElementById('hintPanel');\r\n        if (!hintRoot) return;\r\n\r\n        const groups = Array.from(hintRoot.querySelectorAll('[data-hint-group]')) as HTMLDetailsElement[];\r\n        if (groups.length === 0) return;\r\n\r\n        const compactMedia = globalThis.matchMedia('(max-width: 980px), (max-height: 860px)');\r\n        const applyHintDensity = () => {\r\n            const compact = compactMedia.matches;\r\n            groups.forEach((group, index) => {\r\n                group.open = compact ? index === 0 : true;\r\n            });\r\n        };\r\n\r\n        applyHintDensity();\r\n        compactMedia.addEventListener?.('change', applyHintDensity);\r\n    }\r\n\r\n    const scheduleIdle = (cb: () => void) => {\r\n        if (typeof globalThis.requestIdleCallback === 'function') {\r\n            globalThis.requestIdleCallback(() => cb());\r\n            return;\r\n        }\r\n        globalThis.setTimeout(cb, 0);\r\n    };\r\n\r\n    scheduleIdle(async () => {\r\n    // PWA: register Service Worker (auto-update)\r\n    try {\r\n        initServiceWorker({\r\n            immediate: true,\r\n            onRegistered() {\r\n                log('PWA: service worker registered');\r\n            },\r\n            onRegisterError(error) {\r\n                log('PWA: service worker register error: ' + ((error as any)?.message ?? String(error)));\r\n            },\r\n        });\r\n    } catch (err: any) {\r\n        log('PWA: service worker disabled: ' + (err?.message || err));\r\n    }\r\n\r\n    log('.  \"WS Connect\",   Air/AI .');\r\n    log('     Gyroscope API ( ).');\r\n\r\n    initLogOverlay();\r\n    initWebSocket(getBtnConnect());\r\n    initSpeechRecognition();\r\n    initAiButton();\r\n    initAirButton();\r\n    initVirtualKeyboard();\r\n    unsubscribeWsKeyboardSync?.();\r\n    unsubscribeWsKeyboardSync = onWSConnectionChange((connected) => {\r\n        setRemoteKeyboardEnabled(connected);\r\n    });\r\n    initClipboardToolbar();\r\n    initConfigButton();\r\n    initAdaptiveHintPanel();\r\n    //  RelativeOrientationSensor   \r\n    initRelativeOrientation();\r\n    //     \r\n    //initGravitySensor();\r\n    //initGyro();\r\n    //initAccelerometer();\r\n    });\r\n}\r\n"],"file":"main.js"}