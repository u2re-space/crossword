{"version":3,"file":"index8.js","sources":["../../src/frontend/views/history/index.ts"],"sourcesContent":["/**\n * History View\n * \n * Shell-agnostic history component.\n * Shows operation history with replay/restore capabilities.\n */\n\nimport { H } from \"fest/lure\";\nimport { observe } from \"fest/object\";\nimport { loadAsAdopted, removeAdopted } from \"fest/dom\";\nimport type { View, ViewOptions, ViewLifecycle, ShellContext } from \"../../shells/types\";\nimport type { BaseViewOptions } from \"../types\";\nimport { getItem, setItem } from \"../../../core/storage\";\n\n// @ts-ignore\nimport style from \"./history.scss?inline\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\ninterface HistoryEntry {\n    id: string;\n    timestamp: number;\n    action: string;\n    description: string;\n    content?: string;\n    ok: boolean;\n    error?: string;\n}\n\nconst STORAGE_KEY = \"rs-history\";\n\n// ============================================================================\n// HISTORY VIEW\n// ============================================================================\n\nexport class HistoryView implements View {\n    id = \"history\" as const;\n    name = \"History\";\n    icon = \"clock-counter-clockwise\";\n\n    private options: BaseViewOptions;\n    private shellContext?: ShellContext;\n    private element: HTMLElement | null = null;\n    private entries = observe<HistoryEntry[]>([]);\n    \n    private _sheet: CSSStyleSheet | null = null;\n\n    lifecycle: ViewLifecycle = {\n        onMount: () => {this.loadHistory(); this._sheet ??= loadAsAdopted(style) as CSSStyleSheet; },\n        onUnmount: () => { removeAdopted(this._sheet!); },\n        onShow: () => { this._sheet ??= loadAsAdopted(style) as CSSStyleSheet; this.loadHistory(); },\n        //onHide: () => { removeAdopted(this._sheet!); },\n    };\n\n    constructor(options: BaseViewOptions = {}) {\n        this.options = options;\n        this.shellContext = options.shellContext;\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        if (options) {\n            this.options = { ...this.options, ...options };\n            this.shellContext = options.shellContext || this.shellContext;\n        }\n\n        this._sheet = loadAsAdopted(style) as CSSStyleSheet;\n        this.loadHistory();\n\n        this.element = H`\n            <div class=\"view-history\">\n                <div class=\"view-history__header\">\n                    <h1>History</h1>\n                    <button class=\"view-history__clear-btn\" data-action=\"clear\" type=\"button\">\n                        <ui-icon icon=\"trash\" icon-style=\"duotone\"></ui-icon>\n                        <span>Clear History</span>\n                    </button>\n                </div>\n                <div class=\"view-history__list\" data-history-list>\n                    ${this.renderEntries()}\n                </div>\n            </div>\n        ` as HTMLElement;\n\n        this.setupEventHandlers();\n        return this.element;\n    }\n\n    getToolbar(): HTMLElement | null {\n        return null;\n    }\n\n    // ========================================================================\n    // PRIVATE METHODS\n    // ========================================================================\n\n    private renderEntries(): HTMLElement | string {\n        if (this.entries.length === 0) {\n            return H`\n                <div class=\"view-history__empty\">\n                    <ui-icon icon=\"clock-counter-clockwise\" icon-style=\"duotone\" size=\"48\"></ui-icon>\n                    <p>No history yet</p>\n                </div>\n            ` as HTMLElement;\n        }\n\n        const fragment = document.createDocumentFragment();\n        for (const entry of [...this.entries].reverse()) {\n            const item = H`\n                <div class=\"view-history__item ${entry.ok ? '' : 'error'}\" data-entry=\"${entry.id}\">\n                    <div class=\"view-history__item-header\">\n                        <span class=\"view-history__item-action\">${entry.action}</span>\n                        <span class=\"view-history__item-time\">${this.formatTime(entry.timestamp)}</span>\n                    </div>\n                    <p class=\"view-history__item-desc\">${entry.description}</p>\n                    ${entry.error ? H`<p class=\"view-history__item-error\">${entry.error}</p>` : ''}\n                    ${entry.content ? H`\n                        <div class=\"view-history__item-actions\">\n                            <button class=\"view-history__action-btn\" data-action=\"copy\" data-id=\"${entry.id}\" type=\"button\">\n                                <ui-icon icon=\"copy\" icon-style=\"duotone\" size=\"14\"></ui-icon>\n                                Copy\n                            </button>\n                            <button class=\"view-history__action-btn\" data-action=\"view\" data-id=\"${entry.id}\" type=\"button\">\n                                <ui-icon icon=\"eye\" icon-style=\"duotone\" size=\"14\"></ui-icon>\n                                View\n                            </button>\n                        </div>\n                    ` : ''}\n                </div>\n            ` as HTMLElement;\n            fragment.appendChild(item);\n        }\n        return fragment as unknown as HTMLElement;\n    }\n\n    private setupEventHandlers(): void {\n        if (!this.element) return;\n\n        this.element.addEventListener(\"click\", async (e) => {\n            const target = e.target as HTMLElement;\n            const button = target.closest(\"[data-action]\") as HTMLButtonElement | null;\n            if (!button) return;\n\n            const action = button.dataset.action;\n            const entryId = button.dataset.id;\n\n            if (action === \"clear\") {\n                this.clearHistory();\n            } else if (action === \"copy\" && entryId) {\n                const entry = this.entries.find(e => e.id === entryId);\n                if (entry?.content) {\n                    try {\n                        await navigator.clipboard.writeText(entry.content);\n                        this.showMessage(\"Copied to clipboard\");\n                    } catch {\n                        this.showMessage(\"Failed to copy\");\n                    }\n                }\n            } else if (action === \"view\" && entryId) {\n                const entry = this.entries.find(e => e.id === entryId);\n                if (entry?.content) {\n                    this.shellContext?.navigate(\"viewer\", { content: entry.content });\n                }\n            }\n        });\n    }\n\n    private loadHistory(): void {\n        const saved = getItem<HistoryEntry[]>(STORAGE_KEY, []);\n        this.entries.length = 0;\n        this.entries.push(...saved);\n        this.updateList();\n    }\n\n    private clearHistory(): void {\n        this.entries.length = 0;\n        setItem(STORAGE_KEY, []);\n        this.updateList();\n        this.showMessage(\"History cleared\");\n    }\n\n    private updateList(): void {\n        const list = this.element?.querySelector(\"[data-history-list]\");\n        if (!list) return;\n        list.replaceChildren();\n        const rendered = this.renderEntries();\n        if (typeof rendered !== 'string') {\n            list.appendChild(rendered);\n        }\n    }\n\n    private formatTime(timestamp: number): string {\n        const date = new Date(timestamp);\n        const now = new Date();\n        \n        if (date.toDateString() === now.toDateString()) {\n            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n        }\n        return date.toLocaleDateString([], { month: 'short', day: 'numeric' }) + \n               ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    }\n\n    private showMessage(message: string): void {\n        this.shellContext?.showMessage(message);\n    }\n\n    canHandleMessage(): boolean {\n        return false;\n    }\n\n    async handleMessage(): Promise<void> {}\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport function createView(options?: HistoryViewOptions): HistoryView {\n    return new HistoryView(options);\n}\n\n/** Alias for createView */\nexport const createHistoryView = createView;\n\nexport default createView;\n"],"names":["e"],"mappings":"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"}