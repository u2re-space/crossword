{"version":3,"file":"showOpenFilePicker.js","sources":["../../../../modules/shared/fest/polyfill/showOpenFilePicker.mjs"],"sourcesContent":["// deno-lint-ignore-file require-await constructor-super\n/** @type {import('./showOpenFilePicker').Ponyfills} */\nconst { showOpenFilePicker, showSaveFilePicker } = globalThis.showOpenFilePicker ?? typeof document === 'object' ? (() => {\n    const mapOfFiles = new WeakMap()\n    const prototypeOfFileSystemHandle = FileSystemHandle.prototype\n    const prototypeOfFileSystemFileHandle = FileSystemFileHandle.prototype\n    const a = document.createElement('a')\n\n    const getFileHandle = file => {\n        const fileHandle = {\n            async getFile() { return file; }\n        }//create(prototypeOfFileSystemFileHandle)\n        mapOfFiles.set(fileHandle, file)\n        return fileHandle\n    }\n\n    const getAcceptType = type => values(Object(type?.accept)).join(',')\n\n    const { create, defineProperties, getOwnPropertyDescriptors, values } = Object\n    const { name, kind, ...descriptorsOfFileSystemHandle }  = getOwnPropertyDescriptors(prototypeOfFileSystemHandle)\n    const { getFile, ...descriptorsOfFileSystemFileHandle } = getOwnPropertyDescriptors(prototypeOfFileSystemFileHandle)\n\n    /*\n    defineProperties(prototypeOfFileSystemHandle, {\n        ...descriptorsOfFileSystemHandle,\n        ...getOwnPropertyDescriptors({\n            get name() {\n                return mapOfFiles.get(this)?.name ?? name.call(this)\n            },\n            get kind() {\n                return mapOfFiles.has(this) ? 'file' : kind.call(this)\n            },\n        }),\n    })\n\n    defineProperties(prototypeOfFileSystemFileHandle, {\n        ...descriptorsOfFileSystemFileHandle,\n        ...getOwnPropertyDescriptors({\n            async getFile() {\n                return await (mapOfFiles?.get?.(this) || getFile?.call?.(this))\n            },\n            async createWritable() {\n                const stream = new FileSystemWritableFileStream()\n                mapOfFiles?.set(stream, mapOfFiles?.get?.(this))\n                return stream\n            },\n        }),\n    })*/\n\n    //\n    class FileSystemWritableFileStream extends WritableStream {\n        constructor() {\n            const answer = super({\n                write: async (chunk) => {\n                    const file = mapOfFiles.get(this)\n                    mapOfFiles?.set?.(this, new File([\n                        file,\n                        chunk instanceof Blob || chunk instanceof Uint8Array || typeof chunk === 'string'\n                            ? chunk\n                            : ArrayBuffer.isView(chunk) || chunk instanceof ArrayBuffer\n                                ? new Uint8Array(chunk)\n                                : chunk instanceof DataView\n                                    ? new Uint8Array(chunk.buffer)\n                                    : new Uint8Array(new TextEncoder().encode(String(chunk))),\n                    ], file.name, {\n                        type: file.type,\n                        lastModified: file.lastModified,\n                    }))\n                },\n            });\n            mapOfFiles?.set?.(answer, new File([], 'Untitled.txt', { type: 'text/plain' }))\n        }\n\n        async write(data) {\n            const writer = this.getWriter()\n            await writer.write(data)\n            writer.releaseLock()\n        }\n\n        async close() {\n            const file = mapOfFiles.get(this)\n            if (file != null) {\n                const url = URL.createObjectURL(file)\n\n                document.documentElement.append(a)\n\n                a.href = url\n                a.download = file.name\n                a.type = file.type\n\n                a.click()\n                a.remove()\n\n                URL.revokeObjectURL(url)\n            }\n        }\n    }\n\n    return {\n        showOpenFilePicker(options = null) {\n            const input = document.createElement('input')\n            input.type = 'file'\n            input.multiple = ( options?.multiple ? true : false);\n            input.accept = [].concat(options?.types ?? []).map(getAcceptType).join(',')\n            const promise = new Promise((resolve, reject) => {\n                input.addEventListener('change', () => {\n                    resolve([...input.files].map(getFileHandle))\n                    input.value = null;\n                    input.files = null;\n                }, { once: true })\n\n                input.addEventListener('cancel', () => {\n                    reject(new DOMException('The user aborted a request.'))\n                }, { once: true })\n            })\n            input.click()\n            return promise;\n        },\n        async showSaveFilePicker(options = null) {\n            const accept = [].concat(\n                Object.entries(\n                    Object(\n                        [].concat(options?.types ?? [])[0]?.accept\n                    )\n                )\n            )[0] || [\"text/plain\", [\".txt\"]]\n\n            return getFileHandle(\n                new File(\n                    [],\n                    options?.suggestedName ?? 'Untitled' + (accept?.[1]?.[0] || '.txt'),\n                    {\n                        type: accept?.[0] || 'text/plain'\n                    }\n                )\n            )\n        },\n    }\n})() : {\n    async showOpenFilePicker() {\n        return []\n    },\n    async showSaveFilePicker() {\n        return []\n    },\n}\n\n//\nexport { showOpenFilePicker, showSaveFilePicker };\n"],"names":[],"mappings":"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"}