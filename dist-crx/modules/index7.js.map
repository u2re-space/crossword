{"version":3,"file":"index7.js","sources":["../../src/frontend/items/CustomInstructionsEditor.ts","../../src/frontend/views/settings/Settings.ts","../../src/frontend/views/settings/index.ts"],"sourcesContent":["import { H } from \"fest/lure\";\nimport { observe } from \"fest/object\";\nimport type { CustomInstruction } from \"@rs-com/config/SettingsTypes\";\nimport {\n    getInstructionRegistry,\n    addInstruction,\n    addInstructions,\n    updateInstruction,\n    deleteInstruction,\n    setActiveInstruction,\n    DEFAULT_INSTRUCTION_TEMPLATES\n} from \"@rs-com/service/misc/CustomInstructions\";\n\nexport type CustomInstructionsEditorOptions = {\n    onUpdate?: () => void;\n};\n\ntype EditorState = {\n    instructions: CustomInstruction[];\n    activeId: string;\n    editingId: string | null;\n    newLabel: string;\n    newInstruction: string;\n    isAdding: boolean;\n};\n\nexport const createCustomInstructionsEditor = (opts: CustomInstructionsEditorOptions = {}): HTMLElement => {\n    const state = observe<EditorState>({\n        instructions: [],\n        activeId: \"\",\n        editingId: null,\n        newLabel: \"\",\n        newInstruction: \"\",\n        isAdding: false\n    });\n\n    const root = H`<div class=\"custom-instructions-editor\">\n        <div class=\"ci-row\">\n            <div class=\"ci-header\">\n                <h4>Custom Instructions</h4>\n                <p class=\"ci-desc\">Define custom instructions for AI operations. These can be activated for \"Recognize & Copy\" and selected in the Work Center.</p>\n            </div>\n\n            <div class=\"ci-active-select\">\n                <label>\n                    <span>Active instruction:</span>\n                    <select class=\"ci-select\" data-action=\"select-active\">\n                        <option value=\"\">None (use default)</option>\n                    </select>\n                </label>\n            </div>\n        </div>\n\n        <div class=\"ci-list\" data-list></div>\n\n        <div class=\"ci-add-form\" data-add-form hidden>\n            <input type=\"text\" class=\"ci-input\" data-field=\"label\" placeholder=\"Instruction label...\" />\n            <textarea class=\"ci-textarea\" data-field=\"instruction\" placeholder=\"Enter your custom instruction...\" rows=\"4\"></textarea>\n            <div class=\"ci-add-actions\">\n                <button class=\"btn small primary\" type=\"button\" data-action=\"save-new\">Add</button>\n                <button class=\"btn small\" type=\"button\" data-action=\"cancel-add\">Cancel</button>\n            </div>\n        </div>\n\n        <div class=\"ci-actions\">\n            <button class=\"btn small\" type=\"button\" data-action=\"add\">+ Add Instruction</button>\n            <button class=\"btn small\" type=\"button\" data-action=\"add-templates\">Add Templates</button>\n        </div>\n    </div>` as HTMLElement;\n\n    const listEl = root.querySelector(\"[data-list]\") as HTMLElement;\n    const selectEl = root.querySelector(\"[data-action='select-active']\") as HTMLSelectElement;\n    const addFormEl = root.querySelector(\"[data-add-form]\") as HTMLElement;\n    const labelInput = root.querySelector(\"[data-field='label']\") as HTMLInputElement;\n    const instructionInput = root.querySelector(\"[data-field='instruction']\") as HTMLTextAreaElement;\n\n    const renderList = () => {\n        listEl.replaceChildren();\n\n        if (!state.instructions.length) {\n            listEl.append(H`<div class=\"ci-empty\">No custom instructions. Add one or use templates.</div>` as HTMLElement);\n            return;\n        }\n\n        for (const instr of state.instructions) {\n            const isEditing = state.editingId === instr.id;\n            const isActive = state.activeId === instr.id;\n\n            const item = H`<div class=\"ci-item ${isActive ? \"active\" : \"\"}\" data-id=\"${instr.id}\">\n                <div class=\"ci-item-header\">\n                    <span class=\"ci-item-label\">${instr.label}</span>\n                    <div class=\"ci-item-actions\">\n                        ${isActive\n                            ? H`<span class=\"ci-badge active\">Active</span>`\n                            : H`<button class=\"btn tiny\" type=\"button\" data-action=\"activate\">Use</button>`\n                        }\n                        <button class=\"btn tiny\" type=\"button\" data-action=\"edit\">Edit</button>\n                        <button class=\"btn tiny danger\" type=\"button\" data-action=\"delete\">×</button>\n                    </div>\n                </div>\n                ${isEditing\n                    ? H`<div class=\"ci-edit-form\">\n                        <input type=\"text\" class=\"ci-input\" data-edit-field=\"label\" value=\"${instr.label}\" />\n                        <textarea class=\"ci-textarea\" data-edit-field=\"instruction\" rows=\"4\">${instr.instruction}</textarea>\n                        <div class=\"ci-edit-actions\">\n                            <button class=\"btn small primary\" type=\"button\" data-action=\"save-edit\">Save</button>\n                            <button class=\"btn small\" type=\"button\" data-action=\"cancel-edit\">Cancel</button>\n                        </div>\n                    </div>`\n                    : H`<div class=\"ci-item-preview\">${truncate(instr.instruction, 120)}</div>`\n                }\n            </div>` as HTMLElement;\n\n            item.addEventListener(\"click\", (e) => {\n                const target = e.target as HTMLElement;\n                const action = target.closest(\"[data-action]\")?.getAttribute(\"data-action\");\n\n                if (action === \"activate\") {\n                    void setActiveInstruction(instr.id)\n                        .then(loadData)\n                        .then(() => opts.onUpdate?.());\n                }\n\n                if (action === \"edit\") {\n                    state.editingId = instr.id;\n                    renderList();\n                }\n\n                if (action === \"delete\") {\n                    if (confirm(`Delete \"${instr.label}\"?`)) {\n                        void deleteInstruction(instr.id)\n                            .then(loadData)\n                            .then(() => opts.onUpdate?.());\n                    }\n                }\n\n                if (action === \"save-edit\") {\n                    const labelEl = item.querySelector(\"[data-edit-field='label']\") as HTMLInputElement;\n                    const instrEl = item.querySelector(\"[data-edit-field='instruction']\") as HTMLTextAreaElement;\n\n                    void updateInstruction(instr.id, {\n                        label: labelEl.value.trim() || instr.label,\n                        instruction: instrEl.value.trim()\n                    }).then(() => {\n                        state.editingId = null;\n                        return loadData();\n                    }).then(() => opts.onUpdate?.());\n                }\n\n                if (action === \"cancel-edit\") {\n                    state.editingId = null;\n                    renderList();\n                }\n            });\n\n            listEl.append(item);\n        }\n    };\n\n    const updateSelect = () => {\n        selectEl.replaceChildren();\n        selectEl.append(H`<option value=\"\">None (use default)</option>` as HTMLOptionElement);\n\n        for (const instr of state.instructions) {\n            const opt = H`<option value=\"${instr.id}\">${instr.label}</option>` as HTMLOptionElement;\n            if (instr.id === state.activeId) opt.selected = true;\n            selectEl.append(opt);\n        }\n    };\n\n    const truncate = (text: string, maxLen: number): string => {\n        if (!text || text.length <= maxLen) return text || \"\";\n        return text.slice(0, maxLen).trim() + \"…\";\n    };\n\n    const loadData = async () => {\n        const snapshot = await getInstructionRegistry();\n        state.instructions = snapshot.instructions;\n        state.activeId = snapshot.activeId;\n        renderList();\n        updateSelect();\n    };\n\n    root.addEventListener(\"click\", (e) => {\n        const target = e.target as HTMLElement;\n        const action = target.closest(\"[data-action]\")?.getAttribute(\"data-action\");\n\n        if (action === \"add\") {\n            state.isAdding = true;\n            addFormEl.hidden = false;\n            labelInput.value = \"\";\n            instructionInput.value = \"\";\n            labelInput.focus();\n        }\n\n        if (action === \"cancel-add\") {\n            state.isAdding = false;\n            addFormEl.hidden = true;\n        }\n\n        if (action === \"save-new\") {\n            const label = labelInput.value.trim();\n            const instruction = instructionInput.value.trim();\n\n            if (!instruction) {\n                instructionInput.focus();\n                return;\n            }\n\n            void addInstruction(label || \"Custom\", instruction).then((newInstr) => {\n                if (!newInstr) return;\n                state.isAdding = false;\n                addFormEl.hidden = true;\n                return loadData();\n            }).then(() => opts.onUpdate?.());\n        }\n\n        if (action === \"add-templates\") {\n            const existingLabels = new Set(state.instructions.map(i => i.label.trim().toLowerCase()));\n            const templatesToAdd = DEFAULT_INSTRUCTION_TEMPLATES.filter(t => !existingLabels.has(t.label.trim().toLowerCase()));\n\n            if (!templatesToAdd.length) {\n                alert(\"All templates are already added.\");\n                return;\n            }\n\n            // Use bulk add to avoid race conditions\n            addInstructions(templatesToAdd.map(t => ({\n                label: t.label,\n                instruction: t.instruction,\n                enabled: t.enabled\n            }))).then(loadData).then(() => opts.onUpdate?.());\n        }\n    });\n\n    selectEl.addEventListener(\"change\", () => {\n        const newActiveId = selectEl.value || \"\";\n        void setActiveInstruction(newActiveId || null)\n            .then(loadData)\n            .then(() => opts.onUpdate?.());\n    });\n\n    void loadData();\n\n    return root;\n};\n","//@ts-ignore\nimport style from \"./Settings.scss?inline\";\n\nimport { H } from \"fest/lure\";\nimport { loadSettings, saveSettings } from \"@rs-com/config/Settings\";\nimport type { AppSettings } from \"@rs-com/config/SettingsTypes\";\nimport { applyTheme } from \"@rs-core/utils/Theme\";\nimport { createCustomInstructionsEditor } from \"../../items/CustomInstructionsEditor\";\nimport { loadAsAdopted } from \"fest/dom\";\n\nexport type SettingsViewOptions = {\n    isExtension: boolean;\n    onTheme?: (theme: AppSettings[\"appearance\"] extends { theme?: infer T } ? (T extends string ? T : \"auto\") : \"auto\") => void;\n};\n\nexport const createSettingsView = (opts: SettingsViewOptions) => {\n    loadAsAdopted(style)\n    const root = H`<div class=\"view-settings\">\n\n    <section class=\"actions\">\n      <div class=\"settings-tab-actions\" data-settings-tabs data-active-tab=\"ai\">\n        <button class=\"settings-tab-btn\" type=\"button\" data-action=\"switch-settings-tab\" data-tab=\"appearance\" aria-selected=\"false\">Appearance</button>\n        <button class=\"settings-tab-btn is-active\" type=\"button\" data-action=\"switch-settings-tab\" data-tab=\"ai\" aria-selected=\"true\">AI</button>\n        <button class=\"settings-tab-btn\" type=\"button\" data-action=\"switch-settings-tab\" data-tab=\"instructions\" aria-selected=\"false\">Instructions</button>\n        <button class=\"settings-tab-btn\" type=\"button\" data-action=\"switch-settings-tab\" data-tab=\"extension\" aria-selected=\"false\" data-extension-tab hidden>Extension</button>\n      </div>\n      <span class=\"note\" data-note></span>\n      <h2>Settings</h2>\n      <button class=\"btn primary\" type=\"button\" data-action=\"save\">Save</button>\n    </section>\n\n    <section class=\"card settings-tab-panel\" data-tab-panel=\"appearance\">\n      <h3>Appearance</h3>\n      <label class=\"field\">\n        <span>Theme</span>\n        <select class=\"form-select\" data-field=\"appearance.theme\">\n          <option value=\"light\">Light</option>\n          <option value=\"dark\">Dark</option>\n          <option value=\"auto\">Auto</option>\n        </select>\n        <span>Font Size</span>\n        <select class=\"form-select\" data-field=\"appearance.fontSize\">\n          <option value=\"small\">Small</option>\n          <option value=\"medium\">Medium</option>\n          <option value=\"large\">Large</option>\n        </select>\n      </label>\n    </section>\n\n    <section class=\"card settings-tab-panel is-active\" data-tab-panel=\"ai\">\n      <h3>AI</h3>\n      <label class=\"field\">\n        <span>Base URL</span>\n        <input class=\"form-input\" type=\"url\" inputmode=\"url\" autocomplete=\"off\" data-field=\"ai.baseUrl\" placeholder=\"https://api.proxyapi.ru/openai/v1\" />\n      </label>\n      <label class=\"field\">\n        <span>API Key</span>\n        <input class=\"form-input\" type=\"password\" autocomplete=\"off\" data-field=\"ai.apiKey\" placeholder=\"sk-...\" />\n      </label>\n      <label class=\"field checkbox form-checkbox\">\n        <input type=\"checkbox\" data-field=\"ui.showKey\" />\n        <span>Show API key</span>\n      </label>\n      <label class=\"field\">\n        <span>Share target mode</span>\n        <select class=\"form-select\" data-field=\"ai.shareTargetMode\">\n          <option value=\"recognize\">Recognize and copy</option>\n          <option value=\"analyze\">Analyze and store</option>\n        </select>\n      </label>\n      <label class=\"field checkbox form-checkbox\">\n        <input type=\"checkbox\" data-field=\"ai.autoProcessShared\" />\n        <span>Auto AI on Share Target / File Open (and copy to clipboard)</span>\n      </label>\n      <label class=\"field\">\n        <span>Response language</span>\n        <select class=\"form-select\" data-field=\"ai.responseLanguage\">\n          <option value=\"auto\">Auto-detect</option>\n          <option value=\"en\">English</option>\n          <option value=\"ru\">Russian</option>\n        </select>\n      </label>\n      <label class=\"field checkbox form-checkbox\">\n        <input type=\"checkbox\" data-field=\"ai.translateResults\" />\n        <span>Translate results</span>\n      </label>\n      <label class=\"field checkbox form-checkbox\">\n        <input type=\"checkbox\" data-field=\"ai.generateSvgGraphics\" />\n        <span>Generate SVG graphics</span>\n      </label>\n    </section>\n\n    <section class=\"card settings-tab-panel\" data-tab-panel=\"instructions\" data-section=\"instructions\">\n      <h3>Recognition Instructions</h3>\n      <div data-custom-instructions=\"editor\">\n        ${createCustomInstructionsEditor({ onUpdate: () => setNote(\"Instructions updated.\") })}\n      </div>\n    </section>\n\n    <section class=\"card settings-tab-panel\" data-tab-panel=\"extension\" data-section=\"extension\" hidden>\n      <h3>Extension</h3>\n      <label class=\"field checkbox form-checkbox\">\n        <input type=\"checkbox\" data-field=\"core.ntpEnabled\" />\n        <span>Enable New Tab Page (offline Basic)</span>\n      </label>\n    </section>\n  </div>` as HTMLElement;\n\n    const field = (sel: string) => root.querySelector(sel) as HTMLInputElement | HTMLSelectElement | null;\n    const note = root.querySelector(\"[data-note]\") as HTMLElement | null;\n\n    const apiUrl = field('[data-field=\"ai.baseUrl\"]') as HTMLInputElement | null;\n    const apiKey = field('[data-field=\"ai.apiKey\"]') as HTMLInputElement | null;\n    const showKey = field('[data-field=\"ui.showKey\"]') as HTMLInputElement | null;\n    const mode = field('[data-field=\"ai.shareTargetMode\"]') as HTMLSelectElement | null;\n    const autoProcessShared = field('[data-field=\"ai.autoProcessShared\"]') as HTMLInputElement | null;\n    const responseLanguage = field('[data-field=\"ai.responseLanguage\"]') as HTMLSelectElement | null;\n    const translateResults = field('[data-field=\"ai.translateResults\"]') as HTMLInputElement | null;\n    const generateSvgGraphics = field('[data-field=\"ai.generateSvgGraphics\"]') as HTMLInputElement | null;\n    const theme = field('[data-field=\"appearance.theme\"]') as HTMLSelectElement | null;\n    const fontSize = field('[data-field=\"appearance.fontSize\"]') as HTMLSelectElement | null;\n    const ntpEnabled = field('[data-field=\"core.ntpEnabled\"]') as HTMLInputElement | null;\n    const extSection = root.querySelector('[data-section=\"extension\"]') as HTMLElement | null;\n    const extTab = root.querySelector('[data-extension-tab]') as HTMLButtonElement | null;\n\n    const switchSettingsTab = (tab: string) => {\n        const nextTab = tab || \"ai\";\n        const tabRoot = root.querySelector('[data-settings-tabs]') as HTMLElement | null;\n        tabRoot?.setAttribute(\"data-active-tab\", nextTab);\n\n        const tabButtons = root.querySelectorAll('[data-action=\"switch-settings-tab\"][data-tab]');\n        for (const tabButton of Array.from(tabButtons)) {\n            const btn = tabButton as HTMLButtonElement;\n            const isActive = btn.getAttribute(\"data-tab\") === nextTab;\n            btn.classList.toggle(\"is-active\", isActive);\n            btn.setAttribute(\"aria-selected\", String(isActive));\n        }\n\n        const panels = root.querySelectorAll('[data-tab-panel]');\n        for (const panel of Array.from(panels)) {\n            const el = panel as HTMLElement;\n            const isActive = el.getAttribute(\"data-tab-panel\") === nextTab;\n            if (el.hidden && isActive) continue;\n            el.classList.toggle(\"is-active\", isActive);\n        }\n    };\n\n    const setNote = (t: string) => {\n        if (!note) return;\n        note.textContent = t;\n        if (t) setTimeout(() => (note.textContent = \"\"), 1500);\n    };\n\n    void loadSettings()\n        .then((s) => {\n            if (apiUrl) apiUrl.value = (s?.ai?.baseUrl || \"\").trim();\n            if (apiKey) apiKey.value = (s?.ai?.apiKey || \"\").trim();\n            if (mode) mode.value = (s?.ai?.shareTargetMode || \"recognize\") as any;\n            if (autoProcessShared) autoProcessShared.checked = (s?.ai?.autoProcessShared ?? true) !== false;\n            if (responseLanguage) responseLanguage.value = (s?.ai?.responseLanguage || \"auto\") as any;\n            if (translateResults) translateResults.checked = Boolean(s?.ai?.translateResults);\n            if (generateSvgGraphics) generateSvgGraphics.checked = Boolean(s?.ai?.generateSvgGraphics);\n            if (theme) theme.value = (s?.appearance?.theme || \"auto\") as any;\n            if (fontSize) fontSize.value = (s?.appearance?.fontSize || \"medium\") as any;\n            if (ntpEnabled) ntpEnabled.checked = Boolean(s?.core?.ntpEnabled);\n            opts.onTheme?.((theme?.value as any) || \"auto\");\n        })\n        .catch(() => void 0);\n\n    showKey?.addEventListener(\"change\", () => {\n        if (!apiKey || !showKey) return;\n        apiKey.type = showKey.checked ? \"text\" : \"password\";\n    });\n\n    theme?.addEventListener(\"change\", () => {\n        opts.onTheme?.((theme.value as any) || \"auto\");\n    });\n\n    root.addEventListener(\"click\", (e) => {\n        const t = e.target as HTMLElement | null;\n        const tabBtn = t?.closest?.('button[data-action=\"switch-settings-tab\"]') as HTMLButtonElement | null;\n        if (tabBtn) {\n            switchSettingsTab(tabBtn.getAttribute(\"data-tab\") || \"ai\");\n            return;\n        }\n\n        const btn = t?.closest?.('button[data-action=\"save\"]') as HTMLButtonElement | null;\n        if (!btn) return;\n\n        void (async () => {\n            const next: AppSettings = {\n                ai: {\n                    baseUrl: apiUrl?.value?.trim?.() || \"\",\n                    apiKey: apiKey?.value?.trim?.() || \"\",\n                    shareTargetMode: (mode?.value as any) || \"recognize\",\n                    autoProcessShared: (autoProcessShared?.checked ?? true) !== false,\n                    responseLanguage: (responseLanguage?.value as any) || \"auto\",\n                    translateResults: Boolean(translateResults?.checked),\n                    generateSvgGraphics: Boolean(generateSvgGraphics?.checked),\n                },\n                core: {\n                    ntpEnabled: Boolean(ntpEnabled?.checked),\n                },\n                appearance: {\n                    theme: (theme?.value as any) || \"auto\",\n                    fontSize: (fontSize?.value as any) || \"medium\",\n                },\n            };\n            const saved = await saveSettings(next);\n            applyTheme(saved);\n            opts.onTheme?.((saved.appearance?.theme as any) || \"auto\");\n            setNote(\"Saved.\");\n        })().catch((err) => setNote(String(err)));\n    });\n\n    if (opts.isExtension) {\n        if (extSection) extSection.hidden = false;\n        if (extTab) extTab.hidden = false;\n        const extNote = H`<div class=\"ext-note\">Extension mode: settings are stored in <code>chrome.storage.local</code>.</div>` as HTMLElement;\n        root.append(extNote);\n    }\n\n    return root;\n};\n\n\n//onThemeChange: (theme) => this.options.onThemeChange?.(theme)","/**\n * Settings View\n *\n * Shell-agnostic settings component.\n * Provides application configuration UI.\n */\n\nimport { H } from \"fest/lure\";\nimport { ref } from \"fest/object\";\nimport { loadAsAdopted, removeAdopted } from \"fest/dom\";\nimport type { View, ViewOptions, ViewLifecycle, ShellContext } from \"../../shells/types\";\nimport type { BaseViewOptions } from \"../types\";\n\n// @ts-ignore\nimport settingsStyles from \"./Settings.scss?inline\";\nimport { createSettingsView } from \"./Settings\";\n\n// ============================================================================\n// SETTINGS TYPES\n// ============================================================================\n\ninterface AppSettings {\n    appearance: {\n        theme: \"auto\" | \"light\" | \"dark\";\n        fontSize: \"small\" | \"medium\" | \"large\";\n    };\n    ai: {\n        apiKey?: string;\n        model?: string;\n        autoProcess?: boolean;\n    };\n    general: {\n        autosave: boolean;\n        notifications: boolean;\n    };\n}\n\nconst defaultSettings: AppSettings = {\n    appearance: { theme: \"auto\", fontSize: \"medium\" },\n    ai: { autoProcess: true },\n    general: { autosave: true, notifications: true }\n};\n\n// ============================================================================\n// SETTINGS OPTIONS\n// ============================================================================\n\nexport interface SettingsOptions extends BaseViewOptions {\n    onThemeChange?: (theme: \"auto\" | \"light\" | \"dark\") => void;\n    onSettingsChange?: (settings: AppSettings) => void;\n}\n\n// ============================================================================\n// SETTINGS VIEW\n// ============================================================================\n\nexport class SettingsView implements View {\n    id = \"settings\" as const;\n    name = \"Settings\";\n    icon = \"gear\";\n\n    private options: SettingsOptions;\n    private shellContext?: ShellContext;\n    private element: HTMLElement | null = null;\n    private settings = ref<AppSettings>(defaultSettings);\n\n    private _sheet: CSSStyleSheet | null = null;\n\n    lifecycle: ViewLifecycle = {\n        onMount: () => { this._sheet ??= loadAsAdopted(settingsStyles) as CSSStyleSheet; },\n        onUnmount: () => { removeAdopted(this._sheet!); },\n        onShow: () => { this._sheet ??= loadAsAdopted(settingsStyles) as CSSStyleSheet; },\n        //onHide: () => { removeAdopted(this._sheet!); },\n    };\n\n    constructor(options: SettingsOptions = {}) {\n        this.options = options;\n        this.shellContext = options.shellContext;\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        if (options) {\n            this.options = { ...this.options, ...options };\n            this.shellContext = options.shellContext || this.shellContext;\n        }\n\n        this._sheet = loadAsAdopted(settingsStyles) as CSSStyleSheet;\n        this.loadSettings();\n\n        /*this.element = H`\n            <div class=\"view-settings\">\n                <div class=\"view-settings__content\">\n                    <h1 class=\"view-settings__title\">Settings</h1>\n\n                    <section class=\"view-settings__section\">\n                        <h2>Appearance</h2>\n                        <div class=\"view-settings__group\"><form style=\"display: contents;\" onsubmit=\"return false;\">\n                            <label class=\"view-settings__label\">\n                                <span>Theme</span>\n                                <select data-setting=\"appearance.theme\" class=\"view-settings__select\">\n                                    <option value=\"auto\" ${this.settings.value.appearance.theme === \"auto\" ? \"selected\" : \"\"}>Auto</option>\n                                    <option value=\"light\" ${this.settings.value.appearance.theme === \"light\" ? \"selected\" : \"\"}>Light</option>\n                                    <option value=\"dark\" ${this.settings.value.appearance.theme === \"dark\" ? \"selected\" : \"\"}>Dark</option>\n                                </select>\n                            </label>\n                            <label class=\"view-settings__label\">\n                                <span>Font Size</span>\n                                <select data-setting=\"appearance.fontSize\" class=\"view-settings__select\">\n                                    <option value=\"small\" ${this.settings.value.appearance.fontSize === \"small\" ? \"selected\" : \"\"}>Small</option>\n                                    <option value=\"medium\" ${this.settings.value.appearance.fontSize === \"medium\" ? \"selected\" : \"\"}>Medium</option>\n                                    <option value=\"large\" ${this.settings.value.appearance.fontSize === \"large\" ? \"selected\" : \"\"}>Large</option>\n                                </select>\n                            </label>\n                        </form></div>\n                    </section>\n\n                    <section class=\"view-settings__section\">\n                        <h2>AI Configuration</h2>\n                        <div class=\"view-settings__group\"><form style=\"display: contents;\" onsubmit=\"return false;\">\n                            <label class=\"view-settings__label\">\n                                <span>Base URL</span>\n                                <input\n                                    type=\"url\"\n                                    data-setting=\"ai.baseUrl\"\n                                    class=\"view-settings__input\"\n                                    placeholder=\"Enter your base URL\"\n                                    value=\"${this.settings.value.ai?.baseUrl || \"\"}\"\n                                />\n                            </label>\n                            <label class=\"view-settings__label\">\n                                <span>API Key</span>\n                                <input\n                                    type=\"password\"\n                                    data-setting=\"ai.apiKey\"\n                                    class=\"view-settings__input\"\n                                    placeholder=\"Enter your API key\"\n                                    value=\"${this.settings.value.ai?.apiKey || \"\"}\"\n                                />\n                            </label>\n                            <label class=\"view-settings__label\">\n                                <span>Model</span>\n                                <input\n                                    type=\"text\"\n                                    data-setting=\"ai.model\"\n                                    class=\"view-settings__input\"\n                                    placeholder=\"e.g., gpt-4o-mini\"\n                                    value=\"${this.settings.value.ai.model || \"\"}\"\n                                />\n                            </label>\n                            <label class=\"view-settings__checkbox\">\n                                <input\n                                    type=\"checkbox\"\n                                    data-setting=\"ai.autoProcess\"\n                                    ${this.settings.value.ai.autoProcess ? \"checked\" : \"\"}\n                                />\n                                <span>Auto-process shared content</span>\n                            </label>\n                        </form></div>\n                    </section>\n\n                    <section class=\"view-settings__section\">\n                        <h2>General</h2>\n                        <div class=\"view-settings__group\"><form style=\"display: contents;\" onsubmit=\"return false;\">\n                            <label class=\"view-settings__checkbox\">\n                                <input\n                                    type=\"checkbox\"\n                                    data-setting=\"general.autosave\"\n                                    ${this.settings.value.general.autosave ? \"checked\" : \"\"}\n                                />\n                                <span>Auto-save content</span>\n                            </label>\n                            <label class=\"view-settings__checkbox\">\n                                <input\n                                    type=\"checkbox\"\n                                    data-setting=\"general.notifications\"\n                                    ${this.settings.value.general.notifications ? \"checked\" : \"\"}\n                                />\n                                <span>Enable notifications</span>\n                            </label>\n                        </form></div>\n                    </section>\n\n                    <div class=\"view-settings__actions\">\n                        <button class=\"view-settings__btn view-settings__btn--primary\" data-action=\"save\" type=\"button\">\n                            Save Settings\n                        </button>\n                        <button class=\"view-settings__btn\" data-action=\"reset\" type=\"button\">\n                            Reset to Defaults\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ` as HTMLElement;*/\n\n        this.element = createSettingsView({\n            isExtension: false,\n            onTheme: (theme) => {\n                const nextTheme = theme as \"auto\" | \"light\" | \"dark\";\n                this.applyShellTheme(nextTheme);\n                this.options.onThemeChange?.(nextTheme);\n            }\n        });\n\n        return this.element;\n    }\n\n    getToolbar(): HTMLElement | null {\n        return null;\n    }\n\n    // ========================================================================\n    // PRIVATE METHODS\n    // ========================================================================\n\n    private setupEventHandlers(): void {\n        // Legacy handlers are intentionally disabled.\n        // createSettingsView() owns field bindings and persistence using unified config storage.\n    }\n\n    private loadSettings(): void {\n        this.settings.value = { ...defaultSettings };\n    }\n\n    private saveSettings(): void {\n        this.options.onSettingsChange?.(this.settings.value);\n    }\n\n    private resetSettings(): void {\n        this.settings.value = { ...defaultSettings };\n        this.updateUI();\n    }\n\n    private updateUI(): void {\n        if (!this.element) return;\n\n        // Update all inputs to reflect current settings\n        const inputs = this.element.querySelectorAll(\"[data-setting]\");\n        for (const input of inputs) {\n            const path = (input as HTMLElement).dataset.setting!;\n            const [section, key] = path.split(\".\") as [keyof AppSettings, string];\n            const value = (this.settings.value[section] as any)[key];\n\n            if ((input as HTMLInputElement).type === \"checkbox\") {\n                (input as HTMLInputElement).checked = Boolean(value);\n            } else {\n                (input as HTMLInputElement | HTMLSelectElement).value = value || \"\";\n            }\n        }\n    }\n\n    private showMessage(message: string): void {\n        this.shellContext?.showMessage(message);\n    }\n\n    private applyShellTheme(theme: \"auto\" | \"light\" | \"dark\"): void {\n        const root = this.element?.closest(\"[data-shell]\") as HTMLElement | null;\n        if (!root) return;\n        const resolved = theme === \"auto\"\n            ? (globalThis?.matchMedia?.(\"(prefers-color-scheme: dark)\")?.matches ? \"dark\" : \"light\")\n            : theme;\n        root.dataset.theme = resolved;\n        root.style.colorScheme = resolved;\n    }\n\n    canHandleMessage(messageType: string): boolean {\n        return messageType === \"settings-update\";\n    }\n\n    async handleMessage(message: unknown): Promise<void> {\n        const msg = message as { data?: Partial<AppSettings> };\n        if (msg.data) {\n            this.settings.value = { ...this.settings.value, ...msg.data };\n            this.updateUI();\n        }\n    }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport function createView(options?: SettingsOptions): SettingsView {\n    return new SettingsView(options);\n}\n\nexport default createView;\n"],"names":["style"],"mappings":"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"}