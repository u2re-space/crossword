{"version":3,"file":"index11.js","sources":["../../src/frontend/views/explorer/index.ts"],"sourcesContent":["/**\n * Explorer View\n *\n * Shell-agnostic file explorer component.\n * Uses the <view-explorer> web component for encapsulated rendering.\n */\n\nimport { H } from \"fest/lure\";\nimport { loadAsAdopted, removeAdopted } from \"fest/dom\";\nimport type { View, ViewOptions, ViewLifecycle, ShellContext } from \"../../shells/types\";\nimport type { BaseViewOptions } from \"../types\";\nimport { getString, setString } from \"../../../core/storage\";\n\n// Import the view-explorer web component from fl.ui\nimport { FileManager, type FileItem } from \"fest/fl-ui\";\n\n// Re-export FileManager for backwards compatibility\nexport { FileManager, FileManagerContent } from \"fest/fl-ui\";\n\n// @ts-ignore\nimport style from \"./index.scss?inline\";\n\n// ============================================================================\n// EXPLORER VIEW\n// ============================================================================\n\nexport class ExplorerView implements View {\n    id = \"explorer\" as const;\n    name = \"Explorer\";\n    icon = \"folder\";\n\n    private options: BaseViewOptions;\n    private shellContext?: ShellContext;\n    private element: HTMLElement | null = null;\n    private explorer: FileManager | null = null;\n\n    private _sheet: CSSStyleSheet | null = null;\n\n    lifecycle: ViewLifecycle = {\n        onMount: () => { this.loadLastPath(); this._sheet ??= loadAsAdopted(style) as CSSStyleSheet; },\n        onUnmount: () => { removeAdopted(this._sheet); this.saveCurrentPath(); },\n        onShow: () => { this._sheet ??= loadAsAdopted(style) as CSSStyleSheet; },\n        onHide: () => { this.saveCurrentPath(); },\n    };\n\n    constructor(options: BaseViewOptions = {}) {\n        this.options = options;\n        this.shellContext = options.shellContext;\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        if (options) {\n            this.options = { ...this.options, ...options };\n            this.shellContext = options.shellContext || this.shellContext;\n        }\n\n        this._sheet = loadAsAdopted(style) as CSSStyleSheet;\n\n        // Create element with view-explorer web component\n        this.element = H`\n            <div class=\"view-explorer\">\n                <div class=\"view-explorer__content\" data-explorer-content>\n                    <ui-file-manager view-mode=\"list\"></ui-file-manager>\n                </div>\n            </div>\n        ` as HTMLElement;\n\n        // Get reference to view-explorer component\n        this.explorer = this.element.querySelector(\"ui-file-manager\") as unknown as FileManager;\n\n        // Setup event listeners\n        this.setupExplorerEvents();\n\n        return this.element;\n    }\n\n    getToolbar(): HTMLElement | null {\n        return null;\n    }\n\n    // ========================================================================\n    // PRIVATE METHODS\n    // ========================================================================\n\n    private setupExplorerEvents(): void {\n        if (!this.explorer) return;\n        const explorer = this.explorer as unknown as FileManager & HTMLElement;\n\n        // Handle file open\n        explorer.addEventListener(\"rs-open\", async (e: Event) => {\n            const detail = (e as CustomEvent<{ item: FileItem }>).detail;\n            const item = detail?.item;\n\n            if (item?.kind === \"file\" && item?.file) {\n                const file = item.file as File;\n                const isMarkdown = file.name.toLowerCase().endsWith(\".md\") ||\n                                   file.type === \"text/markdown\";\n\n                if (isMarkdown) {\n                    try {\n                        const content = await file.text();\n                        this.shellContext?.navigate(\"viewer\", { content });\n                    } catch (error) {\n                        console.error(\"[Explorer] Failed to read file:\", error);\n                        this.showMessage(\"Failed to open file\");\n                    }\n                } else {\n                    // Send to work center\n                    this.shellContext?.navigate(\"workcenter\");\n                }\n            }\n        });\n\n        // Handle path changes\n        explorer.addEventListener(\"rs-navigate\", () => {\n            this.saveCurrentPath();\n        });\n    }\n\n    private loadLastPath(): void {\n        if (this.explorer) {\n            const lastPath = getString(\"view-explorer-path\", \"/\");\n            this.explorer.path = lastPath;\n        }\n    }\n\n    private saveCurrentPath(): void {\n        if (this.explorer) {\n            const currentPath = this.explorer.path || \"/\";\n            setString(\"view-explorer-path\", currentPath);\n        }\n    }\n\n    private showMessage(message: string): void {\n        this.shellContext?.showMessage(message);\n    }\n\n    canHandleMessage(messageType: string): boolean {\n        return [\"file-save\", \"navigate-path\", \"content-explorer\"].includes(messageType);\n    }\n\n    async handleMessage(message: unknown): Promise<void> {\n        const msg = message as { data?: { path?: string; into?: string } };\n        const targetPath = msg.data?.path || msg.data?.into;\n        if (targetPath && this.explorer) {\n            this.explorer.navigate(targetPath);\n        }\n    }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport function createView(options?: ExplorerOptions): ExplorerView {\n    return new ExplorerView(options);\n}\n\n/** Alias for createView */\nexport const createExplorerView = createView;\n\nexport default createView;\n"],"names":[],"mappings":"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"}