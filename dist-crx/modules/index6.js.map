{"version":3,"mappings":"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","names":["error"],"ignoreList":[],"sources":["../../src/frontend/views/workcenter/modules/WorkCenterState.ts","../../src/frontend/views/workcenter/modules/WorkCenterUI.ts","../../src/frontend/views/workcenter/modules/WorkCenterFileOps.ts","../../src/com/core/AppCommunicator.ts","../../src/frontend/views/workcenter/modules/WorkCenterShareTarget.ts","../../src/frontend/views/workcenter/modules/WorkCenterTemplates.ts","../../src/frontend/views/workcenter/modules/WorkCenterVoice.ts","../../src/frontend/views/workcenter/modules/WorkCenterActions.ts","../../src/frontend/views/workcenter/modules/WorkCenterDataProcessing.ts","../../src/frontend/views/workcenter/modules/WorkCenterEvents.ts","../../src/frontend/views/workcenter/modules/WorkCenterResults.ts","../../src/frontend/views/workcenter/modules/WorkCenterAttachments.ts","../../src/frontend/views/workcenter/modules/WorkCenterPrompts.ts","../../src/frontend/views/workcenter/modules/WorkCenterHistory.ts","../../src/frontend/views/workcenter/modules/WorkCenter.ts","../../src/frontend/views/workcenter/index.ts"],"sourcesContent":["export interface WorkCenterState {\n    files: File[];\n    selectedFiles: File[];\n    currentPrompt: string;\n    autoAction: boolean;\n    selectedInstruction: string;\n    outputFormat: \"auto\" | \"markdown\" | \"json\" | \"text\" | \"raw\" | \"html\" | \"code\";\n    activeInputTab: \"instruction\" | \"prompt\" | \"attachments\";\n    activeResultsTab: \"output\" | \"pipeline\" | \"history\";\n    selectedLanguage: \"auto\" | \"en\" | \"ru\"; // Language selection for AI responses\n    selectedTemplate: string; // Store the selected template prompt\n    recognitionFormat: \"auto\" | \"markdown\" | \"html\" | \"text\" | \"json\" | \"most-suitable\" | \"most-optimized\" | \"most-legibility\"; // Preferred recognition format\n    processingFormat: \"markdown\" | \"html\" | \"json\" | \"text\" | \"typescript\" | \"javascript\" | \"python\" | \"java\" | \"cpp\" | \"csharp\" | \"php\" | \"ruby\" | \"go\" | \"rust\" | \"xml\" | \"yaml\" | \"css\" | \"scss\"; // Processing output format\n    voiceRecording: boolean;\n    promptTemplates: { name: string, prompt: string }[];\n    lastRawResult: any; // Store raw result for copying unparsed content\n\n    // Data processing pipeline\n    recognizedData: {\n        content: string;\n        timestamp: number;\n        source: 'files' | 'text' | 'url' | 'markdown' | 'image' | 'mixed';\n        recognizedAs: 'markdown' | 'html' | 'text' | 'json' | 'xml' | 'other'; // Format recognized as\n        metadata?: Record<string, any>;\n        responseId?: string; // GPT/AI response ID from HTTP level\n    } | null; // Raw recognized content from files/images\n\n    processedData: {\n        content: string;\n        timestamp: number;\n        action: string; // Template/action applied\n        sourceData: any; // Reference to what was processed\n        metadata?: any;\n    }[] | null; // Chain of processed results\n\n    currentProcessingStep: number; // Current step in processing chain\n}\n\nexport interface WorkCenterDependencies {\n    state: any; // App state\n    history: any[]; // History array\n    getSpeechPrompt: () => Promise<string | null>;\n    showMessage: (message: string) => void;\n    render: () => void;\n    onFilesChanged?: () => void; // Callback when files are added/removed\n}\n\nexport class WorkCenterStateManager {\n    private static readonly STORAGE_KEY = \"rs-workcenter-state\";\n    private static readonly TEMPLATES_STORAGE_KEY = \"rs-workcenter-templates\";\n\n    static createDefaultState(): WorkCenterState {\n        return {\n            files: [],\n            selectedFiles: [],\n            currentPrompt: \"\",\n            autoAction: false,\n            selectedInstruction: \"\",\n            outputFormat: \"auto\",\n            activeInputTab: \"prompt\",\n            activeResultsTab: \"output\",\n            selectedLanguage: \"auto\",\n            selectedTemplate: \"\",\n            recognitionFormat: \"auto\",\n            processingFormat: \"markdown\",\n            voiceRecording: false,\n            promptTemplates: this.loadPromptTemplates(),\n            lastRawResult: null,\n            recognizedData: null,\n            processedData: null,\n            currentProcessingStep: 0,\n            ...this.loadWorkCenterState() // Load persisted state\n        };\n    }\n\n    static saveState(state: WorkCenterState): void {\n        try {\n            const stateToSave = {\n                currentPrompt: state.currentPrompt,\n                autoAction: state.autoAction,\n                selectedInstruction: state.selectedInstruction,\n                outputFormat: state.outputFormat,\n                activeInputTab: state.activeInputTab,\n                activeResultsTab: state.activeResultsTab,\n                selectedLanguage: state.selectedLanguage,\n                selectedTemplate: state.selectedTemplate,\n                recognitionFormat: state.recognitionFormat,\n                processingFormat: state.processingFormat,\n                currentProcessingStep: state.currentProcessingStep,\n                // Save metadata about recognized/processed data, not the full content\n                recognizedData: state.recognizedData ? {\n                    timestamp: state.recognizedData.timestamp,\n                    source: state.recognizedData.source,\n                    contentLength: state.recognizedData.content.length,\n                    metadata: state.recognizedData.metadata\n                } : null,\n                processedData: state.processedData ? state.processedData.map(p => ({\n                    timestamp: p.timestamp,\n                    action: p.action,\n                    contentLength: p.content.length,\n                    metadata: p.metadata\n                })) : null,\n                // Don't save files, voiceRecording, or full content\n            };\n            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(stateToSave));\n        } catch (e) {\n            console.warn(\"Failed to save workcenter state:\", e);\n        }\n    }\n\n    private static loadWorkCenterState(): Partial<WorkCenterState> {\n        try {\n            const saved = localStorage.getItem(this.STORAGE_KEY);\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                return {\n                    currentPrompt: parsed.currentPrompt || \"\",\n                    autoAction: parsed.autoAction || false,\n                    selectedInstruction: parsed.selectedInstruction || \"\",\n                    outputFormat: parsed.outputFormat || \"auto\",\n                    activeInputTab: parsed.activeInputTab || \"prompt\",\n                    activeResultsTab: parsed.activeResultsTab || \"output\",\n                    selectedLanguage: parsed.selectedLanguage || \"auto\",\n                    selectedTemplate: parsed.selectedTemplate || \"\",\n                    recognitionFormat: parsed.recognitionFormat || \"auto\",\n                    processingFormat: parsed.processingFormat || \"markdown\",\n                    currentProcessingStep: parsed.currentProcessingStep || 0,\n                    // Don't restore full content, just metadata\n                };\n            }\n        } catch (e) {\n            console.warn(\"Failed to load workcenter state:\", e);\n        }\n        return {};\n    }\n\n    static loadPromptTemplates(): { name: string, prompt: string }[] {\n        const safeJsonParse = <T>(raw: string | null, fallback: T): T => {\n            if (!raw) return fallback;\n            try {\n                const v = JSON.parse(raw) as T;\n                return v ?? fallback;\n            } catch {\n                return fallback;\n            }\n        };\n\n        return safeJsonParse(localStorage.getItem(this.TEMPLATES_STORAGE_KEY), [\n            { name: \"Analyze & Extract\", prompt: \"Analyze the provided content and extract key information, formulas, data, and insights. Identify the main topics, recognize any mathematical expressions or equations, and provide a structured summary.\" },\n            { name: \"Solve Equations\", prompt: \"Find and solve any mathematical equations, problems, or calculations in the content. Show your work step-by-step and provide the final answers.\" },\n            { name: \"Generate Code\", prompt: \"Based on the description or requirements in the content, generate appropriate code. Include comments and explain the implementation.\" },\n            { name: \"Extract Styles\", prompt: \"Analyze the visual content or design description and extract/generate CSS styles, color schemes, and layout information.\" },\n            { name: \"Document Analysis\", prompt: \"Perform a comprehensive analysis of the document, including structure, key points, relationships, and actionable insights.\" },\n            { name: \"Data Processing\", prompt: \"Process and transform the provided data. Extract structured information, identify patterns, and present results in a clear format.\" }\n        ]);\n    }\n\n    static savePromptTemplates(templates: { name: string, prompt: string }[]): void {\n        try {\n            localStorage.setItem(this.TEMPLATES_STORAGE_KEY, JSON.stringify(templates));\n        } catch (e) {\n            console.warn(\"Failed to save prompt templates:\", e);\n        }\n    }\n\n    static clearRecognizedData(state: WorkCenterState): void {\n        state.recognizedData = null;\n        state.processedData = null;\n        state.currentProcessingStep = 0;\n    }\n\n    static addProcessedStep(state: WorkCenterState, step: { content: string; timestamp: number; action: string; sourceData: any; metadata?: any }): void {\n        if (!state.processedData) {\n            state.processedData = [];\n        }\n        state.processedData.push(step);\n        state.currentProcessingStep++;\n    }\n}","import { H } from \"fest/lure\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterResults } from \"./WorkCenterResults\";\nimport type { WorkCenterAttachments } from \"./WorkCenterAttachments\";\nimport type { WorkCenterPrompts } from \"./WorkCenterPrompts\";\nimport type { WorkCenterHistory } from \"./WorkCenterHistory\";\n\nexport class WorkCenterUI {\n    private container: HTMLElement | null = null;\n    private deps: WorkCenterDependencies;\n    private attachments: WorkCenterAttachments;\n    private prompts: WorkCenterPrompts;\n    private results: WorkCenterResults;\n    private history: WorkCenterHistory;\n\n    constructor(\n        dependencies: WorkCenterDependencies,\n        attachments: WorkCenterAttachments,\n        prompts: WorkCenterPrompts,\n        results: WorkCenterResults,\n        history: WorkCenterHistory\n    ) {\n        this.deps = dependencies;\n        this.attachments = attachments;\n        this.prompts = prompts;\n        this.results = results;\n        this.history = history;\n    }\n\n    setContainer(container: HTMLElement | null): void {\n        this.container = container;\n        this.attachments.setContainer(container);\n        this.prompts.setContainer(container);\n        this.results.setContainer(container);\n        this.history.setContainer(container);\n    }\n\n    getContainer(): HTMLElement | null {\n        return this.container;\n    }\n\n    renderWorkCenterView(state: WorkCenterState): HTMLElement {\n        const container = H`<div class=\"workcenter-view\">\n      <div class=\"workcenter-header\">\n        <h2>AI Work Center</h2>\n        <details class=\"header-controls-disclosure\">\n          <summary class=\"header-controls-summary\">\n            <span>AI Work Center</span>\n          </summary>\n          <div class=\"control-selectors\">\n          <div class=\"format-selector\">\n            <label>Output Format:</label>\n            <select class=\"format-select\">\n              <option value=\"auto\" ${state.outputFormat === 'auto' ? 'selected' : ''}>Auto</option>\n              <option value=\"markdown\" ${state.outputFormat === 'markdown' ? 'selected' : ''}>Markdown</option>\n              <option value=\"json\" ${state.outputFormat === 'json' ? 'selected' : ''}>JSON</option>\n              <option value=\"code\" ${state.outputFormat === 'code' ? 'selected' : ''}>Code</option>\n              <option value=\"raw\" ${state.outputFormat === 'raw' ? 'selected' : ''}>Raw Text</option>\n              <option value=\"text\" ${state.outputFormat === 'text' ? 'selected' : ''}>Plain Text</option>\n              <option value=\"html\" ${state.outputFormat === 'html' ? 'selected' : ''}>HTML</option>\n            </select>\n          </div>\n          <div class=\"language-selector\">\n            <label>Language:</label>\n            <select class=\"language-select\">\n              <option value=\"auto\" ${state.selectedLanguage === 'auto' ? 'selected' : ''}>Auto</option>\n              <option value=\"en\" ${state.selectedLanguage === 'en' ? 'selected' : ''}>English</option>\n              <option value=\"ru\" ${state.selectedLanguage === 'ru' ? 'selected' : ''}></option>\n            </select>\n          </div>\n          <div class=\"recognition-selector\">\n            <label>Recognize as:</label>\n            <select class=\"recognition-select\">\n              <option value=\"auto\" ${state.recognitionFormat === 'auto' ? 'selected' : ''}>Auto</option>\n              <option value=\"most-suitable\" ${state.recognitionFormat === 'most-suitable' ? 'selected' : ''}>Most Suitable</option>\n              <option value=\"most-optimized\" ${state.recognitionFormat === 'most-optimized' ? 'selected' : ''}>Most Optimized</option>\n              <option value=\"most-legibility\" ${state.recognitionFormat === 'most-legibility' ? 'selected' : ''}>Most Legible</option>\n              <option value=\"markdown\" ${state.recognitionFormat === 'markdown' ? 'selected' : ''}>Markdown</option>\n              <option value=\"html\" ${state.recognitionFormat === 'html' ? 'selected' : ''}>HTML</option>\n              <option value=\"text\" ${state.recognitionFormat === 'text' ? 'selected' : ''}>Plain Text</option>\n              <option value=\"json\" ${state.recognitionFormat === 'json' ? 'selected' : ''}>JSON</option>\n            </select>\n          </div>\n          <div class=\"processing-selector\">\n            <label>Process as:</label>\n            <select class=\"processing-select\">\n              <option value=\"markdown\" ${state.processingFormat === 'markdown' ? 'selected' : ''}>Markdown</option>\n              <option value=\"html\" ${state.processingFormat === 'html' ? 'selected' : ''}>HTML</option>\n              <option value=\"json\" ${state.processingFormat === 'json' ? 'selected' : ''}>JSON</option>\n              <option value=\"text\" ${state.processingFormat === 'text' ? 'selected' : ''}>Plain Text</option>\n              <option value=\"typescript\" ${state.processingFormat === 'typescript' ? 'selected' : ''}>TypeScript</option>\n              <option value=\"javascript\" ${state.processingFormat === 'javascript' ? 'selected' : ''}>JavaScript</option>\n              <option value=\"python\" ${state.processingFormat === 'python' ? 'selected' : ''}>Python</option>\n              <option value=\"java\" ${state.processingFormat === 'java' ? 'selected' : ''}>Java</option>\n              <option value=\"cpp\" ${state.processingFormat === 'cpp' ? 'selected' : ''}>C++</option>\n              <option value=\"csharp\" ${state.processingFormat === 'csharp' ? 'selected' : ''}>C#</option>\n              <option value=\"php\" ${state.processingFormat === 'php' ? 'selected' : ''}>PHP</option>\n              <option value=\"ruby\" ${state.processingFormat === 'ruby' ? 'selected' : ''}>Ruby</option>\n              <option value=\"go\" ${state.processingFormat === 'go' ? 'selected' : ''}>Go</option>\n              <option value=\"rust\" ${state.processingFormat === 'rust' ? 'selected' : ''}>Rust</option>\n              <option value=\"xml\" ${state.processingFormat === 'xml' ? 'selected' : ''}>XML</option>\n              <option value=\"yaml\" ${state.processingFormat === 'yaml' ? 'selected' : ''}>YAML</option>\n              <option value=\"css\" ${state.processingFormat === 'css' ? 'selected' : ''}>CSS</option>\n              <option value=\"scss\" ${state.processingFormat === 'scss' ? 'selected' : ''}>SCSS</option>\n            </select>\n          </div>\n          </div>\n        </details>\n      </div>\n\n      <div class=\"workcenter-content\">\n        <div class=\"workcenter-layout\">\n\n          <!-- Results & Processing Section -->\n          <div class=\"workcenter-block results-block\">\n            <div class=\"results-section\">\n              ${this.renderResultsTabs(state)}\n            </div>\n          </div>\n\n          <!-- Input Prompts Section -->\n          <div class=\"workcenter-block prompts-block\">\n            ${this.renderInputTabs(state)}\n          </div>\n        </div>\n      </div>\n    </div>` as HTMLElement;\n\n        this.container = container;\n        this.attachments.setContainer(container);\n        this.prompts.setContainer(container);\n        this.results.setContainer(container);\n\n        // Initialize UI components\n        this.initializeUI(state);\n\n        return container;\n    }\n\n    private initializeUI(state: WorkCenterState): void {\n        // Setup drop zone functionality for attachments\n        this.attachments.setupDropZone(state);\n\n        // Initialize file list and counters\n        this.attachments.updateFileList(state);\n        this.attachments.updateFileCounter(state);\n        this.prompts.updatePromptFileCount(state);\n        this.updateInputTabFileCount(state);\n        this.updateResultsPipelineTabState(state);\n        this.history.updateRecentHistory(state);\n    }\n\n    updateFileCounter(state: WorkCenterState): void {\n        this.attachments.updateFileCounter(state);\n        this.prompts.updatePromptFileCount(state);\n        this.updateInputTabFileCount(state);\n    }\n\n    updateFileList(state: WorkCenterState): void {\n        this.attachments.updateFileList(state);\n        this.prompts.updatePromptFileCount(state);\n        this.updateInputTabFileCount(state);\n    }\n\n    updatePromptInput(state: WorkCenterState): void {\n        this.prompts.updatePromptInput(state);\n    }\n\n    updateTemplateSelect(state: WorkCenterState): void {\n        this.prompts.updateTemplateSelect(state);\n    }\n\n    updateVoiceButton(state: WorkCenterState): void {\n        this.prompts.updateVoiceButton(state);\n    }\n\n\n    updateDataPipeline(state: WorkCenterState): void {\n        this.results.updateDataPipeline(state);\n        this.updateResultsPipelineTabState(state);\n    }\n\n    updateDataCounters(state: WorkCenterState): void {\n        this.attachments.updateDataCounters(state);\n    }\n\n    showProcessingMessage(message: string): void {\n        this.results.showProcessingMessage(message);\n    }\n\n    showResult(state: WorkCenterState): void {\n        this.results.showResult(state);\n    }\n\n    showError(error: string): void {\n        this.results.showError(error);\n    }\n\n    clearResults(): void {\n        this.results.clearResults();\n    }\n\n    revokeAllPreviewUrls(state: WorkCenterState): void {\n        this.attachments.revokeAllPreviewUrls(state);\n    }\n\n    private renderInputTabs(state: WorkCenterState): string {\n        const activeTab = state.activeInputTab || \"prompt\";\n        return `\n            <div class=\"input-tabs-section\" data-input-tabs data-active-tab=\"${activeTab}\">\n                <div class=\"wc-block-header\">\n                    <div class=\"input-tab-actions\">\n                        <button class=\"tab-btn ${activeTab === 'prompt' ? 'is-active' : ''}\" data-action=\"switch-input-tab\" data-tab=\"prompt\" aria-selected=\"${activeTab === 'prompt'}\">Prompt</button>\n                        <button class=\"tab-btn ${activeTab === 'attachments' ? 'is-active' : ''}\" data-action=\"switch-input-tab\" data-tab=\"attachments\" aria-selected=\"${activeTab === 'attachments'}\">Files (${state.files.length})</button>\n                    </div>\n                    <h3>Work Inputs</h3>\n                    <div></div>\n                </div>\n                <div class=\"input-tab-panels\">\n                    <section class=\"tab-panel ${activeTab === 'prompt' ? 'is-active' : ''}\" data-tab-panel=\"prompt\">\n                        ${this.prompts.renderPromptPanel(state)}\n                    </section>\n                    <section class=\"tab-panel ${activeTab === 'attachments' ? 'is-active' : ''}\" data-tab-panel=\"attachments\">\n                        ${this.attachments.renderAttachmentsSection(state)}\n                    </section>\n                </div>\n            </div>\n        `;\n    }\n\n    private renderResultsTabs(state: WorkCenterState): string {\n        const hasPipelineData = Boolean(state.recognizedData || (state.processedData && state.processedData.length > 0));\n        const pipelineCount = (state.recognizedData ? 1 : 0) + (state.processedData?.length || 0);\n        const activeTab = state.activeResultsTab === \"pipeline\" && !hasPipelineData\n            ? \"output\"\n            : state.activeResultsTab;\n\n        return `\n            <div class=\"results-tabs-section\" data-results-tabs data-active-tab=\"${activeTab}\">\n                <div class=\"wc-block-header results-tabs-header\">\n                    <div class=\"results-tab-actions\">\n                        <button class=\"tab-btn ${activeTab === 'output' ? 'is-active' : ''}\" data-action=\"switch-results-tab\" data-tab=\"output\" aria-selected=\"${activeTab === 'output'}\">Output</button>\n                        <button class=\"tab-btn ${activeTab === 'pipeline' ? 'is-active' : ''}\" data-action=\"switch-results-tab\" data-tab=\"pipeline\" aria-selected=\"${activeTab === 'pipeline'}\"${hasPipelineData ? '' : ' disabled'}>Pipeline (${pipelineCount})</button>\n                        <button class=\"tab-btn ${activeTab === 'history' ? 'is-active' : ''}\" data-action=\"switch-results-tab\" data-tab=\"history\" aria-selected=\"${activeTab === 'history'}\">History</button>\n                    </div>\n                    <h3>Results & Processing</h3>\n                    ${this.results.renderOutputHeader()}\n                </div>\n                <div class=\"results-tab-panels\">\n                    <section class=\"results-tab-panel ${activeTab === 'output' ? 'is-active' : ''}\" data-results-tab-panel=\"output\">\n                        <div class=\"wc-output-section\">\n                            ${this.results.renderOutputContent()}\n                        </div>\n                    </section>\n                    <section class=\"results-tab-panel ${activeTab === 'pipeline' ? 'is-active' : ''}\" data-results-tab-panel=\"pipeline\">\n                        ${hasPipelineData ? this.results.renderDataPipeline(state) : '<div class=\"wc-results-empty\">No data pipeline yet</div>'}\n                    </section>\n                    <section class=\"results-tab-panel ${activeTab === 'history' ? 'is-active' : ''}\" data-results-tab-panel=\"history\">\n                        <div class=\"history-section\">\n                            <div class=\"history-header\">\n                                <h4>Recent Activity</h4>\n                                <div class=\"result-actions\">\n                                    <button class=\"btn btn-icon\" data-action=\"view-action-history\" title=\"View Action History\">\n                                        <ui-icon icon=\"history\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                                        <span class=\"btn-text\">History</span>\n                                    </button>\n                                    <button class=\"btn\" data-action=\"view-full-history\">View All History</button>\n                                </div>\n                            </div>\n                            <div class=\"recent-history\" data-recent-history></div>\n                            <div class=\"action-stats\" data-action-stats style=\"display: none;\"></div>\n                        </div>\n                    </section>\n                </div>\n            </div>\n        `;\n    }\n\n    private updateInputTabFileCount(state: WorkCenterState): void {\n        if (!this.container) return;\n        const filesTabBtn = this.container.querySelector('[data-action=\"switch-input-tab\"][data-tab=\"attachments\"]') as HTMLElement | null;\n        if (filesTabBtn) {\n            filesTabBtn.textContent = `Files (${state.files.length})`;\n        }\n    }\n\n    private updateResultsPipelineTabState(state: WorkCenterState): void {\n        if (!this.container) return;\n        const hasPipelineData = Boolean(state.recognizedData || (state.processedData && state.processedData.length > 0));\n        const pipelineCount = (state.recognizedData ? 1 : 0) + (state.processedData?.length || 0);\n        const tabsRoot = this.container.querySelector('[data-results-tabs]') as HTMLElement | null;\n        const pipelineTabBtn = this.container.querySelector('[data-action=\"switch-results-tab\"][data-tab=\"pipeline\"]') as HTMLButtonElement | null;\n        if (!tabsRoot || !pipelineTabBtn) return;\n\n        pipelineTabBtn.textContent = `Pipeline (${pipelineCount})`;\n        pipelineTabBtn.disabled = !hasPipelineData;\n\n        const activeTab = tabsRoot.getAttribute('data-active-tab') || 'output';\n        if (!hasPipelineData && activeTab === 'pipeline') {\n            tabsRoot.setAttribute('data-active-tab', 'output');\n            state.activeResultsTab = 'output';\n\n            const outputBtn = this.container.querySelector('[data-action=\"switch-results-tab\"][data-tab=\"output\"]') as HTMLButtonElement | null;\n            if (outputBtn) {\n                outputBtn.classList.add('is-active');\n                outputBtn.setAttribute('aria-selected', 'true');\n            }\n            pipelineTabBtn.classList.remove('is-active');\n            pipelineTabBtn.setAttribute('aria-selected', 'false');\n\n            const outputPanel = this.container.querySelector('[data-results-tab-panel=\"output\"]') as HTMLElement | null;\n            const pipelinePanel = this.container.querySelector('[data-results-tab-panel=\"pipeline\"]') as HTMLElement | null;\n            outputPanel?.classList.add('is-active');\n            pipelinePanel?.classList.remove('is-active');\n        }\n    }\n}","import type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport { ROUTE_HASHES } from '@rs-com/config/Names';\nimport { normalizeDataAsset, parseDataUrl, isBase64Like } from 'fest/lure';\n\nexport class WorkCenterFileOps {\n    private deps: WorkCenterDependencies;\n\n    constructor(dependencies: WorkCenterDependencies) {\n        this.deps = dependencies;\n    }\n\n    async handleDroppedContent(state: WorkCenterState, content: string, sourceType: string): Promise<void> {\n        const currentHash = this.getCurrentHash();\n\n        // Apply hash-specific drop rules\n        switch (currentHash) {\n            case ROUTE_HASHES.SHARE_TARGET_TEXT:\n                // For text-specific route, only accept text content\n                if (sourceType === 'text' || sourceType === 'html') {\n                    return this.handlePastedContent(state, content, sourceType);\n                } else {\n                    this.deps.showMessage?.('This route only accepts text content. Please paste text or use the files route for file drops.');\n                    return;\n                }\n\n            case ROUTE_HASHES.SHARE_TARGET_IMAGE:\n                // For image-specific route, only accept image content\n                if (this.isImageContent(content) || sourceType === 'image') {\n                    return this.handleImageContent(state, content, sourceType);\n                } else {\n                    this.deps.showMessage?.('This route only accepts image content. Please drop images or use other routes for different content types.');\n                    return;\n                }\n\n            case ROUTE_HASHES.SHARE_TARGET_FILES:\n                // For files route, accept any file drops\n                return this.handlePastedContent(state, content, sourceType);\n\n            case ROUTE_HASHES.SHARE_TARGET_URL:\n                // For URL route, only accept URLs\n                if (this.isValidUrl(content)) {\n                    return this.handlePastedContent(state, content, sourceType);\n                } else {\n                    this.deps.showMessage?.('This route only accepts URLs. Please paste a valid URL.');\n                    return;\n                }\n\n            default:\n                // Default behavior for regular workcenter\n                return this.handlePastedContent(state, content, sourceType);\n        }\n    }\n\n    async handlePastedContent(state: WorkCenterState, content: string, sourceType: string): Promise<void> {\n        const currentHash = this.getCurrentHash();\n\n        try {\n            // Apply hash-specific paste rules\n            switch (currentHash) {\n                case ROUTE_HASHES.SHARE_TARGET_TEXT:\n                    // Only accept text content for text route\n                    if (sourceType === 'text' || sourceType === 'html') {\n                        await this.handleTextContent(state, content, sourceType);\n                    } else {\n                        this.deps.showMessage?.('This route only accepts text content');\n                    }\n                    break;\n\n                case ROUTE_HASHES.SHARE_TARGET_URL:\n                    // Only accept URLs for URL route\n                    if (this.isValidUrl(content)) {\n                        await this.handleUrlContent(state, content);\n                    } else {\n                        this.deps.showMessage?.('This route only accepts valid URLs');\n                    }\n                    break;\n\n                case ROUTE_HASHES.SHARE_TARGET_IMAGE:\n                    // Only accept image content for image route\n                    if (this.isImageContent(content) || this.isBase64Data(content)) {\n                        await this.handleImageContent(state, content, sourceType);\n                    } else {\n                        this.deps.showMessage?.('This route only accepts image content');\n                    }\n                    break;\n\n                default:\n                    // Default behavior for regular workcenter and files route\n                    await this.handleDefaultPaste(state, content, sourceType);\n                    break;\n            }\n        } catch (error) {\n            console.error('[WorkCenter] Failed to handle pasted content:', error);\n            this.deps.showMessage?.('Failed to process pasted content');\n        }\n    }\n\n    private isValidUrl(string: string): boolean {\n        try {\n            new URL(string);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    private isBase64Data(content: string): boolean {\n        const raw = (content || '').trim();\n        return !!parseDataUrl(raw) || isBase64Like(raw);\n    }\n\n    private async handleBase64Content(state: WorkCenterState, content: string): Promise<void> {\n        try {\n            const asset = await normalizeDataAsset(content, {\n                namePrefix: 'pasted-data',\n                uriComponent: true\n            });\n            state.files.push(asset.file);\n            this.deps.showMessage?.('Encoded content decoded and added to work center');\n\n        } catch (error) {\n            console.error('[WorkCenter] Failed to decode base64 content:', error);\n            // Fallback: treat as regular text\n            const fallbackAsset = await normalizeDataAsset(content, {\n                namePrefix: 'pasted-text',\n                mimeType: 'text/plain;charset=utf-8'\n            });\n            state.files.push(fallbackAsset.file);\n\n            this.deps.showMessage?.('Base64 content added as text to work center');\n        }\n    }\n\n    addFilesFromInput(state: WorkCenterState, files: FileList): void {\n        const fileArray = Array.from(files);\n        const currentHash = this.getCurrentHash();\n\n        // Apply hash-specific file filtering\n        let filteredFiles: File[] = fileArray;\n\n        switch (currentHash) {\n            case ROUTE_HASHES.SHARE_TARGET_IMAGE:\n                // Only accept image files for image route\n                filteredFiles = fileArray.filter(file => file.type.startsWith('image/'));\n                if (filteredFiles.length === 0) {\n                    this.deps.showMessage?.('This route only accepts image files. Please drop images or use other routes for different file types.');\n                    return;\n                }\n                break;\n\n            case ROUTE_HASHES.SHARE_TARGET_TEXT:\n                // For text route, only accept text-based files\n                filteredFiles = fileArray.filter(file =>\n                    file.type.startsWith('text/') ||\n                    file.type === 'application/json' ||\n                    file.type === 'application/xml' ||\n                    file.name.toLowerCase().endsWith('.txt') ||\n                    file.name.toLowerCase().endsWith('.md') ||\n                    file.name.toLowerCase().endsWith('.json') ||\n                    file.name.toLowerCase().endsWith('.xml')\n                );\n                if (filteredFiles.length === 0) {\n                    this.deps.showMessage?.('This route only accepts text files. Please drop text files or use the files route for other file types.');\n                    return;\n                }\n                break;\n\n            case ROUTE_HASHES.SHARE_TARGET_FILES:\n                // Accept any files for files route\n                filteredFiles = fileArray;\n                break;\n\n            case ROUTE_HASHES.SHARE_TARGET_URL:\n                // Don't accept files for URL route\n                this.deps.showMessage?.('This route only accepts URLs. Please paste a URL instead of dropping files.');\n                return;\n\n            default:\n                // Default behavior - accept any files\n                filteredFiles = fileArray;\n                break;\n        }\n\n        state.files.push(...filteredFiles);\n\n        // Show appropriate message\n        if (filteredFiles.length > 0) {\n            const fileCount = filteredFiles.length;\n            const fileWord = fileCount === 1 ? 'file' : 'files';\n            this.deps.showMessage?.(`${fileCount} ${fileWord} added to work center`);\n        }\n    }\n\n    removeFile(state: WorkCenterState, index: number): File | null {\n        if (index >= 0 && index < state.files.length) {\n            return state.files.splice(index, 1)[0];\n        }\n        return null;\n    }\n\n    clearAllFiles(state: WorkCenterState): File[] {\n        const files = [...state.files];\n        state.files.length = 0;\n        return files;\n    }\n\n    getFilesForProcessing(state: WorkCenterState): File[] {\n        return [...state.files];\n    }\n\n    hasFiles(state: WorkCenterState): boolean {\n        return state.files.length > 0;\n    }\n\n    hasTextFiles(state: WorkCenterState): boolean {\n        return state.files.some(f =>\n            f.type.startsWith('text/') ||\n            f.type === 'application/markdown' ||\n            f.name?.endsWith('.md') ||\n            f.name?.endsWith('.txt')\n        );\n    }\n\n    determineRecognizedFormat(state: WorkCenterState): 'markdown' | 'html' | 'text' | 'json' | 'xml' | 'other' {\n        const hasTextFile = this.hasTextFiles(state);\n        if (!hasTextFile) {\n            // For images and other files, default to markdown\n            return 'markdown';\n        } else {\n            // For text files, we could potentially detect format from content\n            // For now, default to markdown (can contain markdown)\n            return 'markdown';\n        }\n    }\n\n    validateFileForUpload(file: File): { valid: boolean; reason?: string } {\n        // Check file size (limit to 50MB)\n        const maxSize = 50 * 1024 * 1024;\n        if (file.size > maxSize) {\n            return { valid: false, reason: 'File too large (max 50MB)' };\n        }\n\n        // Check file type\n        const allowedTypes = [\n            'image/', 'text/', 'application/pdf', 'application/json',\n            'application/markdown', 'application/xml'\n        ];\n        const isAllowed = allowedTypes.some(type =>\n            file.type.startsWith(type) || file.name.toLowerCase().endsWith(type.replace('application/', '.'))\n        );\n\n        if (!isAllowed) {\n            return { valid: false, reason: 'File type not supported' };\n        }\n\n        return { valid: true };\n    }\n\n    // ============================================================================\n    // HASH-AWARE CONTENT HANDLING METHODS\n    // ============================================================================\n\n    private getCurrentHash(): string {\n        return typeof globalThis !== 'undefined' ? globalThis?.location?.hash : '';\n    }\n\n    private async handleTextContent(state: WorkCenterState, content: string, sourceType: string): Promise<void> {\n        const asset = await normalizeDataAsset(content, {\n            namePrefix: sourceType === 'html' ? 'shared-html' : 'shared-text',\n            mimeType: sourceType === 'html' ? 'text/html' : 'text/plain;charset=utf-8'\n        });\n        state.files.push(asset.file);\n        this.deps.showMessage?.('Text content added to work center');\n    }\n\n    private async handleUrlContent(state: WorkCenterState, content: string): Promise<void> {\n        const asset = await normalizeDataAsset(content, {\n            namePrefix: 'shared-url',\n            uriComponent: true\n        });\n        state.files.push(asset.file);\n        this.deps.showMessage?.('URL added to work center');\n    }\n\n    private async handleImageContent(state: WorkCenterState, content: string, sourceType: string): Promise<void> {\n        if (this.isBase64Data(content)) {\n            await this.handleBase64Content(state, content);\n        } else {\n            // Handle as regular image file\n            const asset = await normalizeDataAsset(content, {\n                namePrefix: 'shared-image',\n                mimeType: sourceType === 'image' ? 'image/png' : 'text/plain;charset=utf-8',\n                uriComponent: true\n            });\n            state.files.push(asset.file);\n            this.deps.showMessage?.('Image content added to work center');\n        }\n    }\n\n    private async handleDefaultPaste(state: WorkCenterState, content: string, sourceType: string): Promise<void> {\n        // Check if content is a URL\n        if (this.isValidUrl(content)) {\n            const asset = await normalizeDataAsset(content, {\n                namePrefix: 'pasted-url',\n                uriComponent: true\n            });\n            state.files.push(asset.file);\n            this.deps.showMessage?.('URL added to work center');\n        }\n        // Check if content is base64 encoded data\n        else if (this.isBase64Data(content)) {\n            await this.handleBase64Content(state, content);\n        }\n        // Regular text content\n        else {\n            const asset = await normalizeDataAsset(content, {\n                namePrefix: `pasted-${sourceType || 'text'}`,\n                mimeType: sourceType === 'html' ? 'text/html' : 'text/plain;charset=utf-8'\n            });\n            state.files.push(asset.file);\n            this.deps.showMessage?.(`${sourceType === 'html' ? 'HTML' : 'Text'} content added to work center`);\n        }\n    }\n\n    private isImageContent(content: string): boolean {\n        // Check if content looks like image data\n        return content.startsWith('data:image/') ||\n               /\\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(content);\n    }\n}","/**\n * App Communication Utility - DEPRECATED\n * This file is now deprecated in favor of the unified messaging system.\n * Use UnifiedMessaging instead for all new code.\n *\n * @deprecated Use UnifiedMessaging from './UnifiedMessaging' instead\n */\n\nimport { unifiedMessaging, type UnifiedMessage, type MessageHandler } from './UnifiedMessaging';\nimport { BROADCAST_CHANNELS } from '@rs-com/config/Names';\n\n// Re-export types for backward compatibility\nexport type { UnifiedMessage, MessageHandler };\n\n// Legacy interface for backward compatibility\nexport interface AppMessage {\n    type: string;\n    data: unknown;\n    metadata?: unknown;\n}\n\nexport interface AppCommunicatorOptions {\n    channelName: string;\n    availabilityCheckInterval?: number;\n    retryInterval?: number;\n    pingTimeout?: number;\n}\n\n/**\n * @deprecated Use UnifiedMessaging instead\n */\nclass AppCommunicator {\n    private destination: string;\n\n    constructor(options: AppCommunicatorOptions) {\n        this.destination = this.mapChannelToDestination(options.channelName);\n    }\n\n    private mapChannelToDestination(channelName: string): string {\n        const mapping: Record<string, string> = {\n            [BROADCAST_CHANNELS.WORK_CENTER]: 'workcenter',\n            [BROADCAST_CHANNELS.MARKDOWN_VIEWER]: 'markdown-viewer',\n            [BROADCAST_CHANNELS.SETTINGS]: 'settings',\n            [BROADCAST_CHANNELS.CLIPBOARD]: 'clipboard',\n            [BROADCAST_CHANNELS.PRINT_VIEWER]: 'print-viewer'\n        };\n        return mapping[channelName] ?? 'general';\n    }\n\n    /**\n     * @deprecated Use unifiedMessaging.sendMessage() instead\n     */\n    async sendMessage(\n        type: string,\n        data: unknown,\n        options: {\n            priority?: 'low' | 'normal' | 'high';\n            queueIfUnavailable?: boolean;\n            maxRetries?: number;\n        } = {}\n    ): Promise<boolean> {\n        console.warn('[AppCommunicator] Deprecated: Use unifiedMessaging.sendMessage() instead');\n\n        const message = {\n            type,\n            source: 'legacy-app-communicator',\n            destination: this.destination,\n            data,\n            metadata: {\n                priority: options.priority ?? 'normal',\n                maxRetries: options.maxRetries ?? 3,\n                legacy: true\n            }\n        };\n\n        return unifiedMessaging.sendMessage(message);\n    }\n\n    /**\n     * @deprecated Use unifiedMessaging.registerHandler() instead\n     */\n    respondToPing(pingId: string): void {\n        console.warn('[AppCommunicator] Deprecated: Ping/pong handled automatically by unified messaging');\n\n        unifiedMessaging.sendMessage({\n            type: 'pong',\n            source: this.destination,\n            destination: 'ping-requester',\n            data: { pingId },\n            metadata: { legacy: true }\n        });\n    }\n\n    /**\n     * @deprecated Cleanup handled automatically by unified messaging\n     */\n    destroy(): void {\n        console.warn('[AppCommunicator] Deprecated: Cleanup handled automatically by unified messaging');\n    }\n}\n\n// Predefined channel configurations for common app components\nexport const APP_CHANNELS = {\n    WORK_CENTER: BROADCAST_CHANNELS.WORK_CENTER,\n    MARKDOWN_VIEWER: BROADCAST_CHANNELS.MARKDOWN_VIEWER,\n    SETTINGS: BROADCAST_CHANNELS.SETTINGS,\n    GENERAL: BROADCAST_CHANNELS.GENERAL\n} as const;\n\n// Singleton instances for different channels\nconst communicators = new Map<string, AppCommunicator>();\n\n/**\n * @deprecated Use unifiedMessaging directly instead\n */\nexport function getAppCommunicator(\n    channelName: string = APP_CHANNELS.GENERAL,\n    options?: Partial<AppCommunicatorOptions>\n): AppCommunicator {\n    console.warn('[getAppCommunicator] Deprecated: Use unifiedMessaging directly instead');\n\n    const key = channelName;\n    if (!communicators.has(key)) {\n        communicators.set(key, new AppCommunicator({\n            channelName,\n            ...options\n        }));\n    }\n    return communicators.get(key)!;\n}\n\n/**\n * @deprecated Use unifiedMessaging.sendMessage() with destination 'workcenter' instead\n */\nexport function getWorkCenterComm(): AppCommunicator {\n    console.warn('[getWorkCenterComm] Deprecated: Use unifiedMessaging.sendMessage() with destination \"workcenter\" instead');\n    return getAppCommunicator(APP_CHANNELS.WORK_CENTER);\n}\n\n/**\n * @deprecated Use unifiedMessaging for markdown viewer messaging instead\n */\nexport function getMarkdownViewerComm(): AppCommunicator {\n    console.warn('[getMarkdownViewerComm] Deprecated: Use unifiedMessaging for markdown viewer messaging instead');\n    return getAppCommunicator(APP_CHANNELS.MARKDOWN_VIEWER, {\n        availabilityCheckInterval: 3000,\n        retryInterval: 15000\n    });\n}\n\n/**\n * @deprecated Use unifiedMessaging for settings messaging instead\n */\nexport function getSettingsComm(): AppCommunicator {\n    console.warn('[getSettingsComm] Deprecated: Use unifiedMessaging for settings messaging instead');\n    return getAppCommunicator(APP_CHANNELS.SETTINGS, {\n        availabilityCheckInterval: 5000,\n        retryInterval: 60000\n    });\n}\n\nexport { AppCommunicator };\n\n// Export unified messaging functions for easy migration\nexport { unifiedMessaging };\n","import { getWorkCenterComm } from \"@rs-com/core/AppCommunicator\";\nimport { fetchCachedShareFiles } from \"@rs-com/core/ShareTargetGateway\";\nimport { normalizeDataAsset } from \"fest/lure\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterFileOps } from \"./WorkCenterFileOps\";\n\nexport class WorkCenterShareTarget {\n    private deps: WorkCenterDependencies;\n    private _fileOps: WorkCenterFileOps;\n    private workCenterComm = getWorkCenterComm();\n\n    constructor(dependencies: WorkCenterDependencies, fileOps: WorkCenterFileOps) {\n        this.deps = dependencies;\n        this._fileOps = fileOps;\n        // Keep a stable constructor contract while migration is in progress.\n        void this._fileOps;\n    }\n\n    initShareTargetListener(_state: WorkCenterState): void {\n        // The WorkCenterCommunicator handles the BroadcastChannel setup\n        // We just need to set up our message processing\n        console.log('[WorkCenter] Share target result listener initialized via WorkCenterComm');\n    }\n\n    async processQueuedMessages(_state: WorkCenterState): Promise<void> {\n        try {\n            // The WorkCenterCommunicator will automatically process queued messages\n            // when it detects the work center is available\n            console.log('[WorkCenter] Queued message processing handled by WorkCenterComm');\n        } catch (error) {\n            console.error('[WorkCenter] Failed to process queued messages:', error);\n        }\n    }\n\n    handleShareTargetMessage(state: WorkCenterState, event: MessageEvent): void {\n        const { type, data, pingId } = event.data || {};\n\n        if (type === 'ping' && pingId) {\n            // Respond to ping to indicate work center is available\n            this.workCenterComm.respondToPing(pingId);\n        } else if (type === 'share-target-result' && data) {\n            console.log('[WorkCenter] Received share target result:', data);\n            this.addShareTargetResult(state, data);\n        } else if (type === 'share-target-input' && data) {\n            console.log('[WorkCenter] Received share target input:', data);\n            this.addShareTargetInput(state, data);\n        } else if (type === 'ai-result' && data) {\n            console.log('[WorkCenter] Received AI processing result:', data);\n            this.handleAIResult(state, data);\n        } else if (type === 'content-cached' && data) {\n            console.log('[WorkCenter] Received cached content from SW:', data);\n            this.handleCachedContent(state, data);\n        } else if (type === 'content-received' && data) {\n            console.log('[WorkCenter] Received content from SW:', data);\n            this.handleReceivedContent(state, data);\n        }\n    }\n\n    async addShareTargetResult(state: WorkCenterState, resultData: any): Promise<void> {\n        // Add to processedData pipeline\n        const processedEntry = {\n            content: resultData.content || '',\n            timestamp: resultData.timestamp || Date.now(),\n            action: resultData.action || 'Share Target Processing',\n            sourceData: resultData.rawData,\n            metadata: {\n                source: resultData.source || 'share-target',\n                ...resultData.metadata\n            }\n        };\n\n        // Import the state manager function\n        const { WorkCenterStateManager } = await import('./WorkCenterState');\n        WorkCenterStateManager.addProcessedStep(state, processedEntry);\n\n        // Also set lastRawResult so output area can render/copy/view it.\n        state.lastRawResult = resultData.rawData ?? resultData.content ?? null;\n\n        // Save state\n        WorkCenterStateManager.saveState(state);\n\n        // Show notification\n        this.deps.showMessage?.(`Share target result added to work center`);\n\n        // Re-render to update output + pipeline\n        this.deps.render?.();\n    }\n\n    async addShareTargetInput(state: WorkCenterState, inputData: any): Promise<void> {\n        console.log('[WorkCenter] Adding share target input:', inputData);\n\n        try {\n            let filesAdded = 0;\n            let textAdded = false;\n\n            // Handle files/images from share target\n            if (inputData.files && Array.isArray(inputData.files)) {\n                for (const file of inputData.files) {\n                    if (file instanceof File) {\n                        state.files.push(file);\n                        filesAdded++;\n                    }\n                }\n            }\n\n            // Handle text content\n            if (inputData.text && typeof inputData.text === 'string' && inputData.text.trim()) {\n                // Create a text file from the shared text\n                const textBlob = new Blob([inputData.text], { type: 'text/plain' });\n                const textFile = new File([textBlob], 'shared-text.txt', { type: 'text/plain' });\n                state.files.push(textFile);\n                filesAdded++;\n                textAdded = true;\n            }\n\n            // Handle URLs\n            if (inputData.url && typeof inputData.url === 'string') {\n                // Create a text file containing the URL\n                const urlBlob = new Blob([inputData.url], { type: 'text/plain' });\n                const urlFile = new File([urlBlob], 'shared-url.txt', { type: 'text/plain' });\n                state.files.push(urlFile);\n                filesAdded++;\n            }\n\n            // Handle base64 encoded data\n            if (inputData.base64Data && typeof inputData.base64Data === 'string') {\n                try {\n                    const asset = await normalizeDataAsset(inputData.base64Data, {\n                        namePrefix: \"shared\",\n                        uriComponent: true\n                    });\n                    state.files.push(asset.file);\n                    filesAdded++;\n                } catch (error) {\n                    console.warn('[WorkCenter] Failed to decode base64 data:', error);\n                }\n            }\n\n            // Clear recognized data when new inputs are added\n            const { WorkCenterStateManager: StateManager } = await import('./WorkCenterState');\n            StateManager.clearRecognizedData(state);\n\n            // Save state\n            StateManager.saveState(state);\n\n            // Notify about file changes for toolbar updates\n            if (filesAdded > 0 || textAdded) {\n                this.deps.onFilesChanged?.();\n            }\n\n            // Show notification\n            let message = '';\n            if (filesAdded > 0) {\n                message += `${filesAdded} file(s) added to work center`;\n            }\n            if (textAdded) {\n                message += (message ? ' and ' : '') + 'text content added';\n            }\n            if (message) {\n                this.deps.showMessage?.(message);\n            }\n\n            // Re-render so attachment list/count reflects new inputs.\n            if (filesAdded > 0 || textAdded) {\n                this.deps.render?.();\n            }\n\n        } catch (error) {\n            console.error('[WorkCenter] Failed to add share target input:', error);\n            this.deps.showMessage?.('Failed to add share target input');\n        }\n    }\n\n    sendShareTargetResult(resultData: any): void {\n        try {\n            this.workCenterComm.sendMessage('share-target-result', resultData, { priority: 'high' });\n        } catch (error) {\n            console.error('[WorkCenter] Failed to send share target result:', error);\n        }\n    }\n\n    sendShareTargetInput(inputData: any): void {\n        try {\n            this.workCenterComm.sendMessage('share-target-input', inputData, { priority: 'high' });\n        } catch (error) {\n            console.error('[WorkCenter] Failed to send share target input:', error);\n        }\n    }\n\n    private async handleCachedContent(state: WorkCenterState, data: any): Promise<void> {\n        const { cacheKey, context, content } = data;\n\n        if (context === 'share-target' && content) {\n            console.log('[WorkCenter] Processing cached share-target content:', content);\n\n            // Add the content to work center\n            await this.addShareTargetInput(state, content);\n\n            // Try to retrieve additional cached files if any\n            await this.retrieveCachedFiles(state, cacheKey);\n        }\n    }\n\n    private async handleReceivedContent(state: WorkCenterState, data: any): Promise<void> {\n        const { content, context } = data;\n\n        if (context === 'share-target' && content) {\n            console.log('[WorkCenter] Processing received share-target content:', content);\n\n            // Add the content to work center\n            await this.addShareTargetInput(state, content);\n        }\n    }\n\n    async handleAIResult(state: WorkCenterState, resultData: any): Promise<void> {\n        const { success, data, error } = resultData;\n\n        if (!success) {\n            console.warn('[WorkCenter] AI processing failed:', error);\n            this.deps.showMessage?.('AI processing failed: ' + (error || 'Unknown error'));\n            return;\n        }\n\n        if (!data) {\n            console.warn('[WorkCenter] No data in AI result');\n            return;\n        }\n\n        console.log('[WorkCenter] Adding AI processing result to work center');\n\n        try {\n            // Add to processedData pipeline as an AI processing result\n            const processedEntry = {\n                content: typeof data === 'string' ? data : JSON.stringify(data, null, 2),\n                timestamp: Date.now(),\n                action: 'AI Processing (Share Target)',\n                sourceData: { aiResult: data, source: 'share-target' },\n                metadata: {\n                    source: 'share-target-ai',\n                    processingType: 'ai',\n                    resultType: typeof data\n                }\n            };\n\n            // Import the state manager function\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.addProcessedStep(state, processedEntry);\n\n            // Set last result for output actions\n            state.lastRawResult = data;\n\n            // Save state\n            WorkCenterStateManager.saveState(state);\n\n            // Re-render to show output/pipeline updates\n            this.deps.render?.();\n\n            // Show notification\n            this.deps.showMessage?.('AI processing result added to work center');\n\n            // Trigger UI update if needed\n            if (this.deps.render) {\n                this.deps.render();\n            }\n\n        } catch (error) {\n            console.error('[WorkCenter] Failed to add AI result:', error);\n            this.deps.showMessage?.('Failed to add AI processing result');\n        }\n    }\n\n    private async retrieveCachedFiles(state: WorkCenterState, cacheKey: string): Promise<void> {\n        try {\n            const files = await fetchCachedShareFiles(cacheKey || \"latest\");\n            if (files.length > 0) {\n                for (const file of files) {\n                    console.log(\"[WorkCenter] Adding cached file:\", file.name);\n                    state.files.push(file);\n                }\n                this.deps.onFilesChanged?.();\n                this.deps.showMessage?.(`Added ${files.length} cached file(s) from share-target`);\n            }\n        } catch (error) {\n            console.warn('[WorkCenter] Failed to retrieve cached files:', error);\n        }\n    }\n}","import { H } from \"fest/lure\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport {\n    getCustomInstructions,\n    getInstructionRegistry,\n    setActiveInstruction,\n    DEFAULT_INSTRUCTION_TEMPLATES,\n    buildInstructionPrompt\n} from \"@rs-com/service/misc/CustomInstructions\";\nimport type { CustomInstruction } from \"@rs-com/config/SettingsTypes\";\n\nexport class WorkCenterTemplates {\n    private deps: WorkCenterDependencies;\n\n    /** Cached custom instructions from settings */\n    private cachedInstructions: CustomInstruction[] = [];\n    private cachedActiveInstructionId = \"\";\n\n    constructor(dependencies: WorkCenterDependencies) {\n        this.deps = dependencies;\n    }\n\n    // \n    // Custom Instructions (from settings)\n    // \n\n    /** Load custom instructions from app settings */\n    async loadInstructions(): Promise<CustomInstruction[]> {\n        try {\n            const snapshot = await getInstructionRegistry();\n            this.cachedInstructions = snapshot.instructions;\n            this.cachedActiveInstructionId = snapshot.activeId;\n            return this.cachedInstructions;\n        } catch (e) {\n            console.warn(\"[WorkCenterTemplates] Failed to load custom instructions:\", e);\n            return [];\n        }\n    }\n\n    /** Get cached instructions (sync, call loadInstructions first) */\n    getInstructions(): CustomInstruction[] {\n        return this.cachedInstructions;\n    }\n\n    /** Get cached active instruction id from settings */\n    getActiveInstructionId(): string {\n        return this.cachedActiveInstructionId;\n    }\n\n    /** Get the currently active instruction from settings */\n    async getActiveInstruction(): Promise<CustomInstruction | null> {\n        if (this.cachedActiveInstructionId) {\n            const cached = this.getInstructionById(this.cachedActiveInstructionId);\n            if (cached) return cached;\n        }\n        const snapshot = await getInstructionRegistry();\n        this.cachedInstructions = snapshot.instructions;\n        this.cachedActiveInstructionId = snapshot.activeId;\n        return snapshot.activeInstruction;\n    }\n\n    /** Set a specific instruction as active in settings */\n    async setActiveInstruction(id: string | null): Promise<void> {\n        await setActiveInstruction(id);\n        this.cachedActiveInstructionId = id || \"\";\n    }\n\n    /** Build a combined prompt with the selected custom instruction */\n    buildPromptWithInstruction(basePrompt: string, instruction: CustomInstruction | null): string {\n        if (!instruction?.instruction) return basePrompt;\n        return buildInstructionPrompt(basePrompt, instruction.instruction);\n    }\n\n    /** Get a specific instruction by ID */\n    getInstructionById(id: string): CustomInstruction | undefined {\n        return this.cachedInstructions.find(i => i.id === id);\n    }\n\n    /** Resolve selected instruction, fallback to active settings instruction */\n    resolveInstruction(selectedId: string): CustomInstruction | null {\n        if (selectedId) {\n            const selected = this.getInstructionById(selectedId);\n            if (selected) return selected;\n        }\n        if (!this.cachedActiveInstructionId) return null;\n        return this.getInstructionById(this.cachedActiveInstructionId) || null;\n    }\n\n    /** Get default instruction templates (for seeding) */\n    getDefaultTemplates(): Omit<CustomInstruction, \"id\">[] {\n        return DEFAULT_INSTRUCTION_TEMPLATES;\n    }\n\n    renderInstructionPanel(state: WorkCenterState): string {\n        return `\n            <div class=\"instruction-panel\">\n              <div class=\"instruction-selector-row wide\">\n                <label class=\"instruction-label\">\n                  <ui-icon icon=\"clipboard-text\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                  <span>Instruction:</span>\n                </label>\n                <select class=\"instruction-select\" data-action=\"select-instruction\">\n                  <option value=\"\">None (default)</option>\n                </select>\n                <button class=\"btn btn-icon btn-sm\" data-action=\"refresh-instructions\" title=\"Refresh from Settings\">\n                  <ui-icon icon=\"arrows-clockwise\" size=\"14\" icon-style=\"duotone\"></ui-icon>\n                </button>\n              </div>\n              <div class=\"instruction-help\">\n                Active instruction from Settings is appended to your prompt.\n              </div>\n            </div>\n        `;\n    }\n\n    // \n    // Prompt Templates (WorkCenter-local)\n    // \n\n    showTemplateEditor(state: WorkCenterState, container: HTMLElement): void {\n        const modal = H`<div class=\"template-editor-modal\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n            <h3>Prompt Templates</h3>\n            <p class=\"modal-desc\">Manage prompt templates used in Work Center. These define what action to perform on the content.</p>\n        </div>\n        ${this.renderInstructionPanel(state)}\n        <div class=\"template-list\">\n          ${state.promptTemplates.map((template, index) =>\n            H`<div class=\"template-item\" data-index=\"${index}\">\n              <div class=\"template-item-header\">\n                <input type=\"text\" class=\"template-name\" value=\"${template.name}\" data-index=\"${index}\" placeholder=\"Template name...\">\n                <button class=\"btn small btn-danger remove-template\" data-index=\"${index}\" title=\"Remove template\">\n                  <ui-icon icon=\"trash\" size=\"14\"></ui-icon>\n                </button>\n              </div>\n              <textarea class=\"template-prompt\" data-index=\"${index}\" rows=\"3\" placeholder=\"Enter prompt template...\">${template.prompt}</textarea>\n            </div>`\n        )}\n        </div>\n        <div class=\"modal-actions\">\n          <div class=\"modal-actions-group modal-actions-group-start\">\n            <button class=\"btn\" data-action=\"add-template\">\n              <ui-icon icon=\"plus\" size=\"14\"></ui-icon>\n              <span>Add Template</span>\n            </button>\n            <button class=\"btn\" data-action=\"import-instructions\" title=\"Import from Custom Instructions (Settings)\">\n              <ui-icon icon=\"download\" size=\"14\"></ui-icon>\n              <span>Import from Settings</span>\n            </button>\n          </div>\n          <div class=\"modal-actions-group modal-actions-group-end\">\n            <button class=\"btn primary\" data-action=\"save-templates\">Save</button>\n            <button class=\"btn\" data-action=\"close-editor\">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>` as HTMLElement;\n\n        // Template editor events\n        modal.addEventListener('click', async (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.closest(\"[data-action]\")?.getAttribute(\"data-action\");\n            const index = target.closest(\"[data-index]\")?.getAttribute(\"data-index\");\n\n            if (action === 'add-template') {\n                this.addTemplate(state);\n                modal.remove();\n                this.showTemplateEditor(state, container);\n            } else if (action === 'save-templates') {\n                await this.saveTemplates(state, modal);\n                modal.remove();\n                this.deps.render?.();\n            } else if (action === 'close-editor') {\n                modal.remove();\n            } else if (action === 'import-instructions') {\n                await this.importFromCustomInstructions(state);\n                modal.remove();\n                this.showTemplateEditor(state, container);\n            } else if (target.classList.contains('remove-template') && index) {\n                this.removeTemplate(state, parseInt(index));\n                modal.remove();\n                this.showTemplateEditor(state, container);\n            }\n        });\n\n        // Close on backdrop click\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) modal.remove();\n        });\n\n        container.append(modal);\n    }\n\n    private addTemplate(state: WorkCenterState): void {\n        state.promptTemplates.push({ name: 'New Template', prompt: 'Enter your prompt here...' });\n    }\n\n    private removeTemplate(state: WorkCenterState, index: number): void {\n        if (index >= 0 && index < state.promptTemplates.length) {\n            state.promptTemplates.splice(index, 1);\n        }\n    }\n\n    private async saveTemplates(state: WorkCenterState, modal: HTMLElement): Promise<void> {\n        // Update templates from inputs\n        const nameInputs = modal.querySelectorAll('.template-name');\n        const promptInputs = modal.querySelectorAll('.template-prompt');\n\n        state.promptTemplates = Array.from(nameInputs).map((input, i) => ({\n            name: (input as HTMLInputElement).value,\n            prompt: (promptInputs[i] as HTMLTextAreaElement).value\n        }));\n\n        // Save to localStorage\n        const { WorkCenterStateManager } = await import('./WorkCenterState');\n        WorkCenterStateManager.savePromptTemplates(state.promptTemplates);\n\n        this.deps.showMessage?.('Templates saved');\n    }\n\n    /**\n     * Import custom instructions from app settings as prompt templates.\n     * Maps each CustomInstruction into the WorkCenter template format.\n     */\n    private async importFromCustomInstructions(state: WorkCenterState): Promise<void> {\n        try {\n            const instructions = await getCustomInstructions();\n            if (!instructions.length) {\n                this.deps.showMessage?.('No custom instructions found in Settings');\n                return;\n            }\n\n            const existingNames = new Set(state.promptTemplates.map(t => t.name));\n            let added = 0;\n\n            for (const instr of instructions) {\n                if (!existingNames.has(instr.label)) {\n                    state.promptTemplates.push({\n                        name: instr.label,\n                        prompt: instr.instruction\n                    });\n                    added++;\n                }\n            }\n\n            // Persist\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.savePromptTemplates(state.promptTemplates);\n\n            if (added > 0) {\n                this.deps.showMessage?.(`Imported ${added} instruction${added > 1 ? 's' : ''} as templates`);\n            } else {\n                this.deps.showMessage?.('All instructions already exist as templates');\n            }\n        } catch (e) {\n            console.warn(\"[WorkCenterTemplates] Failed to import instructions:\", e);\n            this.deps.showMessage?.('Failed to import instructions');\n        }\n    }\n\n    selectTemplate(state: WorkCenterState, prompt: string): void {\n        state.selectedTemplate = prompt;\n        // Always apply the selected template - templates provide structured prompts\n        // Users can modify them after selection if needed\n        if (prompt) {\n            state.currentPrompt = prompt;\n        }\n    }\n\n    getTemplateByPrompt(state: WorkCenterState, prompt: string): { name: string, prompt: string } | undefined {\n        return state.promptTemplates.find(t => t.prompt === prompt);\n    }\n\n    hasTemplate(state: WorkCenterState, prompt: string): boolean {\n        return state.promptTemplates.some(t => t.prompt === prompt);\n    }\n}\n","import type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\n\nexport class WorkCenterVoice {\n    private deps: WorkCenterDependencies;\n    private voiceTimeout: number | null = null;\n\n    constructor(dependencies: WorkCenterDependencies) {\n        this.deps = dependencies;\n    }\n\n    async startVoiceRecording(state: WorkCenterState): Promise<void> {\n        if (state.voiceRecording) return;\n\n        state.voiceRecording = true;\n\n        try {\n            const prompt = await this.deps.getSpeechPrompt();\n            if (prompt) {\n                state.currentPrompt = prompt;\n            }\n        } catch (e) {\n            console.warn('Voice recording failed:', e);\n            this.deps.showMessage?.('Voice recording failed');\n        } finally {\n            state.voiceRecording = false;\n        }\n    }\n\n    stopVoiceRecording(state: WorkCenterState): void {\n        state.voiceRecording = false;\n        if (this.voiceTimeout) {\n            globalThis?.clearTimeout?.(this.voiceTimeout);\n            this.voiceTimeout = null;\n        }\n    }\n\n    isRecording(state: WorkCenterState): boolean {\n        return state.voiceRecording;\n    }\n\n    setVoiceTimeout(callback: () => void, delay: number = 30000): void {\n        // Clear existing timeout\n        if (this.voiceTimeout) {\n            globalThis?.clearTimeout?.(this.voiceTimeout);\n        }\n\n        // Set new timeout (30 seconds default)\n        this.voiceTimeout = globalThis?.setTimeout?.(() => {\n            callback();\n            this.voiceTimeout = null;\n        }, delay) as any;\n    }\n\n    clearVoiceTimeout(): void {\n        if (this.voiceTimeout) {\n            globalThis?.clearTimeout?.(this.voiceTimeout);\n            this.voiceTimeout = null;\n        }\n    }\n}","import { executionCore } from \"@rs-com/service/misc/ExecutionCore\";\nimport type { ActionContext, ActionInput } from \"@rs-com/service/misc/ActionHistory\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterUI } from \"./WorkCenterUI\";\nimport type { WorkCenterFileOps } from \"./WorkCenterFileOps\";\nimport type { WorkCenterResults } from \"./WorkCenterResults\";\nimport type { WorkCenterDataProcessing } from \"./WorkCenterDataProcessing\";\nimport type { WorkCenterHistory } from \"./WorkCenterHistory\";\nimport type { WorkCenterTemplates } from \"./WorkCenterTemplates\";\nimport { extractJSONFromAIResponse } from \"@rs-core/document/AIResponseParser\";\n\nexport class WorkCenterActions {\n    private deps: WorkCenterDependencies;\n    private ui: WorkCenterUI;\n    private fileOps: WorkCenterFileOps;\n    private dataProcessing: WorkCenterDataProcessing;\n    private results: WorkCenterResults;\n    private history: WorkCenterHistory;\n    private templates: WorkCenterTemplates;\n\n    constructor(\n        dependencies: WorkCenterDependencies,\n        ui: WorkCenterUI,\n        fileOps: WorkCenterFileOps,\n        dataProcessing: WorkCenterDataProcessing,\n        results: WorkCenterResults,\n        history: WorkCenterHistory,\n        templates?: WorkCenterTemplates\n    ) {\n        this.deps = dependencies;\n        this.ui = ui;\n        this.fileOps = fileOps;\n        this.dataProcessing = dataProcessing;\n        this.results = results;\n        this.history = history;\n        this.templates = templates!;\n    }\n\n    async executeUnifiedAction(state: WorkCenterState): Promise<void> {\n        if (this.fileOps.getFilesForProcessing(state).length === 0 && !state.currentPrompt.trim() && !state.recognizedData) {\n            this.deps.showMessage('Please select files or enter a prompt first');\n            return;\n        }\n\n        let processingMessage = 'Processing...';\n\n        // Show what's being processed\n        if (state.recognizedData) {\n            processingMessage = `Processing ${state.recognizedData.source} content...`;\n        } else if (this.fileOps.hasFiles(state)) {\n            processingMessage = `Processing ${state.files.length} file${state.files.length > 1 ? 's' : ''}...`;\n        }\n\n        this.results.showProcessingMessage(processingMessage);\n\n        try {\n            // Prepare input for execution core\n            let basePrompt = state.currentPrompt.trim() ||\n                (state.autoAction ? this.getLastSuccessfulPrompt() : \"Analyze and process the provided content intelligently\");\n\n            // Apply selected or active custom instruction from settings (if any)\n            if (this.templates) {\n                let instruction = this.templates.resolveInstruction(state.selectedInstruction);\n                if (!instruction && !state.selectedInstruction) {\n                    instruction = await this.templates.getActiveInstruction();\n                }\n                if (instruction?.instruction) {\n                    if (!state.selectedInstruction) {\n                        state.selectedInstruction = instruction.id;\n                    }\n                    basePrompt = this.templates.buildPromptWithInstruction(basePrompt, instruction);\n                }\n            }\n\n            const actionInput: ActionInput = {\n                type: state.recognizedData ? 'text' : (this.fileOps.hasFiles(state) ? 'files' : 'text'),\n                files: this.fileOps.hasFiles(state) ? [...state.files] : undefined,\n                text: basePrompt,\n                recognizedData: state.recognizedData || undefined,\n                // Keep legacy field for backward compatibility\n                recognizedContent: state.recognizedData?.content || undefined\n            };\n\n            // Handle special templates that need dynamic language processing\n            const isTranslateTemplate = state.selectedTemplate &&\n                state.selectedTemplate.includes(\"Translate the following content to the selected language\");\n\n            if (isTranslateTemplate && state.selectedLanguage !== 'auto') {\n                // For \"Translate to Language\" template, replace the generic instruction with specific language\n                const targetLanguage = state.selectedLanguage === 'ru' ? 'Russian' : 'English';\n                actionInput.text = `Translate the following content to ${targetLanguage}. Maintain the original formatting and structure where possible. If the content is already in ${targetLanguage}, provide a natural rephrasing or improvement instead.`;\n            } else {\n                // Add language instruction if specific language selected (for other operations)\n                if (state.selectedLanguage !== 'auto') {\n                    const languageInstruction = state.selectedLanguage === 'ru'\n                        ? \"Please respond in Russian language.\"\n                        : \"Please respond in English language.\";\n                    actionInput.text = `${languageInstruction} ${actionInput.text}`;\n                }\n            }\n\n            // Execute through execution core\n            const context: ActionContext = {\n                source: 'workcenter',\n                sessionId: this.generateSessionId()\n            };\n\n            // Determine action based on content type and state\n            let forceAction: string | undefined;\n\n            // If user has provided a specific prompt/template instruction, use it directly\n            // Don't force a generic action that would override the user's instruction\n            const hasUserInstruction = state.currentPrompt.trim() && state.currentPrompt.trim() !== \"Analyze and process the provided content intelligently\";\n\n            if (hasUserInstruction) {\n                // User has provided their own instruction - let the system determine the best action type\n                // based on available data, but use the user's instruction\n                forceAction = undefined; // Let the system auto-determine based on input type\n            } else if (state.recognizedData) {\n                // We have recognized data but no specific user instruction - do additional processing\n                forceAction = 'analyze';\n            } else if (this.fileOps.hasFiles(state)) {\n                // We have files but no recognized data - do initial recognition\n                const hasTextFiles = this.fileOps.hasTextFiles(state);\n\n                if (hasTextFiles) {\n                    // Text files can be processed as source data\n                    forceAction = 'source';\n                } else {\n                    // Binary files need recognition\n                    forceAction = 'recognize';\n                }\n            } else {\n                // No files, no recognized data, no user instruction - general analysis\n                forceAction = 'analyze';\n            }\n\n            const result = await executionCore.execute(actionInput, context, {\n                forceAction,\n                recognitionFormat: state.recognitionFormat,\n                processingFormat: state.processingFormat\n            });\n\n            // Save state\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(state);\n\n            // Store raw result for copying\n            state.lastRawResult = result.rawData;\n\n            // Format and display result\n            const formattedResult = this.dataProcessing.formatResult(result.rawData || result, state.outputFormat);\n            const outputContent = this.ui.getContainer()?.querySelector('[data-output]') as HTMLElement | null;\n            if (outputContent) {\n                outputContent.innerHTML = `<div class=\"result-content\">${formattedResult}</div>`;\n            }\n\n            // Update recognized data if files were processed (initial recognition or source data)\n            if (this.fileOps.hasFiles(state) && result.rawData?.ok && !state.recognizedData) {\n                const isTextFile = this.fileOps.hasTextFiles(state);\n\n                state.recognizedData = {\n                    content: result.content,\n                    timestamp: Date.now(),\n                    source: isTextFile ? 'text' : 'files',\n                    recognizedAs: this.fileOps.determineRecognizedFormat(state),\n                    metadata: {\n                        fileCount: state.files.length\n                    },\n                    responseId: result.responseId || \"unknown\"\n                };\n                this.results.updateDataPipeline(state);\n                this.ui.updateDataCounters(state);\n\n                // Auto-process with selected template if available\n                if (state.selectedTemplate && state.selectedTemplate.trim()) {\n                    console.log('[WorkCenter] Auto-processing with template:', state.selectedTemplate);\n                    // Small delay to allow UI to update\n                    setTimeout(async () => {\n                        await this.executeUnifiedAction(state);\n                    }, 100);\n                }\n            }\n            // Add to processing chain if we have recognized data (additional processing)\n            else if (state.recognizedData && result.rawData?.ok) {\n                const processedEntry = {\n                    content: result.content,\n                    timestamp: Date.now(),\n                    action: state.currentPrompt.trim() || 'additional processing',\n                    sourceData: state.recognizedData,\n                    metadata: { step: state.currentProcessingStep + 1 }\n                };\n\n                const { WorkCenterStateManager: StateManager } = await import('./WorkCenterState');\n                StateManager.addProcessedStep(state, processedEntry);\n            }\n\n        } catch (error) {\n            const errorMsg = error instanceof Error ? error.message : String(error);\n            this.results.showError(errorMsg);\n        }\n\n        this.history.updateRecentHistory(state);\n        this.ui.updateDataPipeline(state);\n        this.ui.updateDataCounters(state);\n    }\n\n    private getLastSuccessfulPrompt(): string {\n        return this.history.getLastSuccessfulPrompt();\n    }\n\n    private generateSessionId(): string {\n        return `wc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    async copyResults(state: WorkCenterState): Promise<void> {\n        if (!state.lastRawResult) return;\n\n        try {\n            await this.dataProcessing.copyResultsToClipboard(state.lastRawResult, state.outputFormat);\n            this.deps.showMessage('Results copied to clipboard');\n        } catch (error) {\n            console.error('Failed to copy results:', error);\n            this.deps.showMessage('Failed to copy results');\n        }\n    }\n\n    async viewResultsInViewer(state: WorkCenterState): Promise<void> {\n        if (!state.lastRawResult) {\n            this.deps.showMessage('No results to view');\n            return;\n        }\n\n        try {\n            const { unifiedMessaging } = await import('@rs-com/core/UnifiedMessaging');\n\n            let resultContent = typeof state.lastRawResult === 'string'\n                ? state.lastRawResult\n                : JSON.stringify(state.lastRawResult, null, 2);\n\n            try {\n                resultContent = JSON.parse(resultContent)?.data || resultContent;\n            } catch (error) {\n            }\n\n            await unifiedMessaging.sendMessage({\n                id: crypto.randomUUID(),\n                type: 'content-view',\n                source: 'workcenter',\n                destination: 'viewer',\n                contentType: state.outputFormat === 'markdown' ? 'markdown' : 'text',\n                data: {\n                    text: resultContent,\n                    filename: `workcenter-output-${Date.now()}.${state.outputFormat === 'markdown' ? 'md' : (state.outputFormat === 'json' ? 'json' : (state.outputFormat === 'html' ? 'html' : (state.outputFormat === 'code' ? 'ts' : 'txt')))}`\n                },\n                metadata: {\n                    title: 'Work Center Output',\n                    timestamp: Date.now(),\n                    source: 'workcenter',\n                    format: state.outputFormat\n                }\n            } as any);\n        } catch (error) {\n            console.error('Failed to open output in viewer:', error);\n            this.deps.showMessage('Failed to open output in viewer');\n        }\n    }\n\n    clearResults(state: WorkCenterState): void {\n        state.lastRawResult = null;\n        this.results.clearResults();\n    }\n\n    async saveResultsToExplorer(state: WorkCenterState): Promise<void> {\n        if (!state.lastRawResult) {\n            this.deps.showMessage('No results to save');\n            return;\n        }\n\n        try {\n            // Import the unified messaging system\n            const { unifiedMessaging } = await import('@rs-com/core/UnifiedMessaging');\n\n            // Create the content to save\n            const resultContent = typeof state.lastRawResult === 'string'\n                ? state.lastRawResult\n                : JSON.stringify(state.lastRawResult, null, 2);\n\n            // Send to explorer for saving\n            await unifiedMessaging.sendMessage({\n                id: crypto.randomUUID(),\n                type: 'content-save',\n                source: 'workcenter',\n                destination: 'explorer',\n                data: {\n                    action: 'save',\n                    text: resultContent,\n                    filename: `workcenter-result-${Date.now()}.${state.outputFormat === 'json' ? 'json' : (state.outputFormat === 'html' ? 'html' : (state.outputFormat === 'code' ? 'ts' : 'txt'))}`,\n                    path: '/workcenter-results/'\n                },\n                metadata: {\n                    title: 'Work Center Result',\n                    timestamp: Date.now(),\n                    source: 'workcenter',\n                    format: state.outputFormat\n                }\n            });\n\n            this.deps.showMessage('Results saved to Explorer');\n        } catch (error) {\n            console.error('Failed to save results to explorer:', error);\n            this.deps.showMessage('Failed to save results to Explorer');\n        }\n    }\n}","import { marked } from \"marked\";\nimport DOMPurify from \"isomorphic-dompurify\";\nimport { extractJSONFromAIResponse } from \"@rs-core/document/AIResponseParser\";\n\nexport class WorkCenterDataProcessing {\n    formatResult(result: any, format: string, outputFormat?: string): string {\n        // Handle auto format - detect the best rendering format based on content\n        if (format === 'auto') {\n            const rawData = result?.rawData || result;\n            let data = extractJSONFromAIResponse<any>(rawData)?.data || rawData;\n\n            // If data is a string that looks like JSON, parse it\n            if (typeof data === 'string') {\n                try {\n                    const parsed = JSON.parse(data);\n                    if (parsed && typeof parsed === 'object') {\n                        data = parsed;\n                    }\n                } catch {\n                    // Keep as string if not valid JSON\n                }\n            }\n\n            // Check if we have structured AI recognition data\n            if (data && typeof data === 'object' && (\n                data.recognized_data ||\n                data.verbose_data ||\n                data.keywords_and_tags ||\n                data.suggested_type\n            )) {\n                // For structured AI data, extract and render content directly as markdown\n                const content: string[] = [];\n\n                // Add recognized data (highest priority)\n                if (data.recognized_data) {\n                    const recognized = Array.isArray(data.recognized_data)\n                        ? data.recognized_data\n                        : [data.recognized_data];\n                    content.push(...recognized.map((item: any) => String(item)));\n                }\n\n                // Add verbose data\n                if (data.verbose_data) {\n                    content.push(String(data.verbose_data));\n                }\n\n                // Add keywords/tags if available\n                if (data.keywords_and_tags && Array.isArray(data.keywords_and_tags) && data.keywords_and_tags.length > 0) {\n                    content.push(`\\n**Keywords:** ${data.keywords_and_tags.join(', ')}`);\n                }\n\n                // Add confidence and type info\n                if (data.confidence || data.suggested_type) {\n                    const info: string[] = [];\n                    if (data.confidence) info.push(`Confidence: ${Math.round(data.confidence * 100)}%`);\n                    if (data.suggested_type) info.push(`Type: ${data.suggested_type}`);\n                    if (info.length > 0) {\n                        content.push(`\\n*${info.join('  ')}*`);\n                    }\n                }\n\n                // Render directly as HTML to preserve KaTeX markup\n                if (content.length > 0) {\n                    const htmlContent = content.join('\\n\\n');\n                    return `<div class=\"markdown-result structured-content\">${htmlContent}</div>`;\n                }\n            }\n\n            // For other structured data, use JSON format\n            if (data && typeof data === 'object') {\n                return this.formatResult(result, 'json');\n            }\n\n            // For plain text or simple content, use markdown\n            return this.formatResult(result, 'markdown');\n        }\n\n        // For JSON format, render the raw data directly to preserve structure\n        if (format === 'json') {\n            // Extract the raw data from the result\n            const rawData = result?.rawData || result;\n            let data = extractJSONFromAIResponse<any>(rawData)?.data || rawData;\n\n            // If data is a string that looks like JSON, parse it\n            if (typeof data === 'string') {\n                try {\n                    const parsed = JSON.parse(data);\n                    if (parsed && typeof parsed === 'object') {\n                        data = parsed;\n                    }\n                } catch {\n                    // Keep as string if not valid JSON\n                }\n            }\n\n            return this.renderAsJSON(data);\n        }\n\n        // Check if we have structured JSON data that should be rendered as markdown\n        if (format === 'markdown') {\n            const rawData = result?.rawData || result;\n            let data = extractJSONFromAIResponse<any>(rawData)?.data || rawData;\n\n            // If data is a string that looks like JSON, parse it\n            if (typeof data === 'string') {\n                try {\n                    const parsed = JSON.parse(data);\n                    if (parsed && typeof parsed === 'object') {\n                        data = parsed;\n                    }\n                } catch {\n                    // Keep as string if not valid JSON\n                }\n            }\n\n            // If we have structured recognition data, extract content for markdown rendering\n            if (data && typeof data === 'object' && (\n                data.recognized_data ||\n                data.verbose_data ||\n                data.keywords_and_tags ||\n                data.suggested_type\n            )) {\n                // Create markdown content from structured data\n                const content: string[] = [];\n\n                // Add recognized data (highest priority)\n                if (data.recognized_data) {\n                    const recognized = Array.isArray(data.recognized_data)\n                        ? data.recognized_data\n                        : [data.recognized_data];\n                    content.push(...recognized.map((item: any) => String(item)));\n                }\n\n                // Add verbose data\n                if (data.verbose_data) {\n                    content.push(String(data.verbose_data));\n                }\n\n                // Add keywords/tags if available\n                if (data.keywords_and_tags && Array.isArray(data.keywords_and_tags) && data.keywords_and_tags.length > 0) {\n                    content.push(`\\n**Keywords:** ${data.keywords_and_tags.join(', ')}`);\n                }\n\n                // Add confidence and type info\n                if (data.confidence || data.suggested_type) {\n                    const info: string[] = [];\n                    if (data.confidence) info.push(`Confidence: ${Math.round(data.confidence * 100)}%`);\n                    if (data.suggested_type) info.push(`Type: ${data.suggested_type}`);\n                    if (info.length > 0) {\n                        content.push(`\\n*${info.join('  ')}*`);\n                    }\n                }\n\n                // If we extracted content, render it directly as HTML to preserve KaTeX markup\n                if (content.length > 0) {\n                    const htmlContent = content.join('\\n\\n');\n                    // For structured data with HTML content, render directly without processing\n                    return `<div class=\"markdown-result structured-content\">${htmlContent}</div>`;\n                }\n            }\n        }\n\n        // For other formats or fallback, normalize and extract data first\n        const normalizedData = this.normalizeResultData(result);\n        if (!normalizedData) return '<div class=\"no-result\">No result</div>';\n\n        // Render based on format\n        switch (format) {\n            case 'code':\n                return this.renderAsCode(normalizedData);\n            case 'raw':\n                return this.renderAsRaw(result?.rawData || result);\n            case 'html':\n                return this.renderAsHTML(normalizedData);\n            case 'text':\n                return this.renderAsText(normalizedData);\n            case 'markdown':\n            default:\n                return this.renderAsMarkdown(normalizedData);\n        }\n    }\n\n    private normalizeResultData(result: any): any {\n        if (!result) return null;\n\n        // Extract data from AI response wrapper\n        let data = extractJSONFromAIResponse<any>(result)?.data || result;\n\n        // Handle nested data structures\n        if (data && typeof data === 'object') {\n            // If data has a 'data' property, use that\n            if (data.data !== undefined) {\n                data = data.data;\n            }\n\n            // If data is still an object, check for string content that needs parsing\n            if (typeof data === 'string') {\n                try {\n                    const parsed = JSON.parse(data);\n                    if (parsed && typeof parsed === 'object') {\n                        data = parsed;\n                    }\n                } catch {\n                    // Keep as string if not valid JSON\n                }\n            }\n        }\n\n        // Handle primitive values by wrapping them\n        if (typeof data !== 'object' || data === null) {\n            data = { recognized_data: [String(data)] };\n        }\n\n        return data;\n    }\n\n    private renderAsJSON(data: any): string {\n        try {\n            // Create a formatted JSON string, but handle HTML content specially\n            const createFormattedJSON = (obj: any, indent: number = 0): string => {\n                const spaces = '  '.repeat(indent);\n\n                if (obj === null) return 'null';\n                if (typeof obj === 'boolean') return obj ? 'true' : 'false';\n                if (typeof obj === 'number') return String(obj);\n                if (typeof obj === 'string') {\n                    // Check if string contains HTML/MathML content that should be rendered\n                    if (obj.includes('<math') || obj.includes('class=\"katex\"') || obj.includes('<span>')) {\n                        // This is HTML/MathML content - create a placeholder that will be replaced with actual HTML\n                        const placeholder = `__HTML_CONTENT_${Math.random().toString(36).substr(2, 9)}__`;\n                        (htmlPlaceholders as any)[placeholder] = obj;\n                        return `\"${placeholder}\"`;\n                    }\n                    // Regular string - escape it\n                    return JSON.stringify(obj);\n                }\n\n                if (Array.isArray(obj)) {\n                    if (obj.length === 0) return '[]';\n                    const items = obj.map(item => createFormattedJSON(item, indent + 1));\n                    return `[\\n${'  '.repeat(indent + 1)}${items.join(`,\\n${'  '.repeat(indent + 1)}`)}\\n${spaces}]`;\n                }\n\n                if (typeof obj === 'object') {\n                    const keys = Object.keys(obj);\n                    if (keys.length === 0) return '{}';\n                    const items = keys.map(key => {\n                        const formattedValue = createFormattedJSON(obj[key], indent + 1);\n                        return `${JSON.stringify(key)}: ${formattedValue}`;\n                    });\n                    return `{\\n${'  '.repeat(indent + 1)}${items.join(`,\\n${'  '.repeat(indent + 1)}`)}\\n${spaces}}`;\n                }\n\n                return String(obj);\n            };\n\n            // Store HTML content placeholders\n            const htmlPlaceholders: Record<string, string> = {};\n            const jsonString = createFormattedJSON(data);\n\n            // Replace placeholders with actual HTML content\n            let finalHTML = `<div class=\"json-result\"><pre>${jsonString}</pre></div>`;\n\n            // Replace placeholders with rendered HTML\n            for (const [placeholder, htmlContent] of Object.entries(htmlPlaceholders)) {\n                // Create a temporary div to hold the HTML content\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = htmlContent;\n                const renderedHTML = tempDiv.innerHTML;\n\n                // Replace the placeholder in the JSON string\n                finalHTML = finalHTML.replace(`\"${placeholder}\"`, `<span class=\"json-html-content\">${renderedHTML}</span>`);\n            }\n\n            return finalHTML;\n        } catch (error) {\n            return `<div class=\"error\">Failed to format JSON: ${error}</div>`;\n        }\n    }\n\n    private renderAsHTML(data: any): string {\n        const content = this.extractContentItems(data);\n        const renderedContent = content.map(item => this.renderContentItem(item, 'html')).join('');\n\n        if (!renderedContent) {\n            return `<div class=\"html-result\">${this.renderMathAsHTML(this.extractTextContent(data))}</div>`;\n        }\n\n        return `<div class=\"html-result\">${renderedContent}</div>`;\n    }\n\n    private renderAsText(data: any): string {\n        const content = this.extractContentItems(data);\n        const renderedContent = content.map(item => this.renderContentItem(item, 'text')).join('\\n\\n');\n\n        if (!renderedContent.trim()) {\n            return `<pre class=\"text-result\">${this.escapeHtml(this.extractTextContent(data))}</pre>`;\n        }\n\n        return `<pre class=\"text-result\">${this.escapeHtml(renderedContent)}</pre>`;\n    }\n\n    private renderAsRaw(data: any): string {\n        let rawText = '';\n        if (typeof data === 'string') {\n            rawText = data;\n        } else {\n            try {\n                rawText = JSON.stringify(data, null, 2);\n            } catch {\n                rawText = String(data ?? '');\n            }\n        }\n        return `<pre class=\"raw-result\">${this.escapeHtml(rawText)}</pre>`;\n    }\n\n    private renderAsCode(data: any): string {\n        const content = this.extractContentItems(data).join('\\n\\n').trim() || this.extractTextContent(data);\n        const code = this.extractLikelyCode(content);\n        const language = this.detectCodeLanguage(content);\n        return `<pre class=\"code-result\"><code data-lang=\"${this.escapeHtml(language)}\">${this.escapeHtml(code)}</code></pre>`;\n    }\n\n    private renderAsMarkdown(data: any): string {\n        const content = this.extractContentItems(data);\n        const renderedContent = content.map(item => this.renderContentItem(item, 'markdown')).join('\\n\\n');\n\n        if (!renderedContent.trim()) {\n            try {\n                const textContent = this.extractTextContent(data);\n                const html = marked.parse(textContent) as string;\n                return DOMPurify.sanitize(html);\n            } catch (error) {\n                console.warn('Markdown parsing failed, falling back to simple rendering:', error);\n                return this.renderMathAsHTML(renderedContent as string);\n            }\n        }\n\n        try {\n            const html = marked.parse(renderedContent) as string;\n            return DOMPurify.sanitize(html);\n        } catch (error) {\n            console.warn('Markdown parsing failed, falling back to simple rendering:', error);\n            return this.renderMathAsHTML(renderedContent as string);\n        }\n    }\n\n    private extractContentItems(data: any): string[] {\n        const items: string[] = [];\n\n        // Extract recognized data (highest priority)\n        if (data.recognized_data) {\n            const recognized = Array.isArray(data.recognized_data)\n                ? data.recognized_data\n                : [data.recognized_data];\n            items.push(...recognized.map((item: any) => String(item)));\n        }\n\n        // Extract verbose data\n        if (data.verbose_data) {\n            items.push(String(data.verbose_data));\n        }\n\n        // Extract other text fields if no recognized/verbose data\n        if (items.length === 0) {\n            const textFields = ['content', 'text', 'message', 'result', 'response', 'description'];\n            for (const field of textFields) {\n                if (data[field]) {\n                    const content = Array.isArray(data[field]) ? data[field] : [data[field]];\n                    items.push(...content.map((item: any) => String(item)));\n                    break; // Use first available field\n                }\n            }\n        }\n\n        // Fallback to raw text extraction\n        if (items.length === 0) {\n            const textContent = this.extractTextContent(data);\n            if (textContent) {\n                items.push(textContent);\n            }\n        }\n\n        return items;\n    }\n\n    private renderContentItem(item: string, format: 'html' | 'text' | 'markdown'): string {\n        switch (format) {\n            case 'html':\n                return `<div class=\"recognized-item\">${this.renderMathAsHTML(item)}</div>`;\n            case 'text':\n                return this.stripMarkdown(item);\n            case 'markdown':\n                return item; // Keep markdown as-is for processing\n            default:\n                return item;\n        }\n    }\n\n    private renderMathAsHTML(content: string): string {\n        // Unified math rendering for HTML output\n        let result = content;\n\n        // Handle display math $$...$$\n        result = result.replace(/\\$\\$([^$]+)\\$\\$/g, (match, math) => {\n            try {\n                const mathHtml = marked.parse(`$$${math}$$`) as string;\n                return mathHtml.replace(/<p>|<\\/p>/g, '').trim();\n            } catch {\n                return `<span class=\"math-display\">${this.escapeHtml(`$$${math}$$`)}</span>`;\n            }\n        });\n\n        // Handle inline math $...$\n        result = result.replace(/\\$([^$]+)\\$/g, (match, math) => {\n            try {\n                const mathHtml = marked.parse(`$${math}$`) as string;\n                return mathHtml.replace(/<p>|<\\/p>/g, '').trim();\n            } catch {\n                return `<span class=\"math-inline\">${this.escapeHtml(`$${math}$`)}</span>`;\n            }\n        });\n\n        // Handle line breaks\n        result = result.replace(/\\n/g, '<br>');\n\n        return result;\n    }\n\n    private stripMarkdown(content: string): string {\n        // Simple markdown stripping for text output\n        return content\n            .replace(/#{1,6}\\s*/g, '') // Headers\n            .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Bold\n            .replace(/\\*(.*?)\\*/g, '$1') // Italic\n            .replace(/`(.*?)`/g, '$1') // Code\n            .replace(/^\\s*[-*+]\\s+/gm, '') // Lists\n            .replace(/^\\s*\\d+\\.\\s+/gm, '') // Numbered lists\n            .replace(/\\[([^\\]]+)\\]\\([^\\)]+\\)/g, '$1') // Links\n            .replace(/!\\[([^\\]]+)\\]\\([^\\)]+\\)/g, '$1') // Images\n            .trim();\n    }\n\n    private extractLikelyCode(content: string): string {\n        const fenced = content.match(/```[\\t ]*([a-zA-Z0-9_-]+)?\\n([\\s\\S]*?)```/);\n        if (fenced?.[2]) {\n            return fenced[2].trim();\n        }\n        return content;\n    }\n\n    private detectCodeLanguage(content: string): string {\n        const fencedLanguage = content.match(/```[\\t ]*([a-zA-Z0-9_-]+)?\\n/)?.[1];\n        if (fencedLanguage) return fencedLanguage.toLowerCase();\n        if (/\\b(interface|type|const|let|=>|import\\s+type)\\b/.test(content)) return 'typescript';\n        if (/\\b(function|const|let|var|import|export)\\b/.test(content)) return 'javascript';\n        if (/\\b(def |import |from |class )/.test(content)) return 'python';\n        if (/\\b<[^>]+>/.test(content)) return 'html';\n        return 'text';\n    }\n\n    private extractTextContent(data: any): string {\n        // Handle null/undefined\n        if (data == null) return '';\n\n        // Handle strings directly\n        if (typeof data === 'string') return data;\n\n        // Handle numbers and booleans\n        if (typeof data === 'number' || typeof data === 'boolean') return String(data);\n\n        // Handle arrays\n        if (Array.isArray(data)) {\n            return data.map(item => this.extractTextContent(item)).join('\\n');\n        }\n\n        // Handle objects - try to find meaningful text fields\n        if (typeof data === 'object') {\n            // Use the same field priority as extractContentItems\n            const textFields = ['verbose_data', 'recognized_data', 'content', 'text', 'message', 'result', 'response', 'data'];\n\n            for (const field of textFields) {\n                if (data[field] != null) {\n                    const content = this.extractTextContent(data[field]);\n                    if (content) return content;\n                }\n            }\n\n            // If no meaningful text fields found, stringify as JSON\n            try {\n                return JSON.stringify(data, null, 2);\n            } catch {\n                return '[Complex Object]';\n            }\n        }\n\n        // Fallback\n        return String(data);\n    }\n\n    private escapeHtml(text: string): string {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    copyResultsToClipboard(result: any, format: string): Promise<void> {\n        let textToCopy = '';\n\n        // For Auto format, determine what content to copy based on detected type\n        if (format === 'auto' && result) {\n            const rawData = result?.rawData || result;\n            let data = extractJSONFromAIResponse<any>(rawData)?.data || rawData;\n\n            // If data is a string that looks like JSON, parse it\n            if (typeof data === 'string') {\n                try {\n                    const parsed = JSON.parse(data);\n                    if (parsed && typeof parsed === 'object') {\n                        data = parsed;\n                    }\n                } catch {\n                    // Keep as string if not valid JSON\n                }\n            }\n\n            // For structured AI data, copy the extracted content\n            if (data && typeof data === 'object' && (\n                data.recognized_data || data.verbose_data\n            )) {\n                const contentItems: string[] = [];\n\n                if (data.recognized_data) {\n                    const recognized = Array.isArray(data.recognized_data)\n                        ? data.recognized_data\n                        : [data.recognized_data];\n                    contentItems.push(...recognized.map((item: any) => String(item)));\n                }\n\n                if (data.verbose_data) {\n                    contentItems.push(String(data.verbose_data));\n                }\n\n                textToCopy = contentItems.join('\\n\\n');\n            } else {\n                // For other data, use normalized content\n                const normalizedData = this.normalizeResultData(result);\n                const contentItems = this.extractContentItems(normalizedData);\n                textToCopy = contentItems.join('\\n\\n');\n            }\n        }\n        // For Markdown and HTML formats, copy raw unparsed content\n        else if ((format === 'markdown' || format === 'html') && result) {\n            const normalizedData = this.normalizeResultData(result);\n            const contentItems = this.extractContentItems(normalizedData);\n            textToCopy = contentItems.join('\\n\\n');\n        }\n        // For JSON format, copy unwrapped content (not the JSON structure)\n        else if (format === 'json' && result) {\n            const normalizedData = this.normalizeResultData(result);\n            const contentItems = this.extractContentItems(normalizedData);\n            textToCopy = contentItems.join('\\n\\n');\n        }\n        else if ((format === 'raw' || format === 'code') && result) {\n            const rawData = result?.rawData || result;\n            textToCopy = typeof rawData === 'string' ? rawData : JSON.stringify(rawData, null, 2);\n        }\n        // For text format or fallback, use rendered content\n        else {\n            textToCopy = result?.textContent || '';\n        }\n\n        return navigator.clipboard.writeText(textToCopy);\n    }\n}","import type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterUI } from \"./WorkCenterUI\";\nimport type { WorkCenterFileOps } from \"./WorkCenterFileOps\";\nimport type { WorkCenterActions } from \"./WorkCenterActions\";\nimport type { WorkCenterTemplates } from \"./WorkCenterTemplates\";\nimport type { WorkCenterVoice } from \"./WorkCenterVoice\";\nimport type { WorkCenterShareTarget } from \"./WorkCenterShareTarget\";\nimport type { WorkCenterHistory } from \"./WorkCenterHistory\";\nimport type { WorkCenterAttachments } from \"./WorkCenterAttachments\";\nimport type { WorkCenterPrompts } from \"./WorkCenterPrompts\";\n\nexport class WorkCenterEvents {\n    private deps: WorkCenterDependencies;\n    private ui: WorkCenterUI;\n    private fileOps: WorkCenterFileOps;\n    private actions: WorkCenterActions;\n    private templates: WorkCenterTemplates;\n    private voice: WorkCenterVoice;\n    private shareTarget: WorkCenterShareTarget;\n    private history: WorkCenterHistory;\n    private attachments: WorkCenterAttachments;\n    private prompts: WorkCenterPrompts;\n    private state: WorkCenterState;\n    private container: HTMLElement | null = null;\n\n    constructor(\n        dependencies: WorkCenterDependencies,\n        ui: WorkCenterUI,\n        fileOps: WorkCenterFileOps,\n        actions: WorkCenterActions,\n        templates: WorkCenterTemplates,\n        voice: WorkCenterVoice,\n        shareTarget: WorkCenterShareTarget,\n        history: WorkCenterHistory,\n        attachments: WorkCenterAttachments,\n        prompts: WorkCenterPrompts,\n        state: WorkCenterState\n    ) {\n        this.deps = dependencies;\n        this.ui = ui;\n        this.fileOps = fileOps;\n        this.actions = actions;\n        this.templates = templates;\n        this.voice = voice;\n        this.shareTarget = shareTarget;\n        this.history = history;\n        this.attachments = attachments;\n        this.prompts = prompts;\n        this.state = state;\n    }\n\n    setContainer(container: HTMLElement): void {\n        this.container = container;\n    }\n\n    setupWorkCenterEvents(): void {\n        if (!this.container) return;\n\n        // File selection\n        this.setupFileSelection();\n\n        // Paste support\n        this.setupPasteSupport();\n\n        // Template selection\n        this.setupTemplateSelection();\n\n        // Instruction selection (from CustomInstructions in Settings)\n        this.setupInstructionSelection();\n\n        // Prompt input\n        this.setupPromptInput();\n        this.setupPromptDropzone();\n\n        // Voice input\n        this.setupVoiceInput();\n\n        // Input tabs\n        this.setupInputTabs();\n        this.setupResultsTabs();\n        this.setupHeaderControlsOverlay();\n\n        // Format selectors\n        this.setupFormatSelectors();\n\n        // Auto action checkbox\n        this.setupAutoActionCheckbox();\n\n        // Action buttons and other click handlers\n        this.setupActionButtons();\n\n        // Pipeline step restoration\n        this.setupPipelineRestoration();\n    }\n\n    private setupFileSelection(): void {\n        if (!this.container) return;\n\n        const fileSelectBtns = Array.from(this.container.querySelectorAll('[data-action=\"select-files\"]')) as HTMLButtonElement[];\n        const fileInput = document.createElement('input');\n        fileInput.type = 'file';\n        fileInput.multiple = true;\n        fileInput.accept = 'image/*,.pdf,.txt,.md,.json,.html,.css,.js,.ts';\n        fileInput.style.display = 'none';\n        this.container.append(fileInput);\n\n        for (const btn of fileSelectBtns) {\n            btn.addEventListener('click', () => fileInput.click());\n        }\n        fileInput.addEventListener('change', async (e) => {\n            const files = Array.from((e.target as HTMLInputElement).files || []);\n            this.fileOps.addFilesFromInput(this.state, files as any);\n            this.ui.updateFileList(this.state);\n            this.ui.updateFileCounter(this.state);\n            this.deps.onFilesChanged?.();\n\n            // Auto-process text/markdown files if template is selected\n            const textFiles = files.filter(f => f.type.startsWith('text/') || f.type === 'application/markdown' || f.name.endsWith('.md') || f.name.endsWith('.txt'));\n            if (textFiles.length > 0 && this.state.selectedTemplate && this.state.selectedTemplate.trim()) {\n                console.log('[WorkCenter] Auto-processing text/markdown files with template:', this.state.selectedTemplate);\n                // Small delay to allow UI to update\n                setTimeout(async () => {\n                    await this.actions.executeUnifiedAction(this.state);\n                }, 100);\n            }\n        });\n    }\n\n\n    private setupPasteSupport(): void {\n        if (!this.container) return;\n\n        this.container.addEventListener('paste', async (e) => {\n            if (!e.clipboardData) return;\n            const target = e.target as EventTarget | null;\n            const isEditableTarget = this.isEditableTarget(target);\n            const hasClipboardFiles = this.hasClipboardFiles(e.clipboardData);\n\n            // Let native paste work in inputs/textareas/contenteditable when clipboard contains text only.\n            // This prevents prompt input text from being misrouted into attachment handling.\n            if (isEditableTarget && !hasClipboardFiles) {\n                return;\n            }\n\n            let contentAdded = false;\n\n            // Handle clipboard file/blob items first (covers copied files/images from OS and apps).\n            const itemFiles: File[] = [];\n            for (const item of Array.from(e.clipboardData.items || [])) {\n                if (item.kind !== 'file' || !item.getAsFile) continue;\n                const file = item.getAsFile();\n                if (file) itemFiles.push(file);\n            }\n\n            if (itemFiles.length > 0) {\n                e.preventDefault();\n                this.fileOps.addFilesFromInput(this.state, itemFiles as any);\n                this.ui.updateFileList(this.state);\n                this.ui.updateFileCounter(this.state);\n                this.deps.onFilesChanged?.();\n                contentAdded = true;\n            }\n\n            // Handle clipboardData.files fallback.\n            if (!contentAdded) {\n                const files = Array.from(e.clipboardData.files || []);\n                if (files.length > 0) {\n                    e.preventDefault();\n                    this.fileOps.addFilesFromInput(this.state, files as any);\n                    this.ui.updateFileList(this.state);\n                    this.ui.updateFileCounter(this.state);\n                    this.deps.onFilesChanged?.();\n                    contentAdded = true;\n                }\n            }\n\n            // Handle text content only when no files/blobs were found.\n            if (!contentAdded) {\n                const textContent = e.clipboardData.getData('text/plain')?.trim();\n                if (textContent) {\n                    e.preventDefault();\n                    await this.fileOps.handlePastedContent(this.state, textContent, 'text');\n                    contentAdded = true;\n                }\n            }\n\n            // Handle HTML content (extract text if no plain text/files).\n            if (!contentAdded) {\n                const htmlContent = e.clipboardData.getData('text/html');\n                if (htmlContent) {\n                    e.preventDefault();\n                    // Extract text from HTML\n                    const tempDiv = document.createElement('div');\n                    tempDiv.innerHTML = htmlContent;\n                    const extractedText = tempDiv.textContent || tempDiv.innerText || '';\n                    if (extractedText.trim()) {\n                        await this.fileOps.handlePastedContent(this.state, extractedText.trim(), 'html');\n                        contentAdded = true;\n                    }\n                }\n            }\n\n            if (!contentAdded) {\n                e.preventDefault();\n                this.deps.showMessage?.('Clipboard content detected but no supported payload was extracted');\n            }\n        });\n    }\n\n    private isEditableTarget(target: EventTarget | null): boolean {\n        if (!(target instanceof HTMLElement)) return false;\n        if (target.isContentEditable) return true;\n        if (target.closest('[contenteditable=\"true\"]')) return true;\n        return target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement;\n    }\n\n    private hasClipboardFiles(clipboardData: DataTransfer): boolean {\n        if ((clipboardData.files || []).length > 0) return true;\n        return Array.from(clipboardData.items || []).some((item) => item.kind === 'file');\n    }\n\n    private setupTemplateSelection(): void {\n        if (!this.container) return;\n\n        const templateSelect = this.container.querySelector('.template-select') as HTMLSelectElement;\n        templateSelect?.addEventListener('change', async () => {\n            const selectedPrompt = templateSelect.value;\n            this.templates.selectTemplate(this.state, selectedPrompt);\n\n            // Always apply the selected template - templates are meant to provide structured prompts\n            // Users can modify them after selection if needed\n            if (selectedPrompt) {\n                this.prompts.updatePromptInput(this.state);\n\n                // Auto-process if we have recognized data or files\n                if (this.state.recognizedData || this.fileOps.hasFiles(this.state)) {\n                    console.log('[WorkCenter] Auto-processing with selected template:', selectedPrompt);\n                    await this.actions.executeUnifiedAction(this.state);\n                }\n            }\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n        });\n    }\n\n    private setupInstructionSelection(): void {\n        if (!this.container) return;\n\n        // Populate the instruction selector from CustomInstructions in settings\n        void this.prompts.populateInstructionSelect(this.state).then(async () => {\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n        });\n\n        const instructionSelect = this.container.querySelector('.instruction-select') as HTMLSelectElement;\n        instructionSelect?.addEventListener('change', async () => {\n            const selectedId = instructionSelect.value;\n            this.prompts.handleInstructionSelection(this.state, selectedId);\n            await this.templates.setActiveInstruction(selectedId || null);\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n        });\n    }\n\n    private setupPromptInput(): void {\n        if (!this.container) return;\n\n        const promptInput = this.container.querySelector('.prompt-input') as HTMLTextAreaElement;\n        promptInput.addEventListener('input', async () => {\n            this.state.currentPrompt = promptInput.value;\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n\n            // Auto-process if we have recognized data and user entered text\n            if (this.state.recognizedData && promptInput.value.trim()) {\n                console.log('[WorkCenter] Auto-processing recognized data with manual prompt');\n                // Debounce auto-processing\n                clearTimeout((this.container as any)._autoProcessTimeout);\n                (this.container as any)._autoProcessTimeout = setTimeout(async () => {\n                    await this.actions.executeUnifiedAction(this.state);\n                }, 1000); // 1 second delay\n            }\n        });\n    }\n\n    private setupVoiceInput(): void {\n        if (!this.container) return;\n\n        const voiceBtn = this.container.querySelector('[data-action=\"voice-input\"]') as HTMLButtonElement;\n        voiceBtn.addEventListener('mousedown', () => this.voice.startVoiceRecording(this.state));\n        voiceBtn.addEventListener('mouseup', () => {\n            this.voice.stopVoiceRecording(this.state);\n            this.ui.updateVoiceButton(this.state);\n        });\n        voiceBtn.addEventListener('mouseleave', () => {\n            this.voice.stopVoiceRecording(this.state);\n            this.ui.updateVoiceButton(this.state);\n        });\n    }\n\n    private setupFormatSelectors(): void {\n        if (!this.container) return;\n\n        // Format selector\n        const formatSelect = this.container.querySelector('.format-select') as HTMLSelectElement;\n        formatSelect.addEventListener('change', async () => {\n            const newFormat = formatSelect.value as \"auto\" | \"markdown\" | \"json\" | \"text\" | \"raw\" | \"html\" | \"code\";\n            this.state.outputFormat = newFormat;\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n\n            // Re-render existing results if available\n            if (this.state.lastRawResult) {\n                const outputContent = this.container?.querySelector('[data-output]') as HTMLElement;\n                const { WorkCenterDataProcessing } = await import('./WorkCenterDataProcessing');\n                const dataProcessing = new WorkCenterDataProcessing();\n                const formattedResult = dataProcessing.formatResult(this.state.lastRawResult, newFormat);\n                outputContent.innerHTML = `<div class=\"result-content\">${formattedResult}</div>`;\n            }\n        });\n\n        // Language selector\n        const languageSelect = this.container.querySelector('.language-select') as HTMLSelectElement;\n        languageSelect.addEventListener('change', async () => {\n            this.state.selectedLanguage = languageSelect.value as \"auto\" | \"en\" | \"ru\";\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n            // Language change doesn't need re-rendering since it affects future AI calls\n        });\n\n        // Recognition format selector\n        const recognitionSelect = this.container.querySelector('.recognition-select') as HTMLSelectElement;\n        recognitionSelect.addEventListener('change', async () => {\n            this.state.recognitionFormat = recognitionSelect.value as \"auto\" | \"markdown\" | \"html\" | \"text\" | \"json\" | \"most-suitable\" | \"most-optimized\" | \"most-legibility\";\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n            // Recognition format change doesn't need re-rendering since it affects future AI calls\n        });\n\n        // Processing format selector\n        const processingSelect = this.container.querySelector('.processing-select') as HTMLSelectElement;\n        processingSelect.addEventListener('change', async () => {\n            this.state.processingFormat = processingSelect.value as \"markdown\" | \"html\" | \"json\" | \"text\" | \"typescript\" | \"javascript\" | \"python\" | \"java\" | \"cpp\" | \"csharp\" | \"php\" | \"ruby\" | \"go\" | \"rust\" | \"xml\" | \"yaml\" | \"css\" | \"scss\";\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n            // Processing format change doesn't need re-rendering since it affects future AI calls\n        });\n    }\n\n    private setupAutoActionCheckbox(): void {\n        if (!this.container) return;\n\n        const autoCheckbox = this.container.querySelector('.auto-action-checkbox') as HTMLInputElement;\n        autoCheckbox.addEventListener('change', async () => {\n            this.state.autoAction = autoCheckbox.checked;\n            const { WorkCenterStateManager } = await import('./WorkCenterState');\n            WorkCenterStateManager.saveState(this.state);\n        });\n    }\n\n    private setupActionButtons(): void {\n        if (!this.container) return;\n\n        this.container.addEventListener('click', async (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.closest('[data-action]')?.getAttribute('data-action');\n\n            if (!action) return;\n\n            switch (action) {\n                case 'edit-templates':\n                    this.templates.showTemplateEditor(this.state, this.container as HTMLElement);\n                    break;\n                case 'refresh-instructions':\n                    await this.prompts.populateInstructionSelect(this.state);\n                    this.prompts.updateInstructionSelect(this.state);\n                    break;\n                case 'clear-prompt':\n                    this.prompts.clearPrompt(this.state);\n                    break;\n                case 'copy-results':\n                    await this.actions.copyResults(this.state);\n                    break;\n                case 'view-output':\n                    await this.actions.viewResultsInViewer(this.state);\n                    break;\n                case 'save-to-explorer':\n                    await this.actions.saveResultsToExplorer(this.state);\n                    break;\n                case 'clear-results':\n                    this.actions.clearResults(this.state);\n                    break;\n                case 'clear-all-files':\n                    this.attachments.clearAllFiles(this.state);\n                    break;\n                case 'view-full-history':\n                    this.deps.state.view = 'history';\n                    this.deps.render();\n                    break;\n                case 'view-action-history':\n                    this.showActionHistory();\n                    break;\n                case 'execute':\n                    await this.actions.executeUnifiedAction(this.state);\n                    break;\n                case 'switch-input-tab':\n                    this.switchInputTab(String(target.closest('[data-tab]')?.getAttribute('data-tab') || 'prompt'));\n                    break;\n                case 'switch-results-tab':\n                    this.switchResultsTab(String(target.closest('[data-tab]')?.getAttribute('data-tab') || 'output'));\n                    break;\n                case 'clear-recognized':\n                    const { WorkCenterStateManager: StateManager1 } = await import('./WorkCenterState');\n                    StateManager1.clearRecognizedData(this.state);\n                    // Update the UI to remove the recognized status and pipeline\n                    const statusElement = this.container?.querySelector('.wc-recognized-status');\n                    if (statusElement) {\n                        statusElement.remove();\n                    }\n                    this.ui.updateDataPipeline(this.state);\n                    break;\n                case 'clear-pipeline':\n                    const { WorkCenterStateManager: StateManager2 } = await import('./WorkCenterState');\n                    StateManager2.clearRecognizedData(this.state);\n                    // Also clear attachments & preview URLs (pipeline reset means \"start over\")\n                    this.ui.revokeAllPreviewUrls(this.state);\n                    this.state.files = [];\n                    this.ui.updateFileList(this.state);\n                    this.ui.updateFileCounter(this.state);\n                    this.deps.onFilesChanged?.();\n                    // Update UI\n                    const statusEl = this.container?.querySelector('.wc-recognized-status');\n                    if (statusEl) {\n                        statusEl.remove();\n                    }\n                    this.ui.updateDataPipeline(this.state);\n                    break;\n            }\n        });\n    }\n\n    private setupPipelineRestoration(): void {\n        if (!this.container) return;\n\n        this.container.addEventListener('click', async (e) => {\n            const target = e.target as HTMLElement;\n            const stepIndex = target.getAttribute('data-restore-step');\n\n            if (stepIndex !== null) {\n                const index = parseInt(stepIndex);\n                if (this.state.processedData && this.state.processedData[index]) {\n                    const step = this.state.processedData[index];\n                    // Restore this processing step result to the output\n                    const outputContent = this.container?.querySelector('[data-output]') as HTMLElement;\n                    const { WorkCenterDataProcessing } = await import('./WorkCenterDataProcessing');\n                    const dataProcessing = new WorkCenterDataProcessing();\n                    const formattedResult = dataProcessing.formatResult({ content: step.content }, this.state.outputFormat);\n                    outputContent.innerHTML = `<div class=\"result-content\">${formattedResult}</div>`;\n                    this.state.lastRawResult = { data: step.content };\n                }\n            }\n        });\n    }\n\n    private setupInputTabs(): void {\n        if (!this.container) return;\n        this.switchInputTab(this.state.activeInputTab || \"prompt\");\n    }\n\n    private setupResultsTabs(): void {\n        if (!this.container) return;\n        this.switchResultsTab(this.state.activeResultsTab || \"output\");\n    }\n\n    private setupHeaderControlsOverlay(): void {\n        if (!this.container) return;\n        const disclosure = this.container.querySelector('.header-controls-disclosure') as HTMLDetailsElement | null;\n        if (!disclosure) return;\n\n        document.addEventListener('click', (event) => {\n            if (!disclosure.open) return;\n            const target = event.target as Node | null;\n            if (target && !disclosure.contains(target)) {\n                disclosure.open = false;\n            }\n        });\n\n        this.container.addEventListener('keydown', (event) => {\n            if (event.key === 'Escape' && disclosure.open) {\n                disclosure.open = false;\n            }\n        });\n    }\n\n    private switchInputTab(tab: string): void {\n        if (!this.container) return;\n        if (![\"instruction\", \"prompt\", \"attachments\"].includes(tab)) return;\n\n        this.state.activeInputTab = tab as WorkCenterState[\"activeInputTab\"];\n        this.container.querySelector('[data-input-tabs]')?.setAttribute('data-active-tab', tab);\n\n        const tabButtons = this.container.querySelectorAll('[data-action=\"switch-input-tab\"][data-tab]');\n        for (const tabButton of Array.from(tabButtons)) {\n            const btn = tabButton as HTMLButtonElement;\n            const isActive = btn.getAttribute('data-tab') === tab;\n            btn.classList.toggle('is-active', isActive);\n            btn.setAttribute('aria-selected', String(isActive));\n        }\n\n        const tabPanels = this.container.querySelectorAll('[data-tab-panel]');\n        for (const panel of Array.from(tabPanels)) {\n            const el = panel as HTMLElement;\n            const isActive = el.getAttribute('data-tab-panel') === tab;\n            el.classList.toggle('is-active', isActive);\n        }\n\n        void import('./WorkCenterState')\n            .then(({ WorkCenterStateManager }) => WorkCenterStateManager.saveState(this.state))\n            .catch(() => {\n                // ignore persistence failures for tab state\n            });\n    }\n\n    private switchResultsTab(tab: string): void {\n        if (!this.container) return;\n        if (![\"output\", \"pipeline\", \"history\"].includes(tab)) return;\n\n        const hasPipelineData = Boolean(this.state.recognizedData || (this.state.processedData && this.state.processedData.length > 0));\n        const nextTab = (tab === \"pipeline\" && !hasPipelineData) ? \"output\" : tab;\n\n        this.state.activeResultsTab = nextTab as WorkCenterState[\"activeResultsTab\"];\n        this.container.querySelector('[data-results-tabs]')?.setAttribute('data-active-tab', nextTab);\n\n        const tabButtons = this.container.querySelectorAll('[data-action=\"switch-results-tab\"][data-tab]');\n        for (const tabButton of Array.from(tabButtons)) {\n            const btn = tabButton as HTMLButtonElement;\n            const isActive = btn.getAttribute('data-tab') === nextTab;\n            btn.classList.toggle('is-active', isActive);\n            btn.setAttribute('aria-selected', String(isActive));\n        }\n\n        const tabPanels = this.container.querySelectorAll('[data-results-tab-panel]');\n        for (const panel of Array.from(tabPanels)) {\n            const el = panel as HTMLElement;\n            const isActive = el.getAttribute('data-results-tab-panel') === nextTab;\n            el.classList.toggle('is-active', isActive);\n        }\n\n        void import('./WorkCenterState')\n            .then(({ WorkCenterStateManager }) => WorkCenterStateManager.saveState(this.state))\n            .catch(() => {\n                // ignore persistence failures for tab state\n            });\n    }\n\n    private setupPromptDropzone(): void {\n        if (!this.container) return;\n        const promptDropzone = this.container.querySelector('[data-prompt-dropzone]') as HTMLElement | null;\n        if (!promptDropzone) return;\n\n        const overlay = this.container.querySelector('[data-prompt-drop-hint]') as HTMLElement | null;\n\n        promptDropzone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            promptDropzone.classList.add('drag-over');\n            overlay?.classList.add('visible');\n        });\n\n        promptDropzone.addEventListener('dragleave', (e) => {\n            const rect = promptDropzone.getBoundingClientRect();\n            const x = e.clientX;\n            const y = e.clientY;\n            if (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) {\n                promptDropzone.classList.remove('drag-over');\n                overlay?.classList.remove('visible');\n            }\n        });\n\n        promptDropzone.addEventListener('drop', async (e) => {\n            e.preventDefault();\n            promptDropzone.classList.remove('drag-over');\n            overlay?.classList.remove('visible');\n\n            const dt = e.dataTransfer;\n            if (!dt) return;\n\n            const files = Array.from(dt.files || []);\n            if (files.length > 0) {\n                this.fileOps.addFilesFromInput(this.state, files as any);\n                this.ui.updateFileList(this.state);\n                this.ui.updateFileCounter(this.state);\n                this.deps.onFilesChanged?.();\n                return;\n            }\n\n            if (dt.types.includes('text/plain')) {\n                const text = dt.getData('text/plain')?.trim();\n                if (text) {\n                    await this.fileOps.handleDroppedContent(this.state, text, 'text');\n                    this.ui.updateFileList(this.state);\n                    this.ui.updateFileCounter(this.state);\n                    this.deps.onFilesChanged?.();\n                    return;\n                }\n            }\n\n            if (dt.types.includes('text/uri-list')) {\n                const uriList = dt.getData('text/uri-list');\n                const urls = uriList.split('\\n').filter((url) => url.trim() && !url.startsWith('#'));\n                const firstUrl = urls[0]?.trim();\n                if (firstUrl) {\n                    await this.fileOps.handleDroppedContent(this.state, firstUrl, 'url');\n                    this.ui.updateFileList(this.state);\n                    this.ui.updateFileCounter(this.state);\n                    this.deps.onFilesChanged?.();\n                    return;\n                }\n            }\n\n            if (dt.types.includes('text/html')) {\n                const html = dt.getData('text/html');\n                if (html) {\n                    const temp = document.createElement('div');\n                    temp.innerHTML = html;\n                    const extracted = (temp.textContent || temp.innerText || '').trim();\n                    if (extracted) {\n                        await this.fileOps.handleDroppedContent(this.state, extracted, 'html');\n                        this.ui.updateFileList(this.state);\n                        this.ui.updateFileCounter(this.state);\n                        this.deps.onFilesChanged?.();\n                        return;\n                    }\n                }\n            }\n        });\n    }\n\n    private showActionHistory(): void {\n        this.history.showActionHistory();\n    }\n\n    private isValidUrl(string: string): boolean {\n        try {\n            new URL(string);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n}","import { H } from \"fest/lure\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterDataProcessing } from \"./WorkCenterDataProcessing\";\n\nexport class WorkCenterResults {\n    private container: HTMLElement | null = null;\n    private deps: WorkCenterDependencies;\n    private dataProcessing: WorkCenterDataProcessing;\n\n    constructor(dependencies: WorkCenterDependencies, dataProcessing: WorkCenterDataProcessing) {\n        this.deps = dependencies;\n        this.dataProcessing = dataProcessing;\n    }\n\n    setContainer(container: HTMLElement | null): void {\n        this.container = container;\n    }\n\n\n    // Output display methods\n    showProcessingMessage(message: string): void {\n        if (!this.container) return;\n        const outputContent = this.container.querySelector('[data-output]') as HTMLElement;\n        if (outputContent) {\n            outputContent.innerHTML = `<div class=\"wc-loading\">${message}</div>`;\n        }\n    }\n\n    showResult(state: WorkCenterState): void {\n        if (!this.container || !state.lastRawResult) return;\n\n        const outputContent = this.container.querySelector('[data-output]') as HTMLElement;\n        if (!outputContent) return;\n\n        const formattedResult = this.dataProcessing.formatResult(state.lastRawResult, state.outputFormat);\n        outputContent.innerHTML = `<div class=\"result-content\">${formattedResult}</div>`;\n    }\n\n    showError(error: string): void {\n        if (!this.container) return;\n        const outputContent = this.container.querySelector('[data-output]') as HTMLElement;\n        if (outputContent) {\n            outputContent.innerHTML = `<div class=\"error\">Error: ${error}</div>`;\n        }\n    }\n\n    clearResults(): void {\n        if (!this.container) return;\n        const outputContent = this.container.querySelector('[data-output]') as HTMLElement;\n        if (outputContent) {\n            outputContent.innerHTML = '<div class=\"wc-results-empty\">Results cleared</div>';\n        }\n    }\n\n    // Data pipeline management\n    renderDataPipeline(state: WorkCenterState): HTMLElement | string {\n        if (!state.recognizedData && (!state.processedData || state.processedData.length === 0)) {\n            return '';\n        }\n\n        return H`<div class=\"data-pipeline-section\">\n            <div class=\"pipeline-content\">\n              <div class=\"pipeline-header\">\n                <h3>Data Processing Pipeline</h3>\n                <div class=\"pipeline-actions\">\n                  <button class=\"btn btn-icon\" data-action=\"clear-pipeline\" title=\"Clear all data\">\n                    <ui-icon icon=\"trash\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                  </button>\n                </div>\n              </div>\n              <div class=\"pipeline-steps\">\n              ${state.recognizedData ? H`<div class=\"pipeline-step recognized-step\">\n                <div class=\"step-header\">\n                  <ui-icon icon=\"eye\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                  <span class=\"step-title\">Recognized Data</span>\n                  <span class=\"step-time\">${new Date(state.recognizedData.timestamp).toLocaleTimeString()}</span>\n                  <span class=\"step-source\">${state.recognizedData.source}</span>\n                  <span class=\"step-format\">${state.recognizedData.recognizedAs}</span>\n                </div>\n                <div class=\"step-content\">\n                  <div class=\"step-preview\">${state.recognizedData.content.substring(0, 100)}${state.recognizedData.content.length > 100 ? '...' : ''}</div>\n                </div>\n              </div>` : ''}\n\n              ${state.processedData ? state.processedData.map((step, index) => {\n                const isShareTarget = step.metadata?.source === 'share-target';\n                const icon = isShareTarget ? 'share' : 'cogs';\n                const stepClass = isShareTarget ? 'pipeline-step share-target-step' : 'pipeline-step processed-step';\n                return H`<div class=\"${stepClass}\">\n                <div class=\"step-header\">\n                  <ui-icon icon=\"${icon}\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                  <span class=\"step-title\">Step ${index + 1}: ${step.action}</span>\n                  <span class=\"step-time\">${new Date(step.timestamp).toLocaleTimeString()}</span>\n                  ${isShareTarget ? H`<span class=\"step-badge share-target-badge\" title=\"Share Target Result\">Share</span>` : ''}\n                  <button class=\"btn small\" data-restore-step=\"${index}\">Use Result</button>\n                </div>\n                <div class=\"step-content\">\n                  <div class=\"step-preview\">${step.content.substring(0, 100)}${step.content.length > 100 ? '...' : ''}</div>\n                </div>\n              </div>`;\n              }) : ''}\n              </div>\n            </div>\n          </div>`;\n    }\n\n    updateDataPipeline(state: WorkCenterState): void {\n        if (!this.container) return;\n\n        const pipelinePanel = this.container.querySelector('[data-results-tab-panel=\"pipeline\"]') as HTMLElement | null;\n        if (!pipelinePanel) return;\n\n        const pipelineHTML = this.renderDataPipeline(state);\n        if (typeof pipelineHTML === 'string') {\n            pipelinePanel.innerHTML = `<div class=\"wc-results-empty\">No data pipeline yet</div>`;\n        } else {\n            pipelinePanel.innerHTML = '';\n            pipelinePanel.appendChild(pipelineHTML);\n        }\n    }\n\n    // Status updates\n    updateRecognizedStatus(state: WorkCenterState): void {\n        if (!this.container) return;\n\n        const statusElement = this.container.querySelector('.wc-recognized-status') as HTMLElement;\n        if (state.recognizedData) {\n            if (!statusElement) {\n                // Add recognized status if it doesn't exist\n                const fileInputArea = this.container.querySelector('.wc-file-drop-overlay');\n                if (fileInputArea) {\n                    const newStatus = H`<div class=\"wc-recognized-status\">\n                        <ui-icon icon=\"check-circle\" size=\"16\" icon-style=\"duotone\" class=\"status-icon\"></ui-icon>\n                        <span>Content recognized - ready for actions</span>\n                        <button class=\"btn small clear-recognized\" data-action=\"clear-recognized\">Clear</button>\n                    </div>` as HTMLElement;\n                    fileInputArea.appendChild(newStatus);\n                }\n            }\n        } else if (statusElement) {\n            statusElement.remove();\n        }\n    }\n\n    // Output actions/header rendering\n    renderOutputHeader(): string {\n        return `\n            <div class=\"wc-output-header\">\n                <div class=\"wc-output-actions\">\n                    <button class=\"btn btn-icon\" data-action=\"view-output\" title=\"View output in Viewer\">\n                        <ui-icon icon=\"eye\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span class=\"btn-text\">View</span>\n                    </button>\n                    <button class=\"btn btn-icon\" data-action=\"copy-results\" title=\"Copy results\">\n                        <ui-icon icon=\"copy\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span class=\"btn-text\">Copy</span>\n                    </button>\n                    <button class=\"btn btn-icon\" data-action=\"save-to-explorer\" title=\"Save to Explorer\">\n                        <ui-icon icon=\"floppy-disk\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span class=\"btn-text\">Save</span>\n                    </button>\n                    <button class=\"btn btn-icon\" data-action=\"clear-results\" title=\"Clear results\">\n                        <ui-icon icon=\"trash\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span class=\"btn-text\">Clear</span>\n                    </button>\n                </div>\n            </div>\n        `;\n    }\n\n    // Output content rendering\n    renderOutputContent(): string {\n        return `\n            <div class=\"wc-output-content\" data-output> No results yet </div>\n        `;\n    }\n\n    // Pipeline step restoration\n    restorePipelineStep(state: WorkCenterState, stepIndex: number): void {\n        if (!this.container) return;\n\n        if (state.processedData && state.processedData[stepIndex]) {\n            const step = state.processedData[stepIndex];\n            // Restore this processing step result to the output\n            const outputContent = this.container.querySelector('[data-output]') as HTMLElement;\n            if (outputContent) {\n                const formattedResult = this.dataProcessing.formatResult({ content: step.content }, state.outputFormat);\n                outputContent.innerHTML = `<div class=\"result-content\">${formattedResult}</div>`;\n                state.lastRawResult = { data: step.content };\n            }\n        }\n    }\n\n    // Batch update method for efficiency\n    updateAllResultsUI(state: WorkCenterState): void {\n        // File counters are now handled by WorkCenterAttachments\n        this.updateDataPipeline(state);\n        this.updateRecognizedStatus(state);\n    }\n}","import { H } from \"fest/lure\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterFileOps } from \"./WorkCenterFileOps\";\nimport { ROUTE_HASHES } from '@rs-com/config/Names';\n\nexport class WorkCenterAttachments {\n    private container: HTMLElement | null = null;\n    private deps: WorkCenterDependencies;\n    private fileOps: WorkCenterFileOps;\n    private previewUrlCache = new WeakMap<File, string>();\n\n    constructor(dependencies: WorkCenterDependencies, fileOps: WorkCenterFileOps) {\n        this.deps = dependencies;\n        this.fileOps = fileOps;\n    }\n\n    setContainer(container: HTMLElement | null): void {\n        this.container = container;\n    }\n\n    // Main attachments section rendering\n    renderAttachmentsSection(state: WorkCenterState): string {\n        return `\n            <div class=\"wc-attachments-section\">\n              <div class=\"file-attachment-area\" data-file-drop-zone=\"\" data-dropzone=\"\">\n                <div class=\"file-drop-zone\" >\n                  <div class=\"drop-zone-content\">\n                    <ui-icon icon=\"folder\" size=\"4rem\" icon-style=\"duotone\" class=\"drop-icon\"></ui-icon>\n                    <div class=\"drop-text\">Drop files here or click to select files</div>\n                    <div class=\"drop-hint\" data-drop-hint>Supports: Images, Documents, Text files, PDFs, URLs, Base64 data</div>\n                  </div>\n                </div>\n                <div class=\"file-list\" data-file-list></div>\n                ${this.renderRecognizedStatus(state)}\n              </div>\n              <div class=\"wc-block-header wc-attachments-toolbar\">\n                <div class=\"file-actions\">\n                  <button class=\"btn btn-icon\" data-action=\"select-files\" title=\"Choose Files\">\n                    <ui-icon icon=\"folder-open\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                    <span class=\"btn-text\">Add Files</span>\n                  </button>\n                  <button class=\"btn btn-icon\" data-action=\"clear-all-files\" title=\"Clear All Files\">\n                    <ui-icon icon=\"trash\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                    <span class=\"btn-text\">Clear All</span>\n                  </button>\n                </div>\n                <div class=\"file-stats\">\n                  <div class=\"file-counter\" data-file-count>\n                    <ui-icon icon=\"file\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                    <span class=\"count\">${state.files.length}</span>\n                    <span class=\"label\">files attached</span>\n                  </div>\n                  ${state.recognizedData ? `\n                    <div class=\"data-counter recognized\">\n                      <ui-icon icon=\"eye\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                      <span>Content recognized</span>\n                    </div>\n                  ` : ''}\n                  ${state.processedData && state.processedData.length > 0 ? `\n                    <div class=\"data-counter processed\">\n                      <ui-icon icon=\"cogs\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                      <span>${state.processedData.length} processing steps</span>\n                    </div>\n                  ` : ''}\n                </div>\n              </div>\n            </div>\n        `;\n    }\n\n    private renderRecognizedStatus(state: WorkCenterState): string {\n        if (!state.recognizedData) return '';\n\n        return `\n            <div class=\"wc-recognized-status\">\n              <ui-icon icon=\"check-circle\" size=\"16\" icon-style=\"duotone\" class=\"status-icon\"></ui-icon>\n              <span>Content recognized - ready for processing</span>\n              <button class=\"btn small clear-recognized\" data-action=\"clear-recognized\">Clear</button>\n            </div>\n        `;\n    }\n\n    // File list management\n    updateFileList(state: WorkCenterState): void {\n        if (!this.container) return;\n        const fileList = this.container.querySelector('[data-file-list]') as HTMLElement;\n        if (!fileList) return;\n\n        fileList.innerHTML = '';\n\n        if (state.files.length === 0) {\n            fileList.innerHTML = '<div class=\"wc-attachments-empty\">No files attached</div>';\n            return;\n        }\n\n        state.files.forEach((file, index) => {\n            const fileItem = this.createFileItem(file, index, state);\n            fileList.append(fileItem);\n        });\n    }\n\n    private createFileItem(file: File, index: number, state: WorkCenterState): HTMLElement {\n        const isImage = this.isImageFile(file);\n        const isMarkdown = this.isMarkdownFile(file);\n        const previewUrl = isImage ? this.getOrCreatePreviewUrl(file) : null;\n        const fileSize = this.formatFileSize(file.size);\n\n        const fileItem = H`<div class=\"file-item\" data-file-index=\"${index}\">\n      <div class=\"file-info\">\n        <span class=\"file-icon\">${this.createFileIconElement(file.type)}</span>\n        ${previewUrl ? H`<img class=\"file-preview\" alt=${file.name || \"image\"} src=${previewUrl} loading=\"lazy\" decoding=\"async\" />` : ''}\n        <div class=\"file-details\">\n          <span class=\"file-name\">${file.name || 'Unnamed file'}</span>\n          <span class=\"file-size\">(${fileSize})</span>\n          <span class=\"file-type\">${this.getReadableFileType(file.type)}</span>\n        </div>\n        ${isMarkdown ? H`<button class=\"btn small\" data-open-md=\"${index}\" title=\"Open in Markdown Viewer\">Open</button>` : ''}\n      </div>\n      <button class=\"btn small remove-btn\" data-remove=\"${index}\" title=\"Remove file\"></button>\n    </div>` as HTMLElement;\n\n        // Add event listeners\n        const openBtn = fileItem.querySelector(`[data-open-md=\"${index}\"]`) as HTMLButtonElement | null;\n        if (openBtn) {\n            openBtn.addEventListener('click', async (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                await this.openMarkdownInViewer(file);\n            });\n        }\n\n        const removeBtn = fileItem.querySelector('.remove-btn') as HTMLButtonElement;\n        removeBtn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.removeFile(state, index);\n        });\n\n        return fileItem;\n    }\n\n    private removeFile(state: WorkCenterState, index: number): void {\n        const removedFile = state.files[index];\n        if (removedFile) {\n            this.revokePreviewUrl(removedFile);\n            state.files.splice(index, 1);\n            this.updateFileList(state);\n            this.updateFileCounter(state);\n            this.deps.onFilesChanged?.();\n        }\n    }\n\n    // Drop zone functionality\n    setupDropZone(state: WorkCenterState): void {\n        if (!this.container) return;\n\n        const dropZone = this.container.querySelector('[data-file-drop-zone]') as HTMLElement | null;\n        if (!dropZone) return;\n        const fileInput = document.createElement('input');\n        fileInput.type = 'file';\n        fileInput.multiple = true;\n        fileInput.accept = 'image/*,.pdf,.txt,.md,.json,.html,.css,.js,.ts';\n        fileInput.style.display = 'none';\n        this.container.append(fileInput);\n\n        // Update drop hint based on current route\n        this.updateDropHint();\n\n        // Click to select files\n        dropZone.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement | null;\n            if (target?.closest('button, a, input, select, textarea, label, [data-remove], [data-open-md]')) {\n                return;\n            }\n            fileInput.click();\n        });\n\n        // Drag and drop events\n        dropZone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            dropZone.classList.add('drag-over');\n        });\n\n        dropZone.addEventListener('dragleave', (e) => {\n            // Only remove drag-over class if leaving the drop zone entirely\n            const rect = dropZone.getBoundingClientRect();\n            const x = e.clientX;\n            const y = e.clientY;\n\n            if (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) {\n                dropZone.classList.remove('drag-over');\n            }\n        });\n\n        dropZone.addEventListener('drop', async (e) => {\n            e.preventDefault();\n            dropZone.classList.remove('drag-over');\n\n            const dataTransfer = e.dataTransfer;\n            if (!dataTransfer) return;\n\n            let contentAdded = false;\n\n            // Handle files\n            const files = Array.from(dataTransfer.files || []);\n            if (files.length > 0) {\n                this.fileOps.addFilesFromInput(state, files as any);\n                this.updateFileList(state);\n                this.updateFileCounter(state);\n                this.deps.onFilesChanged?.();\n                contentAdded = true;\n            }\n\n            // Handle text content from drag\n            if (!contentAdded && dataTransfer.types.includes('text/plain')) {\n                try {\n                    const textContent = dataTransfer.getData('text/plain');\n                    if (textContent?.trim()) {\n                        await this.fileOps.handleDroppedContent(state, textContent.trim(), 'text');\n                        contentAdded = true;\n                    }\n                } catch (error) {\n                    console.warn('[WorkCenter] Failed to get dragged text:', error);\n                }\n            }\n\n            // Handle URLs from drag\n            if (!contentAdded && dataTransfer.types.includes('text/uri-list')) {\n                try {\n                    const uriList = dataTransfer.getData('text/uri-list');\n                    const urls = uriList.split('\\n').filter(url => url.trim() && !url.startsWith('#'));\n                    if (urls.length > 0) {\n                        for (const url of urls) {\n                            if (this.isValidUrl(url.trim())) {\n                                await this.fileOps.handleDroppedContent(state, url.trim(), 'url');\n                                break; // Only handle first valid URL\n                            }\n                        }\n                        contentAdded = true;\n                    }\n                } catch (error) {\n                    console.warn('[WorkCenter] Failed to get dragged URLs:', error);\n                }\n            }\n\n            // Handle HTML content from drag\n            if (!contentAdded && dataTransfer.types.includes('text/html')) {\n                try {\n                    const htmlContent = dataTransfer.getData('text/html');\n                    if (htmlContent) {\n                        // Extract text from HTML\n                        const tempDiv = document.createElement('div');\n                        tempDiv.innerHTML = htmlContent;\n                        const extractedText = tempDiv.textContent || tempDiv.innerText || '';\n                        if (extractedText.trim()) {\n                            await this.fileOps.handleDroppedContent(state, extractedText.trim(), 'html');\n                            contentAdded = true;\n                        }\n                    }\n                } catch (error) {\n                    console.warn('[WorkCenter] Failed to get dragged HTML:', error);\n                }\n            }\n        });\n\n        // File input change\n        fileInput.addEventListener('change', async (e) => {\n            const files = Array.from((e.target as HTMLInputElement).files || []);\n            this.fileOps.addFilesFromInput(state, files as any);\n            this.updateFileList(state);\n            this.updateFileCounter(state);\n            this.deps.onFilesChanged?.();\n\n            // Auto-process text/markdown files if template is selected\n            const textFiles = files.filter(f => f.type.startsWith('text/') || f.type === 'application/markdown' || f.name?.endsWith('.md') || f.name?.endsWith('.txt'));\n            if (textFiles.length > 0 && state.selectedTemplate && state.selectedTemplate.trim()) {\n                console.log('[WorkCenter] Auto-processing text/markdown files with template:', state.selectedTemplate);\n                // Small delay to allow UI to update\n                setTimeout(async () => {\n                    // This will be handled by the actions module\n                    this.deps.showMessage?.('Files attached and ready for processing');\n                }, 100);\n            }\n        });\n    }\n\n    // Update file counter\n    updateFileCounter(state: WorkCenterState): void {\n        if (!this.container) return;\n        const counter = this.container.querySelector('[data-file-count] .count') as HTMLElement;\n        if (counter) {\n            counter.textContent = state.files.length.toString();\n        }\n    }\n\n    // Update data counters (recognized and processed)\n    updateDataCounters(state: WorkCenterState): void {\n        if (!this.container) return;\n\n        // Update recognized data counter\n        const recognizedCounter = this.container.querySelector('.data-counter.recognized') as HTMLElement;\n        if (state.recognizedData) {\n            if (!recognizedCounter) {\n                // Add recognized counter if it doesn't exist\n                const statsContainer = this.container.querySelector('.file-stats');\n                if (statsContainer) {\n                    const newCounter = H`<div class=\"data-counter recognized\">\n                        <ui-icon icon=\"eye\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span>Content recognized</span>\n                    </div>` as HTMLElement;\n                    statsContainer.appendChild(newCounter);\n                }\n            }\n        } else if (recognizedCounter) {\n            recognizedCounter.remove();\n        }\n\n        // Update processed data counter\n        const processedCounter = this.container.querySelector('.data-counter.processed') as HTMLElement;\n        if (state.processedData && state.processedData.length > 0) {\n            if (processedCounter) {\n                const span = processedCounter.querySelector('span') as HTMLElement;\n                if (span) {\n                    span.textContent = `${state.processedData.length} processing steps`;\n                }\n            } else {\n                // Add processed counter if it doesn't exist\n                const statsContainer = this.container.querySelector('.file-stats');\n                if (statsContainer) {\n                    const newCounter = H`<div class=\"data-counter processed\">\n                        <ui-icon icon=\"cogs\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                        <span>${state.processedData.length} processing steps</span>\n                    </div>` as HTMLElement;\n                    statsContainer.appendChild(newCounter);\n                }\n            }\n        } else if (processedCounter) {\n            processedCounter.remove();\n        }\n    }\n\n    // Clear all files\n    clearAllFiles(state: WorkCenterState): void {\n        // Revoke all preview URLs\n        this.revokeAllPreviewUrls(state);\n        state.files.length = 0;\n        this.updateFileList(state);\n        this.updateFileCounter(state);\n        this.updateDataCounters(state);\n        this.deps.onFilesChanged?.();\n    }\n\n    // Helper methods\n    private isImageFile(file: File): boolean {\n        const type = (file?.type || \"\").toLowerCase();\n        return type.startsWith(\"image/\");\n    }\n\n    private isMarkdownFile(file: File): boolean {\n        const name = (file?.name || \"\").toLowerCase();\n        const type = (file?.type || \"\").toLowerCase();\n        return type === \"text/markdown\" || name.endsWith(\".md\") || name.endsWith(\".markdown\") || name.endsWith(\".mdown\") || name.endsWith(\".mkd\") || name.endsWith(\".mkdn\");\n    }\n\n    private getOrCreatePreviewUrl(file: File): string | null {\n        if (!file) return null;\n        if (!this.isImageFile(file)) return null;\n        const cached = this.previewUrlCache.get(file);\n        if (cached) return cached;\n        try {\n            const url = URL.createObjectURL(file);\n            this.previewUrlCache.set(file, url);\n            return url;\n        } catch {\n            return null;\n        }\n    }\n\n    private revokePreviewUrl(file: File): void {\n        const url = this.previewUrlCache.get(file);\n        if (url) {\n            try { URL.revokeObjectURL(url); } catch { /* ignore */ }\n        }\n        this.previewUrlCache.delete(file);\n    }\n\n    private async openMarkdownInViewer(file: File): Promise<void> {\n        try {\n            const md = await file.text();\n            // Minimaledition stores markdown in localStorage + state.markdown.\n            try { localStorage.setItem(\"rs-markdown\", md); } catch { /* ignore */ }\n            try {\n                if (this.deps?.state) {\n                    this.deps.state.markdown = md;\n                    this.deps.state.view = \"markdown-viewer\";\n                }\n            } catch { /* ignore */ }\n            this.deps.showMessage?.(`Opened ${file.name || 'file'} in Markdown Viewer`);\n            this.deps.render?.();\n        } catch (e) {\n            this.deps.showMessage?.(`Failed to open ${file.name || 'file'}`);\n            console.warn(\"[WorkCenter] Failed to open markdown file:\", e);\n        }\n    }\n\n    private createFileIconElement(mimeType: string): HTMLElement {\n        const iconName = this.getFileIconName(mimeType);\n        return H`<ui-icon icon=\"${iconName}\" size=\"20\" icon-style=\"duotone\" class=\"file-type-icon\"></ui-icon>` as HTMLElement;\n    }\n\n    private getFileIconName(mimeType: string): string {\n        if (mimeType.startsWith('image/')) return 'image';\n        if (mimeType === 'application/pdf') return 'file-pdf';\n        if (mimeType.includes('json')) return 'file-text';\n        if (mimeType.includes('text') || mimeType.includes('markdown')) return 'file-text';\n        return 'file';\n    }\n\n    private getReadableFileType(mimeType: string): string {\n        if (!mimeType) return 'Unknown';\n\n        const typeMap: Record<string, string> = {\n            'image/jpeg': 'JPEG Image',\n            'image/png': 'PNG Image',\n            'image/gif': 'GIF Image',\n            'image/webp': 'WebP Image',\n            'image/svg+xml': 'SVG Image',\n            'application/pdf': 'PDF Document',\n            'text/plain': 'Text File',\n            'text/markdown': 'Markdown',\n            'application/json': 'JSON',\n            'text/html': 'HTML',\n            'text/css': 'CSS',\n            'application/javascript': 'JavaScript',\n            'application/typescript': 'TypeScript'\n        };\n\n        // Check for exact matches first\n        if (typeMap[mimeType]) return typeMap[mimeType];\n\n        // Check for category matches\n        if (mimeType.startsWith('image/')) return 'Image';\n        if (mimeType.startsWith('text/')) return 'Text File';\n        if (mimeType.startsWith('application/')) return 'Document';\n\n        return mimeType.split('/')[1]?.toUpperCase() || 'File';\n    }\n\n    private formatFileSize(bytes: number): string {\n        if (bytes < 1024) return `${bytes} B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n        return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    }\n\n    revokeAllPreviewUrls(state: WorkCenterState): void {\n        try {\n            for (const f of state.files) {\n                this.revokePreviewUrl(f);\n            }\n        } catch {\n            // ignore\n        }\n    }\n\n    private isValidUrl(string: string): boolean {\n        try {\n            new URL(string);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    updateDropHint(): void {\n        if (!this.container) return;\n\n        const hintElement = this.container.querySelector('[data-drop-hint]') as HTMLElement;\n        if (!hintElement) return;\n\n        const currentHash = globalThis?.location?.hash;\n\n        switch (currentHash) {\n            case ROUTE_HASHES.SHARE_TARGET_TEXT:\n                hintElement.textContent = 'Drop text files or paste text content here';\n                break;\n            case ROUTE_HASHES.SHARE_TARGET_IMAGE:\n                hintElement.textContent = 'Drop image files here (PNG, JPG, GIF, WebP, etc.)';\n                break;\n            case ROUTE_HASHES.SHARE_TARGET_FILES:\n                hintElement.textContent = 'Drop any files here (images, documents, text files, PDFs, etc.)';\n                break;\n            case ROUTE_HASHES.SHARE_TARGET_URL:\n                hintElement.textContent = 'Paste URLs here (file drops not accepted on this route)';\n                break;\n            default:\n                hintElement.textContent = 'Supports: Images, Documents, Text files, PDFs, URLs, Base64 data';\n                break;\n        }\n    }\n}","import type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport type { WorkCenterTemplates } from \"./WorkCenterTemplates\";\nimport type { WorkCenterVoice } from \"./WorkCenterVoice\";\nimport type { CustomInstruction } from \"@rs-com/config/SettingsTypes\";\n\nexport class WorkCenterPrompts {\n    private container: HTMLElement | null = null;\n    private deps: WorkCenterDependencies;\n    private templates: WorkCenterTemplates;\n    private voice: WorkCenterVoice;\n\n    constructor(dependencies: WorkCenterDependencies, templates: WorkCenterTemplates, voice: WorkCenterVoice) {\n        this.deps = dependencies;\n        this.templates = templates;\n        this.voice = voice;\n    }\n\n    setContainer(container: HTMLElement | null): void {\n        this.container = container;\n    }\n\n\n\n    renderPromptPanel(state: WorkCenterState): string {\n        return `\n            <div class=\"prompt-panel\">\n              <div class=\"prompt-controls\">\n                <select class=\"template-select\">\n                  <option value=\"\">Select Template...</option>\n                  ${state.promptTemplates.map(t => `<option value=\"${t.prompt.replace(/\"/g, '&quot;')}\" ${state.selectedTemplate === t.prompt ? 'selected' : ''}>${t.name}</option>`).join('')}\n                </select>\n                <button class=\"btn btn-icon\" data-action=\"edit-templates\" title=\"Edit Templates\">\n                  <ui-icon icon=\"gear\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                  <span class=\"btn-text\">Templates</span>\n                </button>\n                <button class=\"btn btn-icon prompt-attach-btn\" data-action=\"select-files\" title=\"Attach files\">\n                  <ui-icon icon=\"paperclip\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                  <span class=\"attach-count\" data-prompt-file-count>${state.files.length}</span>\n                </button>\n              </div>\n\n              <div class=\"prompt-input-group\" data-prompt-dropzone data-dropzone=\"\">\n                <div class=\"prompt-input-overlay\" data-prompt-drop-hint>\n                  <ui-icon icon=\"paperclip\" size=\"16\" icon-style=\"duotone\"></ui-icon>\n                  <span>Drop files, links or text to attach</span>\n                </div>\n                <textarea\n                  class=\"prompt-input\"\n                  placeholder=\"Describe what you want to do with the attached content... (or use voice input)\"\n                  rows=\"4\"\n                >${state.currentPrompt}</textarea>\n              </div>\n\n              <div class=\"prompt-actions\">\n                \n                <button class=\"btn voice-btn ${state.voiceRecording ? 'recording' : ''}\" data-action=\"voice-input\">\n                  <ui-icon icon=\"microphone\" size=\"20\" icon-style=\"duotone\"></ui-icon>\n                  ${state.voiceRecording ? 'Recording...' : 'Hold for Voice'}\n                </button>\n                <label class=\"auto-action-label\" title=\"Auto-action (use last successful)\">\n                  <input type=\"checkbox\" class=\"auto-action-checkbox\" ${state.autoAction ? 'checked' : ''}>\n                  <ui-icon icon=\"lightning-a\" size=\"20\" icon-style=\"duotone\"></ui-icon>\n                </label>\n                <button class=\"btn primary action-btn\" data-action=\"execute\">\n                  <ui-icon icon=\"brain\" size=\"20\" icon-style=\"duotone\"></ui-icon>\n                  <span class=\"btn-text\">Process Content</span>\n                </button>\n                <button class=\"btn btn-icon clear-btn\" data-action=\"clear-prompt\" title=\"Clear Prompt\">\n                  <ui-icon icon=\"trash\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n                </button>\n              </div>\n            </div>\n        `;\n    }\n\n    // Backward-compatible section render (unused in tabbed UI)\n    renderPromptsSection(state: WorkCenterState): string {\n        return `\n            <div class=\"prompts-section\">\n              ${this.renderPromptPanel(state)}\n            </div>\n        `;\n    }\n\n    /** Populate the instruction selector with custom instructions from settings */\n    async populateInstructionSelect(state: WorkCenterState): Promise<void> {\n        if (!this.container) return;\n        const select = this.container.querySelector('.instruction-select') as HTMLSelectElement;\n        if (!select) return;\n\n        const instructions = await this.templates.loadInstructions();\n        const hasStoredSelection = Boolean(state.selectedInstruction) && instructions.some(i => i.id === state.selectedInstruction);\n        const selectedId = hasStoredSelection ? state.selectedInstruction : this.templates.getActiveInstructionId();\n        select.innerHTML = '<option value=\"\">None (default)</option>';\n\n        for (const instr of instructions) {\n            const opt = document.createElement('option');\n            opt.value = instr.id;\n            opt.textContent = instr.label;\n            if (instr.id === selectedId) opt.selected = true;\n            select.append(opt);\n        }\n\n        if ((!state.selectedInstruction || !hasStoredSelection) && selectedId) {\n            state.selectedInstruction = selectedId;\n        }\n    }\n\n    /** Update the instruction selector options (sync, after loadInstructions) */\n    updateInstructionSelect(state: WorkCenterState): void {\n        if (!this.container) return;\n        const select = this.container.querySelector('.instruction-select') as HTMLSelectElement;\n        if (!select) return;\n\n        const instructions = this.templates.getInstructions();\n        const hasStoredSelection = Boolean(state.selectedInstruction) && instructions.some(i => i.id === state.selectedInstruction);\n        const selectedId = hasStoredSelection ? state.selectedInstruction : this.templates.getActiveInstructionId();\n        select.innerHTML = '<option value=\"\">None (default)</option>';\n\n        for (const instr of instructions) {\n            const opt = document.createElement('option');\n            opt.value = instr.id;\n            opt.textContent = instr.label;\n            if (instr.id === selectedId) opt.selected = true;\n            select.append(opt);\n        }\n    }\n\n    /** Get the currently selected instruction object */\n    getSelectedInstruction(state: WorkCenterState): CustomInstruction | null {\n        if (!state.selectedInstruction) return null;\n        return this.templates.getInstructionById(state.selectedInstruction) || null;\n    }\n\n    // Update prompt input value\n    updatePromptInput(state: WorkCenterState): void {\n        if (!this.container) return;\n        const promptInput = this.container.querySelector('.prompt-input') as HTMLTextAreaElement;\n        if (promptInput) {\n            promptInput.value = state.currentPrompt;\n        }\n    }\n\n    // Update template select\n    updateTemplateSelect(state: WorkCenterState): void {\n        if (!this.container) return;\n        const templateSelect = this.container.querySelector('.template-select') as HTMLSelectElement;\n        if (templateSelect) {\n            const currentValue = templateSelect.value;\n            templateSelect.innerHTML = '<option value=\"\">Select Template...</option>' +\n                state.promptTemplates.map(t =>\n                    `<option value=\"${t.prompt.replace(/\"/g, '&quot;')}\" ${state.selectedTemplate === t.prompt ? 'selected' : ''}>${t.name}</option>`\n                ).join('');\n\n            // Restore the selected value if it still exists, otherwise keep current\n            if (state.selectedTemplate && state.promptTemplates.some(t => t.prompt === state.selectedTemplate)) {\n                templateSelect.value = state.selectedTemplate;\n            } else {\n                templateSelect.value = currentValue;\n            }\n        }\n    }\n\n    // Update voice button state\n    updateVoiceButton(state: WorkCenterState): void {\n        if (!this.container) return;\n        const voiceBtn = this.container.querySelector('[data-action=\"voice-input\"]') as HTMLButtonElement;\n        if (voiceBtn) {\n            voiceBtn.innerHTML = state.voiceRecording ? '<ui-icon icon=\"microphone\" size=\"20\" icon-style=\"duotone\"></ui-icon> Recording...' : '<ui-icon icon=\"microphone\" size=\"20\" icon-style=\"duotone\"></ui-icon> Hold for Voice';\n            voiceBtn.classList.toggle('recording', state.voiceRecording);\n        }\n    }\n\n    updatePromptFileCount(state: WorkCenterState): void {\n        if (!this.container) return;\n        const count = this.container.querySelector('[data-prompt-file-count]') as HTMLElement | null;\n        if (count) {\n            count.textContent = String(state.files.length);\n        }\n    }\n\n    // Clear prompt\n    clearPrompt(state: WorkCenterState): void {\n        state.currentPrompt = '';\n        this.updatePromptInput(state);\n    }\n\n    // Handle template selection\n    handleTemplateSelection(state: WorkCenterState, selectedPrompt: string): void {\n        state.selectedTemplate = selectedPrompt;\n\n        // Always apply the selected template - templates provide structured prompts\n        // Users can modify them after selection if needed\n        if (selectedPrompt) {\n            state.currentPrompt = selectedPrompt;\n            this.updatePromptInput(state);\n        }\n    }\n\n    // Handle instruction selection\n    handleInstructionSelection(state: WorkCenterState, instructionId: string): void {\n        state.selectedInstruction = instructionId;\n    }\n\n    // Handle auto action toggle\n    handleAutoActionToggle(state: WorkCenterState, checked: boolean): void {\n        state.autoAction = checked;\n    }\n}\n","import { H } from \"fest/lure\";\nimport { actionHistory } from \"@rs-com/service/misc/ActionHistory\";\nimport type { ActionEntry } from \"@rs-com/service/misc/ActionHistory\";\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\n\nexport class WorkCenterHistory {\n    private container: HTMLElement | null = null;\n    private deps: WorkCenterDependencies;\n\n    constructor(dependencies: WorkCenterDependencies) {\n        this.deps = dependencies;\n    }\n\n    setContainer(container: HTMLElement | null): void {\n        this.container = container;\n    }\n\n    // Update recent history display\n    updateRecentHistory(state: WorkCenterState): void {\n        if (!this.container) return;\n        const historyContainer = this.container.querySelector('[data-recent-history]') as HTMLElement;\n        if (!historyContainer) return;\n\n        historyContainer.innerHTML = '';\n\n        // Get recent entries from action history (workcenter only)\n        const recentItems = actionHistory.getRecentEntries(10).filter(\n            entry => entry.context.source === 'workcenter' && entry.status === 'completed'\n        );\n\n        if (recentItems.length === 0) {\n            historyContainer.innerHTML = '<div class=\"wc-history-empty\">No recent activity</div>';\n            return;\n        }\n\n        recentItems.slice(0, 3).forEach(item => {\n            const historyItem = H`<div class=\"history-item-compact\">\n        <div class=\"history-meta\">\n          <span class=\"history-status ${item.result?.type !== 'error' ? 'success' : 'error'}\">${item.result?.type !== 'error' ? '' : ''}</span>\n          <span class=\"history-prompt\">${item.input.text?.substring(0, 50) || item.action}${item.input.text && item.input.text.length > 50 ? '...' : ''}</span>\n          ${item.result?.processingTime ? H`<span class=\"history-time\">${Math.round(item.result.processingTime / 1000)}s</span>` : ''}\n        </div>\n        <button class=\"btn small\" data-restore=\"${item.id}\">Use</button>\n      </div>` as HTMLElement;\n\n            historyItem.querySelector('button')?.addEventListener('click', () => {\n                if (item.input.text) {\n                    state.currentPrompt = item.input.text;\n                    // This will be handled by the inputs module\n                    this.deps.showMessage?.('Restored prompt from history');\n                }\n            });\n\n            historyContainer.append(historyItem);\n        });\n    }\n\n    // Update action history stats\n    updateActionHistory(): void {\n        if (!this.container) return;\n        // Update action history stats if there's a stats display\n        const statsContainer = this.container.querySelector('[data-action-stats]') as HTMLElement;\n        if (statsContainer) {\n            const stats = actionHistory.getStats();\n            statsContainer.innerHTML = `\n                <div class=\"stats-item\">Total: ${stats.total}</div>\n                <div class=\"stats-item\">Success: ${stats.completed}</div>\n                <div class=\"stats-item\">Failed: ${stats.failed}</div>\n            `;\n        }\n    }\n\n    // Show full action history modal\n    showActionHistory(): void {\n        if (!this.container) return;\n\n        const actionEntries = actionHistory.getRecentEntries(50).filter(\n            entry => entry.context.source === 'workcenter'\n        );\n\n        const modal = H`<div class=\"action-history-modal\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3>Action History</h3>\n          <div class=\"modal-actions\">\n            <button class=\"btn btn-icon\" data-action=\"export-history\" title=\"Export History\">\n              <ui-icon icon=\"download\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n            </button>\n            <button class=\"btn btn-icon\" data-action=\"clear-history\" title=\"Clear History\">\n              <ui-icon icon=\"trash\" size=\"18\" icon-style=\"duotone\"></ui-icon>\n            </button>\n            <button class=\"btn\" data-action=\"close-modal\">Close</button>\n          </div>\n        </div>\n\n        <div class=\"history-stats\">\n          ${(() => {\n            const stats = actionHistory.getStats();\n            return H`\n              <div class=\"stat-card\">\n                <div class=\"stat-value\">${stats.total}</div>\n                <div class=\"stat-label\">Total Actions</div>\n              </div>\n              <div class=\"stat-card\">\n                <div class=\"stat-value success\">${stats.completed}</div>\n                <div class=\"stat-label\">Completed</div>\n              </div>\n              <div class=\"stat-card\">\n                <div class=\"stat-value error\">${stats.failed}</div>\n                <div class=\"stat-label\">Failed</div>\n              </div>\n              <div class=\"stat-card\">\n                <div class=\"stat-value\">${stats.byAction['recognize'] || 0}</div>\n                <div class=\"stat-label\">Recognitions</div>\n              </div>\n            `;\n          })()}\n        </div>\n\n        <div class=\"history-filters\">\n          <select class=\"filter-select\" data-filter=\"status\">\n            <option value=\"\">All Status</option>\n            <option value=\"completed\">Completed</option>\n            <option value=\"failed\">Failed</option>\n            <option value=\"processing\">Processing</option>\n          </select>\n          <select class=\"filter-select\" data-filter=\"action\">\n            <option value=\"\">All Actions</option>\n            <option value=\"recognize\">Recognize</option>\n            <option value=\"analyze\">Analyze</option>\n            <option value=\"process\">Process</option>\n          </select>\n        </div>\n\n        <div class=\"action-history-list\">\n          ${actionEntries.length === 0 ? H`<div class=\"wc-history-empty\">No actions found</div>` :\n            actionEntries.map(entry => H`<div class=\"action-history-item ${entry.status}\">\n              <div class=\"action-header\">\n                <div class=\"action-meta\">\n                  <span class=\"action-status ${entry.status}\">${this.getStatusIcon(entry.status)}</span>\n                  <span class=\"action-type\">${entry.action}</span>\n                  <span class=\"action-time\">${this.formatTimeAgo(entry.timestamp)}</span>\n                  ${entry.result?.processingTime ? H`<span class=\"action-duration\">${Math.round(entry.result.processingTime / 1000)}s</span>` : ''}\n                </div>\n                <div class=\"action-actions\">\n                  ${entry.result ? H`<button class=\"btn small\" data-restore-action=\"${entry.id}\">Use Result</button>` : ''}\n                  <button class=\"btn small\" data-view-details=\"${entry.id}\">Details</button>\n                </div>\n              </div>\n\n              <div class=\"action-content\">\n                <div class=\"input-preview\">\n                  <strong>Input:</strong>\n                  ${entry.input.files?.length ?\n                    `${entry.input.files.length} file(s): ${entry.input.files.map(f => f.name).join(', ')}` :\n                    entry.input.text?.substring(0, 100) || 'No input'\n                  }\n                  ${entry.input.text && entry.input.text.length > 100 ? '...' : ''}\n                </div>\n\n                ${entry.result ? H`<div class=\"result-preview\">\n                  <strong>Result:</strong>\n                  <div class=\"result-content\">${entry.result.content.substring(0, 200)}${entry.result.content.length > 200 ? '...' : ''}</div>\n                </div>` : ''}\n\n                ${entry.error ? H`<div class=\"error-preview\">\n                  <strong>Error:</strong> ${entry.error}\n                </div>` : ''}\n              </div>\n            </div>`)}\n        </div>\n      </div>\n    </div>` as HTMLElement;\n\n        // Add event listeners\n        modal.addEventListener('click', (e) => {\n            const target = e.target as HTMLElement;\n            const action = target.getAttribute('data-action') || target.closest('[data-action]')?.getAttribute('data-action');\n            const entryId = target.getAttribute('data-restore-action') || target.getAttribute('data-view-details');\n\n            if (action === 'close-modal') {\n                modal.remove();\n            } else if (action === 'export-history') {\n                this.exportActionHistory();\n            } else if (action === 'clear-history') {\n                if (confirm('Are you sure you want to clear all action history?')) {\n                    actionHistory.clearEntries();\n                    modal.remove();\n                    this.updateRecentHistory({} as WorkCenterState);\n                }\n            } else if (entryId) {\n                const entry = actionHistory.getEntry(entryId);\n                if (entry) {\n                    if (target.hasAttribute('data-restore-action') && entry.result) {\n                        // Restore result to output - this will be handled by results module\n                        this.deps.showMessage?.('Result restored from history');\n                        modal.remove();\n                    } else if (target.hasAttribute('data-view-details')) {\n                        this.showActionDetails(entry);\n                    }\n                }\n            }\n        });\n\n        // Add filter listeners\n        modal.querySelectorAll('.filter-select').forEach(select => {\n            select.addEventListener('change', () => this.applyHistoryFilters(modal));\n        });\n\n        this.container.append(modal);\n    }\n\n    // Show action details modal\n    private showActionDetails(entry: ActionEntry): void {\n        const modal = H`<div class=\"action-details-modal\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3>Action Details</h3>\n          <button class=\"btn\" data-action=\"close-modal\">Close</button>\n        </div>\n\n        <div class=\"details-grid\">\n          <div class=\"detail-item\">\n            <label>ID:</label>\n            <span>${entry.id}</span>\n          </div>\n          <div class=\"detail-item\">\n            <label>Timestamp:</label>\n            <span>${new Date(entry.timestamp).toLocaleString()}</span>\n          </div>\n          <div class=\"detail-item\">\n            <label>Source:</label>\n            <span>${entry.context.source}</span>\n          </div>\n          <div class=\"detail-item\">\n            <label>Action:</label>\n            <span>${entry.action}</span>\n          </div>\n          <div class=\"detail-item\">\n            <label>Status:</label>\n            <span class=\"status-${entry.status}\">${entry.status}</span>\n          </div>\n          ${entry.result?.processingTime ? H`<div class=\"detail-item\">\n            <label>Processing Time:</label>\n            <span>${Math.round(entry.result.processingTime / 1000)}s</span>\n          </div>` : ''}\n        </div>\n\n        <div class=\"details-section\">\n          <h4>Input</h4>\n          <div class=\"input-details\">\n            <div>Type: ${entry.input.type}</div>\n            ${entry.input.files ? H`<div>Files: ${entry.input.files.map(f => f.name).join(', ')}</div>` : ''}\n            ${entry.input.text ? H`<div>Text: <pre>${entry.input.text}</pre></div>` : ''}\n          </div>\n        </div>\n\n        ${entry.result ? H`<div class=\"details-section\">\n          <h4>Result</h4>\n          <div class=\"result-details\">\n            <div>Type: ${entry.result.type}</div>\n            <div>Auto Copied: ${entry.result.autoCopied ? 'Yes' : 'No'}</div>\n            <div>Content: <pre>${entry.result.content}</pre></div>\n          </div>\n        </div>` : ''}\n\n        ${entry.error ? H`<div class=\"details-section\">\n          <h4>Error</h4>\n          <div class=\"error-details\">${entry.error}</div>\n        </div>` : ''}\n      </div>\n    </div>` as HTMLElement;\n\n        modal.addEventListener('click', (e) => {\n            if ((e.target as HTMLElement).getAttribute('data-action') === 'close-modal') {\n                modal.remove();\n            }\n        });\n\n        document.body.append(modal);\n    }\n\n    // Apply filters to history modal\n    private applyHistoryFilters(modal: HTMLElement): void {\n        const statusFilter = (modal.querySelector('[data-filter=\"status\"]') as HTMLSelectElement).value;\n        const actionFilter = (modal.querySelector('[data-filter=\"action\"]') as HTMLSelectElement).value;\n\n        const items = modal.querySelectorAll('.action-history-item');\n        items.forEach(item => {\n            const status = item.classList[1]; // Second class is status\n            const action = item.querySelector('.action-type')?.textContent || '';\n\n            const statusMatch = !statusFilter || status === statusFilter;\n            const actionMatch = !actionFilter || action === actionFilter;\n\n            (item as HTMLElement).style.display = statusMatch && actionMatch ? 'block' : 'none';\n        });\n    }\n\n    // Export action history\n    private exportActionHistory(): void {\n        const data = actionHistory.exportEntries('json');\n        const blob = new Blob([data], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `action-history-${new Date().toISOString().split('T')[0]}.json`;\n        document.body.append(link);\n        link.click();\n        link.remove();\n\n        URL.revokeObjectURL(url);\n        this.deps.showMessage?.('History exported successfully');\n    }\n\n    // Helper methods\n    private getStatusIcon(status: ActionEntry['status']): string {\n        switch (status) {\n            case 'completed': return '';\n            case 'failed': return '';\n            case 'processing': return '';\n            case 'pending': return '';\n            case 'cancelled': return '';\n            default: return '?';\n        }\n    }\n\n    private formatTimeAgo(timestamp: number): string {\n        const now = Date.now();\n        const diff = now - timestamp;\n        const minutes = Math.floor(diff / 60000);\n        const hours = Math.floor(diff / 3600000);\n        const days = Math.floor(diff / 86400000);\n\n        if (days > 0) return `${days}d ago`;\n        if (hours > 0) return `${hours}h ago`;\n        if (minutes > 0) return `${minutes}m ago`;\n        return 'Just now';\n    }\n\n    // Get last successful prompt from history\n    getLastSuccessfulPrompt(): string {\n        const lastSuccessful = this.deps.history.find(h => h.ok);\n        return lastSuccessful?.prompt || \"Process the provided content\";\n    }\n}","// Configure marked with KaTeX extension for HTML output with proper delimiters\nimport { marked, type MarkedExtension } from \"marked\";\nimport markedKatex from \"marked-katex-extension\";\nimport renderMathInElement from \"katex/dist/contrib/auto-render.mjs\";\n\nmarked?.use?.(markedKatex({\n    throwOnError: false,\n    nonStandard: true,\n    output: \"mathml\",\n    strict: false,\n}) as unknown as MarkedExtension,\n{\n    hooks: {\n        preprocess: (markdown: string): string => {\n            if (/\\\\(.*\\\\)|\\\\[.*\\\\]/.test(markdown)) {\n                const katexNode = document.createElement('div')\n                katexNode.innerHTML = markdown\n                renderMathInElement(katexNode, {\n                    throwOnError: false,\n                    nonStandard: true,\n                    output: \"mathml\",\n                    strict: false,\n                    delimiters: [\n                        { left: \"$$\", right: \"$$\", display: true },\n                        { left: \"\\\\[\", right: \"\\\\]\", display: true },\n                        { left: \"$\", right: \"$\", display: false },\n                        { left: \"\\\\(\", right: \"\\\\)\", display: false }\n                    ]\n                })\n\n                return katexNode.innerHTML\n            }\n            return markdown\n        },\n    },\n});\n\n// Re-export state and dependencies interfaces for backward compatibility\nexport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\n\nimport type { WorkCenterState, WorkCenterDependencies } from \"./WorkCenterState\";\nimport { WorkCenterStateManager } from \"./WorkCenterState\";\nimport { WorkCenterUI } from \"./WorkCenterUI\";\nimport { WorkCenterFileOps } from \"./WorkCenterFileOps\";\nimport { WorkCenterShareTarget } from \"./WorkCenterShareTarget\";\nimport { WorkCenterTemplates } from \"./WorkCenterTemplates\";\nimport { WorkCenterVoice } from \"./WorkCenterVoice\";\nimport { WorkCenterActions } from \"./WorkCenterActions\";\nimport { WorkCenterDataProcessing } from \"./WorkCenterDataProcessing\";\nimport { WorkCenterEvents } from \"./WorkCenterEvents\";\n\n// Import component registration system\nimport { registerComponent, initializeComponent } from \"@rs-com/core/UnifiedMessaging\";\nimport { WorkCenterResults } from \"./WorkCenterResults\";\nimport { WorkCenterAttachments } from \"./WorkCenterAttachments\";\nimport { WorkCenterPrompts } from \"./WorkCenterPrompts\";\nimport { WorkCenterHistory } from \"./WorkCenterHistory\";\n\nexport class WorkCenterManager {\n    private state: WorkCenterState;\n    private deps: WorkCenterDependencies;\n\n    // Sub-modules\n    private ui: WorkCenterUI;\n    private fileOps: WorkCenterFileOps;\n    private shareTarget: WorkCenterShareTarget;\n    private templates: WorkCenterTemplates;\n    private voice: WorkCenterVoice;\n    private actions: WorkCenterActions;\n    private dataProcessing: WorkCenterDataProcessing;\n    private attachments: WorkCenterAttachments;\n    private prompts: WorkCenterPrompts;\n    private results: WorkCenterResults;\n    private history: WorkCenterHistory;\n    private events: WorkCenterEvents;\n\n    constructor(dependencies: WorkCenterDependencies) {\n        this.deps = dependencies;\n        this.state = WorkCenterStateManager.createDefaultState();\n\n        // Initialize sub-modules\n        this.dataProcessing = new WorkCenterDataProcessing();\n        this.templates = new WorkCenterTemplates(dependencies);\n        this.voice = new WorkCenterVoice(dependencies);\n        this.fileOps = new WorkCenterFileOps(dependencies);\n        this.history = new WorkCenterHistory(dependencies);\n        this.attachments = new WorkCenterAttachments(dependencies, this.fileOps);\n        this.prompts = new WorkCenterPrompts(dependencies, this.templates, this.voice);\n        this.results = new WorkCenterResults(dependencies, this.dataProcessing);\n        this.ui = new WorkCenterUI(dependencies, this.attachments, this.prompts, this.results, this.history);\n        this.shareTarget = new WorkCenterShareTarget(dependencies, this.fileOps);\n        this.actions = new WorkCenterActions(dependencies, this.ui, this.fileOps, this.dataProcessing, this.results, this.history, this.templates);\n        this.events = new WorkCenterEvents(\n            dependencies,\n            this.ui,\n            this.fileOps,\n            this.actions,\n            this.templates,\n            this.voice,\n            this.shareTarget,\n            this.history,\n            this.attachments,\n            this.prompts,\n            this.state\n        );\n\n        // Initialize share target result listener\n        this.shareTarget.initShareTargetListener(this.state);\n\n        // Register component for catch-up messaging\n        registerComponent('workcenter-core', 'workcenter');\n\n        // Process any queued messages that were sent before work center was available\n        this.shareTarget.processQueuedMessages(this.state);\n\n        // Process pending messages from component registry\n        const pendingMessages = initializeComponent('workcenter-core');\n        for (const message of pendingMessages) {\n            console.log(`[WorkCenter] Processing pending message:`, message);\n            this.handleExternalMessage(message);\n        }\n\n        // Listen for hash changes to update UI elements like drop hints\n        if (typeof globalThis !== 'undefined') {\n            globalThis?.addEventListener?.('hashchange', () => {\n                // Update drop hints when hash changes\n                this.attachments.updateDropHint?.();\n            });\n        }\n    }\n\n    // File handling methods - delegate to fileOps module\n    async handleDroppedContent(content: string, sourceType: string): Promise<void> {\n        return this.fileOps.handleDroppedContent(this.state, content, sourceType);\n    }\n\n    async handlePastedContent(content: string, sourceType: string): Promise<void> {\n        return this.fileOps.handlePastedContent(this.state, content, sourceType);\n    }\n\n    // Handle incoming content from unified messaging system\n    private async handleIncomingContent(data: any, contentType: string): Promise<void> {\n        try {\n            let fileToAttach: File | null = null;\n\n            if (data.file instanceof File) {\n                fileToAttach = data.file;\n            } else if (data.blob instanceof Blob) {\n                const filename = data.filename || `attachment-${Date.now()}.${contentType === 'markdown' ? 'md' : 'txt'}`;\n                fileToAttach = new File([data.blob], filename, { type: data.blob.type });\n            } else if (data.text || data.content) {\n                const content = data.text || data.content;\n                const textContent = typeof content === 'string' ? content : JSON.stringify(content, null, 2);\n                const filename = data.filename || `content-${Date.now()}.${contentType === 'markdown' ? 'md' : 'txt'}`;\n                const mimeType = contentType === 'markdown' ? 'text/markdown' : 'text/plain';\n                fileToAttach = new File([textContent], filename, { type: mimeType });\n            }\n\n            if (fileToAttach) {\n                this.state.files.push(fileToAttach);\n                // Update UI to reflect new file\n                this.ui.updateFileList(this.state);\n                this.ui.updateFileCounter(this.state);\n                this.deps.showMessage(`Attached ${fileToAttach.name} to Work Center`);\n            }\n        } catch (error) {\n            console.warn('[WorkCenter] Failed to handle incoming content:', error);\n            this.deps.showMessage('Failed to attach content');\n        }\n    }\n\n    /**\n     * Public entry for Basic/Main unified-messaging handler and pending inbox replay.\n     * Handles share-target inputs/results and general content-share attachment.\n     */\n    async handleExternalMessage(message: any): Promise<void> {\n        if (!message) return;\n\n        // Share-target messages should update both attachments and results pipeline.\n        if (message.type === 'share-target-input' && message.data) {\n            await this.shareTarget.addShareTargetInput(this.state, message.data);\n            this.ui.updateFileList(this.state);\n            this.ui.updateFileCounter(this.state);\n            this.ui.updateDataPipeline(this.state);\n            return;\n        }\n\n        if (message.type === 'share-target-result' && message.data) {\n            await this.shareTarget.addShareTargetResult(this.state, message.data);\n            this.ui.updateDataPipeline(this.state);\n            return;\n        }\n\n        if (message.type === 'ai-result' && message.data) {\n            await this.shareTarget.handleAIResult(this.state, message.data);\n            this.ui.updateDataPipeline(this.state);\n            return;\n        }\n\n        // Generic content attachment\n        if (message.type === 'content-share' && message.data) {\n            await this.handleIncomingContent(message.data, message.contentType || 'text');\n        }\n    }\n\n\n    getState(): WorkCenterState {\n        return this.state;\n    }\n\n    destroy(): void {\n        // Clear container references\n        this.ui.setContainer(null);\n        this.attachments.setContainer(null);\n        this.prompts.setContainer(null);\n        this.results.setContainer(null);\n        this.history.setContainer(null);\n\n        // The WorkCenterCommunicator handles its own cleanup\n        // No need to manually close channels here\n        console.log('[WorkCenter] WorkCenterManager destroyed');\n    }\n\n    renderWorkCenterView(): HTMLElement {\n        const container = this.ui.renderWorkCenterView(this.state);\n\n        // Set up event listeners\n        this.events.setContainer(container);\n        this.events.setupWorkCenterEvents();\n\n        // Update file list, file counter, and recent history\n        this.ui.updateFileList(this.state);\n        this.ui.updateFileCounter(this.state);\n        this.history.updateRecentHistory(this.state);\n\n        return container;\n    }\n\n}\n","/**\n * Work Center View\n *\n * Shell adapter for the module-based WorkCenter implementation.\n */\n\nimport { loadAsAdopted, removeAdopted } from \"fest/dom\";\nimport type { View, ViewOptions, ViewLifecycle, ShellContext } from \"../../shells/types\";\nimport type { BaseViewOptions } from \"../types\";\nimport { WorkCenterManager } from \"./modules/WorkCenter\";\nimport type { WorkCenterDependencies } from \"./modules/WorkCenterState\";\n\n// @ts-ignore - SCSS import\nimport workcenterStyles from \"./scss/_index.scss?inline\";\n\nexport interface WorkCenterOptions extends BaseViewOptions {\n    initialFiles?: File[];\n    initialPrompt?: string;\n    onProcessComplete?: (result: string) => void;\n    onFilesChange?: (files: File[]) => void;\n}\n\nexport class WorkCenterView implements View {\n    id = \"workcenter\" as const;\n    name = \"Work Center\";\n    icon = \"lightning\";\n\n    private options: WorkCenterOptions;\n    private shellContext?: ShellContext;\n    private element: HTMLElement | null = null;\n    private manager: WorkCenterManager | null = null;\n    private deps: WorkCenterDependencies;\n    private initializedFromOptions = false;\n    private lastOutputText = \"\";\n    private resultObserver: MutationObserver | null = null;\n    private _sheet: CSSStyleSheet | null = null;\n\n    lifecycle: ViewLifecycle = {\n        onMount: () => this.onMount(),\n        onUnmount: () => this.onUnmount(),\n        onShow: () => this.onShow(),\n        onHide: () => this.onHide()\n    };\n\n    constructor(options: WorkCenterOptions = {}) {\n        this.options = options;\n        this.shellContext = options.shellContext;\n\n        this.deps = {\n            state: {},\n            history: [],\n            getSpeechPrompt: async () => null,\n            showMessage: (message: string) => this.showMessage(message),\n            render: () => this.requestRender(),\n            onFilesChanged: () => this.emitFilesChanged()\n        };\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        if (options) {\n            this.options = { ...this.options, ...options };\n            this.shellContext = options.shellContext || this.shellContext;\n        }\n\n        this._sheet = loadAsAdopted(workcenterStyles) as CSSStyleSheet;\n\n        this.manager ??= new WorkCenterManager(this.deps);\n        if (!this.initializedFromOptions) {\n            this.applyInitialOptions();\n            this.initializedFromOptions = true;\n        }\n\n        this.element = this.manager.renderWorkCenterView();\n        this.syncPromptInputFromState();\n        this.setupProcessResultObserver();\n        this.emitFilesChanged();\n        return this.element;\n    }\n\n    getToolbar(): HTMLElement | null {\n        return null;\n    }\n\n    addFiles(files: File[]): void {\n        const state = this.manager?.getState();\n        if (!state || files.length === 0) return;\n        state.files.push(...files);\n        this.requestRender();\n        this.emitFilesChanged();\n    }\n\n    setPrompt(prompt: string): void {\n        const state = this.manager?.getState();\n        if (!state) return;\n        state.currentPrompt = prompt;\n        this.syncPromptInputFromState();\n    }\n\n    getFiles(): File[] {\n        return [...(this.manager?.getState().files || [])];\n    }\n\n    canHandleMessage(messageType: string): boolean {\n        return [\n            \"content-attach\",\n            \"content-process\",\n            \"file-attach\",\n            \"share-target-input\",\n            \"share-target-result\",\n            \"ai-result\",\n            \"content-share\"\n        ].includes(messageType);\n    }\n\n    async handleMessage(message: unknown): Promise<void> {\n        const msg = message as {\n            type?: string;\n            contentType?: string;\n            data?: { file?: File; files?: File[]; text?: string; content?: string; url?: string };\n        };\n\n        if (!this.manager) return;\n\n        if (msg.type === \"share-target-input\" || msg.type === \"share-target-result\" || msg.type === \"ai-result\" || msg.type === \"content-share\") {\n            await this.manager.handleExternalMessage(msg);\n            this.emitFilesChanged();\n            return;\n        }\n\n        if (msg.data?.file) {\n            this.addFiles([msg.data.file]);\n        }\n        if (msg.data?.files?.length) {\n            this.addFiles(msg.data.files);\n        }\n\n        const prompt = msg.data?.text || msg.data?.content || msg.data?.url || \"\";\n        if (prompt.trim()) {\n            this.setPrompt(prompt);\n        }\n\n        if (msg.type === \"content-process\") {\n            const executeBtn = this.element?.querySelector('[data-action=\"execute\"]') as HTMLButtonElement | null;\n            executeBtn?.click();\n        }\n    }\n\n    private applyInitialOptions(): void {\n        const state = this.manager?.getState();\n        if (!state) return;\n\n        if (Array.isArray(this.options.initialFiles) && this.options.initialFiles.length > 0) {\n            state.files.push(...this.options.initialFiles);\n        }\n        if (typeof this.options.initialPrompt === \"string\" && this.options.initialPrompt.trim()) {\n            state.currentPrompt = this.options.initialPrompt;\n        }\n    }\n\n    private syncPromptInputFromState(): void {\n        const state = this.manager?.getState();\n        if (!state || !this.element) return;\n        const promptInput = this.element.querySelector(\".prompt-input\") as HTMLTextAreaElement | null;\n        if (promptInput) {\n            promptInput.value = state.currentPrompt || \"\";\n        }\n    }\n\n    private setupProcessResultObserver(): void {\n        this.resultObserver?.disconnect();\n        if (!this.element || !this.options.onProcessComplete) return;\n\n        const output = this.element.querySelector(\"[data-output]\") as HTMLElement | null;\n        if (!output) return;\n\n        this.resultObserver = new MutationObserver(() => {\n            const resultNode = output.querySelector(\".result-content\") as HTMLElement | null;\n            const text = resultNode?.textContent?.trim() || \"\";\n            if (!text || text === this.lastOutputText) return;\n            this.lastOutputText = text;\n            this.options.onProcessComplete?.(text);\n        });\n\n        this.resultObserver.observe(output, { childList: true, subtree: true, characterData: true });\n    }\n\n    private emitFilesChanged(): void {\n        const files = this.manager?.getState().files || [];\n        this.options.onFilesChange?.([...files]);\n    }\n\n    private requestRender(): void {\n        if (!this.manager || !this.element) return;\n        const parent = this.element.parentElement;\n        const next = this.manager.renderWorkCenterView();\n        if (parent) {\n            parent.replaceChild(next, this.element);\n        }\n        this.element = next;\n        this.syncPromptInputFromState();\n        this.setupProcessResultObserver();\n    }\n\n    private showMessage(message: string): void {\n        this.shellContext?.showMessage(message);\n    }\n\n    private onMount(): void {\n        this._sheet ??= loadAsAdopted(workcenterStyles) as CSSStyleSheet;\n    }\n\n    private onUnmount(): void {\n        this.resultObserver?.disconnect();\n        this.resultObserver = null;\n        this.manager?.destroy();\n        this.manager = null;\n        if (this._sheet) {\n            removeAdopted(this._sheet);\n        }\n        this._sheet = null;\n    }\n\n    private onShow(): void {\n        this._sheet ??= loadAsAdopted(workcenterStyles) as CSSStyleSheet;\n    }\n\n    private onHide(): void {\n        // Keep DOM and manager state alive while hidden.\n    }\n}\n\nexport function createView(options?: WorkCenterOptions): WorkCenterView {\n    return new WorkCenterView(options);\n}\n\nexport const createWorkCenterView = createView;\nexport default createView;\n"],"file":"index6.js"}