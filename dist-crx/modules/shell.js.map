{"version":3,"file":"shell.js","sources":["../../src/frontend/shells/shell.ts"],"sourcesContent":["import { ref } from \"fest/object\";\nimport type { Shell, ShellContext, ShellId, ShellLayoutConfig, ShellNavigationState, ShellTheme, View, ViewId } from \"./types\";\nimport { loadInlineStyle, preloadStyle } from \"fest/dom\";\nimport { ViewRegistry } from \"../shared/registry\";\nimport { showToast } from \"@rs-frontend/items/Toast\";\n\n//\nimport \"fest/fl-ui\";\n\n//@ts-ignore\nimport style from \"../shared/_views.scss?inline\";\n\n\n/**\n * Abstract base shell with common functionality\n */\nexport abstract class ShellBase implements Shell {\n    // Shell properties\n    abstract id: ShellId;\n    abstract name: string;\n    abstract layout: ShellLayoutConfig;\n\n    // State (using any to work around fest/object type inference issue)\n    theme = ref<ShellTheme>({ id: \"auto\", name: \"Auto\", colorScheme: \"auto\" });\n    currentView = ref<ViewId>(\"home\");\n    protected navigationState: ShellNavigationState = {\n        currentView: \"home\",\n        viewHistory: []\n    };\n\n    // DOM elements\n    protected container: HTMLElement | null = null;\n    protected rootElement: HTMLElement | null = null;\n    protected contentContainer: HTMLElement | null = null;\n    protected toolbarContainer: HTMLElement | null = null;\n    protected statusContainer: HTMLElement | null = null;\n\n    // View cache\n    protected loadedViews = new Map<ViewId, { view: View; element: HTMLElement }>();\n    protected currentViewElement: HTMLElement | null = null;\n\n    // Mounted state\n    protected mounted = false;\n\n    // ========================================================================\n    // ABSTRACT METHODS (to be implemented by concrete shells)\n    // ========================================================================\n\n    /**\n     * Create the shell's root layout element\n     */\n    protected abstract createLayout(): HTMLElement;\n\n    /**\n     * Get shell-specific stylesheet (optional)\n     */\n    protected abstract getStylesheet(): string | null;\n\n    // ========================================================================\n    // SHELL INTERFACE IMPLEMENTATION\n    // ========================================================================\n\n    async mount(container: HTMLElement): Promise<void> {\n        if (this.mounted) {\n            console.warn(`[${this.id}] Shell already mounted`);\n            return;\n        }\n\n        this.container = container;\n\n        // Load stylesheet if provided\n        const stylesheet = this.getStylesheet();\n        if (stylesheet) {\n            const styled = await preloadStyle(stylesheet);\n            if (styled) {\n                await loadInlineStyle(stylesheet);\n            }\n        }\n\n        // Create layout\n        this.rootElement = this.createLayout();\n\n        // CRITICAL: Set data-shell attribute for context-based CSS selectors\n        // This enables :has([data-shell=\"...\"\"]) selectors to cascade automatically\n        this.rootElement.setAttribute('data-shell', this.id);\n\n        // Find containers\n        this.contentContainer = this.rootElement.querySelector(\"[data-shell-content]\") || this.rootElement;\n        this.toolbarContainer = this.rootElement.querySelector(\"[data-shell-toolbar]\");\n        this.statusContainer = this.rootElement.querySelector(\"[data-shell-status]\");\n\n        // Apply initial theme\n        this.applyTheme(this.theme.value);\n\n        // Mount to container\n        container.replaceChildren(this.rootElement);\n        this.mounted = true;\n\n        console.log(`[${this.id}] Shell mounted with data-shell=\"${this.id}\"`);\n    }\n\n    unmount(): void {\n        if (!this.mounted) return;\n\n        // Cleanup views\n        for (const [viewId, { view }] of this.loadedViews) {\n            if (view.lifecycle?.onUnmount) {\n                try {\n                    view.lifecycle.onUnmount();\n                } catch (e) {\n                    console.warn(`[${this.id}] View ${viewId} unmount error:`, e);\n                }\n            }\n        }\n        this.loadedViews.clear();\n\n        // Clear DOM\n        this.rootElement?.remove();\n        this.rootElement = null;\n        this.contentContainer = null;\n        this.toolbarContainer = null;\n        this.statusContainer = null;\n        this.container = null;\n        this.mounted = false;\n\n        console.log(`[${this.id}] Shell unmounted`);\n    }\n\n    async navigate(viewId: ViewId, params?: Record<string, string>): Promise<void> {\n        console.log(`[${this.id}] Navigating to: ${viewId}`, params);\n\n        // Update navigation state\n        const previousView = this.navigationState.currentView;\n        this.navigationState.previousView = previousView;\n        this.navigationState.currentView = viewId;\n        this.navigationState.params = params;\n\n        // Add to history (avoid duplicates)\n        if (this.navigationState.viewHistory[this.navigationState.viewHistory.length - 1] !== viewId) {\n            this.navigationState.viewHistory.push(viewId);\n            // Limit history size\n            if (this.navigationState.viewHistory.length > 50) {\n                this.navigationState.viewHistory.shift();\n            }\n        }\n\n        // Update reactive state\n        this.currentView.value = viewId;\n\n        // Update URL pathname (path-based routing, no hash)\n        if (typeof window !== \"undefined\" && typeof window != \"undefined\") {\n            const pathname = `/${viewId}`;\n            const search = params ? \"?\" + new URLSearchParams(params).toString() : \"\";\n            const newUrl = pathname + search;\n\n            if (globalThis?.location?.pathname !== pathname) {\n                globalThis?.history?.pushState?.({ viewId, params }, \"\", newUrl);\n            }\n        }\n\n        // Load and render view\n        try {\n            const element = await this.loadView(viewId, params);\n            this.renderView(element);\n        } catch (error) {\n            console.error(`[${this.id}] Failed to load view ${viewId}:`, error);\n            this.showMessage(`Failed to load ${viewId}`);\n        }\n    }\n\n    async loadView(viewId: ViewId, params?: Record<string, string>): Promise<HTMLElement> {\n        // Check cache first\n        const cached = this.loadedViews.get(viewId);\n        if (cached) {\n            // Call onShow lifecycle\n            if (cached.view.lifecycle?.onShow) {\n                cached.view.lifecycle.onShow();\n            }\n            // Update toolbar if view has one\n            if (cached.view.getToolbar && this.toolbarContainer) {\n                const toolbar = cached.view.getToolbar();\n                this.setViewToolbar(toolbar);\n            }\n            return cached.element;\n        }\n\n        // Load view from registry\n        const view = await ViewRegistry.load(viewId, {\n            shellContext: this.getContext(),\n            params\n        });\n\n        // Render view\n        const element = view.render({\n            shellContext: this.getContext(),\n            params\n        });\n\n        // Cache view\n        this.loadedViews.set(viewId, { view, element });\n\n        // Set toolbar if view has one\n        if (view.getToolbar && this.toolbarContainer) {\n            const toolbar = view.getToolbar();\n            this.setViewToolbar(toolbar);\n        }\n\n        // Call lifecycle\n        if (view.lifecycle?.onMount) {\n            await view.lifecycle.onMount();\n        }\n        if (view.lifecycle?.onShow) {\n            view.lifecycle.onShow();\n        }\n\n        return element;\n    }\n\n    setTheme(theme: ShellTheme): void {\n        this.theme.value = theme;\n        this.applyTheme(theme);\n    }\n\n    getContext(): ShellContext {\n        return {\n            shellId: this.id,\n            navigate: (viewId, params) => this.navigate(viewId, params),\n            goBack: () => this.goBack(),\n            showMessage: (msg, duration) => this.showMessage(msg, duration),\n            navigationState: this.navigationState,\n            theme: this.theme.value,\n            layout: this.layout,\n            getContentContainer: () => this.contentContainer!,\n            getToolbarContainer: () => this.toolbarContainer,\n            setViewToolbar: (toolbar) => this.setViewToolbar(toolbar)\n        };\n    }\n\n    getElement(): HTMLElement {\n        if (!this.rootElement) {\n            throw new Error(`[${this.id}] Shell not mounted`);\n        }\n        return this.rootElement;\n    }\n\n    // ========================================================================\n    // PROTECTED METHODS\n    // ========================================================================\n\n    /**\n     * Render a view into the content container\n     */\n    protected renderView(element: HTMLElement): void {\n        if (!this.contentContainer) {\n            console.warn(`[${this.id}] No content container available`);\n            return;\n        }\n\n        // Detach previous view from DOM and keep it cached in loadedViews.\n        const previousId = this.navigationState.previousView;\n        if (previousId && previousId !== this.currentView.value && this.loadedViews.has(previousId)) {\n            const prev = this.loadedViews.get(previousId)!;\n            if (prev.view.lifecycle?.onHide) {\n                prev.view.lifecycle.onHide();\n            }\n            prev.element.removeAttribute(\"data-view\");\n            prev.element.hidden = true;\n            if (this.contentContainer.contains(prev.element)) {\n                prev.element.remove();\n            }\n        }\n\n        // Show active view and mark it for :has() context selectors.\n        element.setAttribute(\"data-view\", this.currentView.value);\n        element.hidden = false;\n\n        // Add to content if not already there\n        if (!this.contentContainer.contains(element)) {\n            this.contentContainer.appendChild(element);\n        }\n\n        this.currentViewElement = element;\n    }\n\n    /**\n     * Apply theme to the shell\n     */\n    protected applyTheme(theme: ShellTheme): void {\n        if (!this.rootElement) return;\n\n        // Set color scheme\n        const prefersDark = globalThis?.matchMedia?.(\"(prefers-color-scheme: dark)\")?.matches;\n        const resolved = theme.colorScheme === \"dark\" ? \"dark\"\n            : theme.colorScheme === \"light\" ? \"light\"\n            : prefersDark ? \"dark\" : \"light\";\n\n        this.rootElement.dataset.theme = resolved;\n        this.rootElement.style.colorScheme = resolved;\n\n        // Apply CSS variables if provided\n        if (theme.cssVariables) {\n            for (const [key, value] of Object.entries(theme.cssVariables)) {\n                this.rootElement.style.setProperty(key, value);\n            }\n        }\n    }\n\n    /**\n     * Go back in navigation history\n     */\n    protected goBack(): void {\n        const history = this.navigationState.viewHistory;\n        if (history.length > 1) {\n            // Remove current\n            history.pop();\n            // Navigate to previous\n            const previous = history[history.length - 1];\n            if (previous) {\n                this.navigate(previous);\n            }\n        }\n    }\n\n    /**\n     * Show a status message\n     */\n    protected showMessage(message: string, duration = 3000): void {\n        /*if (!this.statusContainer) {\n            console.log(`[${this.id}] Status: ${message}`);\n            return;\n        }\n\n        this.statusContainer.textContent = message;\n        this.statusContainer.hidden = false;\n\n        setTimeout(() => {\n            if (this.statusContainer?.textContent === message) {\n                this.statusContainer.textContent = \"\";\n                this.statusContainer.hidden = true;\n            }\n        }, duration);*/\n\n        showToast({ message, duration, kind: \"info\" });\n    }\n\n    /**\n     * Set the current view's toolbar\n     */\n    protected setViewToolbar(toolbar: HTMLElement | null): void {\n        if (!this.toolbarContainer) return;\n\n        // Clear existing toolbar content\n        this.toolbarContainer.replaceChildren();\n\n        if (toolbar) {\n            this.toolbarContainer.appendChild(toolbar);\n        }\n    }\n\n    // ========================================================================\n    // PATH-BASED NAVIGATION\n    // ========================================================================\n\n    /**\n     * Setup path-based navigation (listen to route-change events)\n     * @deprecated Use setupPopstateNavigation instead\n     */\n    protected setupHashNavigation(): void {\n        // No-op for backwards compatibility\n        // Path-based routing doesn't use hash changes\n    }\n\n    /**\n     * Setup popstate navigation (back/forward buttons)\n     */\n    protected setupPopstateNavigation(): void {\n        if (typeof window === \"undefined\" || typeof window == \"undefined\") return;\n\n        globalThis?.addEventListener?.(\"popstate\", (event) => {\n            // Get view from pathname\n            const pathname = globalThis?.location?.pathname?.replace(/^\\//, \"\").toLowerCase();\n            const viewId = (event.state?.viewId || pathname || \"viewer\") as ViewId;\n\n            if (viewId !== this.currentView.value) {\n                // Navigate without pushing new history\n                this.navigationState.currentView = viewId;\n                this.currentView.value = viewId;\n                this.loadView(viewId, event.state?.params).then(element => {\n                    this.renderView(element);\n                }).catch(console.error);\n            }\n        });\n    }\n\n    /**\n     * Get view ID from current pathname\n     */\n    protected getViewFromPathname(): ViewId | null {\n        if (typeof window === \"undefined\" || typeof window == \"undefined\") return null;\n\n        const pathname = globalThis?.location?.pathname?.replace(/^\\//, \"\").toLowerCase();\n        if (!pathname || pathname === \"/\") {\n            return null; // Root route\n        }\n        return pathname as ViewId;\n    }\n}\n\n"],"names":[],"mappings":"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"}