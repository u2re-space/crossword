import{detectExecutionContext as e}from"./Env.js";const t=async(t,n)=>{if("chrome-extension"!==e())throw new Error("Runtime channel modules can only be created in chrome extension context");const o=(t=>{const n=e();return"chrome-extension"!=n?(console.warn("Chrome extension runtime channels requested but not in chrome extension context. Returning no-op channel."),{async request(e,t=[]){throw console.warn(`CRX messaging not available: ${e}`,t),new Error("Chrome extension messaging is not available in this context")},close(){}}):{async request(e,o=[]){const r={id:`crx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,source:n,target:t,data:1===o.length?o[0]:o,metadata:{timestamp:Date.now()}};return new Promise((t,n)=>{try{console.log("[Runtime Channel] Sending message:",r),chrome.runtime.sendMessage(r,o=>{if(chrome.runtime.lastError)return console.error("[Runtime Channel] Chrome runtime error:",chrome.runtime.lastError),void n(new Error(chrome.runtime.lastError.message));console.log("[Runtime Channel] Received response for",e,":",o),t(o)})}catch(o){console.error("[Runtime Channel] Failed to send message:",o),n(o)}})},close(){}}})(t);console.log("messagingChannel",o);return{capture:async(e,t)=>await(o?.request?.("capture",[{rect:e,mode:t||"recognize"}])),captureScreenshot:async e=>await(o?.request?.("captureScreenshot",[{rect:e}])),processImage:async(e,t)=>await(o?.request?.("processImage",[{imageData:e,mode:t||"recognize"}])),processText:async(e,t)=>await(o?.request?.("processText",[{content:e,contentType:t?.type||"text"}])),async doCopy(e,t){const n=await(o?.request?.("doCopy",[{data:e,showToast:!1!==t?.showToast}]));return!1!==t?.showToast&&n?.success&&"undefined"!=typeof chrome&&chrome.notifications&&chrome.notifications.create({type:"basic",iconUrl:"icons/icon.png",title:"CrossWord",message:"Copied to clipboard!"}),n},loadMarkdown:async e=>await(o?.request?.("loadMarkdown",[e])),captureWithRect:async e=>await(o?.request?.("captureWithRect",[{mode:e||"default"}])),async getCurrentTab(){if("undefined"!=typeof chrome&&chrome.tabs){return(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]}return null},sendMessage:async(e,t)=>await(o?.request?.(e,t?[t]:[])),close(){o?.close?.()}}};export{t as createRuntimeChannelModule};
