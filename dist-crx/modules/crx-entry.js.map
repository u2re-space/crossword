{"version":3,"mappings":"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","names":["applyAppTheme"],"ignoreList":[],"sources":["../../src/com/core/ServiceChannels.ts","../../src/com/core/ShareTargetGateway.ts","../../src/frontend/shared/view-message-routing.ts","../../src/frontend/shared/channel-mixin.ts","../../src/frontend/shared/registry.ts","../../../../modules/projects/lur.e/src/extension/core/UIState.ts","../../src/core/storage/StateStorage.ts","../../src/core/utils/Theme.ts","../../../../modules/projects/veela.css/src/scss/runtime/core/index.ts","../../../../modules/projects/veela.css/src/scss/runtime/basic/index.ts","../../../../modules/projects/veela.css/src/scss/runtime/advanced/index.ts","../../../../modules/projects/veela.css/src/scss/runtime/beercss/index.ts","../../../../modules/projects/veela.css/src/scss/runtime/index.ts","../../../../modules/projects/veela.css/src/ts/font-loader.ts","../../src/frontend/shared/layer-manager.ts","../../src/frontend/main/BootLoader.ts","../../src/frontend/main/crx-entry.ts"],"sourcesContent":["/**\n * Service Channels for CrossWord\n * Extends fest/uniform ServiceChannelManager with app-specific configuration\n */\n\nimport {\n    ServiceChannelManager,\n    createServiceChannelManager,\n    type ServiceChannelConfig,\n    type ChannelMessage,\n    type ChannelState\n} from 'fest/uniform';\n\nimport { BROADCAST_CHANNELS, ROUTE_HASHES, COMPONENTS } from '@rs-com/config/Names';\n\n// Re-export types for consumers\nexport type { ServiceChannelConfig, ChannelMessage, ChannelState };\n\n// ============================================================================\n// CHANNEL TYPES\n// ============================================================================\n\n/**\n * Service/view channel identifiers\n */\nexport type ServiceChannelId = \n    | \"workcenter\"\n    | \"settings\"\n    | \"viewer\"\n    | \"explorer\"\n    | \"airpad\"\n    | \"print\"\n    | \"history\"\n    | \"editor\"\n    | \"home\";\n\n// ============================================================================\n// APP-SPECIFIC CHANNEL CONFIGURATION\n// ============================================================================\n\nexport const SERVICE_CHANNEL_CONFIG: Record<ServiceChannelId, ServiceChannelConfig> = {\n    workcenter: {\n        broadcastName: BROADCAST_CHANNELS.WORK_CENTER,\n        routeHash: ROUTE_HASHES.WORKCENTER,\n        component: COMPONENTS.WORK_CENTER,\n        description: \"AI work center for processing files and content\"\n    },\n    settings: {\n        broadcastName: BROADCAST_CHANNELS.SETTINGS,\n        routeHash: ROUTE_HASHES.SETTINGS,\n        component: COMPONENTS.SETTINGS,\n        description: \"Application settings and configuration\"\n    },\n    viewer: {\n        broadcastName: BROADCAST_CHANNELS.MARKDOWN_VIEWER,\n        routeHash: ROUTE_HASHES.MARKDOWN_VIEWER,\n        component: COMPONENTS.MARKDOWN_VIEWER,\n        description: \"Content viewer for markdown and files\"\n    },\n    explorer: {\n        broadcastName: BROADCAST_CHANNELS.FILE_EXPLORER,\n        routeHash: ROUTE_HASHES.FILE_EXPLORER,\n        component: COMPONENTS.FILE_EXPLORER,\n        description: \"File explorer and browser\"\n    },\n    airpad: {\n        broadcastName: \"rs-airpad\",\n        routeHash: \"#airpad\",\n        component: \"airpad\",\n        description: \"Touch-friendly input pad\"\n    },\n    print: {\n        broadcastName: BROADCAST_CHANNELS.PRINT_CHANNEL,\n        routeHash: ROUTE_HASHES.PRINT,\n        component: COMPONENTS.BASIC_PRINT,\n        description: \"Print preview and export\"\n    },\n    history: {\n        broadcastName: BROADCAST_CHANNELS.HISTORY_CHANNEL,\n        routeHash: ROUTE_HASHES.HISTORY,\n        component: COMPONENTS.HISTORY,\n        description: \"Action history and undo/redo\"\n    },\n    editor: {\n        broadcastName: \"rs-editor\",\n        routeHash: ROUTE_HASHES.MARKDOWN_EDITOR,\n        component: COMPONENTS.MARKDOWN_EDITOR,\n        description: \"Content editor\"\n    },\n    home: {\n        broadcastName: \"rs-home\",\n        routeHash: \"#home\",\n        component: \"home\",\n        description: \"Home/landing view\"\n    }\n};\n\n// ============================================================================\n// APP-SPECIFIC SERVICE CHANNEL MANAGER\n// ============================================================================\n\nlet appServiceChannelManager: ServiceChannelManager<ServiceChannelId> | null = null;\n\n/**\n * Get the app-configured ServiceChannelManager\n */\nexport function getServiceChannels(): ServiceChannelManager<ServiceChannelId> {\n    if (!appServiceChannelManager) {\n        appServiceChannelManager = createServiceChannelManager<ServiceChannelId>({\n            channels: SERVICE_CHANNEL_CONFIG,\n            logPrefix: '[ServiceChannels]'\n        });\n    }\n    return appServiceChannelManager;\n}\n\n// Singleton instance for backward compatibility\nexport const serviceChannels = getServiceChannels();\n\n// ============================================================================\n// CONVENIENCE EXPORTS\n// ============================================================================\n\n/**\n * Initialize a service channel\n */\nexport const initServiceChannel = (channelId: ServiceChannelId) => \n    serviceChannels.initChannel(channelId);\n\n/**\n * Send a message to a channel\n */\nexport const sendToChannel = <T>(target: ServiceChannelId, type: string, data: T) =>\n    serviceChannels.send(target, type, data);\n\n/**\n * Subscribe to channel messages\n */\nexport const affectedToChannel = (\n    channelId: ServiceChannelId,\n    handler: (msg: ChannelMessage) => void\n) => serviceChannels.affected(channelId, handler);\n\n/**\n * Broadcast to all channels\n */\nexport const broadcastToAll = <T>(type: string, data: T) =>\n    serviceChannels.broadcast(type, data);\n\n// Re-export the ServiceChannelManager class for advanced usage\nexport { ServiceChannelManager };\n","import { API_ENDPOINTS } from \"@rs-com/config/Names\";\n\nexport const SHARE_CACHE_NAME = \"share-target-data\";\nexport const SHARE_CACHE_KEY = \"/share-target-data\";\nexport const SHARE_FILES_MANIFEST_KEY = \"/share-target-files\";\nexport const SHARE_FILE_PREFIX = \"/share-target-file/\";\n\nexport type CachedShareFileMeta = {\n    key: string;\n    name: string;\n    type: string;\n    size: number;\n    lastModified?: number;\n};\n\nexport type CachedShareTargetPayload = {\n    meta: unknown;\n    files: File[];\n    fileMeta: CachedShareFileMeta[];\n};\n\nexport type SwCachedContentItem = {\n    key: string;\n    context?: string;\n    content?: unknown;\n};\n\nconst hasCaches = (): boolean =>\n    typeof window !== \"undefined\" && \"caches\" in window;\n\nexport const storeShareTargetPayloadToCache = async (payload: { files: File[]; meta?: Record<string, unknown> }): Promise<boolean> => {\n    if (!hasCaches()) return false;\n\n    const files = Array.isArray(payload.files) ? payload.files : [];\n    const meta = payload.meta ?? {};\n\n    try {\n        const cache = await caches.open(SHARE_CACHE_NAME);\n        const timestamp = Number(meta?.timestamp) || Date.now();\n\n        await cache.put(\n            SHARE_CACHE_KEY,\n            new Response(JSON.stringify({\n                title: meta?.title,\n                text: meta?.text,\n                url: meta?.url,\n                timestamp,\n                fileCount: files.length,\n                imageCount: files.filter((f) => (f?.type || \"\").toLowerCase().startsWith(\"image/\")).length\n            }), { headers: { \"Content-Type\": \"application/json\" } })\n        );\n\n        const fileManifest: CachedShareFileMeta[] = [];\n        for (let i = 0; i < files.length; i++) {\n            const file = files[i];\n            const key = `${SHARE_FILE_PREFIX}${timestamp}-${i}`;\n\n            const headers = new Headers();\n            headers.set(\"Content-Type\", file.type || \"application/octet-stream\");\n            headers.set(\"X-File-Name\", encodeURIComponent(file.name || `file-${i}`));\n            headers.set(\"X-File-Size\", String(file.size || 0));\n            headers.set(\"X-File-LastModified\", String((file as any).lastModified ?? 0));\n\n            await cache.put(key, new Response(file, { headers }));\n            fileManifest.push({\n                key,\n                name: file.name || `file-${i}`,\n                type: file.type || \"application/octet-stream\",\n                size: file.size || 0,\n                lastModified: (file as any).lastModified ?? undefined\n            });\n        }\n\n        await cache.put(\n            SHARE_FILES_MANIFEST_KEY,\n            new Response(JSON.stringify({ files: fileManifest, timestamp }), {\n                headers: { \"Content-Type\": \"application/json\" }\n            })\n        );\n\n        return true;\n    } catch (error) {\n        console.warn(\"[ShareTargetGateway] Failed to store payload to cache:\", error);\n        return false;\n    }\n};\n\nexport const consumeCachedShareTargetPayload = async (opts: { clear?: boolean } = {}): Promise<CachedShareTargetPayload | null> => {\n    const clear = opts.clear !== false;\n    if (!hasCaches()) return null;\n\n    try {\n        const cache = await caches.open(SHARE_CACHE_NAME);\n        const metaResp = await cache.match(SHARE_CACHE_KEY);\n        const manifestResp = await cache.match(SHARE_FILES_MANIFEST_KEY);\n        if (!metaResp && !manifestResp) return null;\n\n        const meta = metaResp ? await metaResp.json().catch(() => null) : null;\n        const manifest = manifestResp ? await manifestResp.json().catch(() => null) : null;\n        const fileMeta: CachedShareFileMeta[] = Array.isArray(manifest?.files) ? manifest.files : [];\n\n        const files: File[] = [];\n        for (const fm of fileMeta) {\n            if (!fm?.key) continue;\n            const response = await cache.match(fm.key);\n            if (!response) continue;\n            const blob = await response.blob();\n            files.push(new File([blob], fm.name || \"shared-file\", {\n                type: fm.type || blob.type || \"application/octet-stream\",\n                lastModified: Number(fm.lastModified) || Date.now()\n            }));\n        }\n\n        if (clear) {\n            await cache.delete(SHARE_CACHE_KEY).catch(() => { });\n            await cache.delete(SHARE_FILES_MANIFEST_KEY).catch(() => { });\n            for (const fm of fileMeta) {\n                if (fm?.key) await cache.delete(fm.key).catch(() => { });\n            }\n        }\n\n        return { meta, files, fileMeta };\n    } catch (error) {\n        console.warn(\"[ShareTargetGateway] Failed to consume cached payload:\", error);\n        return null;\n    }\n};\n\nexport const fetchSwCachedEntries = async (): Promise<SwCachedContentItem[]> => {\n    try {\n        const response = await fetch(API_ENDPOINTS.SW_CONTENT_AVAILABLE);\n        if (!response.ok) return [];\n        const data = await response.json();\n        const keys = Array.isArray(data?.cacheKeys) ? data.cacheKeys : [];\n        const content: SwCachedContentItem[] = [];\n\n        for (const cacheKey of keys) {\n            const key = String(cacheKey?.key || \"\");\n            if (!key) continue;\n            try {\n                const contentResponse = await fetch(`${API_ENDPOINTS.SW_CONTENT}/${key}`);\n                if (!contentResponse.ok) continue;\n                content.push({\n                    key,\n                    context: String(cacheKey?.context || \"\"),\n                    content: await contentResponse.json()\n                });\n            } catch (error) {\n                console.warn(\"[ShareTargetGateway] Failed to fetch SW cache item:\", error);\n            }\n        }\n        return content;\n    } catch (error) {\n        console.warn(\"[ShareTargetGateway] Failed to fetch SW cache entries:\", error);\n        return [];\n    }\n};\n\nexport const fetchCachedShareFiles = async (cacheKey = \"latest\"): Promise<File[]> => {\n    try {\n        const response = await fetch(`/share-target-files?cacheKey=${encodeURIComponent(cacheKey)}`);\n        if (!response.ok) return [];\n        const manifest = await response.json();\n        const fileItems = Array.isArray(manifest?.files) ? manifest.files : [];\n        const files: File[] = [];\n\n        for (const item of fileItems) {\n            const fileUrl = typeof item?.key === \"string\" ? item.key : \"\";\n            if (!fileUrl) continue;\n            try {\n                const fileResponse = await fetch(fileUrl);\n                if (!fileResponse.ok) continue;\n                const fileBlob = await fileResponse.blob();\n                files.push(new File([fileBlob], item.name || \"shared-file\", {\n                    type: item.type || fileBlob.type || \"application/octet-stream\"\n                }));\n            } catch (error) {\n                console.warn(\"[ShareTargetGateway] Failed to fetch file from cache:\", error);\n            }\n        }\n        return files;\n    } catch (error) {\n        console.warn(\"[ShareTargetGateway] Failed to fetch cached share files:\", error);\n        return [];\n    }\n};\n","import type { View } from \"../shells/types\";\nimport type { UnifiedMessage } from \"@rs-com/core/UnifiedMessaging\";\n\nconst VIEW_MESSAGE_FALLBACKS: Record<string, string[]> = {\n    viewer: [\"content-view\", \"content-load\", \"markdown-content\"],\n    workcenter: [\"content-attach\", \"file-attach\", \"share-target-input\", \"content-share\"],\n    explorer: [\"file-save\", \"navigate-path\", \"content-explorer\"],\n    editor: [\"content-load\", \"content-edit\"],\n    settings: [\"settings-update\"],\n    history: [\"history-update\"],\n    home: [\"home-update\"],\n    airpad: [\"content-load\"],\n    print: [\"content-view\"]\n};\n\nexport const inferViewDestination = (viewId: string): string => {\n    if (viewId === \"viewer\") return \"viewer\";\n    if (viewId === \"workcenter\") return \"workcenter\";\n    if (viewId === \"explorer\") return \"explorer\";\n    if (viewId === \"editor\") return \"editor\";\n    if (viewId === \"settings\") return \"settings\";\n    if (viewId === \"history\") return \"history\";\n    if (viewId === \"print\") return \"print\";\n    if (viewId === \"airpad\") return \"airpad\";\n    return viewId || \"viewer\";\n};\n\nconst selectMessageTypeForView = (view: View, incomingType: string): string | null => {\n    const checks = [incomingType, ...(VIEW_MESSAGE_FALLBACKS[view.id] || [])];\n    for (const type of checks) {\n        if (!type) continue;\n        if (!view.canHandleMessage || view.canHandleMessage(type)) {\n            return type;\n        }\n    }\n    return null;\n};\n\nexport const mapUnifiedMessageToView = (\n    view: View,\n    message: UnifiedMessage\n): { type: string; data: unknown; metadata?: unknown } | null => {\n    const selectedType = selectMessageTypeForView(view, message.type);\n    if (!selectedType) return null;\n    return {\n        type: selectedType,\n        data: message.data,\n        metadata: message.metadata\n    };\n};\n","\nimport type {\n    View,\n    ViewLifecycle,\n    ViewOptions\n} from \"../shells/types\";\nimport type {\n    ChannelConnectedView,\n    ViewMessageHandler,\n    ChannelViewOptions,\n    ShareTargetHandler,\n    ShareTargetData\n} from \"./registry\";\nimport { \n    serviceChannels, \n    affectedToChannel,\n    sendToChannel,\n    type ServiceChannelId,\n    type ChannelMessage \n} from \"@rs-com/core/ServiceChannels\";\nimport { BROADCAST_CHANNELS, MESSAGE_TYPES } from \"@rs-com/config/Names\";\nimport {\n    registerHandler,\n    unregisterHandler,\n    registerComponent,\n    initializeComponent,\n    type UnifiedMessage\n} from \"@rs-com/core/UnifiedMessaging\";\nimport { fetchSwCachedEntries } from \"@rs-com/core/ShareTargetGateway\";\nimport { inferViewDestination, mapUnifiedMessageToView } from \"./view-message-routing\";\n\n/**\n * Creates a channel-connected view by mixing channel functionality into an existing view.\n * \n * Usage:\n * ```ts\n * class MyView implements View { ... }\n * const ConnectedView = withViewChannel(MyView, \"workcenter\");\n * ```\n */\nexport function withViewChannel<T extends new (...args: any[]) => View>(\n    ViewClass: T,\n    defaultChannelId: ServiceChannelId\n) {\n    return class extends ViewClass implements ChannelConnectedView {\n        channelId: ServiceChannelId = defaultChannelId;\n        _channelUnaffected: (() => void) | null = null;\n        _channelConnected = false;\n        _messageHandlers = new Map<string, Set<ViewMessageHandler>>();\n\n        constructor(...args: any[]) {\n            super(...args);\n            \n            // Extract channel options if provided\n            const options = args[0] as ChannelViewOptions | undefined;\n            if (options?.channelId) {\n                this.channelId = options.channelId;\n            }\n        }\n\n        async connectChannel(): Promise<void> {\n            if (this._channelConnected) return;\n\n            console.log(`[ViewChannel] Connecting ${this.id} to channel ${this.channelId}`);\n\n            // Initialize the service channel\n            await serviceChannels.initChannel(this.channelId);\n\n            // Subscribe to messages\n            this._channelUnaffected = affectedToChannel(\n                this.channelId,\n                (message) => this._handleChannelMessage(message)\n            );\n\n            this._channelConnected = true;\n            console.log(`[ViewChannel] ${this.id} connected to ${this.channelId}`);\n        }\n\n        disconnectChannel(): void {\n            if (this._channelUnaffected) {\n                this._channelUnaffected();\n                this._channelUnaffected = null;\n            }\n            this._channelConnected = false;\n            console.log(`[ViewChannel] ${this.id} disconnected from ${this.channelId}`);\n        }\n\n        async sendMessage<D>(type: string, data: D): Promise<void> {\n            if (!this._channelConnected) {\n                await this.connectChannel();\n            }\n            await sendToChannel(this.channelId, type, data);\n        }\n\n        isChannelConnected(): boolean {\n            return this._channelConnected;\n        }\n\n        /**\n         * Register a message handler\n         */\n        onChannelMessage(type: string, handler: ViewMessageHandler): () => void {\n            if (!this._messageHandlers.has(type)) {\n                this._messageHandlers.set(type, new Set());\n            }\n            this._messageHandlers.get(type)!.add(handler);\n\n            return () => {\n                this._messageHandlers.get(type)?.delete(handler);\n            };\n        }\n\n        /**\n         * Handle incoming channel message\n         */\n        _handleChannelMessage(message: ChannelMessage): void {\n            // Call type-specific handlers\n            const handlers = this._messageHandlers.get(message.type);\n            if (handlers) {\n                for (const handler of handlers) {\n                    try {\n                        handler(message);\n                    } catch (error) {\n                        console.error(`[ViewChannel] Handler error:`, error);\n                    }\n                }\n            }\n\n            // Call the view's handleMessage if it exists\n            if (typeof (this as any).handleMessage === \"function\") {\n                (this as any).handleMessage(message).catch(console.error);\n            }\n        }\n\n        // Override lifecycle to connect/disconnect channel\n        get lifecycle(): ViewLifecycle {\n            const parentLifecycle = super.lifecycle || {};\n            \n            return {\n                ...parentLifecycle,\n                onMount: async () => {\n                    await this.connectChannel();\n                    if (parentLifecycle.onMount) {\n                        await parentLifecycle.onMount();\n                    }\n                },\n                onUnmount: async () => {\n                    this.disconnectChannel();\n                    if (parentLifecycle.onUnmount) {\n                        await parentLifecycle.onUnmount();\n                    }\n                }\n            };\n        }\n    };\n}\n\n/**\n * Mixin for views that can handle share targets\n */\nexport function withShareTargetHandler<T extends new (...args: any[]) => View>(\n    ViewClass: T\n) {\n    return class extends ViewClass implements ShareTargetHandler {\n        _shareTargetChannel: BroadcastChannel | null = null;\n\n        constructor(...args: any[]) {\n            super(...args);\n        }\n\n        async handleShareTarget(data: ShareTargetData): Promise<void> {\n            console.log(`[ShareTarget] ${this.id} received:`, data);\n            \n            // Default implementation - override in subclass\n            if (typeof (this as any).handleMessage === \"function\") {\n                await (this as any).handleMessage({\n                    type: MESSAGE_TYPES.SHARE_TARGET_INPUT,\n                    data\n                });\n            }\n        }\n\n        canHandleShareTarget(_data: ShareTargetData): boolean {\n            // Default: can handle if view has handleMessage method\n            return typeof (this as any).handleMessage === \"function\";\n        }\n\n        /**\n         * Start listening for share target broadcasts\n         */\n        startShareTargetListener(): void {\n            if (this._shareTargetChannel) return;\n\n            this._shareTargetChannel = new BroadcastChannel(BROADCAST_CHANNELS.SHARE_TARGET);\n            this._shareTargetChannel.onmessage = async (event) => {\n                const { type, data } = event.data || {};\n                \n                if (type === MESSAGE_TYPES.SHARE_RECEIVED && this.canHandleShareTarget(data)) {\n                    await this.handleShareTarget(data);\n                }\n            };\n        }\n\n        /**\n         * Stop listening for share target broadcasts\n         */\n        stopShareTargetListener(): void {\n            if (this._shareTargetChannel) {\n                this._shareTargetChannel.close();\n                this._shareTargetChannel = null;\n            }\n        }\n\n        // Override lifecycle\n        get lifecycle(): ViewLifecycle {\n            const parentLifecycle = super.lifecycle || {};\n            \n            return {\n                ...parentLifecycle,\n                onMount: async () => {\n                    this.startShareTargetListener();\n                    if (parentLifecycle.onMount) {\n                        await parentLifecycle.onMount();\n                    }\n                },\n                onUnmount: async () => {\n                    this.stopShareTargetListener();\n                    if (parentLifecycle.onUnmount) {\n                        await parentLifecycle.onUnmount();\n                    }\n                }\n            };\n        }\n    };\n}\n\n// ============================================================================\n// COMBINED MIXINS\n// ============================================================================\n\n/**\n * Creates a fully connected view with channel and share target support\n */\nexport function withFullChannelSupport<T extends new (...args: any[]) => View>(\n    ViewClass: T,\n    channelId: ServiceChannelId\n) {\n    return withShareTargetHandler(withViewChannel(ViewClass, channelId));\n}\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\n/**\n * Check for pending share target data and deliver to view\n */\nexport async function checkAndDeliverShareData(\n    view: View & Partial<ShareTargetHandler>\n): Promise<boolean> {\n    if (!view.handleShareTarget || !view.canHandleShareTarget) {\n        return false;\n    }\n\n    try {\n        const cacheEntries = await fetchSwCachedEntries();\n        const latestShare = [...cacheEntries].reverse().find((entry) => entry.context === \"share-target\");\n        const rawContent = latestShare?.content;\n\n        if (rawContent && typeof rawContent === \"object\") {\n            const shareData: ShareTargetData = {\n                ...(rawContent as Record<string, unknown>),\n                timestamp: Date.now(),\n                source: \"share-target\"\n            } as ShareTargetData;\n\n            if (view.canHandleShareTarget(shareData)) {\n                await view.handleShareTarget(shareData);\n                return true;\n            }\n        }\n    } catch (error) {\n        console.warn(\"[ViewChannel] Failed to check share data:\", error);\n    }\n\n    return false;\n}\n\n/**\n * Check URL params for cached content\n */\nexport function getContentFromUrlParams(): string | null {\n    const params = new URLSearchParams(globalThis?.location?.search);\n    return params.get(\"cached\") || params.get(\"markdown-content\");\n}\n\nexport interface ViewReceiveBindingOptions {\n    destination?: string;\n    componentId?: string;\n}\n\nexport function bindViewReceiveChannel(\n    view: View,\n    options: ViewReceiveBindingOptions = {}\n): () => void {\n    if (!view.handleMessage) {\n        return () => { };\n    }\n\n    const destination = options.destination || inferViewDestination(String(view.id || \"\"));\n    const componentId = options.componentId || `view:${view.id}`;\n\n    const handler = {\n        canHandle: (message) => message.destination === destination,\n        handle: async (message) => {\n            const mapped = mapUnifiedMessageToView(view, message as UnifiedMessage);\n            if (!mapped) return;\n            await view.handleMessage?.(mapped);\n        }\n    };\n\n    registerComponent(componentId, destination);\n    registerHandler(destination, handler as any);\n\n    const pending = initializeComponent(componentId);\n    if (pending.length > 0) {\n        for (const message of pending) {\n            void handler.handle(message);\n        }\n    }\n\n    return () => {\n        unregisterHandler(destination, handler as any);\n    };\n}\n","/**\n * Shell and View Registry\n *\n * Central registry for shell and view components.\n * Supports lazy loading and caching.\n */\n\nimport type {\n    ShellId,\n    ViewId,\n    ShellRegistration,\n    ViewRegistration,\n    BootConfig,\n    Shell,\n    View,\n    ViewFactory,\n    ShellTheme,\n    ViewLifecycle,\n    ViewOptions\n} from \"../shells/types\";\nimport { \n    serviceChannels, \n    affectedToChannel,\n    sendToChannel,\n    type ServiceChannelId,\n    type ChannelMessage \n} from \"@rs-com/core/ServiceChannels\";\nimport { BROADCAST_CHANNELS, MESSAGE_TYPES } from \"@rs-com/config/Names\";\nimport {\n    registerHandler,\n    unregisterHandler,\n    registerComponent,\n    initializeComponent,\n    type UnifiedMessage\n} from \"@rs-com/core/UnifiedMessaging\";\nimport { bindViewReceiveChannel } from \"./channel-mixin\";\n\n\n// ============================================================================\n// SHELL REGISTRY\n// ============================================================================\n\n/**\n * Registry for shell components\n */\nclass ShellRegistryClass {\n    private shells = new Map<ShellId, ShellRegistration>();\n    private loadedShells = new Map<ShellId, Shell>();\n\n    /**\n     * Register a shell\n     */\n    register(registration: ShellRegistration): void {\n        this.shells.set(registration.id, registration);\n    }\n\n    /**\n     * Get a shell registration\n     */\n    get(id: ShellId): ShellRegistration | undefined {\n        return this.shells.get(id);\n    }\n\n    /**\n     * Get all registered shells\n     */\n    getAll(): ShellRegistration[] {\n        return Array.from(this.shells.values());\n    }\n\n    /**\n     * Load and instantiate a shell\n     */\n    async load(id: ShellId, container: HTMLElement): Promise<Shell> {\n        // Return cached instance if available\n        const cached = this.loadedShells.get(id);\n        if (cached) {\n            return cached;\n        }\n\n        const registration = this.shells.get(id);\n        if (!registration) {\n            throw new Error(`Shell not found: ${id}`);\n        }\n\n        const module = await registration.loader();\n        const factory = (module as any).default || (module as any).createShell;\n\n        if (typeof factory !== \"function\") {\n            throw new Error(`Invalid shell module: ${id}`);\n        }\n\n        const shell = factory(container);\n        this.loadedShells.set(id, shell);\n        return shell;\n    }\n\n    /**\n     * Unload a shell\n     */\n    unload(id: ShellId): void {\n        const shell = this.loadedShells.get(id);\n        if (shell) {\n            shell.unmount();\n            this.loadedShells.delete(id);\n        }\n    }\n\n    /**\n     * Check if a shell is loaded\n     */\n    isLoaded(id: ShellId): boolean {\n        return this.loadedShells.has(id);\n    }\n\n    /**\n     * Get a loaded shell instance\n     */\n    getLoaded(id: ShellId): Shell | undefined {\n        return this.loadedShells.get(id);\n    }\n}\n\nexport const ShellRegistry = new ShellRegistryClass();\n\n// ============================================================================\n// VIEW REGISTRY\n// ============================================================================\n\n/**\n * Registry for view components\n */\nclass ViewRegistryClass {\n    private views = new Map<ViewId, ViewRegistration>();\n    private loadedViews = new Map<ViewId, View>();\n    private viewReceiveCleanup = new Map<ViewId, () => void>();\n\n    /**\n     * Register a view\n     */\n    register(registration: ViewRegistration): void {\n        this.views.set(registration.id, registration);\n    }\n\n    /**\n     * Get a view registration\n     */\n    get(id: ViewId): ViewRegistration | undefined {\n        return this.views.get(id);\n    }\n\n    /**\n     * Get all registered views\n     */\n    getAll(): ViewRegistration[] {\n        return Array.from(this.views.values());\n    }\n\n    /**\n     * Load and instantiate a view\n     */\n    async load(id: ViewId, options?: Parameters<ViewFactory>[0]): Promise<View> {\n        // Return cached instance if available and no new options\n        const cached = this.loadedViews.get(id);\n        if (cached && !options) {\n            return cached;\n        }\n\n        const registration = this.views.get(id);\n        if (!registration) {\n            throw new Error(`View not found: ${id}`);\n        }\n\n        const module = await registration.loader();\n        const factory: ViewFactory = (module as any).default || (module as any).createView;\n\n        if (typeof factory !== \"function\") {\n            throw new Error(`Invalid view module: ${id}`);\n        }\n\n        const view = await factory(options);\n\n        const previousCleanup = this.viewReceiveCleanup.get(id);\n        if (previousCleanup) {\n            previousCleanup();\n            this.viewReceiveCleanup.delete(id);\n        }\n\n        this.loadedViews.set(id, view);\n        this.viewReceiveCleanup.set(id, bindViewReceiveChannel(view, {\n            destination: String(id),\n            componentId: `view:${id}`\n        }));\n        return view;\n    }\n\n    /**\n     * Unload a view (clear cache)\n     */\n    unload(id: ViewId): void {\n        const view = this.loadedViews.get(id);\n        if (view?.lifecycle?.onUnmount) {\n            view.lifecycle.onUnmount();\n        }\n        const receiveCleanup = this.viewReceiveCleanup.get(id);\n        if (receiveCleanup) {\n            receiveCleanup();\n            this.viewReceiveCleanup.delete(id);\n        }\n        this.loadedViews.delete(id);\n    }\n\n    /**\n     * Check if a view is loaded\n     */\n    isLoaded(id: ViewId): boolean {\n        return this.loadedViews.has(id);\n    }\n\n    /**\n     * Get a loaded view instance\n     */\n    getLoaded(id: ViewId): View | undefined {\n        return this.loadedViews.get(id);\n    }\n}\n\nexport const ViewRegistry = new ViewRegistryClass();\n\n// ============================================================================\n// DEFAULT REGISTRATIONS\n// ============================================================================\n\n/**\n * Register default shells\n */\nexport function registerDefaultShells(): void {\n    // Raw shell (minimal, no frames)\n    ShellRegistry.register({\n        id: \"base\",\n        name: \"Base\",\n        description: \"Base shell with no frames or navigation\",\n        loader: () => import(\"../shells/base/index\")\n    });\n\n    // Minimalshell (simple toolbar-based navigation)\n    ShellRegistry.register({\n        id: \"minimal\",\n        name: \"Minimal\",\n        description: \"Minimal toolbar-based navigation\",\n        loader: () => import(\"../shells/minimal/index\")\n    });\n\n    // Faint shell (tabbed sidebar navigation)\n    ShellRegistry.register({\n        id: \"faint\",\n        name: \"Faint\",\n        description: \"Experimental tabbed interface with sidebar\",\n        loader: () => import(\"../shells/faint/index\")\n    });\n}\n\n/**\n * Register default views\n */\nexport function registerDefaultViews(): void {\n    ViewRegistry.register({\n        id: \"viewer\",\n        name: \"Viewer\",\n        icon: \"eye\",\n        loader: () => import(\"../views/viewer\")\n    });\n\n    ViewRegistry.register({\n        id: \"workcenter\",\n        name: \"Work Center\",\n        icon: \"lightning\",\n        loader: () => import(\"../views/workcenter\")\n    });\n\n    ViewRegistry.register({\n        id: \"settings\",\n        name: \"Settings\",\n        icon: \"gear\",\n        loader: () => import(\"../views/settings\")\n    });\n\n    ViewRegistry.register({\n        id: \"history\",\n        name: \"History\",\n        icon: \"clock-counter-clockwise\",\n        loader: () => import(\"../views/history\")\n    });\n\n    ViewRegistry.register({\n        id: \"explorer\",\n        name: \"Explorer\",\n        icon: \"folder\",\n        loader: () => import(\"../views/explorer\")\n    });\n\n    ViewRegistry.register({\n        id: \"airpad\",\n        name: \"Airpad\",\n        icon: \"hand-pointing\",\n        loader: () => import(\"../views/airpad\")\n    });\n\n    ViewRegistry.register({\n        id: \"editor\",\n        name: \"Editor\",\n        icon: \"pencil\",\n        loader: () => import(\"../views/editor\")\n    });\n\n    ViewRegistry.register({\n        id: \"home\",\n        name: \"Home\",\n        icon: \"house\",\n        loader: () => import(\"../views/home\")\n    });\n\n    ViewRegistry.register({\n        id: \"print\",\n        name: \"Print\",\n        icon: \"printer\",\n        loader: () => import(\"../views/print\")\n    });\n}\n\n// ============================================================================\n// DEFAULT THEME\n// ============================================================================\n\nexport const defaultTheme: ShellTheme = {\n    id: \"auto\",\n    name: \"Auto\",\n    colorScheme: \"auto\"\n};\n\nexport const lightTheme: ShellTheme = {\n    id: \"light\",\n    name: \"Light\",\n    colorScheme: \"light\"\n};\n\nexport const darkTheme: ShellTheme = {\n    id: \"dark\",\n    name: \"Dark\",\n    colorScheme: \"dark\"\n};\n\n// ============================================================================\n// BOOT CONFIGURATION\n// ============================================================================\n\n/**\n * Get default boot configuration\n */\nexport function getDefaultBootConfig(): BootConfig {\n    return {\n        defaultShell: \"minimal\",\n        defaultView: \"viewer\",\n        theme: defaultTheme,\n        rememberShellChoice: true,\n        availableShells: ShellRegistry.getAll(),\n        availableViews: ViewRegistry.getAll()\n    };\n}\n\n/**\n * Initialize registries with default shells and views\n */\nexport function initializeRegistries(): void {\n    registerDefaultShells();\n    registerDefaultViews();\n}\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\n/**\n * Message handler function type\n */\nexport type ViewMessageHandler<T = unknown> = (message: ChannelMessage<T>) => void | Promise<void>;\n\n/**\n * Channel-connected view interface\n */\nexport interface ChannelConnectedView extends View {\n    /** Channel ID for this view */\n    channelId: ServiceChannelId;\n    /** Connect to the service channel */\n    connectChannel(): Promise<void>;\n    /** Disconnect from the service channel */\n    disconnectChannel(): void;\n    /** Send a message through the channel */\n    sendMessage<T>(type: string, data: T): Promise<void>;\n    /** Check if connected */\n    isChannelConnected(): boolean;\n}\n\n/**\n * Options for channel-connected views\n */\nexport interface ChannelViewOptions extends ViewOptions {\n    /** Channel ID to connect to */\n    channelId?: ServiceChannelId;\n    /** Auto-connect on mount */\n    autoConnect?: boolean;\n    /** Message handlers */\n    messageHandlers?: Map<string, ViewMessageHandler>;\n}\n\n\n// ============================================================================\n// SHARE TARGET HANDLER MIXIN\n// ============================================================================\n\n/**\n * Share target handler interface\n */\nexport interface ShareTargetHandler {\n    /** Handle incoming share target data */\n    handleShareTarget(data: ShareTargetData): Promise<void>;\n    /** Check if view can handle share target */\n    canHandleShareTarget(data: ShareTargetData): boolean;\n}\n\n/**\n * Share target data structure\n */\nexport interface ShareTargetData {\n    title?: string;\n    text?: string;\n    url?: string;\n    files?: File[];\n    timestamp: number;\n    source: \"share-target\" | \"launch-queue\" | \"clipboard\";\n}\n","import { JSOX } from \"jsox\";\nimport { addEvent, setIdleInterval } from \"fest/dom\";\nimport { safe, addToCallChain } from \"fest/object\";\n// Wait, I should not break imports if I overwrite the file.\n// The previous file had everything inline. I will keep everything inline but modified.\n\n// ... helper functions ...\nconst mapEntriesFrom = (source: any) => {\n    if (!source) return [];\n    if (source instanceof Map) return Array.from(source.entries());\n    if (Array.isArray(source)) {\n        return source.map((value, index) => {\n            if (Array.isArray(value) && value.length === 2) {\n                return value as [any, any];\n            }\n            return [index, value] as [any, any];\n        });\n    }\n    if (source instanceof Set) {\n        return Array.from(source.values()).map((value, index) => [index, value] as [any, any]);\n    }\n    if (typeof source === \"object\") {\n        return Object.entries(source as Record<any, any>);\n    }\n    return [];\n};\n\nconst ownProp = Object.prototype.hasOwnProperty;\n\nconst isPlainObject = (value: any): value is Record<PropertyKey, any>=>{\n    if (!value || typeof value !== \"object\") return false;\n    if (Array.isArray(value)) return false;\n    return !(value instanceof Map) && !(value instanceof Set);\n};\n\nconst identityOf = (value: any, fallback?: any)=>{\n    if (value && typeof value === \"object\") {\n        if (\"id\" in value && (value as any).id != null) return (value as any).id;\n        if (\"key\" in value && (value as any).key != null) return (value as any).key;\n    }\n    return fallback;\n};\n\nconst resolveEntryKey = (entryKey: any, value: any, fallback?: any)=>{\n    if (entryKey != null) return entryKey;\n    const identity = identityOf(value);\n    if (identity != null) return identity;\n    return fallback;\n};\n\nconst mergePlainObject = (target: Record<PropertyKey, any>, source: Record<PropertyKey, any>)=>{\n    for (const key of Object.keys(source)) {\n        const nextValue = source[key];\n        const currentValue = target[key];\n        if (isPlainObject(currentValue) && isPlainObject(nextValue)) {\n            mergePlainObject(currentValue, nextValue);\n            continue;\n        }\n        if (currentValue !== nextValue) {\n            target[key] = nextValue;\n        }\n    }\n    return target;\n};\n\nconst mergeValue = (target: any, source: any)=>{\n    if (target === source) return target;\n    const sourceIsObject = source && typeof source === \"object\";\n\n    if (target instanceof Map && sourceIsObject) {\n        reloadInto(target, source);\n        return target;\n    }\n\n    if (target instanceof Set && sourceIsObject) {\n        reloadInto(target, source);\n        return target;\n    }\n\n    if (Array.isArray(target) && sourceIsObject) {\n        reloadInto(target, source);\n        return target;\n    }\n\n    if (isPlainObject(target) && isPlainObject(source)) {\n        mergePlainObject(target, source);\n        return target;\n    }\n\n    return source;\n};\n\nexport const reloadInto = (items: any|any[]|Set<any>|Map<any, any>, map: any)=>{\n    if (!items || !map) return items;\n    const entries = mapEntriesFrom(map);\n    if (!entries.length) return items;\n\n    if (items instanceof Set) {\n        const existingByKey = new Map<any, any>();\n        for (const value of items.values()) {\n            const key = identityOf(value);\n            if (key != null) existingByKey.set(key, value);\n        }\n\n        const usedKeys = new Set<any>();\n        for (const [entryKey, incoming] of entries) {\n            const key = resolveEntryKey(entryKey, incoming);\n            if (key == null) {\n                if (!items.has(incoming)) items.add(incoming);\n                continue;\n            }\n\n            const hasCurrent = existingByKey.has(key);\n            const current = hasCurrent ? existingByKey.get(key) : undefined;\n            if (hasCurrent) {\n                const merged = mergeValue(current, incoming);\n                if (merged !== current) {\n                    items.delete(current);\n                    items.add(merged);\n                    existingByKey.set(key, merged);\n                }\n            } else {\n                items.add(incoming);\n                existingByKey.set(key, incoming);\n            }\n            usedKeys.add(key);\n        }\n\n        if (usedKeys.size) {\n            for (const value of Array.from(items.values())) {\n                const key = identityOf(value);\n                if (key != null && !usedKeys.has(key)) {\n                    items.delete(value);\n                }\n            }\n        }\n        return items;\n    }\n\n    if (items instanceof Map) {\n        const nextMap = new Map(entries);\n\n        for (const key of Array.from(items.keys())) {\n            if (!nextMap.has(key)) items.delete(key);\n        }\n\n        for (const [key, incoming] of nextMap.entries()) {\n            if (items.has(key)) {\n                const current = items.get(key);\n                const merged = mergeValue(current, incoming);\n                if (merged !== current) items.set(key, merged);\n            } else {\n                items.set(key, incoming);\n            }\n        }\n        return items;\n    }\n\n    if (Array.isArray(items)) {\n        const availableIndexes = new Set<number>();\n        const existingByKey = new Map<any, number>();\n        const existingByObject = new WeakMap<object, number>();\n\n        items.forEach((value, index)=>{\n            availableIndexes.add(index);\n            const key = identityOf(value, index);\n            if (key != null && !existingByKey.has(key)) {\n                existingByKey.set(key, index);\n            }\n            if (value && typeof value === \"object\") {\n                existingByObject.set(value, index);\n            }\n        });\n\n        const takeIndex = (index?: number)=>{\n            if (index == null) return undefined;\n            if (!availableIndexes.has(index)) return undefined;\n            availableIndexes.delete(index);\n            return index;\n        };\n\n        const takeNextAvailable = ()=>{\n            const iterator = availableIndexes.values().next();\n            if (iterator.done) return undefined;\n            const index = iterator.value;\n            availableIndexes.delete(index);\n            return index;\n        };\n\n        let writeIndex = 0;\n        let fallbackIndex = 0;\n\n        for (const [entryKey, incoming] of entries) {\n            const key = resolveEntryKey(entryKey, incoming, fallbackIndex++);\n            let claimedIndex = takeIndex(key != null ? existingByKey.get(key) : undefined);\n\n            if (claimedIndex == null && incoming && typeof incoming === \"object\") {\n                claimedIndex = takeIndex(existingByObject.get(incoming));\n            }\n\n            if (claimedIndex == null) {\n                claimedIndex = takeNextAvailable();\n            }\n\n            const current = claimedIndex != null ? items[claimedIndex] : undefined;\n            const merged = current !== undefined ? mergeValue(current, incoming) : incoming;\n\n            if (writeIndex < items.length) {\n                if (items[writeIndex] !== merged) items[writeIndex] = merged;\n            } else {\n                items.push(merged);\n            }\n\n            writeIndex++;\n        }\n\n        while (items.length > writeIndex) items.pop();\n        return items;\n    }\n\n    if (typeof items === \"object\") {\n        const nextKeys = new Set(entries.map(([key])=>String(key)));\n        for (const prop of Object.keys(items)) {\n            if (!nextKeys.has(prop)) delete (items as any)[prop];\n        }\n\n        for (const [entryKey, incoming] of entries) {\n            const prop = String(entryKey);\n            if (ownProp.call(items, prop)) {\n                const current = (items as any)[prop];\n                const merged = mergeValue(current, incoming);\n                if (merged !== current) (items as any)[prop] = merged;\n            } else {\n                (items as any)[prop] = incoming;\n            }\n        }\n        return items;\n    }\n\n    return items;\n}\n\nexport const mergeByKey = (items: any|any[]|Set<any>|Map<any, any>, key = \"id\")=>{\n    if (items && (items instanceof Set || Array.isArray(items))) {\n        const entries = Array.from(items?.values?.() || []).map((I)=>[I?.[key],I]).filter((I)=>I?.[0] != null);\n        return reloadInto(items, new Map(entries as any));\n    }\n    return items;\n}\n\nconst hasChromeStorage = () => typeof chrome !== \"undefined\" && chrome?.storage?.local;\n\nexport const makeUIState = (storageKey, initialCb, unpackCb, packCb = (items) => safe(items), key = \"id\", saveInterval = 6000)=>{\n    let state = null;\n    state = mergeByKey(initialCb?.() || {}, key);\n\n    // Load initial state\n    if (hasChromeStorage()) {\n        chrome.storage.local.get([storageKey], (result) => {\n            if (result[storageKey]) {\n                const unpacked = unpackCb(JSOX.parse(result?.[storageKey] as string || \"{}\"));\n                reloadInto(state, unpacked);\n            }\n        });\n    } else if (typeof localStorage !== \"undefined\") {\n        if (localStorage.getItem(storageKey)) {\n            state = unpackCb(JSOX.parse(localStorage.getItem(storageKey) || \"{}\"));\n            mergeByKey(state, key);\n        } else {\n            localStorage.setItem(storageKey, JSOX.stringify(packCb(state)));\n        }\n    }\n\n    // Save function\n    const saveInStorage = (ev?: any)=>{\n        const packed = JSOX.stringify(packCb(mergeByKey(state, key)));\n        if (hasChromeStorage()) {\n            chrome.storage.local.set({ [storageKey]: packed });\n        } else if (typeof localStorage !== \"undefined\") {\n            localStorage.setItem(storageKey, packed);\n        }\n    }\n\n    // Periodic save\n    setIdleInterval(saveInStorage, saveInterval);\n\n    // Event listeners\n    if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\n        const listening = [\n            addEvent(document, \"visibilitychange\", (ev)=>{ if (document.visibilityState === \"hidden\") { saveInStorage(ev); } }),\n            addEvent(window, \"beforeunload\", (ev)=>saveInStorage(ev)),\n            addEvent(window, \"pagehide\", (ev)=>saveInStorage(ev)),\n            // Standard storage event for localStorage\n            addEvent(window, \"storage\", (ev)=>{\n                if (ev.storageArea == localStorage && ev.key == storageKey) {\n                    reloadInto(state, unpackCb(JSOX.parse(ev?.newValue || JSOX.stringify(packCb(mergeByKey(state, key))))));\n                }\n            })\n        ];\n\n        addToCallChain(state, Symbol.dispose, ()=>listening.forEach(ub=>ub?.()));\n    }\n\n    // Chrome storage listener\n    if (hasChromeStorage()) {\n        const listener = (changes, area) => {\n            if (area === 'local' && changes[storageKey]) {\n                const newValue = changes[storageKey].newValue;\n                if (newValue) {\n                    reloadInto(state, unpackCb(JSOX.parse(newValue)));\n                }\n            }\n        };\n        chrome.storage.onChanged.addListener(listener);\n        // Cleanup listener on dispose? (UIState usually lives for app lifetime, but good to know)\n    }\n\n    if (state && typeof state === \"object\") {\n        try {\n            Object.defineProperty(state, \"$save\", {\n                value: saveInStorage,\n                configurable: true,\n                enumerable: false,\n                writable: true\n            });\n        } catch (e) {\n            (state as any).$save = saveInStorage;\n        }\n    }\n    return state;\n}\n","import { makeObjectAssignable, observe, stringRef, safe } from \"fest/object\";\nimport { makeUIState } from \"fest/lure/extension/core/UIState\";\nimport { JSOX } from \"jsox\";\nimport { readText } from \"@rs-core/modules/Clipboard\";\n\nexport type GridCell = [number, number];\n\nexport interface SpeedDialItemMeta {\n    action?: string;\n    view?: string;\n    href?: string;\n    description?: string;\n    entityType?: string;\n    tags?: string[];\n    [key: string]: any;\n}\n\nexport interface SpeedDialPersistedItem {\n    id: string;\n    cell: ReturnType<typeof observe<GridCell>>;\n    icon: string;\n    label: string;\n    action: string;\n    meta?: SpeedDialItemMeta;\n}\n\ntype SpeedDialRecord = Omit<SpeedDialPersistedItem, \"meta\">;\n\nexport interface SpeedDialItem {\n    id: string;\n    cell: ReturnType<typeof observe>;\n    icon: ReturnType<typeof stringRef>;\n    label: ReturnType<typeof stringRef>;\n    action: string;\n}\n\nexport const NAVIGATION_SHORTCUTS = [\n    { view: \"home\", label: \"Home\", icon: \"house-line\" },\n    { view: \"task\", label: \"Plan\", icon: \"calendar-dots\" },\n    { view: \"event\", label: \"Events\", icon: \"calendar-star\" },\n    { view: \"bonus\", label: \"Bonuses\", icon: \"ticket\" },\n    { view: \"person\", label: \"Contacts\", icon: \"address-book\" },\n    { view: \"explorer\", label: \"Explorer\", icon: \"books\" },\n    { view: \"settings\", label: \"Settings\", icon: \"gear-six\" }\n] as const;\n\nconst STORAGE_KEY = \"cw::workspace::speed-dial\";\nconst META_STORAGE_KEY = `${STORAGE_KEY}::meta`;\n\nconst fallbackClone = <T>(value: T): T => {\n    if (typeof structuredClone === \"function\") {\n        return structuredClone(safe(value));\n    }\n    return JSOX.parse(JSOX.stringify(value)) as any;\n};\n\nconst generateItemId = () => {\n    if (typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\") {\n        return crypto.randomUUID();\n    }\n    return `sd-${Date.now().toString(36)}-${Math.floor(Math.random() * 1_000)}`;\n};\n\nconst EXTERNAL_SHORTCUTS: SpeedDialPersistedItem[] = [\n    {\n        id: \"shortcut-docs\",\n        cell: observe([0, 1]),\n        icon: \"book-open-text\",\n        label: \"Docs\",\n        action: \"open-link\",\n        meta: { href: \"https://github.com/fest-live\", description: \"Project documentation\" }\n    },\n    {\n        id: \"shortcut-roadmap\",\n        cell: observe([1, 1]),\n        icon: \"signpost\",\n        label: \"Roadmap\",\n        action: \"open-link\",\n        meta: { href: \"https://github.com/u2re-space/unite-2.man\", description: \"Manifest notes\" }\n    },\n    {\n        id: \"shortcut-fest-live\",\n        cell: observe([2, 1]),\n        icon: \"github-logo\",\n        label: \"Fest Live\",\n        action: \"open-link\",\n        meta: { href: \"https://github.com/fest-live\", description: \"Fest Live Organization\" }\n    },\n    {\n        id: \"shortcut-l2ne-dev\",\n        cell: observe([3, 1]),\n        icon: \"user\",\n        label: \"L2NE Dev\",\n        action: \"open-link\",\n        meta: { href: \"https://github.com/L2NE-dev\", description: \"L2NE Developer Profile\" }\n    },\n    {\n        id: \"shortcut-u2re-space\",\n        cell: observe([0, 2]),\n        icon: \"planet\",\n        label: \"U2RE Space\",\n        action: \"open-link\",\n        meta: { href: \"https://github.com/u2re-space/\", description: \"U2RE Space Organization\" }\n    },\n    {\n        id: \"shortcut-telegram\",\n        cell: observe([1, 2]),\n        icon: \"telegram-logo\",\n        label: \"Telegram\",\n        action: \"open-link\",\n        meta: { href: \"https://t.me/u2re_space\", description: \"U2RE Space Telegram\" }\n    }\n];\n\nconst DEFAULT_SPEED_DIAL_DATA: SpeedDialPersistedItem[] = [\n    {\n        id: \"shortcut-explorer\",\n        cell: observe([2, 0]),\n        icon: \"books\",\n        label: \"Explorer\",\n        action: \"open-view\",\n        meta: { view: \"explorer\" }\n    },\n    {\n        id: \"shortcut-settings\",\n        cell: observe([3, 0]),\n        icon: \"gear-six\",\n        label: \"Settings\",\n        action: \"open-view\",\n        meta: { view: \"settings\" }\n    },\n    ...EXTERNAL_SHORTCUTS\n];\n\n\n\nconst splitDefaultEntries = (entries: SpeedDialPersistedItem[]) => {\n    const records: SpeedDialRecord[] = [];\n    const metaEntries: Array<[string, SpeedDialItemMeta]> = [];\n    entries.forEach((entry) => {\n        const { meta, ...record } = entry;\n        records.push(record as SpeedDialRecord);\n        const normalizedMeta: SpeedDialItemMeta = { action: entry.action, ...(meta || {}) };\n        metaEntries.push([entry.id, normalizedMeta]);\n    });\n    return { records, metaEntries };\n};\n\nconst { records: DEFAULT_SPEED_DIAL_RECORDS, metaEntries: DEFAULT_META_ENTRIES } = splitDefaultEntries(DEFAULT_SPEED_DIAL_DATA);\nconst legacyMetaBuffer: Array<[string, SpeedDialItemMeta]> = [];\n\nconst ensureCell = (cell?: ReturnType<typeof observe<GridCell>>): ReturnType<typeof observe<GridCell>> => {\n    if (cell && Array.isArray(cell) && cell.length >= 2) {\n        return observe([Number(cell[0]) || 0, Number(cell[1]) || 0]);\n    }\n    return observe([0, 0]);\n};\n\nconst createMetaState = (meta: SpeedDialItemMeta = {}) => {\n    return makeObjectAssignable(observe({\n        action: meta.action || \"open-view\",\n        view: meta.view || \"\",\n        href: meta.href || \"\",\n        description: meta.description || \"\",\n        entityType: meta.entityType || \"\",\n        tags: Array.isArray(meta.tags) ? [...meta.tags] : [],\n        ...meta\n    }));\n};\n\nexport type SpeedDialMetaEntry = ReturnType<typeof createMetaState>;\nexport type SpeedDialMetaRegistry = Map<string, SpeedDialMetaEntry>;\n\nconst registryFromEntries = (entries: Iterable<[string, SpeedDialItemMeta]>) => {\n    const registry = new Map<string, SpeedDialMetaEntry>();\n    for (const [id, meta] of entries) {\n        registry.set(id, createMetaState(meta));\n    }\n    return registry as SpeedDialMetaRegistry;\n};\n\nconst normalizeMetaEntries = (raw?: any): Array<[string, SpeedDialItemMeta]> => {\n    if (!raw) return [];\n    if (raw instanceof Map) {\n        return Array.from(raw.entries());\n    }\n    if (Array.isArray(raw)) {\n        return raw\n            .map((entry: any) => {\n                if (entry && typeof entry === \"object\" && \"id\" in entry) {\n                    return [entry.id, (entry.meta || entry) as SpeedDialItemMeta] as [string, SpeedDialItemMeta];\n                }\n                return null;\n            })\n            .filter(Boolean) as Array<[string, SpeedDialItemMeta]>;\n    }\n    if (typeof raw === \"object\") {\n        return Object.entries(raw as Record<string, SpeedDialItemMeta>) as Array<[string, SpeedDialItemMeta]>;\n    }\n    return [];\n};\n\nconst packMetaRegistry = (registry: SpeedDialMetaRegistry) => {\n    const payload: Record<string, SpeedDialItemMeta> = {};\n    registry?.forEach((meta, id) => {\n        payload[id] = fallbackClone(meta ?? {});\n    });\n    return payload;\n};\n\nconst createInitialMetaRegistry = () => registryFromEntries(DEFAULT_META_ENTRIES);\nconst unpackMetaRegistry = (raw?: any) => {\n    const entries = normalizeMetaEntries(raw);\n    return registryFromEntries(entries.length ? entries : DEFAULT_META_ENTRIES);\n};\n\nconst unwrapRef = (value: any, fallback?: string) => {\n    if (value && typeof value === \"object\" && \"value\" in value) {\n        return value.value ?? fallback;\n    }\n    return value ?? fallback;\n};\n\nconst serializeItemState = (item: SpeedDialItem): SpeedDialRecord => {\n    return {\n        id: item.id,\n        cell: observe([item.cell?.[0] ?? 0, item.cell?.[1] ?? 0]),\n        icon: unwrapRef(item.icon, \"sparkle\"),\n        label: unwrapRef(item.label, \"Shortcut\"),\n        action: item.action\n    };\n};\n\n\n\nconst createStatefulItem = (config: SpeedDialRecord): SpeedDialItem => {\n    return observe({\n        id: config.id || generateItemId(),\n        cell: observe(ensureCell(config.cell)),\n        icon: stringRef(config.icon || \"sparkle\"),\n        label: stringRef(config.label || \"Shortcut\"),\n        action: config.action || \"open-view\"\n    }) as any;\n};\n\n\nconst createInitialState = () => observe(DEFAULT_SPEED_DIAL_RECORDS.map(createStatefulItem));\nconst unpackState = (raw?: SpeedDialPersistedItem[]) => {\n    const source = Array.isArray(raw) && raw.length ? raw : DEFAULT_SPEED_DIAL_DATA;\n    const records = source.map((entry) => {\n        const { meta, ...record } = entry;\n        if (meta) {\n            legacyMetaBuffer.push([entry.id, { action: entry.action, ...meta }]);\n        } else {\n            legacyMetaBuffer.push([entry.id, { action: entry.action }]);\n        }\n        return record as SpeedDialRecord;\n    });\n    return observe(records.map(createStatefulItem));\n};\nconst packState = (collection: SpeedDialItem[]) => collection.map(serializeItemState);\n\n//\nexport const speedDialMeta = makeUIState(META_STORAGE_KEY, createInitialMetaRegistry, unpackMetaRegistry, packMetaRegistry) as unknown as SpeedDialMetaRegistry;\nexport const speedDialItems = makeUIState(STORAGE_KEY, createInitialState, unpackState, packState) as unknown as SpeedDialItem[];\nexport const persistSpeedDialItems = () => (speedDialItems as any)?.$save?.();\nexport const persistSpeedDialMeta = () => (speedDialMeta as any)?.$save?.();\n\n//\nexport const getSpeedDialMeta = (id?: string | null) => {\n    if (!id) return null;\n    return speedDialMeta?.get?.(id) ?? null;\n};\n\nexport const ensureSpeedDialMeta = (id: string, defaults: SpeedDialItemMeta = {}) => {\n    let meta = speedDialMeta?.get?.(id);\n    if (!meta) {\n        meta = createMetaState(defaults);\n        speedDialMeta?.set?.(id, meta);\n        persistSpeedDialMeta();\n    }\n    if (defaults?.action && meta.action !== defaults.action) {\n        meta.action = defaults.action;\n    }\n    return meta;\n};\n\nexport const removeSpeedDialMeta = (id: string) => {\n    const removed = speedDialMeta?.delete?.(id);\n    if (removed) {\n        persistSpeedDialMeta();\n    }\n    return removed;\n};\n\n\n\n\n\n\nconst syncMetaActionFromItem = (item?: SpeedDialItem | null) => {\n    if (!item) return false;\n    const desiredAction = item.action || \"open-view\";\n    const meta = ensureSpeedDialMeta(item.id, { action: desiredAction });\n    if (meta.action !== desiredAction) {\n        meta.action = desiredAction;\n        return true;\n    }\n    return false;\n};\n\nconst syncMetaActionsForAllItems = () => {\n    let changed = false;\n    speedDialItems?.forEach?.((item) => {\n        if (syncMetaActionFromItem(item)) {\n            changed = true;\n        }\n    });\n    if (changed) {\n        persistSpeedDialMeta();\n    }\n};\n\nconst flushLegacyMetaBuffer = () => {\n    if (!legacyMetaBuffer.length) return;\n    legacyMetaBuffer.forEach(([id, meta]) => {\n        const target = ensureSpeedDialMeta(id, meta);\n        Object.assign(target, meta);\n    });\n    legacyMetaBuffer.length = 0;\n    persistSpeedDialMeta();\n};\n\nflushLegacyMetaBuffer();\nsyncMetaActionsForAllItems();\n\nconst ensureExternalShortcuts = () => {\n    let changed = false;\n    EXTERNAL_SHORTCUTS.forEach((shortcut) => {\n        const exists = speedDialItems?.find?.((item) => item?.id === shortcut.id);\n        if (!exists) {\n            const item = createStatefulItem(shortcut);\n            // Ensure label and icon are set correctly if they are refs in item but strings in shortcut\n            if (shortcut.label && item.label && typeof item.label === 'object' && 'value' in item.label) {\n                item.label.value = shortcut.label;\n            }\n            if (shortcut.icon && item.icon && typeof item.icon === 'object' && 'value' in item.icon) {\n                item.icon.value = shortcut.icon;\n            }\n\n            speedDialItems.push(observe(item) as any);\n            ensureSpeedDialMeta(item.id, shortcut.meta);\n            changed = true;\n        } else {\n            // Update existing items with potentially new meta (e.g. links)\n            const currentMeta = getSpeedDialMeta(shortcut.id);\n            if (shortcut.meta && currentMeta) {\n                if (shortcut.meta.href !== currentMeta.href) {\n                    currentMeta.href = shortcut.meta.href;\n                    changed = true;\n                }\n                if (shortcut.meta.description !== currentMeta.description) {\n                    currentMeta.description = shortcut.meta.description;\n                    changed = true;\n                }\n            } else if (shortcut.meta && !currentMeta) {\n                 ensureSpeedDialMeta(shortcut.id, shortcut.meta);\n                 changed = true;\n            }\n        }\n    });\n    if (changed) {\n        persistSpeedDialItems();\n        persistSpeedDialMeta();\n    }\n};\nensureExternalShortcuts();\n\nexport const findSpeedDialItem = (id?: string | null) => {\n    if (!id) return null;\n    return speedDialItems?.find?.((item) => item?.id === id) || null;\n};\n\nexport const createEmptySpeedDialItem = (cell: ReturnType<typeof observe> = observe([0, 0])): SpeedDialItem => {\n    const item = createStatefulItem({\n        id: generateItemId(),\n        cell,\n        icon: \"sparkle\",\n        label: \"New shortcut\",\n        action: \"open-link\"\n    });\n    ensureSpeedDialMeta(item.id, { action: item.action, href: \"\", description: \"\" });\n    return item;\n};\n\nexport const addSpeedDialItem = (item: SpeedDialItem) => {\n    speedDialItems?.push?.(observe(item) as any);\n    const metaChanged = syncMetaActionFromItem(item);\n    persistSpeedDialItems();\n    if (metaChanged) {\n        persistSpeedDialMeta();\n    }\n    return item;\n};\n\nexport const upsertSpeedDialItem = (item: SpeedDialItem) => {\n    const existingIndex = speedDialItems?.findIndex?.((entry) => entry?.id === item?.id) ?? -1;\n    if (existingIndex === -1) {\n        speedDialItems?.push?.(observe(item) as any);\n    } else if (speedDialItems[existingIndex] !== item) {\n        speedDialItems.splice(existingIndex, 1, observe(item) as any);\n    }\n    const metaChanged = syncMetaActionFromItem(item);\n    persistSpeedDialItems();\n    if (metaChanged) {\n        persistSpeedDialMeta();\n    }\n    return item;\n};\n\nexport const removeSpeedDialItem = (id: string) => {\n    const index = speedDialItems?.findIndex?.((entry) => entry?.id === id) ?? -1;\n    if (index === -1) return false;\n    speedDialItems.splice(index, 1);\n    removeSpeedDialMeta(id);\n    persistSpeedDialItems();\n    return true;\n};\n\nexport const snapshotSpeedDialItem = (item: SpeedDialItem) => {\n    const meta = getSpeedDialMeta(item.id);\n    const resolvedAction = meta?.action || item.action;\n    const metaSnapshot = fallbackClone(meta ?? {});\n    if (!metaSnapshot.action) {\n        metaSnapshot.action = resolvedAction;\n    }\n    return {\n        state: {\n            id: item.id,\n            cell: observe([item.cell?.[0] ?? 0, item.cell?.[1] ?? 0]),\n            icon: unwrapRef(item.icon, \"\"),\n            label: unwrapRef(item.label, \"\")\n        },\n            desc: {\n            action: resolvedAction,\n            meta: metaSnapshot\n        }\n    };\n};\n\nconst WALLPAPER_KEY = \"cw::workspace::wallpaper\";\nexport const wallpaperState = makeUIState(WALLPAPER_KEY, () => observe({\n    src: \"./assets/imgs/test.webp\",\n    opacity: 1,\n    blur: 0\n}), (raw) => observe(raw || {\n    src: \"./assets/imgs/test.webp\",\n    opacity: 1,\n    blur: 0\n}), (state) => ({ ...state })) as unknown as { src: string; opacity: number; blur: number };\n\nexport const persistWallpaper = () => (wallpaperState as any)?.$save?.();\n\nexport type GridShape = \"square\" | \"squircle\" | \"circle\" | \"rounded\" | \"hexagon\" | \"diamond\";\n\nexport interface GridLayoutSettings {\n    columns: number;\n    rows: number;\n    shape: GridShape;\n}\n\nconst GRID_LAYOUT_KEY = \"cw::workspace::grid-layout\";\nexport const gridLayoutState = makeUIState(GRID_LAYOUT_KEY, () => observe({\n    columns: 4,\n    rows: 8,\n    shape: \"square\" as GridShape\n}), (raw) => observe(raw || {\n    columns: 4,\n    rows: 8,\n    shape: \"square\" as GridShape\n}), (state) => ({ ...state })) as unknown as GridLayoutSettings;\n\nexport const persistGridLayout = () => (gridLayoutState as any)?.$save?.();\n\nexport const applyGridSettings = (settings?: { grid?: GridLayoutSettings }) => {\n    const gridConfig = settings?.grid || gridLayoutState;\n    const columns = gridConfig?.columns ?? 4;\n    const rows = gridConfig?.rows ?? 8;\n    const shape = gridConfig?.shape ?? \"square\";\n\n    // Update the reactive state\n    if (gridLayoutState) {\n        gridLayoutState.columns = columns;\n        gridLayoutState.rows = rows;\n        gridLayoutState.shape = shape;\n        persistGridLayout();\n    }\n\n    // Apply to all speed-dial grids via data attributes (for CSS to consume)\n    document.querySelectorAll('.speed-dial-grid').forEach(grid => {\n        const el = grid as HTMLElement;\n        el.dataset.gridColumns = String(columns);\n        el.dataset.gridRows = String(rows);\n        el.dataset.gridShape = shape;\n    });\n\n    // Update CSS custom properties on root for grid layout\n    document.documentElement.dataset.gridColumns = String(columns);\n    document.documentElement.dataset.gridRows = String(rows);\n    document.documentElement.dataset.gridShape = shape;\n};\n\n// Apply grid settings on load\nif (typeof globalThis !== \"undefined\") {\n    requestAnimationFrame(() => applyGridSettings());\n}\n\n//\nexport const parseSpeedDialItemFromJSON = (jsonText: string, suggestedCell?: GridCell): SpeedDialItem | null => {\n    try {\n        const parsed = JSOX.parse(jsonText) as any;\n        if (!parsed || typeof parsed !== \"object\") return null;\n\n        const state = parsed.state || parsed;\n        const desc = parsed.desc || parsed.meta || {};\n\n        if (!state || typeof state !== \"object\") return null;\n\n        const cellValue = state.cell && Array.isArray(state.cell) && state.cell.length >= 2\n            ? [Number(state.cell[0]) || 0, Number(state.cell[1]) || 0] as GridCell\n            : (suggestedCell || [0, 0] as GridCell);\n\n        const item = createStatefulItem({\n            id: state.id || generateItemId(),\n            cell: cellValue,\n            icon: state.icon || desc.icon || \"sparkle\",\n            label: state.label || desc.label || \"Shortcut\",\n            action: desc.action || state.action || \"open-view\"\n        });\n\n        const meta: SpeedDialItemMeta = {\n            action: desc.action || state.action || \"open-view\",\n            ...(desc.meta || desc || {}),\n            ...(state.meta || {})\n        };\n\n        if (meta.href) {\n            meta.action = meta.action || \"open-link\";\n        } else if (meta.view) {\n            meta.action = meta.action || \"open-view\";\n        }\n\n        ensureSpeedDialMeta(item.id, meta);\n        return item;\n    } catch (e) {\n        console.warn(\"Failed to parse JSON for speed dial item:\", e);\n        return null;\n    }\n};\n\n//\nexport const parseSpeedDialItemFromURL = (urlText: string, suggestedCell?: GridCell): SpeedDialItem | null => {\n    try {\n        const trimmed = urlText.trim();\n        if (!trimmed) return null;\n\n        let url: URL;\n        try {\n            url = new URL(trimmed);\n        } catch {\n            try {\n                url = new URL(trimmed, globalThis?.location?.href);\n            } catch {\n                return null;\n            }\n        }\n\n        const hostname = url.hostname || \"\";\n        const domain = hostname.replace(/^www\\./, \"\");\n        const pathname = url.pathname || \"\";\n        const label = domain || url.host || \"Link\";\n\n        const item = createStatefulItem({\n            id: generateItemId(),\n            cell: suggestedCell || [0, 0],\n            icon: \"link\",\n            label,\n            action: \"open-link\"\n        });\n\n        const meta: SpeedDialItemMeta = {\n            action: \"open-link\",\n            href: url.href,\n            description: `${label}${pathname ? ` - ${pathname}` : \"\"}`\n        };\n\n        ensureSpeedDialMeta(item.id, meta);\n        return item;\n    } catch (e) {\n        console.warn(\"Failed to parse URL for speed dial item:\", e);\n        return null;\n    }\n};\n\n//\nexport const createSpeedDialItemFromClipboard = async (suggestedCell?: GridCell): Promise<SpeedDialItem | null> => {\n    try {\n        const clipboardResult = await readText();\n        if (!clipboardResult.ok || !clipboardResult.data) {\n            console.warn(\"Failed to read clipboard text:\", clipboardResult.error);\n            return null;\n        }\n\n        const clipboardText = String(clipboardResult.data);\n        if (!clipboardText.trim()) return null;\n\n        const trimmed = clipboardText.trim();\n\n        const isURL = /^https?:\\/\\/[^\\s]+$/i.test(trimmed) || /^[^\\s]+\\.[a-z]{2,}(\\/|$)/i.test(trimmed);\n\n        if (isURL && URL.canParse(trimmed, globalThis?.location?.origin)) {\n            return parseSpeedDialItemFromURL(trimmed, suggestedCell);\n        }\n\n        const isJSON = (trimmed.startsWith(\"{\") && trimmed.endsWith(\"}\")) || (trimmed.startsWith(\"[\") && trimmed.endsWith(\"]\"));\n        if (isJSON) {\n            const parsed = parseSpeedDialItemFromJSON(trimmed, suggestedCell);\n            if (parsed) return parsed;\n        }\n\n        return null;\n    } catch (e) {\n        console.warn(\"Failed to create speed dial item from clipboard:\", e);\n        return null;\n    }\n};\n\n","import { loadSettings } from \"@rs-com/config/Settings\";\nimport type { AppSettings } from \"@rs-com/config/SettingsTypes\";\nimport { applyGridSettings } from \"@rs-core/storage/StateStorage\";\n\n//\nconst resolveColorScheme = (theme: AppSettings[\"appearance\"] extends { theme?: infer T } ? T : never) => {\n    if (theme === \"dark\" || theme === \"light\") return theme;\n    return globalThis.matchMedia?.(\"(prefers-color-scheme: dark)\")?.matches ? \"dark\" : \"light\";\n};\n\nconst resolveFontSize = (size?: AppSettings[\"appearance\"] extends { fontSize?: infer T } ? T : never) => {\n    switch (size) {\n        case \"small\":\n            return \"14px\";\n        case \"large\":\n            return \"18px\";\n        case \"medium\":\n        default:\n            return \"16px\";\n    }\n};\n\n//\nexport const applyTheme = (settings: AppSettings) => {\n    const root = document.documentElement;\n    const theme = settings.appearance?.theme || \"auto\";\n    const resolvedScheme = resolveColorScheme(theme);\n\n    // implemented in veela.css\n    root.setAttribute(\"data-scheme\", theme);\n    root.setAttribute(\"data-theme\", resolvedScheme);\n    root.style.colorScheme = resolvedScheme;\n    root.style.fontSize = resolveFontSize(settings.appearance?.fontSize);\n    if (settings.appearance?.color) {\n        document.body.style.setProperty(\"--current\", settings.appearance.color);\n        document.body.style.setProperty(\"--primary\", settings.appearance.color);\n        root.style.setProperty(\"--current\", settings.appearance.color);\n        root.style.setProperty(\"--primary\", settings.appearance.color);\n    }\n\n    // Apply grid settings\n    if (settings.grid) {\n        applyGridSettings(settings);\n    }\n};\n\n//\nexport const initTheme = async () => {\n    try {\n        if (typeof document === \"undefined\") return;\n        const settings = await loadSettings();\n        applyTheme(settings);\n\n        // Listen for system changes if in auto mode?\n        // CSS handles this mostly, but if we add listeners here we can be more reactive.\n        globalThis.matchMedia?.('(prefers-color-scheme: dark)')?.addEventListener?.('change', async () => {\n            applyTheme(await loadSettings());\n        });\n    } catch (e) {\n        console.warn(\"Failed to init theme\", e);\n    }\n};\n","/**\n * Veela CSS - Core Runtime Loader\n *\n * Provides the shared foundation styles for all veela variants.\n * Use this when you only need the essential normalize and layout utilities.\n *\n * @example\n * ```ts\n * import { loadCoreStyles } from \"fest/veela/core\";\n * await loadCoreStyles();\n * ```\n */\n\nimport { loadAsAdopted } from \"fest/dom\";\n\nimport styles from \"./index.scss?inline\";\n\n/**\n * Load core veela styles (normalize + layout + states)\n */\nexport async function loadCoreStyles(): Promise<void> {\n    try {\n        await loadAsAdopted(styles);\n        console.log(\"[Veela/Core] Core styles loaded\");\n    } catch (e) {\n        console.warn(\"[Veela/Core] Failed to load core styles:\", e);\n    }\n}\n\nexport default loadCoreStyles;\n","/**\n * Veela CSS - Basic Runtime Loader\n *\n * Provides lightweight styling for minimal applications.\n * Inherits core foundation + adds basic component styles.\n *\n * @example\n * ```ts\n * import { loadBasicStyles } from \"fest/veela/basic\";\n * await loadBasicStyles();\n * ```\n */\n\nimport { loadAsAdopted } from \"fest/dom\";\n\nimport basicStyles from \"./index.scss?inline\";\n\n/**\n * Load basic veela styles\n */\nexport async function loadBasicStyles(): Promise<void> {\n    try {\n        if (basicStyles) {\n            await loadAsAdopted(basicStyles);\n            console.log(\"[Veela/Basic] Basic styles loaded\");\n        }\n    } catch (e) {\n        console.warn(\"[Veela/Basic] Failed to load basic styles:\", e);\n    }\n}\n\n// Re-export core utilities\nexport * from \"../core/index\";\n\nexport default loadBasicStyles;\n","/**\n * Veela CSS - Advanced Runtime Loader\n *\n * Provides full-featured styling with advanced components and effects.\n * Inherits core foundation + adds comprehensive component library.\n *\n * @example\n * ```ts\n * import { loadAdvancedStyles } from \"fest/veela/advanced\";\n * await loadAdvancedStyles();\n * ```\n */\n\nimport { loadAsAdopted } from \"fest/dom\";\n\nimport advancedStyles from \"./index.scss?inline\";\n\n/**\n * Load advanced veela styles\n */\nexport async function loadAdvancedStyles(): Promise<void> {\n    try {\n        if (advancedStyles) {\n            await loadAsAdopted(advancedStyles);\n            console.log(\"[Veela/Advanced] Advanced styles loaded\");\n        }\n    } catch (e) {\n        console.warn(\"[Veela/Advanced] Failed to load advanced styles:\", e);\n    }\n}\n\n// Re-export core utilities\nexport * from \"../core/index\";\n\nexport default loadAdvancedStyles;\n","/**\n * Veela CSS - Beer CSS Compatible Runtime Loader\n *\n * Provides styling compatible with Beer CSS (https://www.beercss.com/)\n * Inherits basic foundation + adds Beer CSS class names and variables.\n *\n * @example\n * ```ts\n * import { loadBeerCssStyles } from \"fest/veela/beercss\";\n * await loadBeerCssStyles();\n * ```\n *\n * @see https://www.beercss.com/ for Beer CSS documentation\n */\n\nimport { loadAsAdopted } from \"fest/dom\";\n\n/**\n * Load Beer CSS compatible styles\n */\nexport async function loadBeerCssStyles(): Promise<void> {\n    try {\n        const beerStyles = await import(\"./_index.scss?inline\");\n        if (beerStyles.default) {\n            await loadAsAdopted(beerStyles.default);\n            console.log(\"[Veela/BeerCSS] Beer CSS compatible styles loaded\");\n        }\n    } catch (e) {\n        console.warn(\"[Veela/BeerCSS] Failed to load Beer CSS styles:\", e);\n    }\n}\n\n// Re-export basic utilities\nexport * from \"../basic/index\";\n\nexport default loadBeerCssStyles;\n","/**\n * Veela CSS - Runtime Entry Point\n *\n * Unified runtime module providing access to all veela style variants.\n *\n * Variants:\n * - core: Shared foundation (normalize, layout, states)\n * - basic: Lightweight styles (core + essential components)\n * - advanced: Full-featured styles (core + comprehensive library)\n * - beercss: Beer CSS compatible (basic + Beer CSS class names)\n *\n * @example\n * ```ts\n * // Load specific variant\n * import { loadBasicStyles } from \"fest/veela/runtime\";\n * await loadBasicStyles();\n *\n * // Or use the variant loader\n * import { loadVeelaVariant } from \"fest/veela/runtime\";\n * await loadVeelaVariant(\"advanced\");\n * ```\n */\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport type VeelaVariant = \"core\" | \"basic\" | \"advanced\" | \"beercss\";\n\nexport interface VeelaConfig {\n    variant: VeelaVariant;\n    loaded: boolean;\n}\n\n// ============================================================================\n// STATE\n// ============================================================================\n\nlet _loadedVariant: VeelaVariant | null = null;\n\n// ============================================================================\n// VARIANT LOADERS\n// ============================================================================\n\nimport { loadCoreStyles } from \"./core/index\";\nimport { loadBasicStyles } from \"./basic/index\";\nimport { loadAdvancedStyles } from \"./advanced/index\";\nimport { loadBeerCssStyles } from \"./beercss/index\";\n\n// ============================================================================\n// UNIFIED LOADER\n// ============================================================================\n\n/**\n * Load a specific veela style variant\n *\n * @param variant - The style variant to load\n * @returns Promise that resolves when styles are loaded\n */\nexport async function loadVeelaVariant(variant: VeelaVariant): Promise<void> {\n    if (_loadedVariant === variant) {\n        console.log(`[Veela] Variant '${variant}' already loaded`);\n        return;\n    }\n\n    console.log(`[Veela] Loading variant: ${variant}`);\n\n    await loadCoreStyles();\n\n    switch (variant) {\n        case \"core\": {\n            await loadCoreStyles();\n            break;\n        }\n        case \"basic\": {\n            await loadBasicStyles();\n            break;\n        }\n        case \"advanced\": {\n            await loadAdvancedStyles();\n            break;\n        }\n        case \"beercss\": {\n            await loadBeerCssStyles();\n            break;\n        }\n        default:\n            console.warn(`[Veela] Unknown variant: ${variant}, using basic`);\n            await loadBasicStyles();\n            break;\n    }\n\n    _loadedVariant = variant;\n}\n\n/**\n * Get the currently loaded variant\n */\nexport function getLoadedVariant(): VeelaVariant | null {\n    return _loadedVariant;\n}\n\n/**\n * Check if a specific variant is loaded\n */\nexport function isVariantLoaded(variant: VeelaVariant): boolean {\n    return _loadedVariant === variant;\n}\n\n// ============================================================================\n// DEFAULT EXPORT\n// ============================================================================\n\nexport default loadVeelaVariant;\n","/**\n * Font Loader Module\n *\n * Loads fonts from base64-encoded, compressed data using:\n * - Compression Streams API for decompression\n * - Blob URL for caching\n * - FontFace API (CSS Font Loading API) for font loading\n */\n\n/**\n * Font metadata for loading\n */\nexport interface FontMetadata {\n    /** Base64-encoded, compressed font data */\n    base64: string;\n    /** Font family name */\n    family: string;\n    /** Font style (normal, italic, etc.) */\n    style?: string;\n    /** Font weight (100-900 or \"100 900\" for variable fonts) */\n    weight?: string | number;\n    /** Whether the font is compressed (requires decompression) */\n    compressed?: boolean;\n}\n\n/**\n * Cache for Blob URLs to avoid re-creating them\n */\nconst blobUrlCache = new Map<string, string>();\n\n/**\n * Cache for FontFace instances\n */\nconst fontFaceCache = new Map<string, FontFace>();\n\n/**\n * Decode base64 string to Uint8Array\n * Uses Uint8Array.fromBase64 if available, otherwise falls back to atob\n */\nfunction decodeBase64(base64: string): Uint8Array {\n    // Check if Uint8Array.fromBase64 is available (ES2024+)\n    if (typeof Uint8Array.fromBase64 === 'function') {\n        return Uint8Array.fromBase64(base64);\n    }\n\n    // Fallback: use atob for older browsers\n    const binaryString = atob(base64);\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes;\n}\n\n/**\n * Decompress data using Compression Streams API\n * Only used for fonts that were compressed (e.g., gzip)\n * woff2 files are already compressed and don't need decompression\n */\nasync function decompress(data: Uint8Array, algorithm: CompressionFormat = 'gzip'): Promise<Uint8Array> {\n    // Check if CompressionStream is available\n    if (typeof CompressionStream === 'undefined') {\n        throw new Error('Compression Streams API is not supported in this browser');\n    }\n\n    // Use DecompressionStream for decompression\n    const stream = new DecompressionStream(algorithm);\n    const writer = stream.writable.getWriter();\n    const reader = stream.readable.getReader();\n\n    // Write compressed data\n    writer.write(data);\n    writer.close();\n\n    // Read decompressed chunks\n    const chunks: Uint8Array[] = [];\n    let done = false;\n\n    while (!done) {\n        const { value, done: readerDone } = await reader.read();\n        done = readerDone;\n        if (value) {\n            chunks.push(value);\n        }\n    }\n\n    // Combine chunks\n    const totalLength = chunks.reduce((sum, chunk) => sum + chunk.length, 0);\n    const result = new Uint8Array(totalLength);\n    let offset = 0;\n    for (const chunk of chunks) {\n        result.set(chunk, offset);\n        offset += chunk.length;\n    }\n\n    return result;\n}\n\n/**\n * Get or create a Blob URL from font data\n * Caches the URL to avoid re-creating Blobs\n */\nasync function getBlobUrl(fontData: Uint8Array, cacheKey: string, mimeType: string = 'font/woff2'): Promise<string> {\n    // Check cache first\n    if (blobUrlCache.has(cacheKey)) {\n        return blobUrlCache.get(cacheKey)!;\n    }\n\n    // Create Blob and URL\n    const blob = new Blob([fontData], { type: mimeType });\n    const url = URL.createObjectURL(blob);\n\n    // Cache the URL\n    blobUrlCache.set(cacheKey, url);\n\n    return url;\n}\n\n/**\n * Load a font from base64-encoded, compressed data\n */\nexport async function loadFont(metadata: FontMetadata): Promise<FontFace> {\n    const { base64, family, style = 'normal', weight = 'normal', compressed = false } = metadata;\n\n    // Create cache key\n    const cacheKey = `${family}-${style}-${weight}`;\n\n    // Check if FontFace is already cached\n    if (fontFaceCache.has(cacheKey)) {\n        return fontFaceCache.get(cacheKey)!;\n    }\n\n    // Decode base64 to Uint8Array\n    const encodedData = decodeBase64(base64);\n\n    // Decompress if needed (woff2 files are already compressed, don't decompress)\n    // Only decompress if explicitly marked as compressed (e.g., gzip)\n    const fontData = compressed ? await decompress(encodedData) : encodedData;\n\n    // Determine MIME type based on compression\n    // woff2 files are already compressed, so if not compressed, assume woff2\n    const mimeType = compressed ? 'application/octet-stream' : 'font/woff2';\n\n    // Get or create Blob URL\n    const blobUrl = await getBlobUrl(fontData, cacheKey, mimeType);\n\n    // Create FontFace instance\n    const fontFace = new FontFace(\n        family,\n        `url(${blobUrl}) format('woff2')`,\n        {\n            style,\n            weight: typeof weight === 'string' ? weight : `${weight}`,\n            display: 'swap'\n        }\n    );\n\n    // Load the font\n    await fontFace.load();\n\n    // Add to document.fonts\n    document.fonts.add(fontFace);\n\n    // Cache the FontFace instance\n    fontFaceCache.set(cacheKey, fontFace);\n\n    return fontFace;\n}\n\n/**\n * Load multiple fonts\n */\nexport async function loadFonts(metadataArray: FontMetadata[]): Promise<FontFace[]> {\n    const promises = metadataArray.map(metadata => loadFont(metadata));\n    return Promise.all(promises);\n}\n\nlet loadingFontRegistry: any = null;\nexport async function loadFontRegistry(): Promise<any> {\n    if (loadingFontRegistry) {\n        return loadingFontRegistry;\n    }\n    loadingFontRegistry = import(\"./font-registry\")?.catch?.((error: any) => { console.error(\"Failed to load font registry:\", error); });;\n    return loadingFontRegistry;\n}\n\n/**\n * Load all fonts from the registry\n */\nexport async function loadAllFonts(): Promise<FontFace[]> {\n    const fontRegistry = await loadFontRegistry();\n    const metadataArray = Object.values(fontRegistry.fontRegistry as Record<string, FontMetadata>);\n    return loadFonts(metadataArray);\n}\n\n/**\n * Load fonts by family name\n */\nexport async function loadFontsByFamily(family: string): Promise<FontFace[]> {\n    const fontRegistry = await loadFontRegistry();\n    const metadataArray = Object.values(fontRegistry.fontRegistry as Record<string, FontMetadata>).filter(\n        metadata => metadata.family === family\n    );\n    return loadFonts(metadataArray);\n}\n\n/**\n * Clear font caches (useful for testing or memory management)\n */\nexport function clearFontCache(): void {\n    // Revoke all Blob URLs\n    for (const url of blobUrlCache.values()) {\n        URL.revokeObjectURL(url);\n    }\n\n    blobUrlCache.clear();\n    fontFaceCache.clear();\n}\n\n/**\n * Font data registry (populated by Vite plugin)\n * Import from generated font-registry module\n */\n//export { fontRegistry } from './font-registry';\n","/**\n * CSS Layer Manager\n *\n * Ensures correct @layer order by injecting layer declarations\n * before any other styles are loaded.\n *\n * This module provides:\n * - Unified layer hierarchy definition\n * - Layer initialization before style loading\n * - Layer name resolution for shells and views\n * - Layer status checking\n *\n * @module layer-manager\n */\n\nimport type { ShellId, ViewId } from \"../shells/types\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport type LayerCategory = 'system' | 'runtime' | 'shell' | 'view' | 'override';\n\nexport interface LayerDefinition {\n    /** Layer name (e.g., 'layer.shell.minimal') */\n    name: string;\n    /** Layer category for grouping */\n    category: LayerCategory;\n    /** Order value (lower = earlier in cascade) */\n    order: number;\n    /** Optional description */\n    description?: string;\n}\n\nexport type { ShellId, ViewId };\n\n// ============================================================================\n// LAYER HIERARCHY DEFINITION\n// ============================================================================\n\n/**\n * Unified layer hierarchy - ORDER MATTERS!\n *\n * Layers are declared in this order to ensure:\n * 1. Reset/normalize come first (lowest specificity wins)\n * 2. Tokens (CSS custom properties) are available early\n * 3. Runtime provides base component styles\n * 4. Shell styles can override runtime\n * 5. View styles can override shell\n * 6. Overrides (theme, print, a11y) win last\n */\nexport const LAYER_HIERARCHY: LayerDefinition[] = [\n    // === SYSTEM LAYERS (order 0-99) ===\n    // Canonical normalize/reset aliases used across runtime variants.\n    { name: 'ux-normalize',             category: 'system',   order: 0,   description: 'Veela normalize layer' },\n    { name: 'layer.reset',              category: 'system',   order: 0,   description: 'CSS reset rules' },\n    { name: 'layer.normalize',          category: 'system',   order: 10,  description: 'Normalize browser defaults' },\n    { name: 'tokens',                   category: 'system',   order: 20,  description: 'Legacy tokens layer' },\n    { name: 'ux-tokens',                category: 'system',   order: 20,  description: 'Veela token layer' },\n    { name: 'layer.tokens',             category: 'system',   order: 20,  description: 'CSS custom properties (variables)' },\n    { name: 'base',                     category: 'system',   order: 30,  description: 'Legacy base layer' },\n    { name: 'ux-base',                  category: 'system',   order: 30,  description: 'Veela base layer' },\n    { name: 'layout',                   category: 'system',   order: 40,  description: 'Legacy layout layer' },\n    { name: 'ux-layout',                category: 'system',   order: 40,  description: 'Veela layout layer' },\n    { name: 'components',               category: 'system',   order: 50,  description: 'Legacy components layer' },\n    { name: 'ux-components',            category: 'system',   order: 50,  description: 'Veela components layer' },\n    { name: 'utilities',                category: 'system',   order: 60,  description: 'Legacy utilities layer' },\n    { name: 'ux-utilities',             category: 'system',   order: 60,  description: 'Veela utilities layer' },\n    { name: 'ux-theme',                 category: 'system',   order: 70,  description: 'Veela theme layer' },\n    { name: 'ux-overrides',             category: 'system',   order: 80,  description: 'Veela overrides layer' },\n    { name: 'layer.properties.shell',   category: 'system',   order: 30,  description: 'Shell context custom properties' },\n    { name: 'layer.properties.views',   category: 'system',   order: 35,  description: 'View context custom properties' },\n\n    // === RUNTIME LAYERS (order 100-199) ===\n    { name: 'layer.runtime.base',       category: 'runtime',  order: 100, description: 'Veela runtime base styles' },\n    { name: 'layer.runtime.components', category: 'runtime',  order: 110, description: 'Reusable component styles' },\n    { name: 'layer.runtime.forms',      category: 'runtime',  order: 115, description: 'Form element base styles' },\n    { name: 'layer.runtime.utilities',  category: 'runtime',  order: 120, description: 'Utility classes' },\n    { name: 'layer.runtime.animations', category: 'runtime',  order: 130, description: 'Keyframes and animation definitions' },\n    { name: 'layer.boot',               category: 'runtime',  order: 140, description: 'Boot/choice screen styles' },\n    { name: 'boot.tokens',              category: 'runtime',  order: 142, description: 'Boot tokens layer' },\n    { name: 'boot.base',                category: 'runtime',  order: 144, description: 'Boot base layer' },\n    { name: 'boot.components',          category: 'runtime',  order: 146, description: 'Boot components layer' },\n    { name: 'boot.responsive',          category: 'runtime',  order: 148, description: 'Boot responsive adjustments' },\n\n    // === SHELL LAYERS (order 200-299) ===\n    { name: 'layer.shell.common',             category: 'shell', order: 200, description: 'Shared shell styles' },\n    { name: 'shell.tokens',                   category: 'shell', order: 202, description: 'Legacy shell tokens' },\n    { name: 'shell.base',                     category: 'shell', order: 204, description: 'Legacy shell base' },\n    { name: 'shell.components',               category: 'shell', order: 206, description: 'Legacy shell components' },\n    { name: 'shell.utilities',                category: 'shell', order: 208, description: 'Legacy shell utilities' },\n    { name: 'shell.overrides',                category: 'shell', order: 209, description: 'Legacy shell overrides' },\n    { name: 'layer.shell.raw',                category: 'shell', order: 210, description: 'Raw shell (minimal)' },\n    { name: 'layer.shell.minimal',              category: 'shell', order: 220, description: 'Minimal shell (toolbar navigation)' },\n    { name: 'layer.shell.minimal.layout',       category: 'shell', order: 222, description: 'Minimal shell layout rules' },\n    { name: 'layer.shell.minimal.components',   category: 'shell', order: 224, description: 'Minimal shell component styles' },\n    { name: 'layer.shell.faint',              category: 'shell', order: 230, description: 'Faint shell (tabbed sidebar)' },\n    { name: 'layer.shell.faint.layout',       category: 'shell', order: 232, description: 'Faint shell layout' },\n    { name: 'layer.shell.faint.sidebar',      category: 'shell', order: 234, description: 'Faint shell sidebar' },\n    { name: 'layer.shell.faint.toolbar',      category: 'shell', order: 236, description: 'Faint shell toolbar' },\n    { name: 'layer.shell.faint.forms',        category: 'shell', order: 238, description: 'Faint shell form components' },\n\n    // === VIEW LAYERS (order 300-399) ===\n    { name: 'layer.view.common',              category: 'view', order: 300, description: 'Shared view styles' },\n    { name: 'layer.view.viewer',              category: 'view', order: 310, description: 'Markdown viewer' },\n    { name: 'layer.view.workcenter',          category: 'view', order: 320, description: 'Work center (AI prompts)' },\n    { name: 'layer.view.workcenter.keyframes', category: 'view', order: 322, description: 'Work center animations' },\n    { name: 'view.workcenter',                category: 'view', order: 324, description: 'Work center styles (legacy name)' },\n    { name: 'view.workcenter.animations',     category: 'view', order: 326, description: 'Work center animations (legacy name)' },\n    { name: 'layer.view.settings',            category: 'view', order: 330, description: 'Settings view' },\n    { name: 'layer.view.explorer',            category: 'view', order: 340, description: 'File explorer' },\n    { name: 'layer.view.history',             category: 'view', order: 350, description: 'History view' },\n    { name: 'layer.view.editor',              category: 'view', order: 360, description: 'Editor view' },\n    { name: 'layer.view.editor.markdown',     category: 'view', order: 362, description: 'Markdown editor sublayer' },\n    { name: 'layer.view.editor.quill',        category: 'view', order: 364, description: 'Quill editor sublayer' },\n    { name: 'layer.view.airpad',              category: 'view', order: 370, description: 'Airpad (touch input)' },\n    { name: 'layer.view.home',                category: 'view', order: 380, description: 'Home/landing view' },\n    { name: 'layer.view.print',               category: 'view', order: 390, description: 'Print view' },\n    { name: 'view-explorer',                  category: 'view', order: 392, description: 'Explorer legacy layered scope' },\n\n    // === OVERRIDE LAYERS (order 900-999) ===\n    { name: 'layer.override.theme',  category: 'override', order: 900, description: 'Theme customizations' },\n    { name: 'layer.override.print',  category: 'override', order: 910, description: 'Print media styles' },\n    { name: 'layer.override.a11y',   category: 'override', order: 920, description: 'Accessibility enhancements' },\n];\n\n// ============================================================================\n// STATE\n// ============================================================================\n\nlet _initialized = false;\nlet _layerElement: HTMLStyleElement | null = null;\n\n// ============================================================================\n// LAYER INITIALIZATION\n// ============================================================================\n\n/**\n * Initialize CSS layer order\n *\n * MUST be called before any other styles are loaded to ensure\n * the cascade layer order is established correctly.\n *\n * This function is idempotent - calling it multiple times is safe.\n *\n * @example\n * ```ts\n * // In application entry point\n * import { initializeLayers } from './shared/layer-manager';\n *\n * async function main() {\n *     // Initialize layers FIRST\n *     initializeLayers();\n *\n *     // Then load styles\n *     await loadStyleSystem('vl-advanced');\n *     // ...\n * }\n * ```\n */\nexport function initializeLayers(): void {\n    if (_initialized) {\n        console.debug('[LayerManager] Already initialized');\n        return;\n    }\n\n    if (typeof document === 'undefined') {\n        console.warn('[LayerManager] No document available (SSR context?)');\n        return;\n    }\n\n    // Sort layers by order value\n    const sortedLayers = [...LAYER_HIERARCHY].sort((a, b) => a.order - b.order);\n    const layerNames = sortedLayers.map(l => l.name);\n\n    // Create @layer declaration\n    const layerRule = `@layer ${layerNames.join(', ')};`;\n\n    // Inject as first stylesheet\n    const style = document.createElement('style');\n    style.id = 'css-layer-init';\n    style.setAttribute('data-layer-manager', 'true');\n    style.textContent = layerRule;\n\n    // Insert at the very beginning of <head>\n    const head = document.head;\n    head.insertBefore(style, head.firstChild);\n\n    _layerElement = style;\n    _initialized = true;\n\n    console.log(`[LayerManager] Initialized ${layerNames.length} layers`);\n}\n\n/**\n * Reset layer initialization (mainly for testing)\n */\nexport function resetLayers(): void {\n    if (_layerElement && _layerElement.parentNode) {\n        _layerElement.parentNode.removeChild(_layerElement);\n    }\n    _layerElement = null;\n    _initialized = false;\n    console.debug('[LayerManager] Reset');\n}\n\n// ============================================================================\n// LAYER NAME HELPERS\n// ============================================================================\n\n/**\n * Get layer name for a shell\n *\n * @param shellId - Shell identifier\n * @returns Layer name (e.g., 'layer.shell.minimal')\n *\n * @example\n * ```scss\n * // In shell SCSS file\n * @layer #{getShellLayer('minimal')} {\n *     .app-shell { ... }\n * }\n * ```\n */\nexport function getShellLayer(shellId: ShellId): string {\n    return `layer.shell.${shellId}`;\n}\n\n/**\n * Get layer name for a view\n *\n * @param viewId - View identifier\n * @returns Layer name (e.g., 'layer.view.viewer')\n *\n * @example\n * ```scss\n * // In view SCSS file\n * @layer #{getViewLayer('viewer')} {\n *     .view-viewer { ... }\n * }\n * ```\n */\nexport function getViewLayer(viewId: ViewId): string {\n    return `layer.view.${viewId}`;\n}\n\n/**\n * Get all layer names in order\n *\n * @returns Array of layer names sorted by cascade order\n */\nexport function getLayerOrder(): string[] {\n    return [...LAYER_HIERARCHY]\n        .sort((a, b) => a.order - b.order)\n        .map(l => l.name);\n}\n\n/**\n * Get layers by category\n *\n * @param category - Layer category to filter\n * @returns Array of layer definitions\n */\nexport function getLayersByCategory(category: LayerCategory): LayerDefinition[] {\n    return LAYER_HIERARCHY.filter(l => l.category === category);\n}\n\n// ============================================================================\n// STATUS CHECKING\n// ============================================================================\n\n/**\n * Check if layers are initialized\n */\nexport function areLayersInitialized(): boolean {\n    return _initialized;\n}\n\n/**\n * Get the layer initialization element\n */\nexport function getLayerElement(): HTMLStyleElement | null {\n    return _layerElement;\n}\n\n// ============================================================================\n// LAYER CONSTANTS (for use in SCSS or TypeScript)\n// ============================================================================\n\n/** Layer names as constants */\nexport const LAYERS = {\n    // System\n    RESET: 'layer.reset',\n    NORMALIZE: 'layer.normalize',\n    TOKENS: 'layer.tokens',\n    PROPERTIES_SHELL: 'layer.properties.shell',\n    PROPERTIES_VIEWS: 'layer.properties.views',\n\n    // Runtime\n    RUNTIME_BASE: 'layer.runtime.base',\n    RUNTIME_COMPONENTS: 'layer.runtime.components',\n    RUNTIME_FORMS: 'layer.runtime.forms',\n    RUNTIME_UTILITIES: 'layer.runtime.utilities',\n    RUNTIME_ANIMATIONS: 'layer.runtime.animations',\n    BOOT: 'layer.boot',\n\n    // Shell\n    SHELL_COMMON: 'layer.shell.common',\n    SHELL_RAW: 'layer.shell.raw',\n    SHELL_MINIMAL: 'layer.shell.minimal',\n    SHELL_MINIMAL_LAYOUT: 'layer.shell.minimal.layout',\n    SHELL_MINIMAL_COMPONENTS: 'layer.shell.minimal.components',\n    SHELL_FAINT: 'layer.shell.faint',\n    SHELL_FAINT_LAYOUT: 'layer.shell.faint.layout',\n    SHELL_FAINT_SIDEBAR: 'layer.shell.faint.sidebar',\n    SHELL_FAINT_TOOLBAR: 'layer.shell.faint.toolbar',\n    SHELL_FAINT_FORMS: 'layer.shell.faint.forms',\n\n    // View\n    VIEW_COMMON: 'layer.view.common',\n    VIEW_VIEWER: 'layer.view.viewer',\n    VIEW_WORKCENTER: 'layer.view.workcenter',\n    VIEW_WORKCENTER_KEYFRAMES: 'layer.view.workcenter.keyframes',\n    VIEW_SETTINGS: 'layer.view.settings',\n    VIEW_EXPLORER: 'layer.view.explorer',\n    VIEW_HISTORY: 'layer.view.history',\n    VIEW_EDITOR: 'layer.view.editor',\n    VIEW_EDITOR_MARKDOWN: 'layer.view.editor.markdown',\n    VIEW_EDITOR_QUILL: 'layer.view.editor.quill',\n    VIEW_AIRPAD: 'layer.view.airpad',\n    VIEW_HOME: 'layer.view.home',\n    VIEW_PRINT: 'layer.view.print',\n\n    // Override\n    OVERRIDE_THEME: 'layer.override.theme',\n    OVERRIDE_PRINT: 'layer.override.print',\n    OVERRIDE_A11Y: 'layer.override.a11y',\n} as const;\n\nexport type LayerName = (typeof LAYERS)[keyof typeof LAYERS];\n\n// ============================================================================\n// DEFAULT EXPORT\n// ============================================================================\n\nexport default {\n    initializeLayers,\n    resetLayers,\n    getShellLayer,\n    getViewLayer,\n    getLayerOrder,\n    getLayersByCategory,\n    areLayersInitialized,\n    getLayerElement,\n    LAYERS,\n    LAYER_HIERARCHY,\n};\n","/**\n * Boot Loader - Shell/Style Initialization System\n * \n * Manages the boot sequence for the CrossWord application:\n * 1. Load style system (Veela CSS or Minimal)\n * 2. Initialize shell (frame/layout/environment)\n * 3. Load view/component/module\n * 4. Connect uniform channels\n * \n * Shell/Style Matrix:\n * | Shells/Styles: | Faint | Minimal | Raw |\n * |----------------|-------|-------|-----|\n * | Veela          |  [r]  |  [o]  | [o] |\n * | Minimal        |  [o]  |  [r]  | [r] |\n * \n * [r] - recommended, [o] - optional\n */\n\nimport { loadAsAdopted } from \"fest/dom\";\nimport { ShellRegistry, initializeRegistries } from \"../shared/registry\";\nimport { defaultTheme, darkTheme, lightTheme } from \"../shared/registry\";\nimport type { ShellId, ViewId, Shell, ShellTheme } from \"../shells/types\";\nimport { serviceChannels, type ServiceChannelId } from \"@rs-com/core/ServiceChannels\";\nimport { loadSettings } from \"@rs-com/config/Settings\";\nimport { applyTheme as applyAppTheme } from \"@rs-core/utils/Theme\";\nimport type { AppSettings } from \"@rs-com/config/SettingsTypes\";\n\nimport { loadVeelaVariant, type VeelaVariant } from \"fest/veela\";\nimport { initializeLayers } from \"../shared/layer-manager\";\n\n// ============================================================================\n// BOOT TYPES\n// ============================================================================\n\n/**\n * Style system identifiers\n */\nexport type StyleSystem = \"raw\" | \"vl-core\" | \"vl-basic\" | \"vl-advanced\" | \"vl-beercss\";\n\n/**\n * Boot configuration\n */\nexport interface BootConfig {\n    /** Style system to use */\n    styleSystem: StyleSystem;\n    /** Shell to initialize */\n    shell: ShellId;\n    /** Initial view to load */\n    defaultView: ViewId;\n    /** Initial theme */\n    theme?: ShellTheme;\n    /** Service channels to initialize */\n    channels?: ServiceChannelId[];\n    /** Remember preferences */\n    rememberChoice?: boolean;\n}\n\n/**\n * Boot state\n */\nexport interface BootState {\n    phase: \"idle\" | \"styles\" | \"shell\" | \"view\" | \"channels\" | \"ready\" | \"error\";\n    styleSystem: StyleSystem | null;\n    shell: ShellId | null;\n    view: ViewId | null;\n    error: Error | null;\n}\n\n/**\n * Boot phase handler\n */\nexport type BootPhaseHandler = (state: BootState) => void | Promise<void>;\n\nconst normalizeShellId = (shell: ShellId): ShellId => {\n    return shell === \"faint\" ? \"minimal\" : shell;\n};\n\n// ============================================================================\n// STYLE SYSTEM CONFIGURATION\n// ============================================================================\n\n/**\n * Style system configurations\n */\nconst STYLE_CONFIGS: Record<StyleSystem, {\n    name: string;\n    stylesheets: string[];\n    description: string;\n    recommendedShells: ShellId[];\n}> = {\n    \"raw\": {\n        name: \"Raw (No Framework)\",\n        stylesheets: [],\n        description: \"No CSS framework, raw browser defaults\",\n        recommendedShells: [\"base\"]\n    },\n    \"vl-core\": {\n        name: \"Core (Shared Foundation)\",\n        stylesheets: [],\n        description: \"Shared foundation styles for all veela variants\",\n        recommendedShells: [\"faint\", \"base\"]\n    },\n    \"vl-basic\": {\n        name: \"Basic Veela Styles\",\n        stylesheets: [],\n        description: \"Minimal styling for basic functionality\",\n        recommendedShells: [\"minimal\", \"base\"]\n    },\n    \"vl-advanced\": {\n        name: \"Advanced (Full-Featured Styling)\",\n        stylesheets: [],\n        description: \"Full-featured styling with design tokens and effects\",\n        recommendedShells: [\"faint\", \"minimal\"]\n    },\n    \"vl-beercss\": {\n        name: \"BeerCSS (Beer CSS Compatible)\",\n        stylesheets: [],\n        description: \"Beer CSS compatible styling with Material Design 3\",\n        recommendedShells: [\"faint\"]\n    }\n};\n\n/**\n * Get recommended style system for a shell\n */\nexport function getRecommendedStyle(shell: ShellId): StyleSystem {\n    switch (shell) {\n        case \"faint\":\n            return \"vl-basic\";\n        case \"minimal\":\n            return \"vl-basic\";\n        case \"base\":\n            return \"vl-core\";\n        default:\n            return \"vl-core\";\n    }\n}\n\n// ============================================================================\n// BOOT LOADER CLASS\n// ============================================================================\n\n/**\n * Boot Loader\n * \n * Manages the application boot sequence with proper ordering:\n * Styles  Shell  View  Channels\n */\nexport class BootLoader {\n    private static instance: BootLoader;\n    \n    // State (use object for mutable state tracking)\n    private state: BootState = {\n        phase: \"idle\",\n        styleSystem: null,\n        shell: null,\n        view: null,\n        error: null\n    };\n    \n    // State change handlers\n    private stateChangeHandlers = new Set<(state: BootState) => void>();\n    \n    // Loaded shell instance\n    private shellInstance: Shell | null = null;\n    \n    \n    // Phase handlers for customization\n    private phaseHandlers = new Map<BootState[\"phase\"], Set<BootPhaseHandler>>();\n\n    private constructor() {\n        // Initialize registries\n        initializeRegistries();\n    }\n\n    static getInstance(): BootLoader {\n        if (!BootLoader.instance) {\n            BootLoader.instance = new BootLoader();\n        }\n        return BootLoader.instance;\n    }\n\n    // ========================================================================\n    // BOOT SEQUENCE\n    // ========================================================================\n\n    /**\n     * Execute the boot sequence\n     */\n    async boot(container: HTMLElement, config: BootConfig): Promise<Shell> {\n        console.log(\"[BootLoader] Starting boot sequence:\", config);\n        \n        try {\n            // Establish canonical cascade layer order before any stylesheet loads.\n            initializeLayers();\n\n            // Phase 0: Load persisted settings early (theme/font-size/etc.)\n            const persistedSettings = await loadSettings().catch((error) => {\n                console.warn(\"[BootLoader] Failed to load settings:\", error);\n                return null;\n            });\n            const persistedTheme = this.resolveThemeFromSettings(persistedSettings);\n\n            // Phase 1: Load Style System\n            await this.loadStyles(config.styleSystem);\n            \n            // Phase 2: Initialize Shell\n            const shell = await this.loadShell(config.shell, container);\n            \n            // Phase 3: Apply Theme\n            shell.setTheme(config.theme || persistedTheme);\n            \n            // Phase 4: Mount Shell\n            await shell.mount(container);\n\n            // Phase 4.5: Apply document-level theme/settings\n            if (persistedSettings) {\n                applyAppTheme(persistedSettings);\n            }\n            \n            // Phase 5: Initialize Channels\n            if (config.channels && config.channels.length > 0) {\n                await this.initChannels(config.channels);\n            }\n            \n            // Phase 6: Navigate to Default View\n            await shell.navigate(config.defaultView);\n            \n            // Mark as ready\n            this.setPhase(\"ready\");\n            \n            // Save preferences\n            if (config.rememberChoice) {\n                this.savePreferences(config);\n            }\n            \n            console.log(\"[BootLoader] Boot complete\");\n            return shell;\n            \n        } catch (error) {\n            console.error(\"[BootLoader] Boot failed:\", error);\n            this.updateState({\n                phase: \"error\",\n                error: error as Error\n            });\n            throw error;\n        }\n    }\n\n    private resolveThemeFromSettings(settings: AppSettings | null | undefined): ShellTheme {\n        const theme = settings?.appearance?.theme || \"auto\";\n        if (theme === \"dark\") return darkTheme;\n        if (theme === \"light\") return lightTheme;\n        return defaultTheme;\n    }\n\n    /**\n     * Load style system\n     */\n    private async loadStyles(styleSystem: StyleSystem): Promise<void> {\n        this.setPhase(\"styles\");\n        console.log(`[BootLoader] Loading style system: ${styleSystem}`);\n        \n        const config = STYLE_CONFIGS[styleSystem] || STYLE_CONFIGS[\"vl-basic\"];\n\n        // Load Veela CSS framework if selected\n        try {\n            // Load the main stylesheet using loadCss helper\n            // Try loading via fest/veela's loadCss which handles paths correctly\n            // Accept only VeelaVariant (type-safe)\n            const veelaVariant = styleSystem?.replace?.(\"veela-\", \"\")?.replace?.(\"vl-\", \"\") || \"basic\";\n            console.log(`[BootLoader] Loading Veela variant: ${veelaVariant}`);\n            await loadVeelaVariant(veelaVariant as VeelaVariant);\n            console.log(\"[BootLoader] Veela CSS loaded\");\n        } catch (error) {\n            console.warn(\"[BootLoader] Failed to load Veela CSS, using fallback:\", error);\n        }\n        \n        // Load any additional stylesheets\n        for (const sheet of config.stylesheets) {\n            try {\n                await loadAsAdopted(sheet);\n            } catch (error) {\n                console.warn(`[BootLoader] Failed to load stylesheet: ${sheet}`, error);\n            }\n        }\n        \n        this.updateState({ styleSystem });\n        console.log(`[BootLoader] Style system ${styleSystem} loaded`);\n    }\n\n    /**\n     * Load and initialize shell\n     */\n    private async loadShell(shellId: ShellId, container: HTMLElement): Promise<Shell> {\n        this.setPhase(\"shell\");\n        const normalizedShell = normalizeShellId(shellId);\n        if (normalizedShell !== shellId) {\n            console.warn(`[BootLoader] Shell \"${shellId}\" is temporarily disabled, redirecting to \"${normalizedShell}\"`);\n        }\n        console.log(`[BootLoader] Loading shell: ${normalizedShell}`);\n        \n        const shell = await ShellRegistry.load(normalizedShell, container);\n        \n        this.shellInstance = shell;\n        this.updateState({ shell: normalizedShell });\n        \n        console.log(`[BootLoader] Shell ${normalizedShell} loaded`);\n        return shell;\n    }\n\n    /**\n     * Initialize service channels\n     */\n    private async initChannels(channelIds: ServiceChannelId[]): Promise<void> {\n        this.setPhase(\"channels\");\n        console.log(`[BootLoader] Initializing channels:`, channelIds);\n        \n        for (const channelId of channelIds) {\n            try {\n                await serviceChannels.initChannel(channelId);\n            } catch (error) {\n                console.warn(`[BootLoader] Failed to init channel ${channelId}:`, error);\n            }\n        }\n        \n        console.log(`[BootLoader] Channels initialized`);\n    }\n\n    // ========================================================================\n    // STATE MANAGEMENT\n    // ========================================================================\n\n    /**\n     * Update state and notify handlers\n     */\n    private updateState(partial: Partial<BootState>): void {\n        Object.assign(this.state, partial);\n        this.notifyStateChange();\n    }\n\n    /**\n     * Set current phase and notify handlers\n     */\n    private setPhase(phase: BootState[\"phase\"]): void {\n        this.updateState({ phase });\n        \n        const handlers = this.phaseHandlers.get(phase);\n        if (handlers) {\n            for (const handler of handlers) {\n                try {\n                    handler(this.state);\n                } catch (error) {\n                    console.error(`[BootLoader] Phase handler error:`, error);\n                }\n            }\n        }\n    }\n\n    /**\n     * Notify all state change handlers\n     */\n    private notifyStateChange(): void {\n        for (const handler of this.stateChangeHandlers) {\n            try {\n                handler(this.state);\n            } catch (error) {\n                console.error(`[BootLoader] State handler error:`, error);\n            }\n        }\n    }\n\n    /**\n     * Subscribe to state changes\n     */\n    onStateChange(handler: (state: BootState) => void): () => void {\n        this.stateChangeHandlers.add(handler);\n        return () => {\n            this.stateChangeHandlers.delete(handler);\n        };\n    }\n\n    /**\n     * Register a phase handler\n     */\n    onPhase(phase: BootState[\"phase\"], handler: BootPhaseHandler): () => void {\n        if (!this.phaseHandlers.has(phase)) {\n            this.phaseHandlers.set(phase, new Set());\n        }\n        this.phaseHandlers.get(phase)!.add(handler);\n        \n        return () => {\n            this.phaseHandlers.get(phase)?.delete(handler);\n        };\n    }\n\n    /**\n     * Get current state\n     */\n    getState(): BootState {\n        return { ...this.state };\n    }\n\n    /**\n     * Get current shell instance\n     */\n    getShell(): Shell | null {\n        return this.shellInstance;\n    }\n\n    // ========================================================================\n    // PREFERENCES\n    // ========================================================================\n\n    /**\n     * Save boot preferences\n     */\n    private savePreferences(config: BootConfig): void {\n        try {\n            const normalizedShell = normalizeShellId(config.shell);\n            localStorage.setItem(\"rs-boot-style\", config.styleSystem);\n            localStorage.setItem(\"rs-boot-shell\", normalizedShell);\n            localStorage.setItem(\"rs-boot-view\", config.defaultView);\n            localStorage.setItem(\"rs-boot-remember\", \"1\");\n        } catch (error) {\n            console.warn(\"[BootLoader] Failed to save preferences:\", error);\n        }\n    }\n\n    /**\n     * Load boot preferences\n     */\n    loadPreferences(): Partial<BootConfig> | null {\n        try {\n            const remember = localStorage.getItem(\"rs-boot-remember\");\n            if (remember !== \"1\") return null;\n            const shell = normalizeShellId((localStorage.getItem(\"rs-boot-shell\") as ShellId) || \"minimal\");\n            \n            return {\n                styleSystem: (localStorage.getItem(\"rs-boot-style\") as StyleSystem) || undefined,\n                shell,\n                defaultView: (localStorage.getItem(\"rs-boot-view\") as ViewId) || undefined\n            };\n        } catch {\n            return null;\n        }\n    }\n\n    /**\n     * Clear preferences\n     */\n    clearPreferences(): void {\n        try {\n            localStorage.removeItem(\"rs-boot-style\");\n            localStorage.removeItem(\"rs-boot-shell\");\n            localStorage.removeItem(\"rs-boot-view\");\n            localStorage.removeItem(\"rs-boot-remember\");\n        } catch {\n            // Ignore\n        }\n    }\n}\n\n// ============================================================================\n// CONVENIENCE EXPORTS\n// ============================================================================\n\n/**\n * Get the singleton boot loader\n */\nexport const bootLoader = BootLoader.getInstance();\n\n/**\n * Quick boot with default configuration\n */\nexport async function quickBoot(\n    container: HTMLElement,\n    shell: ShellId = \"minimal\",\n    view: ViewId = \"viewer\"\n): Promise<Shell> {\n    return bootLoader.boot(container, {\n        styleSystem: getRecommendedStyle(shell),\n        shell,\n        defaultView: view,\n        channels: [view as ServiceChannelId],\n        rememberChoice: false\n    });\n}\n\n/**\n * Boot with Veela + Faint shell\n */\nexport async function bootFaint(\n    container: HTMLElement,\n    view: ViewId = \"viewer\"\n): Promise<Shell> {\n    return bootMinimal(container, view);\n}\n\n/**\n * Boot with Minimal shell\n */\nexport async function bootMinimal(\n    container: HTMLElement,\n    view: ViewId = \"viewer\"\n): Promise<Shell> {\n    return bootLoader.boot(container, {\n        styleSystem: \"vl-basic\",\n        shell: \"minimal\",\n        defaultView: view,\n        channels: [\"workcenter\", \"settings\", \"viewer\"],\n        rememberChoice: true\n    });\n}\n\n/**\n * Boot with Raw shell (minimal)\n */\nexport async function bootBase(\n    container: HTMLElement,\n    view: ViewId = \"viewer\"\n): Promise<Shell> {\n    return bootLoader.boot(container, {\n        styleSystem: \"vl-core\",\n        shell: \"base\",\n        defaultView: view,\n        channels: [],\n        rememberChoice: false\n    });\n}\n\n// ============================================================================\n// DEFAULT EXPORT\n// ============================================================================\n\nexport default bootLoader;\n","/**\n * CRX Frontend Entry Point\n *\n * Entry point for Chrome extension pages (settings, newtab, viewer, etc.).\n * Uses the Raw shell (no toolbar / tabs / navigation chrome).\n * Loads basic styles and lets each view manage its own styling.\n *\n * Usage:\n *   import crxFrontend from \"./crx-entry\";\n *   crxFrontend(document.getElementById(\"app\")!, { initialView: \"settings\" });\n */\n\nimport { bootLoader } from \"./BootLoader\";\nimport type { ViewId, Shell } from \"../shells/types\";\nimport { ViewRegistry } from \"../shared/registry\";\nimport { initializeLayers } from \"../shared/layer-manager\";\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport type CrxAppOptions = {\n    /** View to display - accepts both shell ViewId and legacy MinimalView names */\n    initialView?: ViewId | \"markdown\" | \"markdown-viewer\";\n    /** Optional URL-style params passed to the launched view */\n    viewParams?: Record<string, string>;\n    /** Optional initial payload passed to the launched view */\n    viewPayload?: unknown;\n};\n\n// ============================================================================\n// VIEW NAME MAPPING\n// ============================================================================\n\n/**\n * Map legacy / CRX-specific view names  canonical ViewId\n */\nconst CRX_VIEW_MAP: Record<string, ViewId> = {\n    \"markdown\":         \"viewer\",\n    \"markdown-viewer\":  \"viewer\",\n};\n\nconst resolveViewId = (input?: string): ViewId =>\n    (input && CRX_VIEW_MAP[input]) ?? (input as ViewId) ?? \"viewer\";\n\n// ============================================================================\n// ENTRY POINT\n// ============================================================================\n\n/**\n * Mount the frontend for a Chrome extension page.\n *\n * - Uses the **raw** shell (no toolbar, no tabs).\n * - Loads \"vl-basic\" style system (shell + view own styles handle the rest).\n * - No channels or preference persistence (CRX pages are single-purpose).\n *\n * @param mountElement - DOM element to mount into\n * @param options      - Optional view configuration\n * @returns The mounted shell instance\n */\nexport default async function crxFrontend(\n    mountElement: HTMLElement,\n    options: CrxAppOptions = {},\n): Promise<Shell> {\n    // CRX pages can bypass main index entry, so initialize layers here too.\n    initializeLayers();\n\n    const view = resolveViewId(options.initialView);\n    const hasViewParams = Boolean(options.viewParams && Object.keys(options.viewParams).length > 0);\n    const hasPayload = options.viewPayload !== undefined && options.viewPayload !== null;\n\n    const shell = await bootLoader.boot(mountElement, {\n        styleSystem: \"vl-basic\",\n        shell:       \"base\",\n        defaultView: view,\n        channels:    [],\n        rememberChoice: false,\n    });\n\n    if (hasViewParams) {\n        await shell.navigate(view, options.viewParams);\n    }\n\n    if (hasPayload) {\n        const loadedView = ViewRegistry.getLoaded(view);\n        const asMessageCapable = loadedView as {\n            canHandleMessage?: (messageType: string) => boolean;\n            handleMessage?: (message: unknown) => Promise<void> | void;\n        } | undefined;\n\n        if (asMessageCapable?.canHandleMessage?.(\"content-load\") && asMessageCapable.handleMessage) {\n            await asMessageCapable.handleMessage({\n                type: \"content-load\",\n                data: options.viewPayload\n            });\n        } else if (asMessageCapable?.handleMessage) {\n            await asMessageCapable.handleMessage({\n                type: \"launch\",\n                data: options.viewPayload\n            });\n        }\n    }\n\n    return shell;\n}\n\nexport { crxFrontend };\n"],"file":"crx-entry.js"}