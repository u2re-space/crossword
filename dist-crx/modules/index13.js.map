{"version":3,"mappings":"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","names":["MdViewElement"],"ignoreList":[],"sources":["../../src/frontend/views/print/index.ts"],"sourcesContent":["/**\n * Print View â€” Unified with MarkdownView Component\n *\n * Shell-agnostic print view for rendering and printing markdown content.\n * This view leverages the canonical MarkdownView component from fest/fl-ui\n * for all markdown parsing, caching, sanitization, and styling.\n *\n * Features:\n * - Reuses MarkdownView web component for markdown rendering\n * - KaTeX math rendering (via MarkdownView)\n * - DOMPurify sanitization (via MarkdownView)\n * - OPFS and localStorage caching (via MarkdownView)\n * - DOCX export support\n * - Auto-print on load\n * - Print-optimized styles\n */\n\nimport { H } from \"fest/lure\";\nimport type { View, ViewOptions } from \"../../shells/types\";\nimport { MdViewElement } from \"fest/fl-ui/services/markdown-view\";\n\n// ============================================================================\n// PRINT VIEW OPTIONS\n// ============================================================================\n\nexport interface PrintViewOptions extends ViewOptions {\n    /** Initial markdown content to display */\n    initialMarkdown?: string;\n    /** Title for the document */\n    title?: string;\n    /** Whether to auto-print when loaded */\n    autoPrint?: boolean;\n    /** Custom CSS class for styling */\n    className?: string;\n    /** Print delay in ms */\n    printDelay?: number;\n    /** Export format */\n    exportFormat?: \"print\" | \"docx\";\n}\n\n// ============================================================================\n// PRINT VIEW CLASS\n// ============================================================================\n\nexport class PrintView implements View {\n    readonly id = \"print\";\n    readonly name = \"Print\";\n\n    private element: HTMLElement | null = null;\n    private options: PrintViewOptions;\n    private mdView: MdViewElement | null = null;\n\n    constructor(options: PrintViewOptions = {}) {\n        this.options = {\n            ...options,\n            initialData: options.initialData || options.initialMarkdown\n        };\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        // Merge options from constructor and render call\n        const mergedOptions = { ...this.options, ...options };\n\n        // Load styles (async, but we'll trigger it without awaiting)\n        this.loadStyles().catch(e => console.warn(\"[PrintView] Failed to load print styles:\", e));\n\n        // Get content from options or URL parameters\n        const urlParams = new URLSearchParams(globalThis?.location?.search);\n        const content = (mergedOptions as PrintViewOptions).initialMarkdown ||\n            urlParams.get('content') ||\n            urlParams.get('markdown-content') ||\n            urlParams.get('text') ||\n            (mergedOptions.initialData as string) || '';\n        const title = (mergedOptions as PrintViewOptions).title || urlParams.get('title') || 'Document';\n        const wantsDocx = (mergedOptions as PrintViewOptions).exportFormat === 'docx' ||\n            urlParams.get('export') === 'docx' ||\n            urlParams.get('format') === 'docx';\n        const autoPrint = ((mergedOptions as PrintViewOptions).autoPrint ?? (urlParams.get('auto-print') !== 'false')) && !wantsDocx;\n        const className = (mergedOptions as PrintViewOptions).className || 'print-view';\n\n        // Handle DOCX export (fire and forget)\n        if (wantsDocx && content.trim()) {\n            this.handleDocxExport(content, title).catch(e => console.error('[PrintView] DOCX export error:', e));\n        }\n\n        // Create print layout using MarkdownView web component\n        this.mdView = new MdViewElement() as MdViewElement;\n\n        this.element = H`\n            <div class=\"${className}\">\n                <div class=\"print-content\">\n                    ${this.mdView}\n                </div>\n            </div>\n        ` as HTMLElement;\n\n        // Set markdown content via the component (async, but non-blocking)\n        if (content.trim()) {\n            (this.mdView as any).setContent?.(content).catch((e: any) => {\n                console.warn('[PrintView] Failed to set markdown content:', e);\n            });\n        }\n\n        // Auto-print if enabled (scheduled for later)\n        if (autoPrint && content.trim() && typeof globalThis !== 'undefined' && 'print' in globalThis) {\n            const printDelay = (mergedOptions as PrintViewOptions).printDelay ||\n                (urlParams.get('print-delay') ? parseInt(urlParams.get('print-delay')!) : 1500);\n\n            setTimeout(() => {\n                console.log('[PrintView] Auto-printing document');\n                globalThis?.print?.();\n            }, printDelay);\n        }\n\n        console.log('[PrintView] Rendered', {\n            title,\n            contentLength: content.length,\n            autoPrint,\n        });\n\n        return this.element;\n    }\n\n    private async loadStyles(): Promise<void> {\n        try {\n            // Use the styles from MarkdownView component via fest/fl-ui\n            // Print-specific styles can be added via print media queries in CSS\n            // No additional styles needed since MarkdownView handles all rendering\n            console.log(\"[PrintView] Using MarkdownView component styles\");\n        } catch (e) {\n            console.warn(\"[PrintView] Error during style setup:\", e);\n        }\n    }\n\n    private async handleDocxExport(content: string, title: string): Promise<void> {\n        const { downloadHtmlAsDocx, downloadMarkdownAsDocx } = await import(\"../../../core/document/DocxExport\");\n        const filename = `${(title || 'document').replace(/[\\\\/:*?\"<>|\\u0000-\\u001F]+/g, '-').slice(0, 180)}.docx`;\n        const looksLikeHtml = content.trim().startsWith('<');\n\n        if (looksLikeHtml) {\n            await downloadHtmlAsDocx(content, { title, filename });\n        } else {\n            await downloadMarkdownAsDocx(content, { title, filename });\n        }\n\n        // Close window if requested\n        const urlParams = new URLSearchParams(globalThis?.location?.search);\n        if (urlParams.get('close') === 'true') {\n            try {\n                globalThis?.close?.();\n            } catch {\n                // ignore\n            }\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.element || document.createElement('div');\n    }\n\n    getToolbar?(): HTMLElement | null {\n        return null; // Print view has no toolbar\n    }\n\n    lifecycle? = {\n        onMount: (): void => {\n            console.log('[PrintView] Mounted');\n        },\n\n        onUnmount: (): void => {\n            console.log('[PrintView] Unmounted');\n            this.element = null;\n            this.mdView = null;\n        },\n\n        onShow: (): void => {\n            console.log('[PrintView] Shown');\n        },\n\n        onHide: (): void => {\n            console.log('[PrintView] Hidden');\n        }\n    };\n}\n\n// ============================================================================\n// VIEW FACTORY\n// ============================================================================\n\nexport function createView(options?: PrintViewOptions): PrintView {\n    return new PrintView(options);\n}\n\n/** Alias for createView */\nexport const createPrintView = createView;\n\nexport default createView;\n"],"file":"index13.js"}