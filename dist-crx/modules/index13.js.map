{"version":3,"file":"index13.js","sources":["../../src/frontend/views/editor/index.ts"],"sourcesContent":["/**\n * Editor View\n *\n * Shell-agnostic markdown editor component.\n */\n\nimport { H } from \"fest/lure\";\nimport { ref, affected } from \"fest/object\";\nimport { loadAsAdopted, removeAdopted } from \"fest/dom\";\nimport type { View, ViewOptions, ViewLifecycle, ShellContext } from \"../../shells/types\";\nimport type { BaseViewOptions } from \"../types\";\nimport { createViewState } from \"../types\";\n\n// @ts-ignore\nimport style from \"./editor.scss?inline\";\n\n// ============================================================================\n// EDITOR STATE\n// ============================================================================\n\ninterface EditorState {\n    content: string;\n    filename?: string;\n}\n\nconst STORAGE_KEY = \"rs-editor-state\";\nconst DEFAULT_CONTENT = \"# New Document\\n\\nStart writing here...\";\n\n// ============================================================================\n// EDITOR VIEW\n// ============================================================================\n\nexport interface EditorOptions extends BaseViewOptions {\n    initialContent?: string;\n    filename?: string;\n    onSave?: (content: string) => void;\n    onContentChange?: (content: string) => void;\n}\n\nexport class EditorView implements View {\n    id = \"editor\" as const;\n    name = \"Editor\";\n    icon = \"pencil\";\n\n    private options: EditorOptions;\n    private shellContext?: ShellContext;\n    private element: HTMLElement | null = null;\n    private contentRef = ref(\"\");\n    private stateManager = createViewState<EditorState>(STORAGE_KEY);\n    private textarea: HTMLTextAreaElement | null = null;\n\n    private _sheet: CSSStyleSheet | null = null;\n\n    lifecycle: ViewLifecycle = {\n        onMount: () => this.onMount(),\n        onUnmount: () => this.saveState(),\n        onShow: () => { this._sheet = loadAsAdopted(style) as CSSStyleSheet; },\n        onHide: () => { removeAdopted(this._sheet); this.saveState(); },\n    };\n\n    constructor(options: EditorOptions = {}) {\n        this.options = options;\n        this.shellContext = options.shellContext;\n\n        const saved = this.stateManager.load();\n        this.contentRef.value = options.initialContent || saved?.content || DEFAULT_CONTENT;\n    }\n\n    render(options?: ViewOptions): HTMLElement {\n        if (options) {\n            this.options = { ...this.options, ...options };\n            this.shellContext = options.shellContext || this.shellContext;\n        }\n\n        this._sheet = loadAsAdopted(style) as CSSStyleSheet;\n\n        this.element = H`\n            <div class=\"view-editor\">\n                <div class=\"view-editor__toolbar\">\n                    <div class=\"view-editor__toolbar-left\">\n                        <button class=\"view-editor__btn\" data-action=\"open\" type=\"button\" title=\"Open file\">\n                            <ui-icon icon=\"folder-open\" icon-style=\"duotone\"></ui-icon>\n                            <span>Open</span>\n                        </button>\n                        <button class=\"view-editor__btn\" data-action=\"save\" type=\"button\" title=\"Save file\">\n                            <ui-icon icon=\"floppy-disk\" icon-style=\"duotone\"></ui-icon>\n                            <span>Save</span>\n                        </button>\n                    </div>\n                    <div class=\"view-editor__toolbar-right\">\n                        <button class=\"view-editor__btn\" data-action=\"preview\" type=\"button\" title=\"Preview\">\n                            <ui-icon icon=\"eye\" icon-style=\"duotone\"></ui-icon>\n                            <span>Preview</span>\n                        </button>\n                        <button class=\"view-editor__btn\" data-action=\"copy\" type=\"button\" title=\"Copy all\">\n                            <ui-icon icon=\"copy\" icon-style=\"duotone\"></ui-icon>\n                            <span>Copy</span>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"view-editor__content\">\n                    <textarea\n                        class=\"view-editor__textarea\"\n                        placeholder=\"Start writing markdown...\"\n                        data-editor-input\n                    >${this.contentRef.value}</textarea>\n                </div>\n            </div>\n        ` as HTMLElement;\n\n        this.textarea = this.element.querySelector(\"[data-editor-input]\") as HTMLTextAreaElement;\n        this.setupEventHandlers();\n\n        return this.element;\n    }\n\n    getToolbar(): HTMLElement | null {\n        return null;\n    }\n\n    // ========================================================================\n    // PUBLIC API\n    // ========================================================================\n\n    setContent(content: string): void {\n        this.contentRef.value = content;\n        if (this.textarea) {\n            this.textarea.value = content;\n        }\n    }\n\n    getContent(): string {\n        return this.contentRef.value;\n    }\n\n    // ========================================================================\n    // PRIVATE METHODS\n    // ========================================================================\n\n    private setupEventHandlers(): void {\n        if (!this.element) return;\n\n        // Text input\n        this.textarea?.addEventListener(\"input\", () => {\n            this.contentRef.value = this.textarea?.value || \"\";\n            this.options.onContentChange?.(this.contentRef.value);\n        });\n\n        // Toolbar actions\n        this.element.addEventListener(\"click\", async (e) => {\n            const target = e.target as HTMLElement;\n            const button = target.closest(\"[data-action]\") as HTMLButtonElement | null;\n            if (!button) return;\n\n            const action = button.dataset.action;\n            switch (action) {\n                case \"open\":\n                    this.handleOpen();\n                    break;\n                case \"save\":\n                    this.handleSave();\n                    break;\n                case \"preview\":\n                    this.handlePreview();\n                    break;\n                case \"copy\":\n                    await this.handleCopy();\n                    break;\n            }\n        });\n\n        // Keyboard shortcuts\n        this.textarea?.addEventListener(\"keydown\", (e) => {\n            if (e.ctrlKey || e.metaKey) {\n                if (e.key === \"s\") {\n                    e.preventDefault();\n                    this.handleSave();\n                }\n            }\n        });\n    }\n\n    private handleOpen(): void {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.accept = \".md,.markdown,.txt,text/markdown,text/plain\";\n        input.onchange = async () => {\n            const file = input.files?.[0];\n            if (file) {\n                try {\n                    const content = await file.text();\n                    this.setContent(content);\n                    this.options.filename = file.name;\n                    this.showMessage(`Opened ${file.name}`);\n                } catch {\n                    this.showMessage(\"Failed to open file\");\n                }\n            }\n        };\n        input.click();\n    }\n\n    private handleSave(): void {\n        const content = this.contentRef.value;\n        const filename = this.options.filename || \"document.md\";\n\n        const blob = new Blob([content], { type: \"text/markdown;charset=utf-8\" });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = filename;\n        a.click();\n        setTimeout(() => URL.revokeObjectURL(url), 250);\n\n        this.options.onSave?.(content);\n        this.showMessage(`Saved ${filename}`);\n    }\n\n    private handlePreview(): void {\n        this.shellContext?.navigate(\"viewer\");\n    }\n\n    private async handleCopy(): Promise<void> {\n        try {\n            await navigator.clipboard.writeText(this.contentRef.value);\n            this.showMessage(\"Copied to clipboard\");\n        } catch {\n            this.showMessage(\"Failed to copy\");\n        }\n    }\n\n    private saveState(): void {\n        this.stateManager.save({\n            content: this.contentRef.value,\n            filename: this.options.filename\n        });\n    }\n\n    private onMount(): void {\n        console.log(\"[Editor] Mounted\");\n    }\n\n    private showMessage(message: string): void {\n        this.shellContext?.showMessage(message);\n    }\n\n    canHandleMessage(messageType: string): boolean {\n        return [\"content-edit\", \"content-load\"].includes(messageType);\n    }\n\n    async handleMessage(message: unknown): Promise<void> {\n        const msg = message as { data?: { text?: string; content?: string } };\n        if (msg.data?.text || msg.data?.content) {\n            this.setContent(msg.data.text || msg.data.content || \"\");\n        }\n    }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport function createView(options?: EditorOptions): EditorView {\n    return new EditorView(options);\n}\n\n/** Alias for createView */\nexport const createEditorView = createView;\n\nexport default createView;\n"],"names":[],"mappings":"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"}