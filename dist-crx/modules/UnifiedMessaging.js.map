{"version":3,"file":"UnifiedMessaging.js","sources":["../../../../modules/projects/uniform.ts/src/newer/messaging/MessageQueue.ts","../../../../modules/projects/uniform.ts/src/newer/messaging/UnifiedMessaging.ts","../../src/com/config/Names.ts","../../src/com/core/UnifiedAIConfig.ts","../../src/com/core/UnifiedMessaging.ts"],"sourcesContent":["/**\n * Generic Message Queue Utility\n * Provides persistent queuing for cross-context communications using IndexedDB\n * Part of fest/uniform - no app-specific dependencies\n */\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\nexport interface QueuedMessage<T = unknown> {\n    id: string;\n    type: string;\n    data: T;\n    timestamp: number;\n    priority: MessagePriority;\n    retryCount: number;\n    maxRetries: number;\n    expiresAt?: number;\n    destination?: string;\n    metadata?: Record<string, unknown>;\n}\n\nexport type MessagePriority = 'low' | 'normal' | 'high';\n\nexport interface MessageQueueOptions {\n    dbName?: string;\n    storeName?: string;\n    maxRetries?: number;\n    defaultExpirationMs?: number;\n    fallbackStorageKey?: string;\n}\n\nexport interface QueueMessageOptions {\n    priority?: MessagePriority;\n    maxRetries?: number;\n    expiresAt?: number;\n    destination?: string;\n    metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// MESSAGE QUEUE CLASS\n// ============================================================================\n\nexport class MessageQueue {\n    private db: IDBDatabase | null = null;\n    private dbPromise: Promise<IDBDatabase> | null = null;\n    private options: Required<MessageQueueOptions>;\n\n    constructor(options: MessageQueueOptions = {}) {\n        this.options = {\n            dbName: options.dbName ?? 'UniformMessageQueue',\n            storeName: options.storeName ?? 'messages',\n            maxRetries: options.maxRetries ?? 3,\n            defaultExpirationMs: options.defaultExpirationMs ?? 24 * 60 * 60 * 1000, // 24 hours\n            fallbackStorageKey: options.fallbackStorageKey ?? 'uniform_message_queue'\n        };\n    }\n\n    // ========================================================================\n    // DATABASE INITIALIZATION\n    // ========================================================================\n\n    /**\n     * Initialize IndexedDB database\n     */\n    private async initDB(): Promise<IDBDatabase | null> {\n        if (this.db) return this.db;\n        if (this.dbPromise) return this.dbPromise;\n\n        // Check if IndexedDB is available\n        if (!MessageQueue.isIndexedDBAvailable()) {\n            console.warn('[MessageQueue] IndexedDB not available, using sessionStorage fallback');\n            return null;\n        }\n\n        this.dbPromise = new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.options.dbName, 1);\n\n            request.onerror = () => {\n                console.warn('[MessageQueue] IndexedDB open failed, falling back to sessionStorage');\n                reject(new Error('IndexedDB not available'));\n            };\n\n            request.onsuccess = () => {\n                this.db = request.result;\n                resolve(this.db);\n            };\n\n            request.onupgradeneeded = (event) => {\n                const db = (event.target as IDBOpenDBRequest).result;\n                if (!db.objectStoreNames.contains(this.options.storeName)) {\n                    const store = db.createObjectStore(this.options.storeName, { keyPath: 'id' });\n                    store.createIndex('timestamp', 'timestamp', { unique: false });\n                    store.createIndex('type', 'type', { unique: false });\n                    store.createIndex('priority', 'priority', { unique: false });\n                    store.createIndex('destination', 'destination', { unique: false });\n                }\n            };\n        });\n\n        try {\n            this.db = await this.dbPromise;\n            return this.db;\n        } catch {\n            // Fallback to sessionStorage if IndexedDB fails\n            return null;\n        }\n    }\n\n    // ========================================================================\n    // QUEUE OPERATIONS\n    // ========================================================================\n\n    /**\n     * Generate unique message ID\n     */\n    private generateId(): string {\n        return `msg_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n    }\n\n    /**\n     * Queue a message for later processing\n     */\n    async queueMessage<T>(\n        type: string,\n        data: T,\n        options: QueueMessageOptions = {}\n    ): Promise<string> {\n        const message: QueuedMessage<T> = {\n            id: this.generateId(),\n            type,\n            data,\n            timestamp: Date.now(),\n            priority: options.priority ?? 'normal',\n            retryCount: 0,\n            maxRetries: options.maxRetries ?? this.options.maxRetries,\n            expiresAt: options.expiresAt ?? (Date.now() + this.options.defaultExpirationMs),\n            destination: options.destination,\n            metadata: options.metadata\n        };\n\n        try {\n            const db = await this.initDB();\n            if (db) {\n                await this.addToIndexedDB(db, message);\n            } else {\n                this.addToSessionStorage(message);\n            }\n\n            console.log(`[MessageQueue] Queued message: ${type}`, message.id);\n            return message.id;\n        } catch (error) {\n            console.error('[MessageQueue] Failed to queue message:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Get all queued messages\n     */\n    async getQueuedMessages<T = unknown>(destination?: string): Promise<QueuedMessage<T>[]> {\n        try {\n            const db = await this.initDB();\n            let messages: QueuedMessage<T>[];\n            \n            if (db) {\n                messages = await this.getAllFromIndexedDB<T>(db);\n            } else {\n                messages = this.getAllFromSessionStorage<T>();\n            }\n\n            // Filter by destination if specified\n            if (destination) {\n                messages = messages.filter(msg => msg.destination === destination);\n            }\n\n            // Filter out expired messages\n            const now = Date.now();\n            return messages.filter(msg => !msg.expiresAt || msg.expiresAt > now);\n        } catch (error) {\n            console.error('[MessageQueue] Failed to get queued messages:', error);\n            return this.getAllFromSessionStorage<T>();\n        }\n    }\n\n    /**\n     * Remove a message from the queue\n     */\n    async removeMessage(messageId: string): Promise<void> {\n        try {\n            const db = await this.initDB();\n            if (db) {\n                await this.deleteFromIndexedDB(db, messageId);\n            } else {\n                this.deleteFromSessionStorage(messageId);\n            }\n        } catch (error) {\n            console.error('[MessageQueue] Failed to remove message:', error);\n        }\n    }\n\n    /**\n     * Update message retry count\n     */\n    async updateMessageRetry(messageId: string, retryCount: number): Promise<void> {\n        try {\n            const db = await this.initDB();\n            if (db) {\n                await this.updateInIndexedDB(db, messageId, { retryCount });\n            } else {\n                this.updateInSessionStorage(messageId, { retryCount });\n            }\n        } catch (error) {\n            console.error('[MessageQueue] Failed to update message retry:', error);\n        }\n    }\n\n    /**\n     * Clear all expired messages\n     */\n    async clearExpiredMessages(): Promise<number> {\n        try {\n            const messages = await this.getQueuedMessages();\n            const now = Date.now();\n            const expiredIds = messages\n                .filter(msg => msg.expiresAt && msg.expiresAt <= now)\n                .map(msg => msg.id);\n\n            for (const id of expiredIds) {\n                await this.removeMessage(id);\n            }\n\n            if (expiredIds.length > 0) {\n                console.log(`[MessageQueue] Cleared ${expiredIds.length} expired messages`);\n            }\n            \n            return expiredIds.length;\n        } catch (error) {\n            console.error('[MessageQueue] Failed to clear expired messages:', error);\n            return 0;\n        }\n    }\n\n    /**\n     * Clear all messages\n     */\n    async clearAll(): Promise<void> {\n        try {\n            const db = await this.initDB();\n            if (db) {\n                await this.clearIndexedDB(db);\n            } else {\n                sessionStorage.removeItem(this.options.fallbackStorageKey);\n            }\n            console.log('[MessageQueue] Cleared all messages');\n        } catch (error) {\n            console.error('[MessageQueue] Failed to clear all messages:', error);\n        }\n    }\n\n    /**\n     * Get queue statistics\n     */\n    async getStats(): Promise<{\n        total: number;\n        byPriority: Record<MessagePriority, number>;\n        byDestination: Record<string, number>;\n        expired: number;\n    }> {\n        const messages = await this.getQueuedMessages();\n        const now = Date.now();\n        \n        const byPriority: Record<MessagePriority, number> = { low: 0, normal: 0, high: 0 };\n        const byDestination: Record<string, number> = {};\n        let expired = 0;\n\n        for (const msg of messages) {\n            byPriority[msg.priority]++;\n            if (msg.destination) {\n                byDestination[msg.destination] = (byDestination[msg.destination] || 0) + 1;\n            }\n            if (msg.expiresAt && msg.expiresAt <= now) {\n                expired++;\n            }\n        }\n\n        return {\n            total: messages.length,\n            byPriority,\n            byDestination,\n            expired\n        };\n    }\n\n    // ========================================================================\n    // INDEXEDDB OPERATIONS\n    // ========================================================================\n\n    private async addToIndexedDB<T>(db: IDBDatabase, message: QueuedMessage<T>): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([this.options.storeName], 'readwrite');\n            const store = transaction.objectStore(this.options.storeName);\n            const request = store.add(message);\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    private async getAllFromIndexedDB<T>(db: IDBDatabase): Promise<QueuedMessage<T>[]> {\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([this.options.storeName], 'readonly');\n            const store = transaction.objectStore(this.options.storeName);\n            const request = store.getAll();\n            request.onsuccess = () => resolve(request.result as QueuedMessage<T>[]);\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    private async deleteFromIndexedDB(db: IDBDatabase, id: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([this.options.storeName], 'readwrite');\n            const store = transaction.objectStore(this.options.storeName);\n            const request = store.delete(id);\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    private async updateInIndexedDB(\n        db: IDBDatabase, \n        id: string, \n        updates: Partial<QueuedMessage>\n    ): Promise<void> {\n        const transaction = db.transaction([this.options.storeName], 'readwrite');\n        const store = transaction.objectStore(this.options.storeName);\n        \n        const message = await new Promise<QueuedMessage | undefined>((resolve, reject) => {\n            const request = store.get(id);\n            request.onsuccess = () => resolve(request.result);\n            request.onerror = () => reject(request.error);\n        });\n\n        if (message) {\n            Object.assign(message, updates);\n            await new Promise<void>((resolve, reject) => {\n                const request = store.put(message);\n                request.onsuccess = () => resolve();\n                request.onerror = () => reject(request.error);\n            });\n        }\n    }\n\n    private async clearIndexedDB(db: IDBDatabase): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([this.options.storeName], 'readwrite');\n            const store = transaction.objectStore(this.options.storeName);\n            const request = store.clear();\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    // ========================================================================\n    // SESSION STORAGE FALLBACK\n    // ========================================================================\n\n    private getAllFromSessionStorage<T>(): QueuedMessage<T>[] {\n        try {\n            const stored = sessionStorage.getItem(this.options.fallbackStorageKey);\n            return stored ? JSON.parse(stored) : [];\n        } catch {\n            return [];\n        }\n    }\n\n    private addToSessionStorage<T>(message: QueuedMessage<T>): void {\n        const existing = this.getAllFromSessionStorage();\n        existing.push(message);\n        sessionStorage.setItem(this.options.fallbackStorageKey, JSON.stringify(existing));\n    }\n\n    private deleteFromSessionStorage(id: string): void {\n        const existing = this.getAllFromSessionStorage();\n        const filtered = existing.filter(msg => msg.id !== id);\n        sessionStorage.setItem(this.options.fallbackStorageKey, JSON.stringify(filtered));\n    }\n\n    private updateInSessionStorage(id: string, updates: Partial<QueuedMessage>): void {\n        const existing = this.getAllFromSessionStorage();\n        const message = existing.find(msg => msg.id === id);\n        if (message) {\n            Object.assign(message, updates);\n            sessionStorage.setItem(this.options.fallbackStorageKey, JSON.stringify(existing));\n        }\n    }\n\n    // ========================================================================\n    // STATIC UTILITIES\n    // ========================================================================\n\n    /**\n     * Check if IndexedDB is available\n     */\n    static isIndexedDBAvailable(): boolean {\n        try {\n            return typeof indexedDB !== 'undefined' &&\n                   typeof IDBTransaction !== 'undefined' &&\n                   typeof IDBKeyRange !== 'undefined';\n        } catch {\n            return false;\n        }\n    }\n}\n\n// ============================================================================\n// SINGLETON FACTORY\n// ============================================================================\n\nconst instances = new Map<string, MessageQueue>();\n\n/**\n * Get or create a MessageQueue instance\n */\nexport function getMessageQueue(options?: MessageQueueOptions): MessageQueue {\n    const key = options?.dbName ?? 'default';\n    if (!instances.has(key)) {\n        instances.set(key, new MessageQueue(options));\n    }\n    return instances.get(key)!;\n}\n\n/**\n * Create a new MessageQueue instance (not cached)\n */\nexport function createMessageQueue(options?: MessageQueueOptions): MessageQueue {\n    return new MessageQueue(options);\n}\n","/**\n * Unified Messaging System\n * Consolidates all messaging, broadcasting, queuing, and pipeline functionality\n * Part of fest/uniform - configurable without app-specific dependencies\n */\n\nimport {\n    OptimizedWorkerChannel,\n} from '../next/storage/Queued';\nimport { detectExecutionContext, supportsDedicatedWorkers } from '../next/utils/Env';\nimport { createQueuedOptimizedWorkerChannel } from '../next/utils/Utils';\n\nimport {\n    MessageQueue,\n    getMessageQueue,\n    type QueuedMessage,\n    type MessagePriority\n} from './MessageQueue';\n\n// ============================================================================\n// TYPES AND INTERFACES\n// ============================================================================\n\nexport interface UnifiedMessage<T = unknown> {\n    id: string;\n    type: string;\n    source: string;\n    destination?: string;\n    contentType?: string;\n    data: T;\n    metadata?: MessageMetadata;\n}\n\nexport interface MessageMetadata {\n    timestamp?: number;\n    correlationId?: string;\n    priority?: MessagePriority;\n    expiresAt?: number;\n    retryCount?: number;\n    maxRetries?: number;\n    [key: string]: unknown;\n}\n\nexport interface MessageHandler<T = unknown> {\n    canHandle: (message: UnifiedMessage<T>) => boolean;\n    handle: (message: UnifiedMessage<T>) => Promise<void> | void;\n}\n\nexport interface WorkerChannelConfig {\n    name: string;\n    script: string | (() => Worker) | Worker;\n    options?: WorkerOptions;\n    protocolOptions?: {\n        timeout?: number;\n        retries?: number;\n        batching?: boolean;\n        compression?: boolean;\n    };\n}\n\nexport interface PipelineConfig {\n    name: string;\n    stages: PipelineStage[];\n    errorHandler?: (error: unknown, stage: PipelineStage, message: UnifiedMessage) => void;\n    timeout?: number;\n}\n\nexport interface PipelineStage {\n    name: string;\n    handler: (message: UnifiedMessage) => Promise<UnifiedMessage> | UnifiedMessage;\n    timeout?: number;\n    retries?: number;\n}\n\nexport interface ChannelMapping {\n    destination: string;\n    channel: string;\n}\n\nexport interface UnifiedMessagingConfig {\n    /** Custom channel mappings (destination -> channel name) */\n    channelMappings?: Record<string, string>;\n    /** Message queue options */\n    queueOptions?: {\n        dbName?: string;\n        storeName?: string;\n        maxRetries?: number;\n        defaultExpirationMs?: number;\n    };\n    /** Pending message store options */\n    pendingStoreOptions?: {\n        storageKey?: string;\n        maxMessages?: number;\n        defaultTTLMs?: number;\n    };\n}\n\n// ============================================================================\n// PENDING MESSAGE STORE (SYNC CATCH-UP)\n// ============================================================================\n\ninterface PendingStoreEntry {\n    destination: string;\n    message: UnifiedMessage;\n    storedAt: number;\n}\n\nexport class PendingMessageStore {\n    private readonly storageKey: string;\n    private readonly maxMessages: number;\n    private readonly defaultTTLMs: number;\n\n    constructor(options?: { storageKey?: string; maxMessages?: number; defaultTTLMs?: number }) {\n        this.storageKey = options?.storageKey ?? 'uniform-messaging-pending';\n        this.maxMessages = options?.maxMessages ?? 200;\n        this.defaultTTLMs = options?.defaultTTLMs ?? 24 * 60 * 60 * 1000; // 24h\n    }\n\n    private read(): PendingStoreEntry[] {\n        if (typeof window === 'undefined' || typeof localStorage === 'undefined') return [];\n        try {\n            const raw = localStorage.getItem(this.storageKey);\n            if (!raw) return [];\n            const parsed = JSON.parse(raw);\n            return Array.isArray(parsed) ? parsed : [];\n        } catch {\n            return [];\n        }\n    }\n\n    private write(entries: PendingStoreEntry[]): void {\n        if (typeof window === 'undefined' || typeof localStorage === 'undefined') return;\n        try {\n            localStorage.setItem(this.storageKey, JSON.stringify(entries));\n        } catch {\n            // Storage might be full or unavailable\n        }\n    }\n\n    enqueue(destination: string, message: UnifiedMessage): void {\n        if (!destination) return;\n        const now = Date.now();\n        const ttl = Number(message?.metadata?.expiresAt)\n            ? Math.max(0, Number(message.metadata!.expiresAt) - now)\n            : this.defaultTTLMs;\n\n        // Skip immediately-expired\n        if (ttl <= 0) return;\n\n        const entries = this.read()\n            .filter(e => e && typeof e === 'object')\n            .filter(e => {\n                const expiresAt = Number(e?.message?.metadata?.expiresAt) ||\n                    (Number(e?.storedAt) + this.defaultTTLMs);\n                return expiresAt > now;\n            });\n\n        entries.push({ destination, message, storedAt: now });\n        if (entries.length > this.maxMessages) {\n            entries.splice(0, entries.length - this.maxMessages);\n        }\n        this.write(entries);\n    }\n\n    drain(destination: string): UnifiedMessage[] {\n        if (!destination) return [];\n        const now = Date.now();\n        const entries = this.read();\n\n        const keep: PendingStoreEntry[] = [];\n        const out: UnifiedMessage[] = [];\n\n        for (const e of entries) {\n            const expiresAt = Number(e?.message?.metadata?.expiresAt) ||\n                (Number(e?.storedAt) + this.defaultTTLMs);\n            if (expiresAt <= now) continue;\n            if (e?.destination === destination && e?.message) {\n                out.push(e.message);\n            } else {\n                keep.push(e);\n            }\n        }\n\n        this.write(keep);\n        return out;\n    }\n\n    has(destination: string): boolean {\n        if (!destination) return false;\n        const now = Date.now();\n        return this.read().some((e) => {\n            if (!e || typeof e !== 'object') return false;\n            const expiresAt = Number(e?.message?.metadata?.expiresAt) ||\n                (Number(e?.storedAt) + this.defaultTTLMs);\n            return expiresAt > now && e?.destination === destination;\n        });\n    }\n\n    clear(): void {\n        this.write([]);\n    }\n}\n\n// ============================================================================\n// UNIFIED MESSAGING MANAGER\n// ============================================================================\n\nexport class UnifiedMessagingManager {\n    private handlers = new Map<string, MessageHandler[]>();\n    private channels = new Map<string, BroadcastChannel | OptimizedWorkerChannel>();\n    private workerChannels = new Map<string, OptimizedWorkerChannel>();\n    private viewChannels = new Map<string, Set<string>>();\n    private pipelines = new Map<string, PipelineConfig>();\n    private messageQueue: MessageQueue;\n    private pendingStore: PendingMessageStore;\n    private initializedViews = new Set<string>();\n    private viewReadyPromises = new Map<string, { resolve: () => void; reject: (e: unknown) => void; promise: Promise<void> }>();\n    private executionContext: ReturnType<typeof detectExecutionContext>;\n    private channelMappings: Record<string, string>;\n    private componentRegistry = new Map<string, string>();\n\n    constructor(config: UnifiedMessagingConfig = {}) {\n        this.executionContext = detectExecutionContext();\n        this.channelMappings = config.channelMappings ?? {};\n        this.messageQueue = getMessageQueue(config.queueOptions);\n        this.pendingStore = new PendingMessageStore(config.pendingStoreOptions);\n        this.setupGlobalListeners();\n    }\n\n    // ========================================================================\n    // MESSAGE HANDLING\n    // ========================================================================\n\n    /**\n     * Register a message handler for a specific destination\n     */\n    registerHandler(destination: string, handler: MessageHandler): void {\n        if (!this.handlers.has(destination)) {\n            this.handlers.set(destination, []);\n        }\n        this.handlers.get(destination)!.push(handler);\n    }\n\n    /**\n     * Unregister a message handler\n     */\n    unregisterHandler(destination: string, handler: MessageHandler): void {\n        const handlers = this.handlers.get(destination);\n        if (handlers) {\n            const index = handlers.indexOf(handler);\n            if (index > -1) {\n                handlers.splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * Send a message to a destination\n     */\n    async sendMessage(message: Partial<UnifiedMessage> & { type: string; data: unknown }): Promise<boolean> {\n        // Ensure message has required fields\n        const fullMessage: UnifiedMessage = {\n            id: message.id ?? crypto.randomUUID(),\n            type: message.type,\n            source: message.source ?? 'unified-messaging',\n            destination: message.destination,\n            contentType: message.contentType,\n            data: message.data,\n            metadata: { timestamp: Date.now(), ...message.metadata }\n        };\n\n        // Try to deliver immediately\n        if (await this.tryDeliverMessage(fullMessage)) {\n            return true;\n        }\n\n        // Queue for later delivery if destination not available\n        if (fullMessage.destination) {\n            // Store in sync pending store for view/component catch-up\n            this.pendingStore.enqueue(fullMessage.destination, fullMessage);\n\n            await this.messageQueue.queueMessage(fullMessage.type, fullMessage, {\n                priority: fullMessage.metadata?.priority ?? 'normal',\n                maxRetries: fullMessage.metadata?.maxRetries ?? 3,\n                destination: fullMessage.destination\n            });\n        }\n\n        return false;\n    }\n\n    /**\n     * Process a message through registered handlers\n     */\n    async processMessage(message: UnifiedMessage): Promise<void> {\n        const destination = message.destination ?? 'general';\n        const handlers = this.handlers.get(destination) ?? [];\n\n        for (const handler of handlers) {\n            if (handler.canHandle(message)) {\n                try {\n                    await handler.handle(message);\n                } catch (error) {\n                    console.error(`[UnifiedMessaging] Handler error for ${destination}:`, error);\n                }\n            }\n        }\n    }\n\n    /**\n     * Try to deliver message immediately\n     */\n    private async tryDeliverMessage(message: UnifiedMessage): Promise<boolean> {\n        // Check if destination has handlers\n        if (message.destination && this.handlers.has(message.destination)) {\n            await this.processMessage(message);\n            return true;\n        }\n\n        // Check if we have a broadcast channel for the destination\n        const channelName = this.getChannelForDestination(message.destination);\n        if (channelName && this.channels.has(channelName)) {\n            const channel = this.channels.get(channelName);\n            if (channel instanceof BroadcastChannel) {\n                try {\n                    channel.postMessage(message);\n                    return true;\n                } catch (error) {\n                    console.warn(`[UnifiedMessaging] Failed to post to broadcast channel ${channelName}:`, error);\n                }\n            } else if (channel && 'request' in channel) {\n                try {\n                    await (channel as OptimizedWorkerChannel).request(message.type, [message]);\n                    return true;\n                } catch (error) {\n                    console.warn(`[UnifiedMessaging] Failed to post to worker channel ${channelName}:`, error);\n                }\n            }\n        }\n\n        return false;\n    }\n\n    // ========================================================================\n    // WORKER CHANNEL MANAGEMENT\n    // ========================================================================\n\n    /**\n     * Register worker channels for a specific view\n     */\n    registerViewChannels(viewHash: string, configs: WorkerChannelConfig[]): void {\n        const channelNames = new Set<string>();\n\n        for (const config of configs) {\n            if (!this.isWorkerSupported(config)) {\n                console.log(`[UnifiedMessaging] Skipping worker '${config.name}' in ${this.executionContext} context`);\n                continue;\n            }\n\n            const channel = createQueuedOptimizedWorkerChannel({\n                name: config.name,\n                script: config.script,\n                options: config.options,\n                context: this.executionContext\n            }, config.protocolOptions, () => {\n                console.log(`[UnifiedMessaging] Channel '${config.name}' ready for view '${viewHash}'`);\n            });\n\n            const channelKey = `${viewHash}:${config.name}`;\n            this.workerChannels.set(channelKey, channel);\n            this.channels.set(channelKey, channel);\n            channelNames.add(config.name);\n        }\n\n        this.viewChannels.set(viewHash, channelNames);\n    }\n\n    /**\n     * Initialize channels when a view becomes active\n     */\n    async initializeViewChannels(viewHash: string): Promise<void> {\n        if (this.initializedViews.has(viewHash)) return;\n\n        const deferred = this.createDeferred<void>();\n        this.viewReadyPromises.set(viewHash, deferred);\n\n        console.log(`[UnifiedMessaging] Initializing channels for view: ${viewHash}`);\n\n        const channelNames = this.viewChannels.get(viewHash);\n        if (!channelNames) {\n            deferred.resolve();\n            return;\n        }\n\n        const initPromises: Promise<void>[] = [];\n        for (const channelName of channelNames) {\n            const channelKey = `${viewHash}:${channelName}`;\n            const channel = this.workerChannels.get(channelKey);\n\n            if (channel) {\n                initPromises.push(\n                    channel.request('ping', {}).catch(() => {\n                        console.log(`[UnifiedMessaging] Channel '${channelName}' queued for view '${viewHash}'`);\n                    })\n                );\n            }\n        }\n\n        await Promise.allSettled(initPromises);\n        this.initializedViews.add(viewHash);\n        deferred.resolve();\n    }\n\n    /**\n     * Get a worker channel for a specific view and worker\n     */\n    getWorkerChannel(viewHash: string, workerName: string): OptimizedWorkerChannel | null {\n        return this.workerChannels.get(`${viewHash}:${workerName}`) ?? null;\n    }\n\n    // ========================================================================\n    // BROADCAST CHANNEL MANAGEMENT\n    // ========================================================================\n\n    /**\n     * Create or get a broadcast channel\n     */\n    getBroadcastChannel(channelName: string): BroadcastChannel {\n        if (!this.channels.has(channelName)) {\n            try {\n                const channel = new BroadcastChannel(channelName);\n                channel.addEventListener('message', (event) => {\n                    this.handleBroadcastMessage(event.data, channelName);\n                });\n                this.channels.set(channelName, channel);\n            } catch (error) {\n                console.warn(`[UnifiedMessaging] BroadcastChannel not available: ${channelName}`, error);\n                // Return a mock channel that does nothing\n                const mockChannel = {\n                    postMessage: () => {},\n                    close: () => {},\n                    addEventListener: () => {},\n                    removeEventListener: () => {}\n                } as unknown as BroadcastChannel;\n                this.channels.set(channelName, mockChannel);\n            }\n        }\n        return this.channels.get(channelName) as BroadcastChannel;\n    }\n\n    /**\n     * Handle incoming broadcast messages\n     */\n    private async handleBroadcastMessage(message: unknown, channelName: string): Promise<void> {\n        try {\n            const msgObj = message as Record<string, unknown>;\n            const unifiedMessage: UnifiedMessage = msgObj?.id ? (message as UnifiedMessage) : {\n                id: crypto.randomUUID(),\n                type: String(msgObj?.type ?? 'unknown'),\n                source: channelName,\n                data: message,\n                metadata: { timestamp: Date.now() }\n            };\n\n            await this.processMessage(unifiedMessage);\n        } catch (error) {\n            console.error(`[UnifiedMessaging] Error handling broadcast message on ${channelName}:`, error);\n        }\n    }\n\n    // ========================================================================\n    // PIPELINE MANAGEMENT\n    // ========================================================================\n\n    /**\n     * Register a message processing pipeline\n     */\n    registerPipeline(config: PipelineConfig): void {\n        this.pipelines.set(config.name, config);\n    }\n\n    /**\n     * Process a message through a pipeline\n     */\n    async processThroughPipeline(pipelineName: string, message: UnifiedMessage): Promise<UnifiedMessage> {\n        const pipeline = this.pipelines.get(pipelineName);\n        if (!pipeline) {\n            throw new Error(`Pipeline '${pipelineName}' not found`);\n        }\n\n        let currentMessage = { ...message };\n        const timeout = pipeline.timeout ?? 30000;\n\n        for (const stage of pipeline.stages) {\n            const stageTimeout = stage.timeout ?? timeout;\n            const retries = stage.retries ?? 0;\n\n            for (let attempt = 0; attempt <= retries; attempt++) {\n                try {\n                    const result = await Promise.race([\n                        stage.handler(currentMessage),\n                        new Promise<never>((_, reject) =>\n                            setTimeout(() => reject(new Error(`Stage '${stage.name}' timeout`)), stageTimeout)\n                        )\n                    ]);\n\n                    currentMessage = result;\n                    break; // Success, move to next stage\n                } catch (error) {\n                    if (attempt === retries) {\n                        if (pipeline.errorHandler) {\n                            pipeline.errorHandler(error, stage, currentMessage);\n                        }\n                        throw error;\n                    }\n                    console.warn(`[UnifiedMessaging] Pipeline '${pipelineName}' stage '${stage.name}' attempt ${attempt + 1} failed:`, error);\n                }\n            }\n        }\n\n        return currentMessage;\n    }\n\n    // ========================================================================\n    // QUEUE MANAGEMENT\n    // ========================================================================\n\n    /**\n     * Process queued messages for a destination\n     */\n    async processQueuedMessages(destination?: string): Promise<void> {\n        const queuedMessages = await this.messageQueue.getQueuedMessages(destination);\n\n        for (const queuedMessage of queuedMessages) {\n            const dataAsMessage = queuedMessage.data as Record<string, unknown>;\n            const message: UnifiedMessage = (\n                dataAsMessage &&\n                typeof dataAsMessage === 'object' &&\n                typeof dataAsMessage.type === 'string' &&\n                typeof dataAsMessage.id === 'string'\n            )\n                ? (dataAsMessage as unknown as UnifiedMessage)\n                : {\n                    id: queuedMessage.id,\n                    type: queuedMessage.type,\n                    source: 'queue',\n                    destination: queuedMessage.destination,\n                    data: queuedMessage.data,\n                    metadata: {\n                        timestamp: queuedMessage.timestamp,\n                        retryCount: queuedMessage.retryCount,\n                        maxRetries: queuedMessage.maxRetries,\n                        ...queuedMessage.metadata\n                    }\n                };\n\n            if (await this.tryDeliverMessage(message)) {\n                await this.messageQueue.removeMessage(queuedMessage.id);\n            }\n        }\n    }\n\n    // ========================================================================\n    // COMPONENT REGISTRATION\n    // ========================================================================\n\n    /**\n     * Register a component with a destination\n     */\n    registerComponent(componentId: string, destination: string): void {\n        this.componentRegistry.set(componentId, destination);\n    }\n\n    /**\n     * Initialize a component and return any pending messages\n     */\n    initializeComponent(componentId: string): UnifiedMessage[] {\n        const destination = this.componentRegistry.get(componentId);\n        if (!destination) return [];\n        return this.pendingStore.drain(destination);\n    }\n\n    /**\n     * Check if there are pending messages for a destination\n     */\n    hasPendingMessages(destination: string): boolean {\n        return this.pendingStore.has(destination);\n    }\n\n    /**\n     * Explicitly enqueue a pending message\n     */\n    enqueuePendingMessage(destination: string, message: UnifiedMessage): void {\n        const dest = String(destination ?? '').trim();\n        if (!dest || !message) return;\n        this.pendingStore.enqueue(dest, message);\n    }\n\n    // ========================================================================\n    // CHANNEL MAPPING\n    // ========================================================================\n\n    /**\n     * Set channel mappings\n     */\n    setChannelMappings(mappings: Record<string, string>): void {\n        this.channelMappings = { ...this.channelMappings, ...mappings };\n    }\n\n    /**\n     * Get channel name for a destination\n     */\n    private getChannelForDestination(destination?: string): string | null {\n        if (!destination) return null;\n        return this.channelMappings[destination] ?? null;\n    }\n\n    // ========================================================================\n    // UTILITY METHODS\n    // ========================================================================\n\n    /**\n     * Check if a worker configuration is supported\n     */\n    private isWorkerSupported(_config: WorkerChannelConfig): boolean {\n        if (this.executionContext === 'service-worker') {\n            return true;\n        }\n\n        if (this.executionContext === 'chrome-extension') {\n            return supportsDedicatedWorkers();\n        }\n\n        return true;\n    }\n\n    /**\n     * Set up global listeners for cross-component communication\n     */\n    private setupGlobalListeners(): void {\n        if (typeof window !== 'undefined') {\n            window.addEventListener('message', (event) => {\n                if (event.data && typeof event.data === 'object' && event.data.type) {\n                    this.handleBroadcastMessage(event.data, 'window-message');\n                }\n            });\n        }\n    }\n\n    /**\n     * Create a deferred promise\n     */\n    private createDeferred<T>(): { resolve: (value: T) => void; reject: (e: unknown) => void; promise: Promise<T> } {\n        let resolve!: (value: T) => void;\n        let reject!: (e: unknown) => void;\n        const promise = new Promise<T>((res, rej) => {\n            resolve = res;\n            reject = rej;\n        });\n        return { resolve, reject, promise };\n    }\n\n    /**\n     * Get execution context\n     */\n    getExecutionContext(): string {\n        return this.executionContext;\n    }\n\n    /**\n     * Clean up resources\n     */\n    destroy(): void {\n        for (const channel of this.channels.values()) {\n            if (channel instanceof BroadcastChannel) {\n                channel.close();\n            } else if (channel && 'close' in channel) {\n                (channel as OptimizedWorkerChannel).close();\n            }\n        }\n\n        this.channels.clear();\n        this.workerChannels.clear();\n        this.handlers.clear();\n        this.pipelines.clear();\n    }\n}\n\n// ============================================================================\n// SINGLETON FACTORY\n// ============================================================================\n\nlet defaultInstance: UnifiedMessagingManager | null = null;\n\n/**\n * Get the default UnifiedMessagingManager instance\n */\nexport function getUnifiedMessaging(config?: UnifiedMessagingConfig): UnifiedMessagingManager {\n    if (!defaultInstance) {\n        defaultInstance = new UnifiedMessagingManager(config);\n    }\n    return defaultInstance;\n}\n\n/**\n * Create a new UnifiedMessagingManager instance (not cached)\n */\nexport function createUnifiedMessaging(config?: UnifiedMessagingConfig): UnifiedMessagingManager {\n    return new UnifiedMessagingManager(config);\n}\n\n/**\n * Reset the default instance (useful for testing)\n */\nexport function resetUnifiedMessaging(): void {\n    if (defaultInstance) {\n        defaultInstance.destroy();\n        defaultInstance = null;\n    }\n}\n\n// ============================================================================\n// CONVENIENCE FUNCTIONS\n// ============================================================================\n\n/**\n * Send a message using the default manager\n */\nexport function sendMessage(message: Partial<UnifiedMessage> & { type: string; data: unknown }): Promise<boolean> {\n    return getUnifiedMessaging().sendMessage(message);\n}\n\n/**\n * Register a handler using the default manager\n */\nexport function registerHandler(destination: string, handler: MessageHandler): void {\n    getUnifiedMessaging().registerHandler(destination, handler);\n}\n\n/**\n * Get a worker channel using the default manager\n */\nexport function getWorkerChannel(viewHash: string, workerName: string): OptimizedWorkerChannel | null {\n    return getUnifiedMessaging().getWorkerChannel(viewHash, workerName);\n}\n\n/**\n * Get a broadcast channel using the default manager\n */\nexport function getBroadcastChannel(channelName: string): BroadcastChannel {\n    return getUnifiedMessaging().getBroadcastChannel(channelName);\n}\n","/**\n * Centralized naming system for CrossWord application\n * Consolidates component names, channel names, route names, etc.\n */\n\n// ============================================================================\n// BROADCAST CHANNELS\n// ============================================================================\n\n/**\n * Broadcast channel names used throughout the application\n */\nexport const BROADCAST_CHANNELS = {\n    // Service Worker Channels (matching SW implementation)\n    SHARE_TARGET: 'rs-share-target',\n    TOAST: 'rs-toast',\n    CLIPBOARD: 'rs-clipboard',\n\n    // App Component Channels (for AppCommunicator)\n    WORK_CENTER: 'rs-workcenter',\n    MARKDOWN_VIEWER: 'rs-markdown-viewer',\n    SETTINGS: 'rs-settings',\n    GENERAL: 'rs-app-general',\n\n    // Unified Messaging Channels\n    MINIMAL_APP: 'minimal-app',\n    MAIN_APP: 'main-app',\n    FILE_EXPLORER: 'file-explorer',\n    PRINT_VIEWER: 'print-viewer',\n    SETTINGS_VIEWER: 'settings-viewer',\n    HISTORY_VIEWER: 'history-viewer',\n\n    // Additional channels used in routing\n    MARKDOWN_VIEWER_CHANNEL: 'markdown-viewer',\n    FILE_EXPLORER_CHANNEL: 'file-explorer',\n    SETTINGS_CHANNEL: 'settings',\n    HISTORY_CHANNEL: 'history',\n    PRINT_CHANNEL: 'print',\n\n    // Service Channels (new architecture)\n    SERVICE_WORKCENTER: 'rs-service-workcenter',\n    SERVICE_SETTINGS: 'rs-service-settings',\n    SERVICE_VIEWER: 'rs-service-viewer',\n    SERVICE_EXPLORER: 'rs-service-explorer',\n    SERVICE_AIRPAD: 'rs-service-airpad',\n    SERVICE_PRINT: 'rs-service-print',\n    SERVICE_HISTORY: 'rs-service-history',\n    SERVICE_EDITOR: 'rs-service-editor',\n    SERVICE_HOME: 'rs-service-home'\n} as const;\n\n// ============================================================================\n// COMPONENT/MODULE NAMES\n// ============================================================================\n\n/**\n * Component and module identifiers\n */\nexport const COMPONENTS = {\n    // Core Components\n    WORK_CENTER: 'workcenter',\n    MARKDOWN_VIEWER: 'markdown-viewer',\n    MARKDOWN_EDITOR: 'markdown-editor',\n    RICH_EDITOR: 'rich-editor',\n    SETTINGS: 'settings',\n    HISTORY: 'history',\n    FILE_PICKER: 'file-picker',\n    FILE_EXPLORER: 'file-explorer',\n\n    // Sub-components\n    WORKCENTER_CORE: 'workcenter-core',\n    BASIC_WORKCENTER: 'basic-workcenter',\n    BASIC_VIEWER: 'basic-viewer',\n    BASIC_EXPLORER: 'basic-explorer',\n    BASIC_SETTINGS: 'basic-settings',\n    BASIC_HISTORY: 'basic-history',\n    BASIC_PRINT: 'basic-print',\n\n    // New architecture views\n    AIRPAD: 'airpad',\n    HOME: 'home',\n    EDITOR: 'editor',\n    VIEWER: 'viewer',\n    EXPLORER: 'explorer',\n    PRINT: 'print'\n} as const;\n\n// ============================================================================\n// SHELL IDENTIFIERS\n// ============================================================================\n\n/**\n * Shell identifiers for boot/layout selection\n */\nexport const SHELLS = {\n    BASIC: 'basic',\n    FAINT: 'faint',\n    RAW: 'raw'\n} as const;\n\n/**\n * Style system identifiers\n */\nexport const STYLE_SYSTEMS = {\n    VEELA: 'veela',\n    BASIC: 'basic',\n    RAW: 'raw'\n} as const;\n\n// ============================================================================\n// API ENDPOINTS\n// ============================================================================\n\n/**\n * API endpoint paths\n */\nexport const API_ENDPOINTS = {\n    // Processing APIs\n    PROCESSING: '/api/processing',\n    ANALYZE: '/api/analyze',\n    TEST: '/api/test',\n    HEALTH: '/health',\n\n    // Asset proxies\n    PHOSPHOR_ICONS: '/assets/icons/phosphor',\n    ICON_PROXY: '/api/icon-proxy',\n\n    // Content APIs\n    SHARE_TARGET: '/share-target',\n    SHARE_TARGET_ALT: '/share_target',\n    LAUNCH_QUEUE: '/launch-queue',\n\n    // Internal SW APIs\n    SW_CONTENT: '/sw-content',\n    SW_CONTENT_AVAILABLE: '/sw-content/available',\n    CLIPBOARD_PENDING: '/clipboard/pending',\n    CLIPBOARD_CLEAR: '/clipboard/clear'\n} as const;\n\n// ============================================================================\n// ROUTE/HASH IDENTIFIERS\n// ============================================================================\n\n/**\n * Location hash identifiers for app navigation\n */\nexport const ROUTE_HASHES = {\n    // Basic app views\n    MARKDOWN_VIEWER: '#markdown-viewer',\n    MARKDOWN_EDITOR: '#markdown-editor',\n    RICH_EDITOR: '#rich-editor',\n    SETTINGS: '#settings',\n    HISTORY: '#history',\n    WORKCENTER: '#workcenter',\n    FILE_PICKER: '#file-picker',\n    FILE_EXPLORER: '#file-explorer',\n    PRINT: '#print',\n\n    // Work center specific hashes\n    WORKCENTER_FILES: '#workcenter-files',\n    WORKCENTER_TEXT: '#workcenter-text',\n    WORKCENTER_IMAGES: '#workcenter-images',\n    WORKCENTER_PROCESSING: '#workcenter-processing',\n\n    // Share target specific hashes\n    SHARE_TARGET_TEXT: '#share-target-text',\n    SHARE_TARGET_FILES: '#share-target-files',\n    SHARE_TARGET_URL: '#share-target-url',\n    SHARE_TARGET_IMAGE: '#share-target-image'\n} as const;\n\n// ============================================================================\n// DATABASE/STORAGE KEYS\n// ============================================================================\n\n/**\n * IndexedDB and LocalStorage key names\n */\nexport const STORAGE_KEYS = {\n    // Service Worker\n    SW_CACHE_KEYS: 'sw-cache-keys',\n    SW_CONTENT_CACHE: 'sw-content-cache',\n    SHARE_TARGET_DATA: 'share-target-data',\n    SHARE_TARGET_FILES: 'share-target-files',\n    CLIPBOARD_OPERATIONS: 'clipboard-operations',\n\n    // Frontend\n    WORKCENTER_STATE: 'rs-workcenter-state',\n    WORKCENTER_TEMPLATES: 'rs-workcenter-templates',\n    SETTINGS: 'rs-settings',\n    HISTORY: 'rs-history',\n\n    // Theme and UI\n    THEME_PREFERENCES: 'theme-preferences',\n    UI_STATE: 'ui-state'\n} as const;\n\n// ============================================================================\n// MESSAGE TYPES\n// ============================================================================\n\n/**\n * Message types used in broadcast channels and unified messaging\n */\nexport const MESSAGE_TYPES = {\n    // Service Worker Messages\n    SHARE_RECEIVED: 'share-received',\n    SHARE_RESULT: 'share-result',\n    AI_RESULT: 'ai-result',\n    CONTENT_CACHED: 'content-cached',\n    CONTENT_RECEIVED: 'content-received',\n\n    // Clipboard Messages\n    COPY: 'copy',\n    CLIPBOARD_READY: 'clipboard-ready',\n\n    // Work Center Messages\n    SHARE_TARGET_INPUT: 'share-target-input',\n    SHARE_TARGET_RESULT: 'share-target-result',\n    FILES_CHANGED: 'files-changed',\n\n    // Toast Messages\n    SHOW_TOAST: 'show-toast',\n\n    // Ping/Pong\n    PING: 'ping',\n    PONG: 'pong',\n\n    // Content Sharing\n    CONTENT_SHARE: 'content-share',\n    CONTENT_REQUEST: 'content-request'\n} as const;\n\n// ============================================================================\n// CONTENT TYPES AND CONTEXTS\n// ============================================================================\n\n/**\n * Content type identifiers\n */\nexport const CONTENT_TYPES = {\n    TEXT: 'text',\n    URL: 'url',\n    FILE: 'file',\n    IMAGE: 'image',\n    MARKDOWN: 'markdown',\n    HTML: 'html',\n    JSON: 'json',\n    PDF: 'pdf',\n    AUDIO: 'audio',\n    VIDEO: 'video',\n    OTHER: 'other'\n} as const;\n\n/**\n * Content context identifiers\n */\nexport const CONTENT_CONTEXTS = {\n    SHARE_TARGET: 'share-target',\n    LAUNCH_QUEUE: 'launch-queue',\n    PUSH_MESSAGE: 'push-message',\n    BACKGROUND_SYNC: 'background-sync',\n    CLIPBOARD: 'clipboard',\n    DRAG_DROP: 'drag-drop',\n    PASTE: 'paste'\n} as const;\n\n// ============================================================================\n// DESTINATION NAMES\n// ============================================================================\n\n/**\n * Destination identifiers for unified messaging\n */\nexport const DESTINATIONS = {\n    WORKCENTER: 'workcenter',\n    CLIPBOARD: 'clipboard',\n    MARKDOWN_VIEWER: 'markdown-viewer',\n    SETTINGS: 'settings',\n    HISTORY: 'history',\n    FILE_EXPLORER: 'file-explorer',\n    PRINT_VIEWER: 'print-viewer',\n    BASIC_APP: 'basic-app',\n    MAIN_APP: 'main-app'\n} as const;\n\n// ============================================================================\n// UTILITY FUNCTIONS\n// ============================================================================\n\n/**\n * Get broadcast channel name by component\n */\nexport function getChannelForComponent(component: string): string {\n    const channelMap: Record<string, string> = {\n        [COMPONENTS.WORK_CENTER]: BROADCAST_CHANNELS.WORK_CENTER,\n        [COMPONENTS.MARKDOWN_VIEWER]: BROADCAST_CHANNELS.MARKDOWN_VIEWER,\n        [COMPONENTS.SETTINGS]: BROADCAST_CHANNELS.SETTINGS,\n        [COMPONENTS.FILE_EXPLORER]: BROADCAST_CHANNELS.FILE_EXPLORER,\n        [COMPONENTS.WORKCENTER_CORE]: BROADCAST_CHANNELS.SHARE_TARGET,\n        [COMPONENTS.BASIC_WORKCENTER]: BROADCAST_CHANNELS.SHARE_TARGET,\n        'minimal-app': BROADCAST_CHANNELS.MINIMAL_APP,\n        'main-app': BROADCAST_CHANNELS.MAIN_APP\n    };\n\n    return channelMap[component] || BROADCAST_CHANNELS.GENERAL;\n}\n\n/**\n * Get route hash for component\n */\nexport function getHashForComponent(component: string): string {\n    const hashMap: Record<string, string> = {\n        [COMPONENTS.WORK_CENTER]: ROUTE_HASHES.WORKCENTER,\n        [COMPONENTS.MARKDOWN_VIEWER]: ROUTE_HASHES.MARKDOWN_VIEWER,\n        [COMPONENTS.MARKDOWN_EDITOR]: ROUTE_HASHES.MARKDOWN_EDITOR,\n        [COMPONENTS.RICH_EDITOR]: ROUTE_HASHES.RICH_EDITOR,\n        [COMPONENTS.SETTINGS]: ROUTE_HASHES.SETTINGS,\n        [COMPONENTS.HISTORY]: ROUTE_HASHES.HISTORY,\n        [COMPONENTS.FILE_PICKER]: ROUTE_HASHES.FILE_PICKER,\n        [COMPONENTS.FILE_EXPLORER]: ROUTE_HASHES.FILE_EXPLORER\n    };\n\n    return hashMap[component] || '#';\n}\n\n/**\n * Get storage key for component data\n */\nexport function getStorageKeyForComponent(component: string, dataType: string): string {\n    const keyMap: Record<string, Record<string, string>> = {\n        [COMPONENTS.WORK_CENTER]: {\n            state: STORAGE_KEYS.WORKCENTER_STATE,\n            templates: STORAGE_KEYS.WORKCENTER_TEMPLATES\n        },\n        [COMPONENTS.SETTINGS]: {\n            data: STORAGE_KEYS.SETTINGS\n        },\n        [COMPONENTS.HISTORY]: {\n            data: STORAGE_KEYS.HISTORY\n        }\n    };\n\n    return keyMap[component]?.[dataType] || `${component}-${dataType}`;\n}\n\n// ============================================================================\n// TYPE EXPORTS\n// ============================================================================\n\nexport type BroadcastChannelName = typeof BROADCAST_CHANNELS[keyof typeof BROADCAST_CHANNELS];\nexport type ComponentName = typeof COMPONENTS[keyof typeof COMPONENTS];\nexport type RouteHash = typeof ROUTE_HASHES[keyof typeof ROUTE_HASHES];\nexport type StorageKey = typeof STORAGE_KEYS[keyof typeof STORAGE_KEYS];\nexport type MessageType = typeof MESSAGE_TYPES[keyof typeof MESSAGE_TYPES];\nexport type ContentType = typeof CONTENT_TYPES[keyof typeof CONTENT_TYPES];\nexport type ContentContext = typeof CONTENT_CONTEXTS[keyof typeof CONTENT_CONTEXTS];\nexport type Destination = typeof DESTINATIONS[keyof typeof DESTINATIONS];\nexport type ShellName = typeof SHELLS[keyof typeof SHELLS];\nexport type StyleSystemName = typeof STYLE_SYSTEMS[keyof typeof STYLE_SYSTEMS];\nexport type ApiEndpoint = typeof API_ENDPOINTS[keyof typeof API_ENDPOINTS];\n\n// ============================================================================\n// SERVICE CHANNEL MAPPING\n// ============================================================================\n\n/**\n * Map service channel IDs to broadcast channel names\n */\nexport const SERVICE_CHANNEL_MAP: Record<string, string> = {\n    workcenter: BROADCAST_CHANNELS.SERVICE_WORKCENTER,\n    settings: BROADCAST_CHANNELS.SERVICE_SETTINGS,\n    viewer: BROADCAST_CHANNELS.SERVICE_VIEWER,\n    explorer: BROADCAST_CHANNELS.SERVICE_EXPLORER,\n    airpad: BROADCAST_CHANNELS.SERVICE_AIRPAD,\n    print: BROADCAST_CHANNELS.SERVICE_PRINT,\n    history: BROADCAST_CHANNELS.SERVICE_HISTORY,\n    editor: BROADCAST_CHANNELS.SERVICE_EDITOR,\n    home: BROADCAST_CHANNELS.SERVICE_HOME\n} as const;\n\n/**\n * Map view IDs to route hashes\n */\nexport const VIEW_ROUTE_MAP: Record<string, string> = {\n    workcenter: ROUTE_HASHES.WORKCENTER,\n    settings: ROUTE_HASHES.SETTINGS,\n    viewer: ROUTE_HASHES.MARKDOWN_VIEWER,\n    explorer: ROUTE_HASHES.FILE_EXPLORER,\n    airpad: '#airpad',\n    print: ROUTE_HASHES.PRINT,\n    history: ROUTE_HASHES.HISTORY,\n    editor: ROUTE_HASHES.MARKDOWN_EDITOR,\n    home: '#home'\n} as const;","/**\n * Unified AI Configuration and Instructions\n *\n * Centralizes all AI processing rules, instructions, and configurations\n * for consistent behavior across different entry points and modules.\n */\n\nimport type { RecognizeByInstructionsOptions } from '@rs-com/service/service/ProcessingData';\n\n// Import built-in AI instructions and templates\nimport {\n    AI_INSTRUCTIONS,\n    BUILT_IN_AI_ACTIONS,\n} from './BuiltInAI';\n\n// AI Processing Types\nexport type AIProcessingType =\n    | 'solve-and-answer'\n    | 'write-code'\n    | 'extract-css'\n    | 'recognize-content'\n    | 'convert-data'\n    | 'extract-entities'\n    | 'general-processing';\n\n// Content Processing Rules\nexport interface ProcessingRule {\n    type: AIProcessingType;\n    instruction: string;\n    options?: RecognizeByInstructionsOptions;\n    supportedContentTypes: string[];\n    priority: number;\n}\n\n// AI_INSTRUCTIONS imported from BuiltInAI module\n\n// Core content types\nexport type ContentType =\n    | 'file'\n    | 'blob'\n    | 'text'\n    | 'markdown'\n    | 'image'\n    | 'url'\n    | 'base64';\n\n// Content contexts (where content comes from)\nexport type ContentContext =\n    | 'share-target'\n    | 'launch-queue'\n    | 'paste'\n    | 'drag-drop'\n    | 'file-open'\n    | 'url-open'\n    | 'crx-snip'\n    | 'api-upload'\n    | 'initial-load'\n    | 'broadcast';\n\n// Content actions (what to do with the content)\nexport type ContentAction =\n    | 'view'          // Display in appropriate viewer\n    | 'edit'          // Open in editor\n    | 'attach'        // Attach to work center\n    | 'process'       // Process with AI\n    | 'save'          // Save to explorer\n    | 'print'         // Send to print\n    | 'clipboard';    // Copy to clipboard\n\n// Association override factors for content routing\nexport type AssociationOverrideFactor =\n    | 'explicit-workcenter'\n    | 'explicit-viewer'\n    | 'explicit-explorer'\n    | 'force-attachment'\n    | 'force-processing'\n    | 'bypass-default'\n    | 'user-action';\n\n// Unified Processing Configuration\nexport interface UnifiedProcessingConfig {\n    processingUrl: string;\n    contentAction: {\n        onResult: string;\n        onAccept: string;\n        doProcess: string;\n        openApp?: boolean;\n    };\n    supportedContentTypes?: string[];\n    defaultOverrideFactors?: AssociationOverrideFactor[];\n    associationOverrides?: Record<string, AssociationOverrideFactor[]>;\n}\n\n// Unified Processing Rules for different entry points\nexport const UNIFIED_PROCESSING_RULES: Record<string, UnifiedProcessingConfig> = {\n    \"share-target\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"write-clipboard\",\n            onAccept: \"attach-to-associated\",\n            doProcess: \"instantly\",\n            openApp: true\n        },\n        supportedContentTypes: [\"text\", \"markdown\", \"image\", \"url\"],\n        defaultOverrideFactors: [] // Use default associations\n    },\n    \"launch-queue\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"none\",\n            onAccept: \"attach-to-associated\",\n            doProcess: \"manually\",\n            openApp: true\n        },\n        supportedContentTypes: [\"file\", \"blob\", \"text\", \"markdown\", \"image\"],\n        defaultOverrideFactors: [] // Use default associations\n    },\n    \"crx-snip\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"write-clipboard\",\n            onAccept: \"attach-to-associated\",\n            doProcess: \"instantly\",\n            openApp: false // Don't open PWA for background processing\n        },\n        supportedContentTypes: [\"text\", \"image\"],\n        defaultOverrideFactors: [\"force-processing\"] // Force processing for CRX snips\n    },\n    \"paste\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"none\",\n            onAccept: \"attach-to-associated\",\n            doProcess: \"manually\",\n            openApp: false\n        },\n        supportedContentTypes: [\"text\", \"markdown\", \"image\"],\n        defaultOverrideFactors: [],\n        associationOverrides: {\n            // When user explicitly pastes and wants to process, override defaults\n            \"text\": [\"user-action\"],\n            \"markdown\": [\"user-action\"]\n        }\n    },\n    \"drop\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"none\",\n            onAccept: \"attach-to-associated\",\n            doProcess: \"manually\",\n            openApp: false\n        },\n        supportedContentTypes: [\"file\", \"blob\", \"text\", \"markdown\", \"image\"],\n        defaultOverrideFactors: [],\n        associationOverrides: {\n            // When user drops files explicitly, treat as user action\n            \"file\": [\"user-action\"],\n            \"blob\": [\"user-action\"]\n        }\n    },\n    \"button-attach-workcenter\": {\n        processingUrl: \"/api/processing\",\n        contentAction: {\n            onResult: \"none\",\n            onAccept: \"attach-to-workcenter\",\n            doProcess: \"manually\",\n            openApp: false\n        },\n        supportedContentTypes: [\"text\", \"markdown\", \"image\", \"file\"],\n        defaultOverrideFactors: [\"explicit-workcenter\"], // Always override to workcenter\n        associationOverrides: {\n            // Explicit button clicks always go to workcenter\n            \"markdown\": [\"explicit-workcenter\"], // Override default viewer association\n            \"text\": [\"explicit-workcenter\"],     // Override default viewer association\n            \"image\": [\"explicit-workcenter\"],    // Already goes to workcenter, but explicit\n            \"file\": [\"explicit-workcenter\"]      // Override file-explorer association\n        }\n    }\n};\n\n// Backward compatibility - keep the old format\nexport const processingRules = Object.fromEntries(\n    Object.entries(UNIFIED_PROCESSING_RULES).map(([key, config]) => [\n        key,\n        {\n            processingUrl: config.processingUrl,\n            contentAction: config.contentAction,\n            ...(config.supportedContentTypes && { supportedContentTypes: config.supportedContentTypes })\n        }\n    ])\n);\n\n// AI Processing Rules Configuration (auto-generated from BUILT_IN_AI_ACTIONS)\nconst AI_PROCESSING_TYPES: readonly AIProcessingType[] = [\n    'solve-and-answer',\n    'write-code',\n    'extract-css',\n    'recognize-content',\n    'convert-data',\n    'extract-entities',\n    'general-processing'\n] as const;\n\nconst toAIProcessingType = (id: string): AIProcessingType | null => {\n    const normalized = String(id || '').toLowerCase().replace(/_/g, '-') as AIProcessingType;\n    return (AI_PROCESSING_TYPES as readonly string[]).includes(normalized) ? normalized : null;\n};\n\nexport const PROCESSING_RULES: ProcessingRule[] = BUILT_IN_AI_ACTIONS\n    .map(action => {\n        const type = toAIProcessingType(action.id);\n        if (!type) return null;\n        return {\n            type,\n            instruction: AI_INSTRUCTIONS[action.instructionKey],\n            supportedContentTypes: action.supportedContentTypes,\n            priority: action.priority\n        } satisfies ProcessingRule;\n    })\n    .filter((v): v is ProcessingRule => Boolean(v));\n\n// Content Type Mappings\nexport const CONTENT_TYPE_MAPPINGS = {\n    // File extensions to MIME types\n    extensions: {\n        '.md': 'text/markdown',\n        '.markdown': 'text/markdown',\n        '.txt': 'text/plain',\n        '.html': 'text/html',\n        '.css': 'text/css',\n        '.js': 'application/javascript',\n        '.ts': 'application/typescript',\n        '.json': 'application/json',\n        '.xml': 'application/xml',\n        '.csv': 'text/csv',\n        '.pdf': 'application/pdf',\n        '.png': 'image/png',\n        '.jpg': 'image/jpeg',\n        '.jpeg': 'image/jpeg',\n        '.gif': 'image/gif',\n        '.svg': 'image/svg+xml',\n        '.webp': 'image/webp'\n    },\n\n    // MIME type to processing type mapping\n    mimeToProcessing: {\n        'text/markdown': 'general-processing',\n        'text/plain': 'general-processing',\n        'text/html': 'extract-css',\n        'text/css': 'extract-css',\n        'application/javascript': 'write-code',\n        'application/typescript': 'write-code',\n        'application/json': 'convert-data',\n        'application/xml': 'convert-data',\n        'text/csv': 'convert-data',\n        'application/pdf': 'recognize-content',\n        'image/png': 'recognize-content',\n        'image/jpeg': 'recognize-content',\n        'image/gif': 'recognize-content',\n        'image/svg+xml': 'extract-css',\n        'image/webp': 'recognize-content'\n    } as Record<string, AIProcessingType>\n};\n\n// Processing Configuration\nexport interface ProcessingConfig {\n    maxRetries: number;\n    timeoutMs: number;\n    enableCaching: boolean;\n    enableStreaming: boolean;\n    defaultLanguage: string;\n    supportedLanguages: string[];\n}\n\n// Default processing configuration\nexport const DEFAULT_PROCESSING_CONFIG: ProcessingConfig = {\n    maxRetries: 3,\n    timeoutMs: 30000,\n    enableCaching: true,\n    enableStreaming: false,\n    defaultLanguage: 'en',\n    supportedLanguages: ['en', 'es', 'fr', 'de', 'it', 'pt', 'ru', 'zh', 'ja', 'ko']\n};\n\n// Utility Functions\n\n/**\n * Get the appropriate processing rule for content type and operation\n */\nexport function getProcessingRule(\n    contentType: string,\n    requestedType?: AIProcessingType\n): ProcessingRule | null {\n    // If specific type requested, try to find it\n    if (requestedType) {\n        const rule = PROCESSING_RULES.find(r => r.type === requestedType);\n        if (rule && (rule.supportedContentTypes.includes(contentType) || rule.supportedContentTypes.includes('*'))) {\n            return rule;\n        }\n    }\n\n    // Otherwise, find best match based on content type and priority\n    const matchingRules = PROCESSING_RULES\n        .filter(rule => rule.supportedContentTypes.includes(contentType) || rule.supportedContentTypes.includes('*'))\n        .sort((a, b) => b.priority - a.priority);\n\n    return matchingRules[0] || null;\n}\n\n/**\n * Get MIME type from file extension\n */\nexport function getMimeTypeFromExtension(filename: string): string {\n    const extension = filename.toLowerCase().substring(filename.lastIndexOf('.'));\n    return CONTENT_TYPE_MAPPINGS.extensions[extension] || 'application/octet-stream';\n}\n\n/**\n * Get processing type from MIME type\n */\nexport function getProcessingTypeFromMime(mimeType: string): AIProcessingType {\n    return CONTENT_TYPE_MAPPINGS.mimeToProcessing[mimeType] || 'general-processing';\n}\n\n/**\n * Get processing type from file\n */\nexport function getProcessingTypeFromFile(file: File): AIProcessingType {\n    const mimeType = file.type || getMimeTypeFromExtension(file.name);\n    return getProcessingTypeFromMime(mimeType);\n}\n\n/**\n * Create processing options with defaults\n */\nexport function createProcessingOptions(\n    overrides: Partial<RecognizeByInstructionsOptions> = {}\n): RecognizeByInstructionsOptions {\n    // RecognizeByInstructionsOptions currently only supports instruction + verbosity/effort knobs.\n    // Keep this helper for forward compatibility, but only return supported keys.\n    return { ...overrides };\n}\n\n/**\n * Validate content for processing\n */\nexport function validateContentForProcessing(\n    content: any,\n    contentType: string\n): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    if (!content) {\n        errors.push('Content is required');\n    }\n\n    if (!contentType) {\n        errors.push('Content type is required');\n    }\n\n    // Type-specific validation\n    switch (contentType) {\n        case 'text':\n        case 'markdown':\n            if (typeof content !== 'string' || content.trim().length === 0) {\n                errors.push('Text content must be a non-empty string');\n            }\n            break;\n        case 'file':\n            if (!(content instanceof File)) {\n                errors.push('File content must be a File object');\n            }\n            break;\n        case 'blob':\n            if (!(content instanceof Blob)) {\n                errors.push('Blob content must be a Blob object');\n            }\n            break;\n        case 'base64':\n            if (typeof content !== 'string' || !content.match(/^data:[^;]+;base64,/)) {\n                errors.push('Base64 content must be a valid data URL');\n            }\n            break;\n    }\n\n    return {\n        valid: errors.length === 0,\n        errors\n    };\n}","/**\n * Unified Messaging System for CrossWord\n * Extends fest/uniform messaging with app-specific configuration\n */\n\nimport {\n    UnifiedMessagingManager,\n    getUnifiedMessaging as getBaseMessaging,\n    sendMessage as baseSendMessage,\n    type UnifiedMessage,\n    type MessageHandler,\n    type WorkerChannelConfig,\n    type PipelineConfig,\n    type PipelineStage,\n    type UnifiedMessagingConfig\n} from 'fest/uniform';\n\nimport {\n    BROADCAST_CHANNELS,\n    CONTENT_TYPES,\n    DESTINATIONS,\n} from '@rs-com/config/Names';\n\nimport { resolveAssociation, resolveAssociationPipeline } from './ContentAssociations';\n\n// Re-export types for consumers\nexport type {\n    UnifiedMessage,\n    MessageHandler,\n    WorkerChannelConfig,\n    PipelineConfig,\n    PipelineStage,\n    UnifiedMessagingConfig\n};\n\n// ============================================================================\n// APP-SPECIFIC CHANNEL MAPPINGS\n// ============================================================================\n\nconst APP_CHANNEL_MAPPINGS: Record<string, string> = {\n    [DESTINATIONS.WORKCENTER]: BROADCAST_CHANNELS.WORK_CENTER,\n    [DESTINATIONS.CLIPBOARD]: BROADCAST_CHANNELS.CLIPBOARD,\n    [DESTINATIONS.MARKDOWN_VIEWER]: BROADCAST_CHANNELS.MARKDOWN_VIEWER,\n    [DESTINATIONS.SETTINGS]: BROADCAST_CHANNELS.SETTINGS,\n    [DESTINATIONS.FILE_EXPLORER]: BROADCAST_CHANNELS.FILE_EXPLORER,\n    [DESTINATIONS.PRINT_VIEWER]: BROADCAST_CHANNELS.PRINT_VIEWER\n};\n\n// ============================================================================\n// APP-SPECIFIC MESSAGING MANAGER\n// ============================================================================\n\nlet appMessagingInstance: UnifiedMessagingManager | null = null;\n\n/**\n * Get the app-configured UnifiedMessagingManager\n */\nexport function getUnifiedMessaging(): UnifiedMessagingManager {\n    if (!appMessagingInstance) {\n        appMessagingInstance = getBaseMessaging({\n            channelMappings: APP_CHANNEL_MAPPINGS,\n            queueOptions: {\n                dbName: 'CrossWordMessageQueue',\n                storeName: 'messages',\n                maxRetries: 3,\n                defaultExpirationMs: 24 * 60 * 60 * 1000 // 24 hours\n            },\n            pendingStoreOptions: {\n                storageKey: 'rs-unified-messaging-pending',\n                maxMessages: 200,\n                defaultTTLMs: 24 * 60 * 60 * 1000 // 24 hours\n            }\n        });\n    }\n    return appMessagingInstance;\n}\n\n// Singleton instance for backward compatibility\nexport const unifiedMessaging = getUnifiedMessaging();\n\n// ============================================================================\n// CONVENIENCE FUNCTIONS\n// ============================================================================\n\n/**\n * Send a message using the app-configured manager\n */\nexport function sendMessage(message: Omit<UnifiedMessage, 'id' | 'source'> & { source?: string }): Promise<boolean> {\n    return unifiedMessaging.sendMessage({\n        ...message,\n        source: message.source ?? 'unified-messaging'\n    } as UnifiedMessage);\n}\n\n/**\n * Register a handler using the app-configured manager\n */\nexport function registerHandler(destination: string, handler: MessageHandler): void {\n    unifiedMessaging.registerHandler(destination, handler);\n}\n\nexport function unregisterHandler(destination: string, handler: MessageHandler): void {\n    unifiedMessaging.unregisterHandler(destination, handler);\n}\n\n/**\n * Get a worker channel from the app manager\n */\nexport function getWorkerChannel(viewHash: string, workerName: string) {\n    return unifiedMessaging.getWorkerChannel(viewHash, workerName);\n}\n\n/**\n * Get a broadcast channel from the app manager\n */\nexport function getBroadcastChannel(channelName: string): BroadcastChannel {\n    return unifiedMessaging.getBroadcastChannel(channelName);\n}\n\n// ============================================================================\n// BACKWARD COMPATIBILITY FUNCTIONS\n// ============================================================================\n\nexport function sendToWorkCenter(data: unknown, options?: Record<string, unknown>): Promise<boolean> {\n    return sendMessage({\n        type: 'content-share',\n        source: 'unified-messaging',\n        destination: DESTINATIONS.WORKCENTER,\n        data,\n        metadata: options\n    });\n}\n\nexport function sendToClipboard(data: unknown, options?: Record<string, unknown>): Promise<boolean> {\n    return sendMessage({\n        type: 'clipboard-copy',\n        source: 'unified-messaging',\n        destination: DESTINATIONS.CLIPBOARD,\n        data,\n        metadata: options\n    });\n}\n\nexport function navigateToView(view: string): Promise<boolean> {\n    return sendMessage({\n        type: 'navigation',\n        source: 'unified-messaging',\n        destination: 'router',\n        data: { view },\n        metadata: { priority: 'high' }\n    });\n}\n\nexport function initializeComponent(componentId: string): UnifiedMessage[] {\n    return unifiedMessaging.initializeComponent(componentId);\n}\n\nexport function hasPendingMessages(destination: string): boolean {\n    return unifiedMessaging.hasPendingMessages(destination);\n}\n\nexport function enqueuePendingMessage(destination: string, message: UnifiedMessage): void {\n    const dest = String(destination ?? '').trim();\n    if (!dest || !message) return;\n    unifiedMessaging.enqueuePendingMessage(dest, message);\n}\n\nexport function registerComponent(componentId: string, destination: string): void {\n    unifiedMessaging.registerComponent(componentId, destination);\n}\n\n// ============================================================================\n// CONTENT PROCESSING (APP-SPECIFIC)\n// ============================================================================\n\nexport function processInitialContent(content: Record<string, unknown>): Promise<void> {\n    const contentType = String(content?.contentType ?? content?.type ?? CONTENT_TYPES.OTHER);\n    const resolved = resolveAssociationPipeline({\n        contentType,\n        context: content?.context as string | undefined,\n        processingSource: content?.processingSource as string | undefined,\n        overrideFactors: (content?.overrideFactors ?? content?.metadata?.overrideFactors) as string[] | undefined\n    });\n\n    const payload = content?.content ?? content?.data ?? content;\n    const meta = (content?.metadata ?? {}) as Record<string, unknown>;\n\n    const source = String(content?.source ?? meta?.source ?? 'content-association');\n    const tasks = resolved.pipeline.map((dest) => {\n        if (dest === \"basic-viewer\") {\n            return sendMessage({\n                type: 'content-view',\n                source,\n                destination: 'basic-viewer',\n                contentType: resolved.normalizedContentType,\n                data: {\n                    content: (payload as Record<string, unknown>)?.text ?? (payload as Record<string, unknown>)?.content ?? payload,\n                    text: (payload as Record<string, unknown>)?.text,\n                    filename: (payload as Record<string, unknown>)?.filename ?? meta?.filename,\n                },\n                metadata: {\n                    ...meta,\n                    overrideFactors: resolved.overrideFactors,\n                    context: content?.context,\n                    processingSource: content?.processingSource\n                }\n            });\n        }\n\n        if (dest === \"basic-explorer\") {\n            return sendMessage({\n                type: 'content-explorer',\n                source,\n                destination: 'basic-explorer',\n                contentType: resolved.normalizedContentType,\n                data: {\n                    action: 'save',\n                    ...(payload as Record<string, unknown>),\n                },\n                metadata: {\n                    ...meta,\n                    overrideFactors: resolved.overrideFactors,\n                    context: content?.context,\n                    processingSource: content?.processingSource\n                }\n            });\n        }\n\n        // Default: attach into workcenter\n        return sendMessage({\n            type: 'content-share',\n            source,\n            destination: 'basic-workcenter',\n            contentType: resolved.normalizedContentType,\n            data: payload,\n            metadata: {\n                ...meta,\n                overrideFactors: resolved.overrideFactors,\n                context: content?.context,\n                processingSource: content?.processingSource\n            }\n        });\n    });\n\n    return Promise.allSettled(tasks).then(() => {});\n}\n\n// ============================================================================\n// MESSAGE CREATION HELPERS\n// ============================================================================\n\nexport function createMessageWithOverrides(\n    type: string,\n    source: string,\n    contentType: string,\n    data: unknown,\n    overrideFactors: string[] = [],\n    processingSource?: string\n): UnifiedMessage {\n    const resolved = resolveAssociation({\n        contentType,\n        context: processingSource,\n        processingSource,\n        overrideFactors\n    });\n\n    return {\n        id: crypto.randomUUID(),\n        type,\n        source,\n        destination: resolved.destination === \"basic-viewer\"\n            ? 'basic-viewer'\n            : resolved.destination === \"basic-explorer\"\n                ? 'basic-explorer'\n                : 'basic-workcenter',\n        contentType,\n        data,\n        metadata: {\n            timestamp: Date.now(),\n            overrideFactors,\n            processingSource,\n            priority: 'normal'\n        }\n    };\n}\n"],"names":["getUnifiedMessaging","getBaseMessaging"],"mappings":"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"}